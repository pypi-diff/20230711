# Comparing `tmp/black-23.3.0.tar.gz` & `tmp/black-23.7.0.tar.gz`

## Comparing `black-23.3.0.tar` & `black-23.7.0.tar`

### file list

```diff
@@ -1,335 +1,342 @@
--rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 black-23.3.0/.coveragerc
--rw-r--r--   0        0        0      360 2020-02-02 00:00:00.000000 black-23.3.0/.flake8
--rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-23.3.0/.git_archival.txt
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.3.0/.gitattributes
--rw-r--r--   0        0        0     1987 2020-02-02 00:00:00.000000 black-23.3.0/.pre-commit-config.yaml
--rw-r--r--   0        0        0      523 2020-02-02 00:00:00.000000 black-23.3.0/.pre-commit-hooks.yaml
--rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-23.3.0/.prettierrc.yaml
--rw-r--r--   0        0        0      220 2020-02-02 00:00:00.000000 black-23.3.0/.readthedocs.yaml
--rw-r--r--   0        0        0    49375 2020-02-02 00:00:00.000000 black-23.3.0/CHANGES.md
--rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-23.3.0/CONTRIBUTING.md
--rw-r--r--   0        0        0      587 2020-02-02 00:00:00.000000 black-23.3.0/Dockerfile
--rw-r--r--   0        0        0     9766 2020-02-02 00:00:00.000000 black-23.3.0/README.md
--rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-23.3.0/SECURITY.md
--rw-r--r--   0        0        0     1538 2020-02-02 00:00:00.000000 black-23.3.0/action.yml
--rw-r--r--   0        0        0      795 2020-02-02 00:00:00.000000 black-23.3.0/mypy.ini
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-23.3.0/test_requirements.txt
--rw-r--r--   0        0        0     2971 2020-02-02 00:00:00.000000 black-23.3.0/tox.ini
--rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-23.3.0/.github/CODE_OF_CONDUCT.md
--rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-23.3.0/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-23.3.0/.github/dependabot.yml
--rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-23.3.0/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-23.3.0/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-23.3.0/.github/ISSUE_TEMPLATE/docs-issue.md
--rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-23.3.0/.github/ISSUE_TEMPLATE/feature_request.md
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-23.3.0/.github/ISSUE_TEMPLATE/style_issue.md
--rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/changelog.yml
--rw-r--r--   0        0        0     5301 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/diff_shades.yml
--rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/diff_shades_comment.yml
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/doc.yml
--rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/docker.yml
--rw-r--r--   0        0        0     1127 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/fuzz.yml
--rw-r--r--   0        0        0     1231 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/lint.yml
--rw-r--r--   0        0        0     2333 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/pypi_upload.yml
--rw-r--r--   0        0        0     2994 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/test.yml
--rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-23.3.0/.github/workflows/upload_binary.yml
--rw-r--r--   0        0        0     2241 2020-02-02 00:00:00.000000 black-23.3.0/action/main.py
--rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-23.3.0/autoload/black.vim
--rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-23.3.0/docs/Makefile
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.3.0/docs/authors.md
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.3.0/docs/change_log.md
--rw-r--r--   0        0        0     6673 2020-02-02 00:00:00.000000 black-23.3.0/docs/conf.py
--rw-r--r--   0        0        0     5843 2020-02-02 00:00:00.000000 black-23.3.0/docs/faq.md
--rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 black-23.3.0/docs/getting_started.md
--rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-23.3.0/docs/index.md
--rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-23.3.0/docs/license.md
--rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-23.3.0/docs/make.bat
--rw-r--r--   0        0        0      258 2020-02-02 00:00:00.000000 black-23.3.0/docs/requirements.txt
--rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-23.3.0/docs/_static/license.svg
--rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-23.3.0/docs/_static/logo2-readme.png
--rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-23.3.0/docs/_static/logo2.png
--rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-23.3.0/docs/_static/pypi_template.svg
--rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/flake8/.flake8
--rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/flake8/setup.cfg
--rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/flake8/tox.ini
--rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/isort/.editorconfig
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/isort/.isort.cfg
--rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/isort/pyproject.toml
--rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/isort/setup.cfg
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/pylint/pylintrc
--rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/pylint/pyproject.toml
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-23.3.0/docs/compatible_configs/pylint/setup.cfg
--rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/gauging_changes.md
--rw-r--r--   0        0        0     1528 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/index.md
--rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/issue_triage.md
--rw-r--r--   0        0        0     8585 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/release_process.md
--rw-r--r--   0        0        0     2520 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/the_basics.md
--rw-r--r--   0        0        0     1302 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/reference/reference_classes.rst
--rw-r--r--   0        0        0      225 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/reference/reference_exceptions.rst
--rw-r--r--   0        0        0     4010 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/reference/reference_functions.rst
--rw-r--r--   0        0        0      338 2020-02-02 00:00:00.000000 black-23.3.0/docs/contributing/reference/reference_summary.rst
--rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-23.3.0/docs/guides/index.md
--rw-r--r--   0        0        0     2309 2020-02-02 00:00:00.000000 black-23.3.0/docs/guides/introducing_black_to_your_project.md
--rw-r--r--   0        0        0     7023 2020-02-02 00:00:00.000000 black-23.3.0/docs/guides/using_black_with_other_tools.md
--rw-r--r--   0        0        0    14185 2020-02-02 00:00:00.000000 black-23.3.0/docs/integrations/editors.md
--rw-r--r--   0        0        0     2255 2020-02-02 00:00:00.000000 black-23.3.0/docs/integrations/github_actions.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-23.3.0/docs/integrations/index.md
--rw-r--r--   0        0        0     1198 2020-02-02 00:00:00.000000 black-23.3.0/docs/integrations/source_version_control.md
--rw-r--r--   0        0        0    21411 2020-02-02 00:00:00.000000 black-23.3.0/docs/the_black_code_style/current_style.md
--rw-r--r--   0        0        0     4527 2020-02-02 00:00:00.000000 black-23.3.0/docs/the_black_code_style/future_style.md
--rw-r--r--   0        0        0     2197 2020-02-02 00:00:00.000000 black-23.3.0/docs/the_black_code_style/index.md
--rw-r--r--   0        0        0     4258 2020-02-02 00:00:00.000000 black-23.3.0/docs/usage_and_configuration/black_as_a_server.md
--rw-r--r--   0        0        0     2092 2020-02-02 00:00:00.000000 black-23.3.0/docs/usage_and_configuration/black_docker_image.md
--rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-23.3.0/docs/usage_and_configuration/file_collection_and_discovery.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-23.3.0/docs/usage_and_configuration/index.md
--rw-r--r--   0        0        0    10160 2020-02-02 00:00:00.000000 black-23.3.0/docs/usage_and_configuration/the_basics.md
--rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-23.3.0/gallery/Dockerfile
--rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-23.3.0/gallery/README.md
--rwxr-xr-x   0        0        0     9119 2020-02-02 00:00:00.000000 black-23.3.0/gallery/gallery.py
--rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-23.3.0/plugin/black.vim
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/scripts/__init__.py
--rw-r--r--   0        0        0     1831 2020-02-02 00:00:00.000000 black-23.3.0/scripts/check_pre_commit_rev_in_example.py
--rw-r--r--   0        0        0     1510 2020-02-02 00:00:00.000000 black-23.3.0/scripts/check_version_in_basics_example.py
--rw-r--r--   0        0        0     8647 2020-02-02 00:00:00.000000 black-23.3.0/scripts/diff_shades_gha_helper.py
--rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-23.3.0/scripts/fuzz.py
--rw-r--r--   0        0        0     2455 2020-02-02 00:00:00.000000 black-23.3.0/scripts/make_width_table.py
--rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-23.3.0/scripts/migrate-black.py
--rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-23.3.0/src/_black_version.py
--rw-r--r--   0        0        0    46682 2020-02-02 00:00:00.000000 black-23.3.0/src/black/__init__.py
--rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-23.3.0/src/black/__main__.py
--rw-r--r--   0        0        0    10871 2020-02-02 00:00:00.000000 black-23.3.0/src/black/_width_table.py
--rw-r--r--   0        0        0    12273 2020-02-02 00:00:00.000000 black-23.3.0/src/black/brackets.py
--rw-r--r--   0        0        0     2946 2020-02-02 00:00:00.000000 black-23.3.0/src/black/cache.py
--rw-r--r--   0        0        0    12792 2020-02-02 00:00:00.000000 black-23.3.0/src/black/comments.py
--rw-r--r--   0        0        0     6286 2020-02-02 00:00:00.000000 black-23.3.0/src/black/concurrency.py
--rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 black-23.3.0/src/black/const.py
--rw-r--r--   0        0        0     1594 2020-02-02 00:00:00.000000 black-23.3.0/src/black/debug.py
--rw-r--r--   0        0        0    13448 2020-02-02 00:00:00.000000 black-23.3.0/src/black/files.py
--rw-r--r--   0        0        0    13501 2020-02-02 00:00:00.000000 black-23.3.0/src/black/handle_ipynb_magics.py
--rw-r--r--   0        0        0    60263 2020-02-02 00:00:00.000000 black-23.3.0/src/black/linegen.py
--rw-r--r--   0        0        0    36523 2020-02-02 00:00:00.000000 black-23.3.0/src/black/lines.py
--rw-r--r--   0        0        0     7229 2020-02-02 00:00:00.000000 black-23.3.0/src/black/mode.py
--rw-r--r--   0        0        0    25698 2020-02-02 00:00:00.000000 black-23.3.0/src/black/nodes.py
--rw-r--r--   0        0        0     1653 2020-02-02 00:00:00.000000 black-23.3.0/src/black/numerics.py
--rw-r--r--   0        0        0     3486 2020-02-02 00:00:00.000000 black-23.3.0/src/black/output.py
--rw-r--r--   0        0        0    10198 2020-02-02 00:00:00.000000 black-23.3.0/src/black/parsing.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/src/black/py.typed
--rw-r--r--   0        0        0     3451 2020-02-02 00:00:00.000000 black-23.3.0/src/black/report.py
--rw-r--r--   0        0        0      556 2020-02-02 00:00:00.000000 black-23.3.0/src/black/rusty.py
--rw-r--r--   0        0        0    11198 2020-02-02 00:00:00.000000 black-23.3.0/src/black/strings.py
--rw-r--r--   0        0        0    90830 2020-02-02 00:00:00.000000 black-23.3.0/src/black/trans.py
--rw-r--r--   0        0        0     8068 2020-02-02 00:00:00.000000 black-23.3.0/src/blackd/__init__.py
--rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-23.3.0/src/blackd/__main__.py
--rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-23.3.0/src/blackd/middlewares.py
--rw-r--r--   0        0        0    11278 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/Grammar.txt
--rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/LICENSE
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/PatternGrammar.txt
--rw-r--r--   0        0        0     1071 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/README
--rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/__init__.py
--rw-r--r--   0        0        0     5732 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pygram.py
--rw-r--r--   0        0        0    32612 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pytree.py
--rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/__init__.py
--rw-r--r--   0        0        0     9607 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/conv.py
--rw-r--r--   0        0        0    10671 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/driver.py
--rw-r--r--   0        0        0     6873 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/grammar.py
--rw-r--r--   0        0        0     1628 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/literals.py
--rw-r--r--   0        0        0    14859 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/parse.py
--rw-r--r--   0        0        0    15491 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/pgen.py
--rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/token.py
--rw-r--r--   0        0        0    22842 2020-02-02 00:00:00.000000 black-23.3.0/src/blib2to3/pgen2/tokenize.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/__init__.py
--rw-r--r--   0        0        0       36 2020-02-02 00:00:00.000000 black-23.3.0/tests/conftest.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.3.0/tests/empty.toml
--rw-r--r--   0        0        0     4133 2020-02-02 00:00:00.000000 black-23.3.0/tests/optional.py
--rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-23.3.0/tests/test.toml
--rw-r--r--   0        0        0   100992 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_black.py
--rw-r--r--   0        0        0     9172 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_blackd.py
--rw-r--r--   0        0        0     7460 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_format.py
--rw-r--r--   0        0        0    16267 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_ipynb.py
--rw-r--r--   0        0        0     1289 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_no_ipynb.py
--rw-r--r--   0        0        0     2237 2020-02-02 00:00:00.000000 black-23.3.0/tests/test_trans.py
--rw-r--r--   0        0        0     6893 2020-02-02 00:00:00.000000 black-23.3.0/tests/util.py
--rw-r--r--   0        0        0     4160 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/conditional_expression.py
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/empty_pyproject.toml
--rw-r--r--   0        0        0      498 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/fast/pep_572_do_not_remove_parens.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/ignore_subfolders_gitignore_tests/a.py
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
--rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/.gitignore
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/include_exclude_tests/b/exclude/a.pyi
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_gitignore_tests/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_nested_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/invalid_nested_gitignore_tests/a/a.py
--rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/non_python_notebook.ipynb
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/notebook_empty_metadata.ipynb
--rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
--rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
--rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/jupyter/notebook_without_changes.ipynb
--rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/async_as_identifier.py
--rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/blackd_diff.diff
--rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/blackd_diff.py
--rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/debug_visitor.out
--rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/debug_visitor.py
--rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/decorators.py
--rw-r--r--   0        0        0     3601 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/docstring_no_string_normalization.py
--rw-r--r--   0        0        0      357 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
--rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
--rw-r--r--   0        0        0      598 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/force_py36.py
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/force_pyi.py
--rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/invalid_header.py
--rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/linelength6.py
--rw-r--r--   0        0        0    11578 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/long_strings_flag_disabled.py
--rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/missing_final_newline.diff
--rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/missing_final_newline.py
--rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/nested_class_stub.pyi
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/pattern_matching_invalid.py
--rw-r--r--   0        0        0       69 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/power_op_newline.py
--rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/python2_detection.py
--rw-r--r--   0        0        0     2361 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/string_quotes.py
--rw-r--r--   0        0        0     2266 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/miscellaneous/stub.pyi
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/x.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/a.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/c.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/child/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/child/a.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/child/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/nested_gitignore_tests/root/child/c.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/async_stmts.py
--rw-r--r--   0        0        0     4147 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/cantfit.py
--rw-r--r--   0        0        0     8290 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/comments7.py
--rw-r--r--   0        0        0      613 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/format_unicode_escape_seq.py
--rw-r--r--   0        0        0     2784 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_dict_values.py
--rw-r--r--   0        0        0    33380 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_strings.py
--rw-r--r--   0        0        0     1418 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_strings__east_asian_width.py
--rw-r--r--   0        0        0     6536 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_strings__edge_case.py
--rw-r--r--   0        0        0    45997 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_strings__regression.py
--rw-r--r--   0        0        0     1077 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/long_strings__type_annotations.py
--rw-r--r--   0        0        0     7199 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/multiline_strings.py
--rw-r--r--   0        0        0      481 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/percent_precedence.py
--rw-r--r--   0        0        0     2525 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/prefer_rhs_split.py
--rw-r--r--   0        0        0      334 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/return_annotation_brackets_string.py
--rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview/trailing_comma.py
--rw-r--r--   0        0        0     1140 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/targeting_py38.py
--rw-r--r--   0        0        0     3361 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/targeting_py39.py
--rw-r--r--   0        0        0      595 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_10.py
--rw-r--r--   0        0        0      553 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_11.py
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_8.py
--rw-r--r--   0        0        0      623 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_9.py
--rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/project_metadata/both_pyproject.toml
--rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/project_metadata/neither_pyproject.toml
--rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/project_metadata/only_black_pyproject.toml
--rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/project_metadata/only_metadata_pyproject.toml
--rw-r--r--   0        0        0      765 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/parenthesized_context_managers.py
--rw-r--r--   0        0        0     2668 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pattern_matching_complex.py
--rw-r--r--   0        0        0     1965 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pattern_matching_extras.py
--rw-r--r--   0        0        0     3066 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pattern_matching_generic.py
--rw-r--r--   0        0        0     2641 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pattern_matching_simple.py
--rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pattern_matching_style.py
--rw-r--r--   0        0        0      491 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/pep_572_py310.py
--rw-r--r--   0        0        0      509 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/remove_newline_after_match.py
--rw-r--r--   0        0        0      380 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_310/starred_for_target.py
--rw-r--r--   0        0        0     2114 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_311/pep_646.py
--rw-r--r--   0        0        0      972 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_311/pep_654.py
--rw-r--r--   0        0        0     2033 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_311/pep_654_style.py
--rw-r--r--   0        0        0      597 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_36/numeric_literals.py
--rw-r--r--   0        0        0      267 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_36/numeric_literals_skip_underscores.py
--rw-r--r--   0        0        0     1199 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_37/python37.py
--rw-r--r--   0        0        0      680 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_38/pep_570.py
--rw-r--r--   0        0        0      970 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_38/pep_572.py
--rw-r--r--   0        0        0     1895 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_38/pep_572_remove_parens.py
--rw-r--r--   0        0        0      834 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_38/python38.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_39/pep_572_py39.py
--rw-r--r--   0        0        0      696 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_39/python39.py
--rw-r--r--   0        0        0     2575 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/py_39/remove_with_brackets.py
--rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/attribute_access_on_number_literals.py
--rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/beginning_backslash.py
--rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/bracketmatch.py
--rw-r--r--   0        0        0     1091 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/class_blank_parentheses.py
--rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/class_methods_new_line.py
--rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/collections.py
--rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comment_after_escaped_newline.py
--rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments.py
--rw-r--r--   0        0        0     7639 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments2.py
--rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments3.py
--rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments4.py
--rw-r--r--   0        0        0     1196 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments5.py
--rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments6.py
--rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments8.py
--rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments9.py
--rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/comments_non_breaking_space.py
--rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/composition.py
--rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/composition_no_trailing_comma.py
--rw-r--r--   0        0        0     7763 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/docstring.py
--rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/docstring_no_extra_empty_line_before_eof.py
--rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/docstring_preview.py
--rw-r--r--   0        0        0     4596 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/empty_lines.py
--rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/expression.diff
--rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/expression.py
--rw-r--r--   0        0        0     9645 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtonoff.py
--rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtonoff2.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtonoff3.py
--rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtonoff4.py
--rw-r--r--   0        0        0     3627 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtonoff5.py
--rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtpass_imports.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip.py
--rw-r--r--   0        0        0      555 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip2.py
--rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip3.py
--rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip4.py
--rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip5.py
--rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip6.py
--rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip7.py
--rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fmtskip8.py
--rw-r--r--   0        0        0      815 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/fstring.py
--rw-r--r--   0        0        0     6414 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/function.py
--rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/function2.py
--rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/function_trailing_comma.py
--rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/import_spacing.py
--rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/one_element_subscript.py
--rw-r--r--   0        0        0     3359 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/power_op_spacing.py
--rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/prefer_rhs_split_reformatted.py
--rw-r--r--   0        0        0     3205 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/remove_await_parens.py
--rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/remove_except_parens.py
--rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/remove_for_brackets.py
--rw-r--r--   0        0        0     3351 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/remove_newline_after_code_block_open.py
--rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/remove_parens.py
--rw-r--r--   0        0        0     5045 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/return_annotation_brackets.py
--rw-r--r--   0        0        0     1398 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/skip_magic_trailing_comma.py
--rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/slices.py
--rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/string_prefixes.py
--rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/torture.py
--rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens1.py
--rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens2.py
--rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens3.py
--rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/trailing_commas_in_leading_parts.py
--rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/tricky_unicode_symbols.py
--rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/tupleassign.py
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/simple_cases/whitespace.py
--rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-23.3.0/tests/data/type_comments/type_comment_syntax_error.py
--rw-r--r--   0        0        0      272 2020-02-02 00:00:00.000000 black-23.3.0/.gitignore
--rw-r--r--   0        0        0     8043 2020-02-02 00:00:00.000000 black-23.3.0/AUTHORS.md
--rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-23.3.0/LICENSE
--rw-r--r--   0        0        0     6815 2020-02-02 00:00:00.000000 black-23.3.0/pyproject.toml
--rw-r--r--   0        0        0    61028 2020-02-02 00:00:00.000000 black-23.3.0/PKG-INFO
+-rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 black-23.7.0/.coveragerc
+-rw-r--r--   0        0        0      360 2020-02-02 00:00:00.000000 black-23.7.0/.flake8
+-rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-23.7.0/.git_archival.txt
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.7.0/.gitattributes
+-rw-r--r--   0        0        0     1997 2020-02-02 00:00:00.000000 black-23.7.0/.pre-commit-config.yaml
+-rw-r--r--   0        0        0      523 2020-02-02 00:00:00.000000 black-23.7.0/.pre-commit-hooks.yaml
+-rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-23.7.0/.prettierrc.yaml
+-rw-r--r--   0        0        0      220 2020-02-02 00:00:00.000000 black-23.7.0/.readthedocs.yaml
+-rw-r--r--   0        0        0    51880 2020-02-02 00:00:00.000000 black-23.7.0/CHANGES.md
+-rw-r--r--   0        0        0      932 2020-02-02 00:00:00.000000 black-23.7.0/CITATION.cff
+-rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-23.7.0/CONTRIBUTING.md
+-rw-r--r--   0        0        0      587 2020-02-02 00:00:00.000000 black-23.7.0/Dockerfile
+-rw-r--r--   0        0        0     9766 2020-02-02 00:00:00.000000 black-23.7.0/README.md
+-rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-23.7.0/SECURITY.md
+-rw-r--r--   0        0        0     1616 2020-02-02 00:00:00.000000 black-23.7.0/action.yml
+-rw-r--r--   0        0        0      795 2020-02-02 00:00:00.000000 black-23.7.0/mypy.ini
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.7.0/test_requirements.txt
+-rw-r--r--   0        0        0     2905 2020-02-02 00:00:00.000000 black-23.7.0/tox.ini
+-rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-23.7.0/.github/CODE_OF_CONDUCT.md
+-rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-23.7.0/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-23.7.0/.github/dependabot.yml
+-rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-23.7.0/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-23.7.0/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-23.7.0/.github/ISSUE_TEMPLATE/docs-issue.md
+-rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-23.7.0/.github/ISSUE_TEMPLATE/feature_request.md
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-23.7.0/.github/ISSUE_TEMPLATE/style_issue.md
+-rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/changelog.yml
+-rw-r--r--   0        0        0     5319 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/diff_shades.yml
+-rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/diff_shades_comment.yml
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/doc.yml
+-rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/docker.yml
+-rw-r--r--   0        0        0     1120 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/fuzz.yml
+-rw-r--r--   0        0        0     1231 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/lint.yml
+-rw-r--r--   0        0        0     2333 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/pypi_upload.yml
+-rw-r--r--   0        0        0     3038 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/test.yml
+-rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-23.7.0/.github/workflows/upload_binary.yml
+-rw-r--r--   0        0        0     2463 2020-02-02 00:00:00.000000 black-23.7.0/action/main.py
+-rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-23.7.0/autoload/black.vim
+-rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-23.7.0/docs/Makefile
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.7.0/docs/authors.md
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-23.7.0/docs/change_log.md
+-rw-r--r--   0        0        0     6673 2020-02-02 00:00:00.000000 black-23.7.0/docs/conf.py
+-rw-r--r--   0        0        0     5843 2020-02-02 00:00:00.000000 black-23.7.0/docs/faq.md
+-rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 black-23.7.0/docs/getting_started.md
+-rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-23.7.0/docs/index.md
+-rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-23.7.0/docs/license.md
+-rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-23.7.0/docs/make.bat
+-rw-r--r--   0        0        0      258 2020-02-02 00:00:00.000000 black-23.7.0/docs/requirements.txt
+-rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-23.7.0/docs/_static/license.svg
+-rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-23.7.0/docs/_static/logo2-readme.png
+-rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-23.7.0/docs/_static/logo2.png
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-23.7.0/docs/_static/pypi_template.svg
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/flake8/.flake8
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/flake8/setup.cfg
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/flake8/tox.ini
+-rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/isort/.editorconfig
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/isort/.isort.cfg
+-rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/isort/pyproject.toml
+-rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/isort/setup.cfg
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/pylint/pylintrc
+-rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/pylint/pyproject.toml
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-23.7.0/docs/compatible_configs/pylint/setup.cfg
+-rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/gauging_changes.md
+-rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/index.md
+-rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/issue_triage.md
+-rw-r--r--   0        0        0     8585 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/release_process.md
+-rw-r--r--   0        0        0     2520 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/the_basics.md
+-rw-r--r--   0        0        0     4024 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/reference/reference_classes.rst
+-rw-r--r--   0        0        0      383 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/reference/reference_exceptions.rst
+-rw-r--r--   0        0        0     3973 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/reference/reference_functions.rst
+-rw-r--r--   0        0        0      488 2020-02-02 00:00:00.000000 black-23.7.0/docs/contributing/reference/reference_summary.rst
+-rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-23.7.0/docs/guides/index.md
+-rw-r--r--   0        0        0     2329 2020-02-02 00:00:00.000000 black-23.7.0/docs/guides/introducing_black_to_your_project.md
+-rw-r--r--   0        0        0     7023 2020-02-02 00:00:00.000000 black-23.7.0/docs/guides/using_black_with_other_tools.md
+-rw-r--r--   0        0        0    12055 2020-02-02 00:00:00.000000 black-23.7.0/docs/integrations/editors.md
+-rw-r--r--   0        0        0     2255 2020-02-02 00:00:00.000000 black-23.7.0/docs/integrations/github_actions.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-23.7.0/docs/integrations/index.md
+-rw-r--r--   0        0        0     1730 2020-02-02 00:00:00.000000 black-23.7.0/docs/integrations/source_version_control.md
+-rw-r--r--   0        0        0    21275 2020-02-02 00:00:00.000000 black-23.7.0/docs/the_black_code_style/current_style.md
+-rw-r--r--   0        0        0     4536 2020-02-02 00:00:00.000000 black-23.7.0/docs/the_black_code_style/future_style.md
+-rw-r--r--   0        0        0     2197 2020-02-02 00:00:00.000000 black-23.7.0/docs/the_black_code_style/index.md
+-rw-r--r--   0        0        0     4258 2020-02-02 00:00:00.000000 black-23.7.0/docs/usage_and_configuration/black_as_a_server.md
+-rw-r--r--   0        0        0     2092 2020-02-02 00:00:00.000000 black-23.7.0/docs/usage_and_configuration/black_docker_image.md
+-rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-23.7.0/docs/usage_and_configuration/file_collection_and_discovery.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-23.7.0/docs/usage_and_configuration/index.md
+-rw-r--r--   0        0        0    15591 2020-02-02 00:00:00.000000 black-23.7.0/docs/usage_and_configuration/the_basics.md
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-23.7.0/gallery/Dockerfile
+-rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-23.7.0/gallery/README.md
+-rwxr-xr-x   0        0        0     9105 2020-02-02 00:00:00.000000 black-23.7.0/gallery/gallery.py
+-rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-23.7.0/plugin/black.vim
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/scripts/__init__.py
+-rw-r--r--   0        0        0     1831 2020-02-02 00:00:00.000000 black-23.7.0/scripts/check_pre_commit_rev_in_example.py
+-rw-r--r--   0        0        0     1586 2020-02-02 00:00:00.000000 black-23.7.0/scripts/check_version_in_basics_example.py
+-rw-r--r--   0        0        0     8943 2020-02-02 00:00:00.000000 black-23.7.0/scripts/diff_shades_gha_helper.py
+-rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-23.7.0/scripts/fuzz.py
+-rw-r--r--   0        0        0     2323 2020-02-02 00:00:00.000000 black-23.7.0/scripts/make_width_table.py
+-rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-23.7.0/scripts/migrate-black.py
+-rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-23.7.0/src/_black_version.py
+-rw-r--r--   0        0        0    45868 2020-02-02 00:00:00.000000 black-23.7.0/src/black/__init__.py
+-rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-23.7.0/src/black/__main__.py
+-rw-r--r--   0        0        0    10761 2020-02-02 00:00:00.000000 black-23.7.0/src/black/_width_table.py
+-rw-r--r--   0        0        0    12163 2020-02-02 00:00:00.000000 black-23.7.0/src/black/brackets.py
+-rw-r--r--   0        0        0     2946 2020-02-02 00:00:00.000000 black-23.7.0/src/black/cache.py
+-rw-r--r--   0        0        0    12681 2020-02-02 00:00:00.000000 black-23.7.0/src/black/comments.py
+-rw-r--r--   0        0        0     6359 2020-02-02 00:00:00.000000 black-23.7.0/src/black/concurrency.py
+-rw-r--r--   0        0        0      321 2020-02-02 00:00:00.000000 black-23.7.0/src/black/const.py
+-rw-r--r--   0        0        0     1594 2020-02-02 00:00:00.000000 black-23.7.0/src/black/debug.py
+-rw-r--r--   0        0        0    13831 2020-02-02 00:00:00.000000 black-23.7.0/src/black/files.py
+-rw-r--r--   0        0        0    13657 2020-02-02 00:00:00.000000 black-23.7.0/src/black/handle_ipynb_magics.py
+-rw-r--r--   0        0        0    61298 2020-02-02 00:00:00.000000 black-23.7.0/src/black/linegen.py
+-rw-r--r--   0        0        0    36672 2020-02-02 00:00:00.000000 black-23.7.0/src/black/lines.py
+-rw-r--r--   0        0        0     7802 2020-02-02 00:00:00.000000 black-23.7.0/src/black/mode.py
+-rw-r--r--   0        0        0    26463 2020-02-02 00:00:00.000000 black-23.7.0/src/black/nodes.py
+-rw-r--r--   0        0        0     1653 2020-02-02 00:00:00.000000 black-23.7.0/src/black/numerics.py
+-rw-r--r--   0        0        0     3486 2020-02-02 00:00:00.000000 black-23.7.0/src/black/output.py
+-rw-r--r--   0        0        0     7862 2020-02-02 00:00:00.000000 black-23.7.0/src/black/parsing.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/src/black/py.typed
+-rw-r--r--   0        0        0     3451 2020-02-02 00:00:00.000000 black-23.7.0/src/black/report.py
+-rw-r--r--   0        0        0      556 2020-02-02 00:00:00.000000 black-23.7.0/src/black/rusty.py
+-rw-r--r--   0        0        0    11098 2020-02-02 00:00:00.000000 black-23.7.0/src/black/strings.py
+-rw-r--r--   0        0        0    91262 2020-02-02 00:00:00.000000 black-23.7.0/src/black/trans.py
+-rw-r--r--   0        0        0     8121 2020-02-02 00:00:00.000000 black-23.7.0/src/blackd/__init__.py
+-rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-23.7.0/src/blackd/__main__.py
+-rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-23.7.0/src/blackd/middlewares.py
+-rw-r--r--   0        0        0    11530 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/Grammar.txt
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/LICENSE
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/PatternGrammar.txt
+-rw-r--r--   0        0        0     1071 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/README
+-rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/__init__.py
+-rw-r--r--   0        0        0     5815 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pygram.py
+-rw-r--r--   0        0        0    32574 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pytree.py
+-rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/__init__.py
+-rw-r--r--   0        0        0     9587 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/conv.py
+-rw-r--r--   0        0        0    10605 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/driver.py
+-rw-r--r--   0        0        0     6858 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/grammar.py
+-rw-r--r--   0        0        0     1616 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/literals.py
+-rw-r--r--   0        0        0    14816 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/parse.py
+-rw-r--r--   0        0        0    15458 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/pgen.py
+-rw-r--r--   0        0        0     1824 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/token.py
+-rw-r--r--   0        0        0    23007 2020-02-02 00:00:00.000000 black-23.7.0/src/blib2to3/pgen2/tokenize.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/__init__.py
+-rw-r--r--   0        0        0       36 2020-02-02 00:00:00.000000 black-23.7.0/tests/conftest.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.7.0/tests/empty.toml
+-rw-r--r--   0        0        0     4133 2020-02-02 00:00:00.000000 black-23.7.0/tests/optional.py
+-rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-23.7.0/tests/test.toml
+-rw-r--r--   0        0        0   101017 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_black.py
+-rw-r--r--   0        0        0     9172 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_blackd.py
+-rw-r--r--   0        0        0     7806 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_format.py
+-rw-r--r--   0        0        0    16141 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_ipynb.py
+-rw-r--r--   0        0        0     1247 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_no_ipynb.py
+-rw-r--r--   0        0        0     2237 2020-02-02 00:00:00.000000 black-23.7.0/tests/test_trans.py
+-rw-r--r--   0        0        0     6893 2020-02-02 00:00:00.000000 black-23.7.0/tests/util.py
+-rw-r--r--   0        0        0     4160 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/conditional_expression.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/empty_pyproject.toml
+-rw-r--r--   0        0        0      498 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/fast/pep_572_do_not_remove_parens.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/ignore_subfolders_gitignore_tests/a.py
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
+-rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/.gitignore
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/include_exclude_tests/b/exclude/a.pyi
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_gitignore_tests/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_nested_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/invalid_nested_gitignore_tests/a/a.py
+-rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/non_python_notebook.ipynb
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/notebook_empty_metadata.ipynb
+-rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
+-rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/notebook_trailing_newline.ipynb
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
+-rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/jupyter/notebook_without_changes.ipynb
+-rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/async_as_identifier.py
+-rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/blackd_diff.diff
+-rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/blackd_diff.py
+-rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/debug_visitor.out
+-rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/debug_visitor.py
+-rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/decorators.py
+-rw-r--r--   0        0        0     3601 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/docstring_no_string_normalization.py
+-rw-r--r--   0        0        0      357 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
+-rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
+-rw-r--r--   0        0        0      598 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/force_py36.py
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/force_pyi.py
+-rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/invalid_header.py
+-rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/linelength6.py
+-rw-r--r--   0        0        0    11578 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/long_strings_flag_disabled.py
+-rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/missing_final_newline.diff
+-rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/missing_final_newline.py
+-rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/nested_class_stub.pyi
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/pattern_matching_invalid.py
+-rw-r--r--   0        0        0       69 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/power_op_newline.py
+-rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/python2_detection.py
+-rw-r--r--   0        0        0     2361 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/string_quotes.py
+-rw-r--r--   0        0        0     2266 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/miscellaneous/stub.pyi
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/x.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/a.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/c.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/child/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/child/a.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/child/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/nested_gitignore_tests/root/child/c.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/async_stmts.py
+-rw-r--r--   0        0        0     4107 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/cantfit.py
+-rw-r--r--   0        0        0     8290 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/comments7.py
+-rw-r--r--   0        0        0      613 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/format_unicode_escape_seq.py
+-rw-r--r--   0        0        0     2784 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_dict_values.py
+-rw-r--r--   0        0        0    33216 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_strings.py
+-rw-r--r--   0        0        0     1418 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_strings__east_asian_width.py
+-rw-r--r--   0        0        0     6536 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_strings__edge_case.py
+-rw-r--r--   0        0        0    45897 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_strings__regression.py
+-rw-r--r--   0        0        0     1077 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/long_strings__type_annotations.py
+-rw-r--r--   0        0        0     7199 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/multiline_strings.py
+-rw-r--r--   0        0        0      810 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/no_blank_line_before_docstring.py
+-rw-r--r--   0        0        0      481 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/percent_precedence.py
+-rw-r--r--   0        0        0     2525 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/prefer_rhs_split.py
+-rw-r--r--   0        0        0      334 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/return_annotation_brackets_string.py
+-rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview/trailing_comma.py
+-rw-r--r--   0        0        0     1140 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/targeting_py38.py
+-rw-r--r--   0        0        0     3361 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/targeting_py39.py
+-rw-r--r--   0        0        0      595 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_10.py
+-rw-r--r--   0        0        0      553 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_11.py
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_8.py
+-rw-r--r--   0        0        0      623 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_9.py
+-rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/project_metadata/both_pyproject.toml
+-rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/project_metadata/neither_pyproject.toml
+-rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/project_metadata/only_black_pyproject.toml
+-rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/project_metadata/only_metadata_pyproject.toml
+-rw-r--r--   0        0        0      765 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/parenthesized_context_managers.py
+-rw-r--r--   0        0        0     2668 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pattern_matching_complex.py
+-rw-r--r--   0        0        0     1965 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pattern_matching_extras.py
+-rw-r--r--   0        0        0     3066 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pattern_matching_generic.py
+-rw-r--r--   0        0        0     2641 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pattern_matching_simple.py
+-rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pattern_matching_style.py
+-rw-r--r--   0        0        0      491 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/pep_572_py310.py
+-rw-r--r--   0        0        0      509 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/remove_newline_after_match.py
+-rw-r--r--   0        0        0      380 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_310/starred_for_target.py
+-rw-r--r--   0        0        0     2114 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_311/pep_646.py
+-rw-r--r--   0        0        0      972 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_311/pep_654.py
+-rw-r--r--   0        0        0     2033 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_311/pep_654_style.py
+-rw-r--r--   0        0        0      141 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_312/type_aliases.py
+-rw-r--r--   0        0        0     1112 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_312/type_params.py
+-rw-r--r--   0        0        0      597 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_36/numeric_literals.py
+-rw-r--r--   0        0        0      267 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_36/numeric_literals_skip_underscores.py
+-rw-r--r--   0        0        0     1199 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_37/python37.py
+-rw-r--r--   0        0        0      680 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_38/pep_570.py
+-rw-r--r--   0        0        0      970 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_38/pep_572.py
+-rw-r--r--   0        0        0     1895 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_38/pep_572_remove_parens.py
+-rw-r--r--   0        0        0      834 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_38/python38.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_39/pep_572_py39.py
+-rw-r--r--   0        0        0      696 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_39/python39.py
+-rw-r--r--   0        0        0     2575 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/py_39/remove_with_brackets.py
+-rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/attribute_access_on_number_literals.py
+-rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/beginning_backslash.py
+-rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/bracketmatch.py
+-rw-r--r--   0        0        0     1091 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/class_blank_parentheses.py
+-rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/class_methods_new_line.py
+-rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/collections.py
+-rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comment_after_escaped_newline.py
+-rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments.py
+-rw-r--r--   0        0        0     7749 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments2.py
+-rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments3.py
+-rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments4.py
+-rw-r--r--   0        0        0     1196 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments5.py
+-rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments6.py
+-rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments8.py
+-rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments9.py
+-rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/comments_non_breaking_space.py
+-rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/composition.py
+-rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/composition_no_trailing_comma.py
+-rw-r--r--   0        0        0     7763 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/docstring.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/docstring_preview.py
+-rw-r--r--   0        0        0     4596 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/empty_lines.py
+-rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/expression.diff
+-rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/expression.py
+-rw-r--r--   0        0        0     9645 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtonoff.py
+-rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtonoff2.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtonoff3.py
+-rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtonoff4.py
+-rw-r--r--   0        0        0     3627 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtonoff5.py
+-rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtpass_imports.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip.py
+-rw-r--r--   0        0        0      555 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip2.py
+-rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip3.py
+-rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip4.py
+-rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip5.py
+-rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip6.py
+-rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip7.py
+-rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fmtskip8.py
+-rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/fstring.py
+-rw-r--r--   0        0        0     6414 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/function.py
+-rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/function2.py
+-rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/function_trailing_comma.py
+-rw-r--r--   0        0        0      505 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/ignore_pyi.py
+-rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/import_spacing.py
+-rw-r--r--   0        0        0      644 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/multiline_consecutive_open_parentheses_ignore.py
+-rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/one_element_subscript.py
+-rw-r--r--   0        0        0      583 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/pep_604.py
+-rw-r--r--   0        0        0     3359 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/power_op_spacing.py
+-rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/prefer_rhs_split_reformatted.py
+-rw-r--r--   0        0        0     3205 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/remove_await_parens.py
+-rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/remove_except_parens.py
+-rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/remove_for_brackets.py
+-rw-r--r--   0        0        0     3351 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/remove_newline_after_code_block_open.py
+-rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/remove_parens.py
+-rw-r--r--   0        0        0     5045 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/return_annotation_brackets.py
+-rw-r--r--   0        0        0     1398 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/skip_magic_trailing_comma.py
+-rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/slices.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/string_prefixes.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/torture.py
+-rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/trailing_comma_optional_parens1.py
+-rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/trailing_comma_optional_parens2.py
+-rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/trailing_comma_optional_parens3.py
+-rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/trailing_commas_in_leading_parts.py
+-rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/tricky_unicode_symbols.py
+-rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/tupleassign.py
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/simple_cases/whitespace.py
+-rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-23.7.0/tests/data/type_comments/type_comment_syntax_error.py
+-rw-r--r--   0        0        0      272 2020-02-02 00:00:00.000000 black-23.7.0/.gitignore
+-rw-r--r--   0        0        0     8043 2020-02-02 00:00:00.000000 black-23.7.0/AUTHORS.md
+-rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-23.7.0/LICENSE
+-rw-r--r--   0        0        0     6696 2020-02-02 00:00:00.000000 black-23.7.0/pyproject.toml
+-rw-r--r--   0        0        0    63440 2020-02-02 00:00:00.000000 black-23.7.0/PKG-INFO
```

### Comparing `black-23.3.0/.pre-commit-config.yaml` & `black-23.7.0/.pre-commit-config.yaml`

 * *Files 5% similar despite different names*

```diff
@@ -34,24 +34,24 @@
       - id: flake8
         additional_dependencies:
           - flake8-bugbear
           - flake8-comprehensions
           - flake8-simplify
 
   - repo: https://github.com/pre-commit/mirrors-mypy
-    rev: v0.991
+    rev: v1.4.1
     hooks:
       - id: mypy
         exclude: ^docs/conf.py
         additional_dependencies:
           - types-dataclasses >= 0.1.3
           - types-PyYAML
           - tomli >= 0.2.6, < 2.0.0
           - types-typed-ast >= 1.4.1
-          - click >= 8.1.0
+          - click >= 8.1.0, != 8.1.4
           - packaging >= 22.0
           - platformdirs >= 2.1.0
           - pytest
           - hypothesis
 
   - repo: https://github.com/pre-commit/mirrors-prettier
     rev: v2.7.1
```

### Comparing `black-23.3.0/.pre-commit-hooks.yaml` & `black-23.7.0/.pre-commit-hooks.yaml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/CHANGES.md` & `black-23.7.0/CHANGES.md`

 * *Files 1% similar despite different names*

```diff
@@ -43,14 +43,86 @@
 <!-- For example, Docker, GitHub Actions, pre-commit, editors -->
 
 ### Documentation
 
 <!-- Major changes to documentation and policies. Small docs changes
      don't need a changelog entry. -->
 
+## 23.7.0
+
+### Highlights
+
+- Runtime support for Python 3.7 has been removed. Formatting 3.7 code will still be
+  supported until further notice (#3765)
+
+### Stable style
+
+- Fix a bug where an illegal trailing comma was added to return type annotations using
+  PEP 604 unions (#3735)
+- Fix several bugs and crashes where comments in stub files were removed or mishandled
+  under some circumstances (#3745)
+- Fix a crash with multi-line magic comments like `type: ignore` within parentheses
+  (#3740)
+- Fix error in AST validation when _Black_ removes trailing whitespace in a type comment
+  (#3773)
+
+### Preview style
+
+- Implicitly concatenated strings used as function args are no longer wrapped inside
+  parentheses (#3640)
+- Remove blank lines between a class definition and its docstring (#3692)
+
+### Configuration
+
+- The `--workers` argument to _Black_ can now be specified via the `BLACK_NUM_WORKERS`
+  environment variable (#3743)
+- `.pytest_cache`, `.ruff_cache` and `.vscode` are now excluded by default (#3691)
+- Fix _Black_ not honouring `pyproject.toml` settings when running `--stdin-filename`
+  and the `pyproject.toml` found isn't in the current working directory (#3719)
+- _Black_ will now error if `exclude` and `extend-exclude` have invalid data types in
+  `pyproject.toml`, instead of silently doing the wrong thing (#3764)
+
+### Packaging
+
+- Upgrade mypyc from 0.991 to 1.3 (#3697)
+- Remove patching of Click that mitigated errors on Python 3.6 with `LANG=C` (#3768)
+
+### Parser
+
+- Add support for the new PEP 695 syntax in Python 3.12 (#3703)
+
+### Performance
+
+- Speed up _Black_ significantly when the cache is full (#3751)
+- Avoid importing `IPython` in a case where we wouldn't need it (#3748)
+
+### Output
+
+- Use aware UTC datetimes internally, avoids deprecation warning on Python 3.12 (#3728)
+- Change verbose logging to exactly mirror _Black_'s logic for source discovery (#3749)
+
+### _Blackd_
+
+- The `blackd` argument parser now shows the default values for options in their help
+  text (#3712)
+
+### Integrations
+
+- Black is now tested with
+  [`PYTHONWARNDEFAULTENCODING = 1`](https://docs.python.org/3/library/io.html#io-encoding-warning)
+  (#3763)
+- Update GitHub Action to display black output in the job summary (#3688)
+
+### Documentation
+
+- Add a CITATION.cff file to the root of the repository, containing metadata on how to
+  cite this software (#3723)
+- Update the _classes_ and _exceptions_ documentation in Developer reference to match
+  the latest code base (#3755)
+
 ## 23.3.0
 
 ### Highlights
 
 This release fixes a longstanding confusing behavior in Black's GitHub action, where the
 version of the action did not determine the version of Black being run (issue #3382). In
 addition, there is a small bug fix around imports and a number of improvements to the
```

### Comparing `black-23.3.0/Dockerfile` & `black-23.7.0/Dockerfile`

 * *Files identical despite different names*

### Comparing `black-23.3.0/README.md` & `black-23.7.0/README.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/action.yml` & `black-23.7.0/action.yml`

 * *Files 6% similar despite different names*

```diff
@@ -29,19 +29,20 @@
     default: ""
 branding:
   color: "black"
   icon: "check-circle"
 runs:
   using: composite
   steps:
-    - run: |
+    - name: black
+      run: |
         if [ "$RUNNER_OS" == "Windows" ]; then
-          python $GITHUB_ACTION_PATH/action/main.py
+          python $GITHUB_ACTION_PATH/action/main.py | tee -a $GITHUB_STEP_SUMMARY
         else
-          python3 $GITHUB_ACTION_PATH/action/main.py
+          python3 $GITHUB_ACTION_PATH/action/main.py | tee -a $GITHUB_STEP_SUMMARY
         fi
       env:
         # TODO: Remove once https://github.com/actions/runner/issues/665 is fixed.
         INPUT_OPTIONS: ${{ inputs.options }}
         INPUT_SRC: ${{ inputs.src }}
         INPUT_JUPYTER: ${{ inputs.jupyter }}
         INPUT_BLACK_ARGS: ${{ inputs.black_args }}
```

### Comparing `black-23.3.0/mypy.ini` & `black-23.7.0/mypy.ini`

 * *Files 11% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 [mypy]
 # Specify the target platform details in config, so your developers are
 # free to run mypy on Windows, Linux, or macOS and get consistent
 # results.
-python_version=3.7
+python_version=3.8
 
 mypy_path=src
 
 show_column_numbers=True
 show_error_codes=True
 
 # be strict
```

### Comparing `black-23.3.0/tox.ini` & `black-23.7.0/tox.ini`

 * *Files 4% similar despite different names*

```diff
@@ -1,13 +1,15 @@
 [tox]
 isolated_build = true
 envlist = {,ci-}py{37,38,39,310,311,py3},fuzz,run_self
 
 [testenv]
-setenv = PYTHONPATH = {toxinidir}/src
+setenv =
+    PYTHONPATH = {toxinidir}/src
+    PYTHONWARNDEFAULTENCODING = 1
 skip_install = True
 # We use `recreate=True` because otherwise, on the second run of `tox -e py`,
 # the `no_jupyter` tests would run with the jupyter extra dependencies installed.
 # See https://github.com/psf/black/issues/2367.
 recreate = True
 deps =
     -r{toxinidir}/test_requirements.txt
@@ -33,27 +35,23 @@
 deps =
     -r{toxinidir}/test_requirements.txt
 ; a separate worker is required in ci due to https://foss.heptapod.net/pypy/pypy/-/issues/3317
 ; this seems to cause tox to wait forever
 ; remove this when pypy releases the bugfix
 commands =
     pip install -e .[d]
-    coverage erase
     pytest tests \
         --run-optional no_jupyter \
         !ci: --numprocesses auto \
-        ci: --numprocesses 1 \
-        --cov {posargs}
+        ci: --numprocesses 1
     pip install -e .[jupyter]
     pytest tests --run-optional jupyter \
         -m jupyter \
         !ci: --numprocesses auto \
-        ci: --numprocesses 1 \
-        --cov --cov-append {posargs}
-    coverage report
+        ci: --numprocesses 1
 
 [testenv:{,ci-}311]
 setenv =
   PYTHONPATH = {toxinidir}/src
   AIOHTTP_NO_EXTENSIONS = 1
 skip_install = True
 recreate = True
```

### Comparing `black-23.3.0/.github/CODE_OF_CONDUCT.md` & `black-23.7.0/.github/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/PULL_REQUEST_TEMPLATE.md` & `black-23.7.0/.github/PULL_REQUEST_TEMPLATE.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/dependabot.yml` & `black-23.7.0/.github/dependabot.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/ISSUE_TEMPLATE/bug_report.md` & `black-23.7.0/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/ISSUE_TEMPLATE/config.yml` & `black-23.7.0/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/ISSUE_TEMPLATE/docs-issue.md` & `black-23.7.0/.github/ISSUE_TEMPLATE/docs-issue.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/ISSUE_TEMPLATE/feature_request.md` & `black-23.7.0/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/ISSUE_TEMPLATE/style_issue.md` & `black-23.7.0/.github/ISSUE_TEMPLATE/style_issue.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/workflows/changelog.yml` & `black-23.7.0/.github/workflows/changelog.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/workflows/diff_shades.yml` & `black-23.7.0/.github/workflows/diff_shades.yml`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
       - uses: actions/checkout@v3
       - uses: actions/setup-python@v4
         with:
           python-version: "*"
 
       - name: Install diff-shades and support dependencies
         run: |
-          python -m pip install click packaging urllib3
+          python -m pip install 'click==8.1.3' packaging urllib3
           python -m pip install https://github.com/ichard26/diff-shades/archive/stable.zip
 
       - name: Calculate run configuration & metadata
         id: set-config
         env:
           GITHUB_TOKEN: ${{ github.token }}
         run: >
@@ -60,15 +60,15 @@
       - uses: actions/setup-python@v4
         with:
           python-version: "*"
 
       - name: Install diff-shades and support dependencies
         run: |
           python -m pip install https://github.com/ichard26/diff-shades/archive/stable.zip
-          python -m pip install click packaging urllib3
+          python -m pip install 'click==8.1.3' packaging urllib3
           # After checking out old revisions, this might not exist so we'll use a copy.
           cat scripts/diff_shades_gha_helper.py > helper.py
           git config user.name "diff-shades-gha"
           git config user.email "diff-shades-gha@example.com"
 
       - name: Attempt to use cached baseline analysis
         id: baseline-cache
```

### Comparing `black-23.3.0/.github/workflows/diff_shades_comment.yml` & `black-23.7.0/.github/workflows/diff_shades_comment.yml`

 * *Files 6% similar despite different names*

```diff
@@ -29,21 +29,21 @@
         run: >
           python scripts/diff_shades_gha_helper.py comment-details
           ${{github.event.workflow_run.id }}
 
       - name: Try to find pre-existing PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
         id: find-comment
-        uses: peter-evans/find-comment@034abe94d3191f9c89d870519735beae326f2bdb
+        uses: peter-evans/find-comment@a54c31d7fa095754bfef525c0c8e5e5674c4b4b1
         with:
           issue-number: ${{ steps.metadata.outputs.pr-number }}
           comment-author: "github-actions[bot]"
           body-includes: "diff-shades"
 
       - name: Create or update PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
-        uses: peter-evans/create-or-update-comment@67dcc547d311b736a8e6c5c236542148a47adc3d
+        uses: peter-evans/create-or-update-comment@c6c9a1a66007646a28c153e2a8580a5bad27bcfa
         with:
           comment-id: ${{ steps.find-comment.outputs.comment-id }}
           issue-number: ${{ steps.metadata.outputs.pr-number }}
           body: ${{ steps.metadata.outputs.comment-body }}
           edit-mode: replace
```

### Comparing `black-23.3.0/.github/workflows/doc.yml` & `black-23.7.0/.github/workflows/doc.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/workflows/docker.yml` & `black-23.7.0/.github/workflows/docker.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/workflows/fuzz.yml` & `black-23.7.0/.github/workflows/fuzz.yml`

 * *Files 1% similar despite different names*

```diff
@@ -18,15 +18,15 @@
       github.event_name == 'push' || github.event.pull_request.head.repo.full_name !=
       github.repository
 
     runs-on: ubuntu-latest
     strategy:
       fail-fast: false
       matrix:
-        python-version: ["3.7", "3.8", "3.9", "3.10", "3.11"]
+        python-version: ["3.8", "3.9", "3.10", "3.11"]
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Set up Python ${{ matrix.python-version }}
         uses: actions/setup-python@v4
         with:
```

### Comparing `black-23.3.0/.github/workflows/lint.yml` & `black-23.7.0/.github/workflows/lint.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/.github/workflows/pypi_upload.yml` & `black-23.7.0/.github/workflows/pypi_upload.yml`

 * *Files 1% similar despite different names*

```diff
@@ -54,15 +54,15 @@
             name: macos-universal2
             macos_arch: "universal2"
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Build wheels via cibuildwheel
-        uses: pypa/cibuildwheel@v2.12.1
+        uses: pypa/cibuildwheel@v2.13.1
         env:
           CIBW_ARCHS_MACOS: "${{ matrix.macos_arch }}"
 
       - name: Upload wheels as workflow artifacts
         uses: actions/upload-artifact@v3
         with:
           name: ${{ matrix.name }}-mypyc-wheels
```

### Comparing `black-23.3.0/.github/workflows/test.yml` & `black-23.7.0/.github/workflows/test.yml`

 * *Files 4% similar despite different names*

```diff
@@ -27,15 +27,15 @@
       github.event_name == 'push' || github.event.pull_request.head.repo.full_name !=
       github.repository
 
     runs-on: ${{ matrix.os }}
     strategy:
       fail-fast: false
       matrix:
-        python-version: ["3.7", "3.8", "3.9", "3.10", "3.11", "pypy-3.7", "pypy-3.8"]
+        python-version: ["3.8", "3.9", "3.10", "3.11", "pypy-3.8"]
         os: [ubuntu-latest, macOS-latest, windows-latest]
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Set up Python ${{ matrix.python-version }}
         uses: actions/setup-python@v4
@@ -54,15 +54,17 @@
       - name: Unit tests (pypy)
         if: "startsWith(matrix.python-version, 'pypy')"
         run: tox -e ci-pypy3 -- -v --color=yes
 
       - name: Upload coverage to Coveralls
         # Upload coverage if we are on the main repository and
         # we're running on Linux (this action only supports Linux)
-        if: github.repository == 'psf/black' && matrix.os == 'ubuntu-latest'
+        if:
+          github.repository == 'psf/black' && matrix.os == 'ubuntu-latest' &&
+          !startsWith(matrix.python-version, 'pypy')
         uses: AndreMiras/coveralls-python-action@v20201129
         with:
           github-token: ${{ secrets.GITHUB_TOKEN }}
           parallel: true
           flag-name: py${{ matrix.python-version }}-${{ matrix.os }}
           debug: true
 
@@ -99,8 +101,8 @@
 
       - name: Install black with uvloop
         run: |
           python -m pip install pip --upgrade --disable-pip-version-check
           python -m pip install -e ".[uvloop]"
 
       - name: Format ourselves
-        run: python -m black --check src/
+        run: python -m black --check .
```

### Comparing `black-23.3.0/.github/workflows/upload_binary.yml` & `black-23.7.0/.github/workflows/upload_binary.yml`

 * *Files identical despite different names*

### Comparing `black-23.3.0/action/main.py` & `black-23.7.0/action/main.py`

 * *Files 8% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     describe_name = ""
     with open(ACTION_PATH / ".git_archival.txt", encoding="utf-8") as fp:
         for line in fp:
             if line.startswith("describe-name: "):
                 describe_name = line[len("describe-name: ") :].rstrip()
                 break
     if not describe_name:
-        print("::error::Failed to detect action version.", flush=True)
+        print("::error::Failed to detect action version.", file=sys.stderr, flush=True)
         sys.exit(1)
     # expected format is one of:
     # - 23.1.0
     # - 23.1.0-51-g448bba7
     if describe_name.count("-") < 2:
         # the action's commit matches a tag exactly, install exact version from PyPI
         req = f"black{extra_deps}=={describe_name}"
@@ -49,19 +49,29 @@
     stdout=PIPE,
     stderr=STDOUT,
     encoding="utf-8",
     cwd=ACTION_PATH,
 )
 if pip_proc.returncode:
     print(pip_proc.stdout)
-    print("::error::Failed to install Black.", flush=True)
+    print("::error::Failed to install Black.", file=sys.stderr, flush=True)
     sys.exit(pip_proc.returncode)
 
 
 base_cmd = [str(ENV_BIN / "black")]
 if BLACK_ARGS:
     # TODO: remove after a while since this is deprecated in favour of SRC + OPTIONS.
-    proc = run([*base_cmd, *shlex.split(BLACK_ARGS)])
+    proc = run(
+        [*base_cmd, *shlex.split(BLACK_ARGS)],
+        stdout=PIPE,
+        stderr=STDOUT,
+        encoding="utf-8",
+    )
 else:
-    proc = run([*base_cmd, *shlex.split(OPTIONS), *shlex.split(SRC)])
-
+    proc = run(
+        [*base_cmd, *shlex.split(OPTIONS), *shlex.split(SRC)],
+        stdout=PIPE,
+        stderr=STDOUT,
+        encoding="utf-8",
+    )
+print(proc.stdout)
 sys.exit(proc.returncode)
```

### Comparing `black-23.3.0/autoload/black.vim` & `black-23.7.0/autoload/black.vim`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/Makefile` & `black-23.7.0/docs/Makefile`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/conf.py` & `black-23.7.0/docs/conf.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/faq.md` & `black-23.7.0/docs/faq.md`

 * *Files 1% similar despite different names*

```diff
@@ -53,16 +53,16 @@
 
 ## Why is my Jupyter Notebook cell not formatted?
 
 _Black_ is timid about formatting Jupyter Notebooks. Cells containing any of the
 following will not be formatted:
 
 - automagics (e.g. `pip install black`)
-- non-Python cell magics (e.g. `%%writeline`). These can be added with the flag
-  `--python-cell-magics`, e.g. `black --python-cell-magics writeline hello.ipynb`.
+- non-Python cell magics (e.g. `%%writefile`). These can be added with the flag
+  `--python-cell-magics`, e.g. `black --python-cell-magics writefile hello.ipynb`.
 - multiline magics, e.g.:
 
   ```python
   %timeit f(1, \
           2, \
           3)
   ```
```

### Comparing `black-23.3.0/docs/getting_started.md` & `black-23.7.0/docs/getting_started.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/index.md` & `black-23.7.0/docs/index.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/make.bat` & `black-23.7.0/docs/make.bat`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/_static/license.svg` & `black-23.7.0/docs/_static/license.svg`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/_static/logo2-readme.png` & `black-23.7.0/docs/_static/logo2-readme.png`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/_static/logo2.png` & `black-23.7.0/docs/_static/logo2.png`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/_static/pypi_template.svg` & `black-23.7.0/docs/_static/pypi_template.svg`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/contributing/gauging_changes.md` & `black-23.7.0/docs/contributing/gauging_changes.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/contributing/index.md` & `black-23.7.0/docs/contributing/index.md`

 * *Files 2% similar despite different names*

```diff
@@ -20,15 +20,16 @@
 ```
 
 In terms of inspiration, _Black_ is about as configurable as _gofmt_ (which is to say,
 not very). This is deliberate. _Black_ aims to provide a consistent style and take away
 opportunities for arguing about style.
 
 Bug reports and fixes are always welcome! Please follow the
-[issue template on GitHub](https://github.com/psf/black/issues/new) for best results.
+[issue templates on GitHub](https://github.com/psf/black/issues/new/choose) for best
+results.
 
 Before you suggest a new feature or configuration knob, ask yourself why you want it. If
 it enables better integration with some workflow, fixes an inconsistency, speeds things
 up, and so on - go for it! On the other hand, if your answer is "because I don't like a
 particular formatting" then you're not ready to embrace _Black_ yet. Such changes are
 unlikely to get accepted. You can still try but prepare to be disappointed.
```

### Comparing `black-23.3.0/docs/contributing/issue_triage.md` & `black-23.7.0/docs/contributing/issue_triage.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/contributing/release_process.md` & `black-23.7.0/docs/contributing/release_process.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/contributing/the_basics.md` & `black-23.7.0/docs/contributing/the_basics.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/contributing/reference/reference_classes.rst` & `black-23.7.0/docs/contributing/reference/reference_classes.rst`

 * *Files 26% similar despite different names*

```diff
@@ -1,12 +1,15 @@
 *Black* classes
 ===============
 
 *Contents are subject to change.*
 
+Black Classes
+~~~~~~~~~~~~~~
+
 .. currentmodule:: black
 
 :class:`BracketTracker`
 -----------------------
 
 .. autoclass:: black.brackets.BracketTracker
     :members:
@@ -14,14 +17,20 @@
 :class:`Line`
 -------------
 
 .. autoclass:: black.lines.Line
     :members:
     :special-members: __str__, __bool__
 
+:class:`RHSResult`
+-------------------------
+
+.. autoclass:: black.lines.RHSResult
+    :members:
+
 :class:`LinesBlock`
 -------------------------
 
 .. autoclass:: black.lines.LinesBlock
     :members:
 
 :class:`EmptyLineTracker`
@@ -39,44 +48,180 @@
 
 :class:`ProtoComment`
 ---------------------
 
 .. autoclass:: black.comments.ProtoComment
     :members:
 
+:class:`Mode`
+---------------------
+
+.. autoclass:: black.mode.Mode
+    :members:
+
 :class:`Report`
 ---------------
 
 .. autoclass:: black.report.Report
     :members:
     :special-members: __str__
 
+:class:`Ok`
+---------------
+
+.. autoclass:: black.rusty.Ok
+    :show-inheritance:
+    :members:
+
+:class:`Err`
+---------------
+
+.. autoclass:: black.rusty.Err
+    :show-inheritance:
+    :members:
+
 :class:`Visitor`
 ----------------
 
 .. autoclass:: black.nodes.Visitor
     :show-inheritance:
     :members:
 
-Enums
-=====
+:class:`StringTransformer`
+----------------------------
 
-:class:`Changed`
-----------------
+.. autoclass:: black.trans.StringTransformer
+    :show-inheritance:
+    :members:
 
-.. autoclass:: black.Changed
+:class:`CustomSplit`
+----------------------------
+
+.. autoclass:: black.trans.CustomSplit
+    :members:
+
+:class:`CustomSplitMapMixin`
+-----------------------------
+
+.. autoclass:: black.trans.CustomSplitMapMixin
     :show-inheritance:
     :members:
 
-:class:`Mode`
------------------
+:class:`StringMerger`
+----------------------
 
-.. autoclass:: black.Mode
+.. autoclass:: black.trans.StringMerger
+    :show-inheritance:
+    :members:
+
+:class:`StringParenStripper`
+-----------------------------
+
+.. autoclass:: black.trans.StringParenStripper
+    :show-inheritance:
+    :members:
+
+:class:`BaseStringSplitter`
+-----------------------------
+
+.. autoclass:: black.trans.BaseStringSplitter
+    :show-inheritance:
+    :members:
+
+:class:`StringSplitter`
+-----------------------------
+
+.. autoclass:: black.trans.StringSplitter
+    :show-inheritance:
+    :members:
+
+:class:`StringParenWrapper`
+-----------------------------
+
+.. autoclass:: black.trans.StringParenWrapper
+    :show-inheritance:
+    :members:
+
+:class:`StringParser`
+-----------------------------
+
+.. autoclass:: black.trans.StringParser
+    :members:
+
+:class:`DebugVisitor`
+------------------------
+
+.. autoclass:: black.debug.DebugVisitor
+    :show-inheritance:
+    :members:
+
+:class:`Replacement`
+------------------------
+
+.. autoclass:: black.handle_ipynb_magics.Replacement
+    :members:
+
+:class:`CellMagic`
+------------------------
+
+.. autoclass:: black.handle_ipynb_magics.CellMagic
+    :members:
+
+:class:`CellMagicFinder`
+------------------------
+
+.. autoclass:: black.handle_ipynb_magics.CellMagicFinder
+    :show-inheritance:
+    :members:
+
+:class:`OffsetAndMagic`
+------------------------
+
+.. autoclass:: black.handle_ipynb_magics.OffsetAndMagic
+    :members:
+
+:class:`MagicFinder`
+------------------------
+
+.. autoclass:: black.handle_ipynb_magics.MagicFinder
+    :show-inheritance:
+    :members:
+
+Enum Classes
+~~~~~~~~~~~~~
+
+Classes inherited from Python `Enum <https://docs.python.org/3/library/enum.html#enum.Enum>`_ class.
+
+:class:`Changed`
+----------------
+
+.. autoclass:: black.report.Changed
     :show-inheritance:
     :members:
 
 :class:`WriteBack`
 ------------------
 
 .. autoclass:: black.WriteBack
     :show-inheritance:
     :members:
+
+:class:`TargetVersion`
+----------------------
+
+.. autoclass:: black.mode.TargetVersion
+    :show-inheritance:
+    :members:
+
+:class:`Feature`
+------------------
+
+.. autoclass:: black.mode.Feature
+    :show-inheritance:
+    :members:
+
+:class:`Preview`
+------------------
+
+.. autoclass:: black.mode.Preview
+    :show-inheritance:
+    :members:
```

### Comparing `black-23.3.0/docs/contributing/reference/reference_functions.rst` & `black-23.7.0/docs/contributing/reference/reference_functions.rst`

 * *Files 1% similar despite different names*

```diff
@@ -161,16 +161,14 @@
 
 .. autofunction:: black.strings.normalize_string_prefix
 
 .. autofunction:: black.strings.normalize_string_quotes
 
 .. autofunction:: black.linegen.normalize_invisible_parens
 
-.. autofunction:: black.patch_click
-
 .. autofunction:: black.nodes.preceding_leaf
 
 .. autofunction:: black.re_compile_maybe_verbose
 
 .. autofunction:: black.linegen.should_split_line
 
 .. autofunction:: black.concurrency.shutdown
```

### Comparing `black-23.3.0/docs/guides/introducing_black_to_your_project.md` & `black-23.7.0/docs/guides/introducing_black_to_your_project.md`

 * *Files 7% similar despite different names*

```diff
@@ -42,11 +42,10 @@
 ```console
 $ git config blame.ignoreRevsFile .git-blame-ignore-revs
 ```
 
 **The one caveat is that some online Git-repositories like GitLab do not yet support
 ignoring revisions using their native blame UI.** So blame information will be cluttered
 with a reformatting commit on those platforms. (If you'd like this feature, there's an
-open issue for [GitLab](https://gitlab.com/gitlab-org/gitlab/-/issues/31423)). This is
-however supported by
-[GitHub](https://docs.github.com/en/repositories/working-with-files/using-files/viewing-a-file#ignore-commits-in-the-blame-view),
-currently in beta.
+open issue for [GitLab](https://gitlab.com/gitlab-org/gitlab/-/issues/31423)).
+[GitHub supports `.git-blame-ignore-revs`](https://docs.github.com/en/repositories/working-with-files/using-files/viewing-a-file#ignore-commits-in-the-blame-view)
+by default in blame views however.
```

### Comparing `black-23.3.0/docs/guides/using_black_with_other_tools.md` & `black-23.7.0/docs/guides/using_black_with_other_tools.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/integrations/editors.md` & `black-23.7.0/docs/integrations/editors.md`

 * *Files 6% similar despite different names*

```diff
@@ -330,68 +330,14 @@
 
 To run _Black_ on a key press (e.g. F9 below), add this:
 
 ```
 nnoremap <F9> :Black<CR>
 ```
 
-#### Troubleshooting
-
-**How to get Vim with Python 3.6?** On Ubuntu 17.10 Vim comes with Python 3.6 by
-default. On macOS with Homebrew run: `brew install vim`. When building Vim from source,
-use: `./configure --enable-python3interp=yes`. There's many guides online how to do
-this.
-
-**I get an import error when using _Black_ from a virtual environment**: If you get an
-error message like this:
-
-```text
-Traceback (most recent call last):
-  File "<string>", line 63, in <module>
-  File "/home/gui/.vim/black/lib/python3.7/site-packages/black.py", line 45, in <module>
-    from typed_ast import ast3, ast27
-  File "/home/gui/.vim/black/lib/python3.7/site-packages/typed_ast/ast3.py", line 40, in <module>
-    from typed_ast import _ast3
-ImportError: /home/gui/.vim/black/lib/python3.7/site-packages/typed_ast/_ast3.cpython-37m-x86_64-linux-gnu.so: undefined symbool: PyExc_KeyboardInterrupt
-```
-
-Then you need to install `typed_ast` directly from the source code. The error happens
-because `pip` will download [Python wheels](https://pythonwheels.com/) if they are
-available. Python wheels are a new standard of distributing Python packages and packages
-that have Cython and extensions written in C are already compiled, so the installation
-is much more faster. The problem here is that somehow the Python environment inside Vim
-does not match with those already compiled C extensions and these kind of errors are the
-result. Luckily there is an easy fix: installing the packages from the source code.
-
-The package that causes problems is:
-
-- [typed-ast](https://pypi.org/project/typed-ast/)
-
-Now remove those two packages:
-
-```console
-$ pip uninstall typed-ast -y
-```
-
-And now you can install them with:
-
-```console
-$ pip install --no-binary :all: typed-ast
-```
-
-The C extensions will be compiled and now Vim's Python environment will match. Note that
-you need to have the GCC compiler and the Python development files installed (on
-Ubuntu/Debian do `sudo apt-get install build-essential python3-dev`).
-
-If you later want to update _Black_, you should do it like this:
-
-```console
-$ pip install -U black --no-binary typed-ast
-```
-
 ### With ALE
 
 1. Install [`ale`](https://github.com/dense-analysis/ale)
 
 1. Install `black`
 
 1. Add this to your vimrc:
```

### Comparing `black-23.3.0/docs/integrations/github_actions.md` & `black-23.7.0/docs/integrations/github_actions.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/integrations/index.md` & `black-23.7.0/docs/integrations/index.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/integrations/source_version_control.md` & `black-23.7.0/docs/integrations/source_version_control.md`

 * *Files 9% similar despite different names*

```diff
@@ -3,32 +3,48 @@
 Use [pre-commit](https://pre-commit.com/). Once you
 [have it installed](https://pre-commit.com/#install), add this to the
 `.pre-commit-config.yaml` in your repository:
 
 ```yaml
 repos:
   - repo: https://github.com/psf/black
-    rev: 23.3.0
+    rev: 23.7.0
     hooks:
       - id: black
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
-        language_version: python3.9
+        language_version: python3.11
 ```
 
 Feel free to switch out the `rev` value to something else, like another
 [tag/version][black-tags] or even a specific commit. Although we discourage the use of
 branches or other mutable refs since the hook [won't auto update as you may
 expect][pre-commit-mutable-rev].
 
-If you want support for Jupyter Notebooks as well, then replace `id: black` with
-`id: black-jupyter`.
+## Jupyter Notebooks
+
+There is an alternate hook `black-jupyter` that expands the targets of `black` to
+include Jupyter Notebooks. To use this hook, simply replace the hook's `id: black` with
+`id: black-jupyter` in the `.pre-commit-config.yaml`:
+
+```yaml
+repos:
+  - repo: https://github.com/psf/black
+    rev: 23.7.0
+    hooks:
+      - id: black-jupyter
+        # It is recommended to specify the latest version of Python
+        # supported by your project here, or alternatively use
+        # pre-commit's default_language_version, see
+        # https://pre-commit.com/#top_level-default_language_version
+        language_version: python3.11
+```
 
 ```{note}
-The `black-jupyter` hook is only available from version 21.8b0 and onwards.
+The `black-jupyter` hook became available in version 21.8b0.
 ```
 
 [black-tags]: https://github.com/psf/black/tags
 [pre-commit-mutable-rev]:
   https://pre-commit.com/#using-the-latest-version-for-a-repository
```

### Comparing `black-23.3.0/docs/the_black_code_style/current_style.md` & `black-23.7.0/docs/the_black_code_style/current_style.md`

 * *Files 2% similar despite different names*

```diff
@@ -136,14 +136,16 @@
 grammar to accept breaks that would otherwise be parse errors. That makes them confusing
 to look at and brittle to modify. This is why _Black_ always gets rid of them.
 
 If you're reaching for backslashes, that's a clear signal that you can do better if you
 slightly refactor your code. I hope some of the examples above show you that there are
 many ways in which you can do it.
 
+(labels/line-length)=
+
 ### Line length
 
 You probably noticed the peculiar default line length. _Black_ defaults to 88 characters
 per line, which happens to be 10% over 80. This number was found to produce
 significantly shorter files than sticking with 80 (the most popular), or even 79 (used
 by the standard library). In general,
 [90-ish seems like the wise choice](https://youtu.be/wf-BqAjZb8M?t=260).
@@ -154,41 +156,43 @@
 limit.
 
 You can also increase it, but remember that people with sight disabilities find it
 harder to work with line lengths exceeding 100 characters. It also adversely affects
 side-by-side diff review on typical screen resolutions. Long lines also make it harder
 to present code neatly in documentation or talk slides.
 
-If you're using Flake8, you can bump `max-line-length` to 88 and mostly forget about it.
-However, it's better if you use [Bugbear](https://github.com/PyCQA/flake8-bugbear)'s
-B950 warning instead of E501, and bump the max line length to 88 (or the `--line-length`
-you used for black), which will align more with black's _"try to respect
-`--line-length`, but don't become crazy if you can't"_. You'd do it like this:
-
-```ini
-[flake8]
-max-line-length = 88
-...
-select = C,E,F,W,B,B950
-extend-ignore = E203, E501
-```
+#### Flake8
 
-Explanation of why E203 is disabled can be found further in this documentation. And if
-you're curious about the reasoning behind B950,
-[Bugbear's documentation](https://github.com/PyCQA/flake8-bugbear#opinionated-warnings)
-explains it. The tl;dr is "it's like highway speed limits, we won't bother you if you
-overdo it by a few km/h".
-
-**If you're looking for a minimal, black-compatible flake8 configuration:**
-
-```ini
-[flake8]
-max-line-length = 88
-extend-ignore = E203
-```
+If you use Flake8, you have a few options:
+
+1. Recommended is using [Bugbear](https://github.com/PyCQA/flake8-bugbear) and enabling
+   its B950 check instead of using Flake8's E501, because it aligns with Black's 10%
+   rule. Install Bugbear and use the following config:
+
+   ```ini
+   [flake8]
+   max-line-length = 80
+   ...
+   select = C,E,F,W,B,B950
+   extend-ignore = E203, E501
+   ```
+
+   The rationale for E950 is explained in
+   [Bugbear's documentation](https://github.com/PyCQA/flake8-bugbear#opinionated-warnings).
+
+2. For a minimally compatible config:
+
+   ```ini
+   [flake8]
+   max-line-length = 88
+   extend-ignore = E203
+   ```
+
+An explanation of why E203 is disabled can be found in the [Slices section](#slices) of
+this page.
 
 ### Empty lines
 
 _Black_ avoids spurious vertical whitespace. This is in the spirit of PEP 8 which says
 that in-function vertical whitespace should only be used sparingly.
 
 _Black_ will allow single empty lines inside functions, and single and double empty
@@ -269,14 +273,16 @@
 comma in this situation and _Black_ didn't recognize it was safe to do so, put it there
 manually and _Black_ will keep it.
 
 A pre-existing trailing comma informs _Black_ to always explode contents of the current
 bracket pair into one item per line. Read more about this in the
 [Pragmatism](#pragmatism) section below.
 
+(labels/strings)=
+
 ### Strings
 
 _Black_ prefers double quotes (`"` and `"""`) over single quotes (`'` and `'''`). It
 will replace the latter with the former as long as it does not result in more backslash
 escapes than before.
 
 _Black_ also standardizes string prefixes. Prefix characters are made lowercase with the
@@ -453,14 +459,16 @@
 
 Early versions of _Black_ used to be absolutist in some respects. They took after its
 initial author. This was fine at the time as it made the implementation simpler and
 there were not many users anyway. Not many edge cases were reported. As a mature tool,
 _Black_ does make some exceptions to rules it otherwise holds. This section documents
 what those exceptions are and why this is the case.
 
+(labels/magic-trailing-comma)=
+
 ### The magic trailing comma
 
 _Black_ in general does not take existing formatting into account.
 
 However, there are cases where you put a short collection or function call in your code
 but you anticipate it will grow in the future.
 
@@ -489,14 +497,16 @@
 _Black_ normalizes string quotes as well as string prefixes, making them lowercase. One
 exception to this rule is r-strings. It turns out that the very popular
 [MagicPython](https://github.com/MagicStack/MagicPython/) syntax highlighter, used by
 default by (among others) GitHub and Visual Studio Code, differentiates between
 r-strings and R-strings. The former are syntax highlighted as regular expressions while
 the latter are treated as true raw strings with no special semantics.
 
+(labels/ast-changes)=
+
 ### AST before and after formatting
 
 When run with `--safe` (the default), _Black_ checks that the code before and after is
 semantically equivalent. This check is done by comparing the AST of the source with the
 AST of the target. There are three limited cases in which the AST does differ:
 
 1. _Black_ cleans up leading and trailing whitespace of docstrings, re-indenting them if
```

### Comparing `black-23.3.0/docs/the_black_code_style/future_style.md` & `black-23.7.0/docs/the_black_code_style/future_style.md`

 * *Files 2% similar despite different names*

```diff
@@ -43,14 +43,16 @@
     cm1 = exit_stack.enter_context(make_context_manager1())
     cm2 = exit_stack.enter_context(make_context_manager2())
     cm3 = exit_stack.enter_context(make_context_manager3())
     cm4 = exit_stack.enter_context(make_context_manager4())
     ...
 ```
 
+(labels/preview-style)=
+
 ## Preview style
 
 Experimental, potentially disruptive style changes are gathered under the `--preview`
 CLI flag. At the end of each year, these changes may be adopted into the default style,
 as described in [The Black Code Style](index.md). Because the functionality is
 experimental, feedback and issue reports are highly encouraged!
 
@@ -89,15 +91,14 @@
 ### Improved parentheses management
 
 For dict literals with long values, they are now wrapped in parentheses. Unnecessary
 parentheses are now removed. For example:
 
 ```python
 my_dict = {
-    my_dict = {
     "a key in my dict": a_very_long_variable
     * and_a_very_long_function_call()
     / 100000.0,
     "another key": (short_value),
 }
 ```
```

### Comparing `black-23.3.0/docs/the_black_code_style/index.md` & `black-23.7.0/docs/the_black_code_style/index.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/usage_and_configuration/black_as_a_server.md` & `black-23.7.0/docs/usage_and_configuration/black_as_a_server.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/usage_and_configuration/black_docker_image.md` & `black-23.7.0/docs/usage_and_configuration/black_docker_image.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/usage_and_configuration/file_collection_and_discovery.md` & `black-23.7.0/docs/usage_and_configuration/file_collection_and_discovery.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/usage_and_configuration/index.md` & `black-23.7.0/docs/usage_and_configuration/index.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/docs/usage_and_configuration/the_basics.md` & `black-23.7.0/docs/usage_and_configuration/the_basics.md`

 * *Files 21% similar despite different names*

```diff
@@ -22,70 +22,114 @@
 
 ```sh
 python -m black {source_file_or_directory}
 ```
 
 ### Command line options
 
-The CLI options of _Black_ can be displayed by expanding the view below or by running
-`black --help`. While _Black_ has quite a few knobs these days, it is still opinionated
-so style options are deliberately limited and rarely added.
+The CLI options of _Black_ can be displayed by running `black --help`. All options are
+also covered in more detail below.
 
-<details>
+While _Black_ has quite a few knobs these days, it is still opinionated so style options
+are deliberately limited and rarely added.
 
-<summary>CLI reference</summary>
+Note that all command-line options listed above can also be configured using a
+`pyproject.toml` file (more on that below).
+
+#### `-c`, `--code`
 
-```{program-output} black --help
+Format the code passed in as a string.
 
+```console
+$ black --code "print ( 'hello, world' )"
+print("hello, world")
 ```
 
-</details>
+#### `-l`, `--line-length`
 
-Note that all command-line options listed above can also be configured using a
-`pyproject.toml` file (more on that below).
+How many characters per line to allow. The default is 88.
 
-### Code input alternatives
+See also [the style documentation](labels/line-length).
 
-#### Standard Input
+#### `-t`, `--target-version`
 
-_Black_ supports formatting code via stdin, with the result being printed to stdout.
-Just let _Black_ know with `-` as the path.
+Python versions that should be supported by Black's output. You should include all
+versions that your code supports. If you support Python 3.7 through 3.10, you should
+write:
 
 ```console
-$ echo "print ( 'hello, world' )" | black -
-print("hello, world")
-reformatted -
-All done!   
-1 file reformatted.
+$ black -t py37 -t py38 -t py39 -t py310
 ```
 
-**Tip:** if you need _Black_ to treat stdin input as a file passed directly via the CLI,
-use `--stdin-filename`. Useful to make sure _Black_ will respect the `--force-exclude`
-option on some editors that rely on using stdin.
+In a [configuration file](#configuration-via-a-file), you can write:
 
-#### As a string
+```toml
+target-versions = ["py37", "py38", "py39", "py310"]
+```
 
-You can also pass code as a string using the `-c` / `--code` option.
+_Black_ uses this option to decide what grammar to use to parse your code. In addition,
+it may use it to decide what style to use. For example, support for a trailing comma
+after `*args` in a function call was added in Python 3.5, so _Black_ will add this comma
+only if the target versions are all Python 3.5 or higher:
 
 ```console
-$ black --code "print ( 'hello, world' )"
-print("hello, world")
+$ black --line-length=10 --target-version=py35 -c 'f(a, *args)'
+f(
+    a,
+    *args,
+)
+$ black --line-length=10 --target-version=py34 -c 'f(a, *args)'
+f(
+    a,
+    *args
+)
+$ black --line-length=10 --target-version=py34 --target-version=py35 -c 'f(a, *args)'
+f(
+    a,
+    *args
+)
 ```
 
-### Writeback and reporting
+#### `--pyi`
 
-By default _Black_ reformats the files given and/or found in place. Sometimes you need
-_Black_ to just tell you what it _would_ do without actually rewriting the Python files.
+Format all input files like typing stubs regardless of file extension. This is useful
+when piping source on standard input.
 
-There's two variations to this mode that are independently enabled by their respective
-flags. Both variations can be enabled at once.
+#### `--ipynb`
+
+Format all input files like Jupyter Notebooks regardless of file extension. This is
+useful when piping source on standard input.
+
+#### `--python-cell-magics`
+
+When processing Jupyter Notebooks, add the given magic to the list of known python-
+magics. Useful for formatting cells with custom python magics.
+
+#### `-S, --skip-string-normalization`
+
+By default, _Black_ uses double quotes for all strings and normalizes string prefixes,
+as described in [the style documentation](labels/strings). If this option is given,
+strings are left unchanged instead.
+
+#### `-C, --skip-magic-trailing-comma`
+
+By default, _Black_ uses existing trailing commas as an indication that short lines
+should be left separate, as described in
+[the style documentation](labels/magic-trailing-comma). If this option is given, the
+magic trailing comma is ignored.
+
+#### `--preview`
+
+Enable potentially disruptive style changes that may be added to Black's main
+functionality in the next major release. Read more about
+[our preview style](labels/preview-style).
 
 (labels/exit-code)=
 
-#### Exit code
+#### `--check`
 
 Passing `--check` will make _Black_ exit with:
 
 - code 0 if nothing would change;
 - code 1 if some files would be reformatted; or
 - code 123 if there was an internal error
 
@@ -107,49 +151,120 @@
 error: cannot format test.py: INTERNAL ERROR: Black produced code that is not equivalent to the source.  Please report a bug on https://github.com/psf/black/issues.  This diff might be helpful: /tmp/blk_kjdr1oog.log
 Oh no!   
 1 file would fail to reformat.
 $ echo $?
 123
 ```
 
-#### Diffs
+#### `--diff`
 
 Passing `--diff` will make _Black_ print out diffs that indicate what changes _Black_
 would've made. They are printed to stdout so capturing them is simple.
 
-If you'd like colored diffs, you can enable them with the `--color`.
+If you'd like colored diffs, you can enable them with `--color`.
 
 ```console
 $ black test.py --diff
---- test.py     2021-03-08 22:23:40.848954 +0000
-+++ test.py     2021-03-08 22:23:47.126319 +0000
+--- test.py     2021-03-08 22:23:40.848954+00:00
++++ test.py     2021-03-08 22:23:47.126319+00:00
 @@ -1 +1 @@
 -print ( 'hello, world' )
 +print("hello, world")
 would reformat test.py
 All done!   
 1 file would be reformatted.
 ```
 
-### Output verbosity
+#### `--color` / `--no-color`
 
-_Black_ in general tries to produce the right amount of output, balancing between
-usefulness and conciseness. By default, _Black_ emits files modified and error messages,
-plus a short summary.
+Show (or do not show) colored diff. Only applies when `--diff` is given.
+
+#### `--fast` / `--safe`
+
+By default, _Black_ performs [an AST safety check](labels/ast-changes) after formatting
+your code. The `--fast` flag turns off this check and the `--safe` flag explicitly
+enables it.
+
+#### `--required-version`
+
+Require a specific version of _Black_ to be running. This is useful for ensuring that
+all contributors to your project are using the same version, because different versions
+of _Black_ may format code a little differently. This option can be set in a
+configuration file for consistent results across environments.
 
 ```console
-$ black src/
+$ black --version
+black, 23.7.0 (compiled: yes)
+$ black --required-version 23.7.0 -c "format = 'this'"
+format = "this"
+$ black --required-version 31.5b2 -c "still = 'beta?!'"
+Oh no!    The required version does not match the running version!
+```
+
+You can also pass just the major version:
+
+```console
+$ black --required-version 22 -c "format = 'this'"
+format = "this"
+$ black --required-version 31 -c "still = 'beta?!'"
+Oh no!    The required version does not match the running version!
+```
+
+Because of our [stability policy](../the_black_code_style/index.md), this will guarantee
+stable formatting, but still allow you to take advantage of improvements that do not
+affect formatting.
+
+#### `--include`
+
+A regular expression that matches files and directories that should be included on
+recursive searches. An empty value means all files are included regardless of the name.
+Use forward slashes for directories on all platforms (Windows, too). Exclusions are
+calculated first, inclusions later.
+
+#### `--exclude`
+
+A regular expression that matches files and directories that should be excluded on
+recursive searches. An empty value means no paths are excluded. Use forward slashes for
+directories on all platforms (Windows, too). Exclusions are calculated first, inclusions
+later.
+
+#### `--extend-exclude`
+
+Like `--exclude`, but adds additional files and directories on top of the excluded ones.
+Useful if you simply want to add to the default.
+
+#### `--force-exclude`
+
+Like `--exclude`, but files and directories matching this regex will be excluded even
+when they are passed explicitly as arguments. This is useful when invoking _Black_
+programmatically on changed files, such as in a pre-commit hook or editor plugin.
+
+#### `--stdin-filename`
+
+The name of the file when passing it through stdin. Useful to make sure Black will
+respect the `--force-exclude` option on some editors that rely on using stdin.
+
+#### `-W`, `--workers`
+
+When _Black_ formats multiple files, it may use a process pool to speed up formatting.
+This option controls the number of parallel workers. This can also be specified via the
+`BLACK_NUM_WORKERS` environment variable.
+
+#### `-q`, `--quiet`
+
+Passing `-q` / `--quiet` will cause _Black_ to stop emitting all non-critical output.
+Error messages will still be emitted (which can silenced by `2>/dev/null`).
+
+```console
+$ black src/ -q
 error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio
-reformatted src/black_primer/lib.py
-reformatted src/blackd/__init__.py
-reformatted src/black/__init__.py
-Oh no!   
-3 files reformatted, 2 files left unchanged, 1 file failed to reformat.
 ```
 
+#### `-v`, `--verbose`
+
 Passing `-v` / `--verbose` will cause _Black_ to also emit messages about files that
 were not changed or were ignored due to exclusion patterns. If _Black_ is using a
 configuration file, a blue message detailing which one it is using will be emitted.
 
 ```console
 $ black src/ -v
 Using configuration from /tmp/pyproject.toml.
@@ -160,43 +275,94 @@
 reformatted src/black_primer/lib.py
 reformatted src/blackd/__init__.py
 reformatted src/black/__init__.py
 Oh no!   
 3 files reformatted, 2 files left unchanged, 1 file failed to reformat
 ```
 
-Passing `-q` / `--quiet` will cause _Black_ to stop emitting all non-critial output.
-Error messages will still be emitted (which can silenced by `2>/dev/null`).
+#### `--version`
+
+You can check the version of _Black_ you have installed using the `--version` flag.
 
 ```console
-$ black src/ -q
-error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio
+$ black --version
+black, 23.7.0
 ```
 
-### Versions
+#### `--config`
 
-You can check the version of _Black_ you have installed using the `--version` flag.
+Read configuration options from a configuration file. See
+[below](#configuration-via-a-file) for more details on the configuration file.
+
+#### `-h`, `--help`
+
+Show available command-line options and exit.
+
+### Environment variable options
+
+_Black_ supports the following configuration via environment variables.
+
+#### `BLACK_CACHE_DIR`
+
+The directory where _Black_ should store its cache.
+
+#### `BLACK_NUM_WORKERS`
+
+The number of parallel workers _Black_ should use. The command line option `-W` /
+`--workers` takes precedence over this environment variable.
+
+### Code input alternatives
+
+_Black_ supports formatting code via stdin, with the result being printed to stdout.
+Just let _Black_ know with `-` as the path.
 
 ```console
-$ black --version
-black, version 23.3.0
+$ echo "print ( 'hello, world' )" | black -
+print("hello, world")
+reformatted -
+All done!   
+1 file reformatted.
 ```
 
-An option to require a specific version to be running is also provided.
+**Tip:** if you need _Black_ to treat stdin input as a file passed directly via the CLI,
+use `--stdin-filename`. Useful to make sure _Black_ will respect the `--force-exclude`
+option on some editors that rely on using stdin.
+
+You can also pass code as a string using the `-c` / `--code` option.
+
+### Writeback and reporting
+
+By default _Black_ reformats the files given and/or found in place. Sometimes you need
+_Black_ to just tell you what it _would_ do without actually rewriting the Python files.
+
+There's two variations to this mode that are independently enabled by their respective
+flags:
+
+- `--check` (exit with code 1 if any file would be reformatted)
+- `--diff` (print a diff instead of reformatting files)
+
+Both variations can be enabled at once.
+
+### Output verbosity
+
+_Black_ in general tries to produce the right amount of output, balancing between
+usefulness and conciseness. By default, _Black_ emits files modified and error messages,
+plus a short summary.
 
 ```console
-$ black --required-version 21.9b0 -c "format = 'this'"
-format = "this"
-$ black --required-version 31.5b2 -c "still = 'beta?!'"
-Oh no!    The required version does not match the running version!
+$ black src/
+error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio
+reformatted src/black_primer/lib.py
+reformatted src/blackd/__init__.py
+reformatted src/black/__init__.py
+Oh no!   
+3 files reformatted, 2 files left unchanged, 1 file failed to reformat.
 ```
 
-This is useful for example when running _Black_ in multiple environments that haven't
-necessarily installed the correct version. This option can be set in a configuration
-file for consistent results across environments.
+The `--quiet` and `--verbose` flags control output verbosity.
 
 ## Configuration via a file
 
 _Black_ is able to read project-specific default values for its command line options
 from a `pyproject.toml` file. This is especially useful for specifying custom
 `--include` and `--exclude`/`--force-exclude`/`--extend-exclude` patterns for your
 project.
```

### Comparing `black-23.3.0/gallery/README.md` & `black-23.7.0/gallery/README.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/gallery/gallery.py` & `black-23.7.0/gallery/gallery.py`

 * *Files 1% similar despite different names*

```diff
@@ -239,19 +239,17 @@
             )
         git_switch_branch("main", repo=repo)
 
     git_switch_branch("main", repo=options.black_repo)
 
 
 def main() -> None:
-    parser = ArgumentParser(
-        description="""Black Gallery is a script that
+    parser = ArgumentParser(description="""Black Gallery is a script that
     automates the process of applying different Black versions to a selected
-    PyPI package and seeing the results between versions."""
-    )
+    PyPI package and seeing the results between versions.""")
 
     group = parser.add_mutually_exclusive_group(required=True)
     group.add_argument("-p", "--pypi-package", help="PyPI package to download.")
     group.add_argument(
         "-t", "--top-packages", help="Top n PyPI packages to download.", type=int
     )
```

### Comparing `black-23.3.0/plugin/black.vim` & `black-23.7.0/plugin/black.vim`

 * *Files identical despite different names*

### Comparing `black-23.3.0/scripts/check_pre_commit_rev_in_example.py` & `black-23.7.0/scripts/check_pre_commit_rev_in_example.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/scripts/check_version_in_basics_example.py` & `black-23.7.0/scripts/check_version_in_basics_example.py`

 * *Files 14% similar despite different names*

```diff
@@ -16,28 +16,29 @@
     changes_soup = BeautifulSoup(changes_html, "html.parser")
     headers = changes_soup.find_all("h2")
     tags = [header.string for header in headers if header.string != "Unreleased"]
     latest_tag = tags[0]
 
     the_basics_html = commonmark.commonmark(the_basics)
     the_basics_soup = BeautifulSoup(the_basics_html, "html.parser")
-    (version_example,) = [
+    version_examples = [
         code_block.string
         for code_block in the_basics_soup.find_all(class_="language-console")
         if "$ black --version" in code_block.string
     ]
 
     for tag in tags:
-        if tag in version_example and tag != latest_tag:
-            print(
-                "Please set the version in the ``black --version`` "
-                "example from ``the_basics.md`` to be the latest one.\n"
-                f"Expected {latest_tag}, got {tag}.\n"
-            )
-            sys.exit(1)
+        for version_example in version_examples:
+            if tag in version_example and tag != latest_tag:
+                print(
+                    "Please set the version in the ``black --version`` "
+                    "examples from ``the_basics.md`` to be the latest one.\n"
+                    f"Expected {latest_tag}, got {tag}.\n"
+                )
+                sys.exit(1)
 
 
 if __name__ == "__main__":
     with open("CHANGES.md", encoding="utf-8") as fd:
         changes = fd.read()
     with open(
         os.path.join("docs", "usage_and_configuration", "the_basics.md"),
```

### Comparing `black-23.3.0/scripts/diff_shades_gha_helper.py` & `black-23.7.0/scripts/diff_shades_gha_helper.py`

 * *Files 3% similar despite different names*

```diff
@@ -48,15 +48,21 @@
 
 
 def set_output(name: str, value: str) -> None:
     if len(value) < 200:
         print(f"[INFO]: setting '{name}' to '{value}'")
     else:
         print(f"[INFO]: setting '{name}' to [{len(value)} chars]")
-    print(f"::set-output name={name}::{value}")
+
+    # Originally the `set-output` workflow command was used here, now replaced
+    # by setting variables through the `GITHUB_OUTPUT` environment variable
+    # to stay up to date with GitHub's update.
+    if "GITHUB_OUTPUT" in os.environ:
+        with open(os.environ["GITHUB_OUTPUT"], "a") as f:
+            print(f"{name}={value}", file=f)
 
 
 def http_get(url: str, *, is_json: bool = True, **kwargs: Any) -> Any:
     headers = kwargs.get("headers") or {}
     headers["User-Agent"] = USER_AGENT
     if "github" in url:
         if GH_API_TOKEN:
```

### Comparing `black-23.3.0/scripts/fuzz.py` & `black-23.7.0/scripts/fuzz.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/scripts/make_width_table.py` & `black-23.7.0/scripts/make_width_table.py`

 * *Files 14% similar despite different names*

```diff
@@ -45,29 +45,21 @@
     if start_codepoint >= 0:
         yield (start_codepoint, end_codepoint, range_width)
 
 
 def main() -> None:
     table_path = join(dirname(__file__), "..", "src", "black", "_width_table.py")
     with open(table_path, "w") as f:
-        f.write(
-            f"""# Generated by {basename(__file__)}
+        f.write(f"""# Generated by {basename(__file__)}
 # wcwidth {wcwidth.__version__}
 # Unicode {wcwidth.list_versions()[-1]}
-import sys
-from typing import List, Tuple
-
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Final, List, Tuple
 
 WIDTH_TABLE: Final[List[Tuple[int, int, int]]] = [
-"""
-        )
+""")
         for triple in make_width_table():
             f.write(f"    {triple!r},\n")
         f.write("]\n")
 
 
 if __name__ == "__main__":
     main()
```

### Comparing `black-23.3.0/scripts/migrate-black.py` & `black-23.7.0/scripts/migrate-black.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/__init__.py` & `black-23.7.0/src/black/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 import platform
 import re
 import sys
 import tokenize
 import traceback
 from contextlib import contextmanager
 from dataclasses import replace
-from datetime import datetime
+from datetime import datetime, timezone
 from enum import Enum
 from json.decoder import JSONDecodeError
 from pathlib import Path
 from typing import (
     Any,
     Dict,
     Generator,
@@ -123,15 +123,17 @@
 ) -> Optional[str]:
     """Inject Black configuration from "pyproject.toml" into defaults in `ctx`.
 
     Returns the path to a successfully found and read configuration file, None
     otherwise.
     """
     if not value:
-        value = find_pyproject_toml(ctx.params.get("src", ()))
+        value = find_pyproject_toml(
+            ctx.params.get("src", ()), ctx.params.get("stdin_filename", None)
+        )
         if value is None:
             return None
 
     try:
         config = parse_pyproject_toml(value)
     except (OSError, ValueError) as e:
         raise click.FileError(
@@ -151,14 +153,24 @@
 
     target_version = config.get("target_version")
     if target_version is not None and not isinstance(target_version, list):
         raise click.BadOptionUsage(
             "target-version", "Config key target-version must be a list"
         )
 
+    exclude = config.get("exclude")
+    if exclude is not None and not isinstance(exclude, str):
+        raise click.BadOptionUsage("exclude", "Config key exclude must be a string")
+
+    extend_exclude = config.get("extend_exclude")
+    if extend_exclude is not None and not isinstance(extend_exclude, str):
+        raise click.BadOptionUsage(
+            "extend-exclude", "Config key extend-exclude must be a string"
+        )
+
     default_map: Dict[str, Any] = {}
     if ctx.default_map:
         default_map.update(ctx.default_map)
     default_map.update(config)
 
     ctx.default_map = default_map
     return value
@@ -358,26 +370,30 @@
         "Like --exclude, but files and directories matching this regex will be "
         "excluded even when they are passed explicitly as arguments."
     ),
 )
 @click.option(
     "--stdin-filename",
     type=str,
+    is_eager=True,
     help=(
         "The name of the file when passing it through stdin. Useful to make "
         "sure Black will respect --force-exclude option on some "
         "editors that rely on using stdin."
     ),
 )
 @click.option(
     "-W",
     "--workers",
     type=click.IntRange(min=1),
     default=None,
-    help="Number of parallel workers [default: number of CPUs in the system]",
+    help=(
+        "Number of parallel workers [default: BLACK_NUM_WORKERS environment variable "
+        "or number of CPUs in the system]"
+    ),
 )
 @click.option(
     "-q",
     "--quiet",
     is_flag=True,
     help=(
         "Don't emit non-error messages to stderr. Errors are still emitted; silence"
@@ -474,43 +490,21 @@
     if verbose:
         if root:
             out(
                 f"Identified `{root}` as project root containing a {method}.",
                 fg="blue",
             )
 
-            normalized = [
-                (
-                    (source, source)
-                    if source == "-"
-                    else (normalize_path_maybe_ignore(Path(source), root), source)
-                )
-                for source in src
-            ]
-            srcs_string = ", ".join(
-                [
-                    (
-                        f'"{_norm}"'
-                        if _norm
-                        else f'\033[31m"{source} (skipping - invalid)"\033[34m'
-                    )
-                    for _norm, source in normalized
-                ]
-            )
-            out(f"Sources to be formatted: {srcs_string}", fg="blue")
-
         if config:
             config_source = ctx.get_parameter_source("config")
             user_level_config = str(find_user_pyproject_toml())
             if config == user_level_config:
                 out(
-                    (
-                        "Using configuration from user-level config at "
-                        f"'{user_level_config}'."
-                    ),
+                    "Using configuration from user-level config at "
+                    f"'{user_level_config}'.",
                     fg="blue",
                 )
             elif config_source in (
                 ParameterSource.DEFAULT,
                 ParameterSource.DEFAULT_MAP,
             ):
                 out("Using configuration from project root.", fg="blue")
@@ -646,17 +640,23 @@
             p = Path(stdin_filename)
             is_stdin = True
         else:
             p = Path(s)
             is_stdin = False
 
         if is_stdin or p.is_file():
-            normalized_path = normalize_path_maybe_ignore(p, ctx.obj["root"], report)
+            normalized_path: Optional[str] = normalize_path_maybe_ignore(
+                p, ctx.obj["root"], report
+            )
             if normalized_path is None:
+                if verbose:
+                    out(f'Skipping invalid source: "{normalized_path}"', fg="red")
                 continue
+            if verbose:
+                out(f'Found input source: "{normalized_path}"', fg="blue")
 
             normalized_path = "/" + normalized_path
             # Hard-exclude any files that matches the `--force-exclude` regex.
             if force_exclude:
                 force_exclude_match = force_exclude.search(normalized_path)
             else:
                 force_exclude_match = None
@@ -671,14 +671,17 @@
                 verbose=verbose, quiet=quiet
             ):
                 continue
 
             sources.add(p)
         elif p.is_dir():
             p = root / normalize_path_maybe_ignore(p, ctx.obj["root"], report)
+            if verbose:
+                out(f'Found input source directory: "{p}"', fg="blue")
+
             if using_default_exclude:
                 gitignore = {
                     root: root_gitignore,
                     p: get_gitignore(p),
                 }
             sources.update(
                 gen_python_files(
@@ -691,17 +694,20 @@
                     report,
                     gitignore,
                     verbose=verbose,
                     quiet=quiet,
                 )
             )
         elif s == "-":
+            if verbose:
+                out("Found input source stdin", fg="blue")
             sources.add(p)
         else:
             err(f"invalid path: {s}")
+
     return sources
 
 
 def path_empty(
     src: Sized, msg: str, quiet: bool, verbose: bool, ctx: click.Context
 ) -> None:
     """
@@ -805,15 +811,15 @@
     `mode` and `fast` options are passed to :func:`format_file_contents`.
     """
     if src.suffix == ".pyi":
         mode = replace(mode, is_pyi=True)
     elif src.suffix == ".ipynb":
         mode = replace(mode, is_ipynb=True)
 
-    then = datetime.utcfromtimestamp(src.stat().st_mtime)
+    then = datetime.fromtimestamp(src.stat().st_mtime, timezone.utc)
     header = b""
     with open(src, "rb") as buf:
         if mode.skip_source_first_line:
             header = buf.readline()
         src_contents, encoding, newline = decode_bytes(buf.read())
     try:
         dst_contents = format_file_contents(src_contents, fast=fast, mode=mode)
@@ -826,17 +832,17 @@
     src_contents = header.decode(encoding) + src_contents
     dst_contents = header.decode(encoding) + dst_contents
 
     if write_back == WriteBack.YES:
         with open(src, "w", encoding=encoding, newline=newline) as f:
             f.write(dst_contents)
     elif write_back in (WriteBack.DIFF, WriteBack.COLOR_DIFF):
-        now = datetime.utcnow()
-        src_name = f"{src}\t{then} +0000"
-        dst_name = f"{src}\t{now} +0000"
+        now = datetime.now(timezone.utc)
+        src_name = f"{src}\t{then}"
+        dst_name = f"{src}\t{now}"
         if mode.is_ipynb:
             diff_contents = ipynb_diff(src_contents, dst_contents, src_name, dst_name)
         else:
             diff_contents = diff(src_contents, dst_contents, src_name, dst_name)
 
         if write_back == WriteBack.COLOR_DIFF:
             diff_contents = color_diff(diff_contents)
@@ -866,15 +872,15 @@
 
     If content is None, it's read from sys.stdin.
 
     If `write_back` is YES, write reformatted code back to stdout. If it is DIFF,
     write a diff to stdout. The `mode` argument is passed to
     :func:`format_file_contents`.
     """
-    then = datetime.utcnow()
+    then = datetime.now(timezone.utc)
 
     if content is None:
         src, encoding, newline = decode_bytes(sys.stdin.buffer.read())
     else:
         src, encoding, newline = content, "utf-8", ""
 
     dst = src
@@ -891,17 +897,17 @@
         )
         if write_back == WriteBack.YES:
             # Make sure there's a newline after the content
             if dst and dst[-1] != "\n":
                 dst += "\n"
             f.write(dst)
         elif write_back in (WriteBack.DIFF, WriteBack.COLOR_DIFF):
-            now = datetime.utcnow()
-            src_name = f"STDIN\t{then} +0000"
-            dst_name = f"STDOUT\t{now} +0000"
+            now = datetime.now(timezone.utc)
+            src_name = f"STDIN\t{then}"
+            dst_name = f"STDOUT\t{now}"
             d = diff(src, dst, src_name, dst_name)
             if write_back == WriteBack.COLOR_DIFF:
                 d = color_diff(d)
                 f = wrap_stream_for_windows(f)
             f.write(d)
         f.detach()
 
@@ -1273,14 +1279,17 @@
         elif (
             n.type == syms.tname_star
             and len(n.children) == 3
             and n.children[2].type == syms.star_expr
         ):
             features.add(Feature.VARIADIC_GENERICS)
 
+        elif n.type in (syms.type_stmt, syms.typeparams):
+            features.add(Feature.TYPE_PARAMS)
+
     return features
 
 
 def detect_target_versions(
     node: Node, *, future_imports: Optional[Set[str]] = None
 ) -> Set[TargetVersion]:
     """Detect the version to target based on the nodes used."""
@@ -1397,55 +1406,20 @@
     """Return an empty context manager.
 
     To be used like `nullcontext` in Python 3.7.
     """
     yield
 
 
-def patch_click() -> None:
-    """Make Click not crash on Python 3.6 with LANG=C.
-
-    On certain misconfigured environments, Python 3 selects the ASCII encoding as the
-    default which restricts paths that it can access during the lifetime of the
-    application.  Click refuses to work in this scenario by raising a RuntimeError.
-
-    In case of Black the likelihood that non-ASCII characters are going to be used in
-    file paths is minimal since it's Python source code.  Moreover, this crash was
-    spurious on Python 3.7 thanks to PEP 538 and PEP 540.
-    """
-    modules: List[Any] = []
-    try:
-        from click import core
-    except ImportError:
-        pass
-    else:
-        modules.append(core)
-    try:
-        # Removed in Click 8.1.0 and newer; we keep this around for users who have
-        # older versions installed.
-        from click import _unicodefun  # type: ignore
-    except ImportError:
-        pass
-    else:
-        modules.append(_unicodefun)
-
-    for module in modules:
-        if hasattr(module, "_verify_python3_env"):
-            module._verify_python3_env = lambda: None
-        if hasattr(module, "_verify_python_env"):
-            module._verify_python_env = lambda: None
-
-
 def patched_main() -> None:
     # PyInstaller patches multiprocessing to need freeze_support() even in non-Windows
     # environments so just assume we always need to call it if frozen.
     if getattr(sys, "frozen", False):
         from multiprocessing import freeze_support
 
         freeze_support()
 
-    patch_click()
     main()
 
 
 if __name__ == "__main__":
     patched_main()
```

### Comparing `black-23.3.0/src/black/_width_table.py` & `black-23.7.0/src/black/_width_table.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,17 +1,11 @@
 # Generated by make_width_table.py
 # wcwidth 0.2.6
 # Unicode 15.0.0
-import sys
-from typing import List, Tuple
-
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Final, List, Tuple
 
 WIDTH_TABLE: Final[List[Tuple[int, int, int]]] = [
     (0, 0, 0),
     (1, 31, -1),
     (127, 159, -1),
     (768, 879, 0),
     (1155, 1161, 0),
```

### Comparing `black-23.3.0/src/black/brackets.py` & `black-23.7.0/src/black/brackets.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,17 +1,11 @@
 """Builds on top of nodes.py to track brackets."""
 
-import sys
 from dataclasses import dataclass, field
-from typing import Dict, Iterable, List, Optional, Sequence, Set, Tuple, Union
-
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Dict, Final, Iterable, List, Optional, Sequence, Set, Tuple, Union
 
 from black.nodes import (
     BRACKET,
     CLOSING_BRACKETS,
     COMPARATORS,
     LOGIC_OPERATORS,
     MATH_OPERATORS,
```

### Comparing `black-23.3.0/src/black/cache.py` & `black-23.7.0/src/black/cache.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/comments.py` & `black-23.7.0/src/black/comments.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,17 +1,11 @@
 import re
-import sys
 from dataclasses import dataclass
 from functools import lru_cache
-from typing import Iterator, List, Optional, Union
-
-if sys.version_info >= (3, 8):
-    from typing import Final
-else:
-    from typing_extensions import Final
+from typing import Final, Iterator, List, Optional, Union
 
 from black.nodes import (
     CLOSING_BRACKETS,
     STANDALONE_COMMENT,
     WHITESPACE,
     container_of,
     first_leaf_of,
```

### Comparing `black-23.3.0/src/black/concurrency.py` & `black-23.7.0/src/black/concurrency.py`

 * *Files 2% similar despite different names*

```diff
@@ -76,15 +76,16 @@
     workers: Optional[int],
 ) -> None:
     """Reformat multiple files using a ProcessPoolExecutor."""
     maybe_install_uvloop()
 
     executor: Executor
     if workers is None:
-        workers = os.cpu_count() or 1
+        workers = int(os.environ.get("BLACK_NUM_WORKERS", 0))
+        workers = workers or os.cpu_count() or 1
     if sys.platform == "win32":
         # Work around https://bugs.python.org/issue26903
         workers = min(workers, 60)
     try:
         executor = ProcessPoolExecutor(max_workers=workers)
     except (ImportError, NotImplementedError, OSError):
         # we arrive here if the underlying system does not support multi-processing
```

### Comparing `black-23.3.0/src/black/debug.py` & `black-23.7.0/src/black/debug.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/files.py` & `black-23.7.0/src/black/files.py`

 * *Files 2% similar despite different names*

```diff
@@ -38,15 +38,15 @@
 from black.output import err
 from black.report import Report
 
 if TYPE_CHECKING:
     import colorama  # noqa: F401
 
 
-@lru_cache()
+@lru_cache
 def find_project_root(
     srcs: Sequence[str], stdin_filename: Optional[str] = None
 ) -> Tuple[Path, str]:
     """Return a directory containing .git, .hg, or pyproject.toml.
 
     That directory will be a common parent of all files and directories
     passed in `srcs`.
@@ -85,17 +85,19 @@
 
         if (directory / "pyproject.toml").is_file():
             return directory, "pyproject.toml"
 
     return directory, "file system root"
 
 
-def find_pyproject_toml(path_search_start: Tuple[str, ...]) -> Optional[str]:
+def find_pyproject_toml(
+    path_search_start: Tuple[str, ...], stdin_filename: Optional[str] = None
+) -> Optional[str]:
     """Find the absolute filepath to a pyproject.toml if it exists"""
-    path_project_root, _ = find_project_root(path_search_start)
+    path_project_root, _ = find_project_root(path_search_start, stdin_filename)
     path_pyproject_toml = path_project_root / "pyproject.toml"
     if path_pyproject_toml.is_file():
         return str(path_pyproject_toml)
 
     try:
         path_user_pyproject_toml = find_user_pyproject_toml()
         return (
@@ -206,15 +208,15 @@
             specifiers.append(s)
         else:
             specifiers.append(s)
 
     return SpecifierSet(",".join(str(s) for s in specifiers))
 
 
-@lru_cache()
+@lru_cache
 def find_user_pyproject_toml() -> Path:
     r"""Return the path to the top-level user configuration for black.
 
     This looks for ~\.black on Windows and ~/.config/black on Linux and other
     Unix systems.
 
     May raise:
@@ -226,15 +228,15 @@
         user_config_path = Path.home() / ".black"
     else:
         config_root = os.environ.get("XDG_CONFIG_HOME", "~/.config")
         user_config_path = Path(config_root).expanduser() / "black"
     return user_config_path.resolve()
 
 
-@lru_cache()
+@lru_cache
 def get_gitignore(root: Path) -> PathSpec:
     """Return a PathSpec matching gitignore content if present."""
     gitignore = root / ".gitignore"
     lines: List[str] = []
     if gitignore.is_file():
         with gitignore.open(encoding="utf-8") as gf:
             lines = gf.readlines()
@@ -270,23 +272,32 @@
         if report:
             report.path_ignored(path, f"cannot be read because {e}")
         return None
 
     return root_relative_path
 
 
-def path_is_ignored(
-    path: Path, gitignore_dict: Dict[Path, PathSpec], report: Report
+def _path_is_ignored(
+    root_relative_path: str,
+    root: Path,
+    gitignore_dict: Dict[Path, PathSpec],
+    report: Report,
 ) -> bool:
+    path = root / root_relative_path
+    # Note that this logic is sensitive to the ordering of gitignore_dict. Callers must
+    # ensure that gitignore_dict is ordered from least specific to most specific.
     for gitignore_path, pattern in gitignore_dict.items():
-        relative_path = normalize_path_maybe_ignore(path, gitignore_path, report)
-        if relative_path is None:
+        try:
+            relative_path = path.relative_to(gitignore_path).as_posix()
+        except ValueError:
             break
         if pattern.match_file(relative_path):
-            report.path_ignored(path, "matches a .gitignore file content")
+            report.path_ignored(
+                path.relative_to(root), "matches a .gitignore file content"
+            )
             return True
     return False
 
 
 def path_is_excluded(
     normalized_path: str,
     pattern: Optional[Pattern[str]],
@@ -320,15 +331,17 @@
     assert root.is_absolute(), f"INTERNAL ERROR: `root` must be absolute but is {root}"
     for child in paths:
         normalized_path = normalize_path_maybe_ignore(child, root, report)
         if normalized_path is None:
             continue
 
         # First ignore files matching .gitignore, if passed
-        if gitignore_dict and path_is_ignored(child, gitignore_dict, report):
+        if gitignore_dict and _path_is_ignored(
+            normalized_path, root, gitignore_dict, report
+        ):
             continue
 
         # Then ignore with `--exclude` `--extend-exclude` and `--force-exclude` options.
         normalized_path = "/" + normalized_path
         if child.is_dir():
             normalized_path += "/"
```

### Comparing `black-23.3.0/src/black/handle_ipynb_magics.py` & `black-23.7.0/src/black/handle_ipynb_magics.py`

 * *Files 1% similar despite different names*

```diff
@@ -51,19 +51,24 @@
 
 @dataclasses.dataclass(frozen=True)
 class Replacement:
     mask: str
     src: str
 
 
-@lru_cache()
+@lru_cache
 def jupyter_dependencies_are_installed(*, verbose: bool, quiet: bool) -> bool:
     try:
-        import IPython  # noqa:F401
+        # isort: off
+        # tokenize_rt is less commonly installed than IPython
+        # and IPython is expensive to import
         import tokenize_rt  # noqa:F401
+        import IPython  # noqa:F401
+
+        # isort: on
     except ModuleNotFoundError:
         if verbose or not quiet:
             msg = (
                 "Skipping .ipynb files as Jupyter dependencies are not installed.\n"
                 'You can fix this by running ``pip install "black[jupyter]"``'
             )
             out(msg)
@@ -326,15 +331,16 @@
 
     Note that the source of the abstract syntax tree
     will already have been processed by IPython's
     TransformerManager().transform_cell.
 
     For example,
 
-        %%time\nfoo()
+        %%time\n
+        foo()
 
     would have been transformed to
 
         get_ipython().run_cell_magic('time', '', 'foo()\\n')
 
     and we look for instances of the latter.
     """
```

### Comparing `black-23.3.0/src/black/linegen.py` & `black-23.7.0/src/black/linegen.py`

 * *Files 1% similar despite different names*

```diff
@@ -45,14 +45,15 @@
     is_name_token,
     is_one_sequence_between,
     is_one_tuple,
     is_rpar_token,
     is_stub_body,
     is_stub_suite,
     is_tuple_containing_walrus,
+    is_type_ignore_comment_string,
     is_vararg,
     is_walrus_assignment,
     is_yield,
     syms,
     wrap_in_parentheses,
 )
 from black.numerics import normalize_numeric_literal
@@ -211,14 +212,26 @@
         )
         for child in node.children:
             if is_name_token(child) and child.value in keywords:
                 yield from self.line()
 
             yield from self.visit(child)
 
+    def visit_typeparams(self, node: Node) -> Iterator[Line]:
+        yield from self.visit_default(node)
+        node.children[0].prefix = ""
+
+    def visit_typevartuple(self, node: Node) -> Iterator[Line]:
+        yield from self.visit_default(node)
+        node.children[1].prefix = ""
+
+    def visit_paramspec(self, node: Node) -> Iterator[Line]:
+        yield from self.visit_default(node)
+        node.children[1].prefix = ""
+
     def visit_dictsetmaker(self, node: Node) -> Iterator[Line]:
         if Preview.wrap_long_dict_values_in_parens in self.mode:
             for i, child in enumerate(node.children):
                 if i == 0:
                     continue
                 if node.children[i - 1].type == token.COLON:
                     if child.type == syms.atom and child.children[0].type == token.LPAR:
@@ -902,14 +915,21 @@
                     node.prev_sibling.type == RARROW
                     for node in (
                         leaves[0].parent,
                         getattr(leaves[0].parent, "parent", None),
                     )
                     if isinstance(node, Node) and isinstance(node.prev_sibling, Leaf)
                 )
+                # Except the false negatives above for PEP 604 unions where we
+                # can't add the comma.
+                and not (
+                    leaves[0].parent
+                    and leaves[0].parent.next_sibling
+                    and leaves[0].parent.next_sibling.type == token.VBAR
+                )
             )
 
             if original.is_import or no_commas:
                 for i in range(len(leaves) - 1, -1, -1):
                     if leaves[i].type == STANDALONE_COMMENT:
                         continue
 
@@ -1376,16 +1396,21 @@
             return False
 
     first = node.children[0]
     last = node.children[-1]
     if is_lpar_token(first) and is_rpar_token(last):
         middle = node.children[1]
         # make parentheses invisible
-        first.value = ""
-        last.value = ""
+        if (
+            # If the prefix of `middle` includes a type comment with
+            # ignore annotation, then we do not remove the parentheses
+            not is_type_ignore_comment_string(middle.prefix.strip())
+        ):
+            first.value = ""
+            last.value = ""
         maybe_make_parens_invisible_in_atom(
             middle,
             parent=parent,
             remove_brackets_around_comma=remove_brackets_around_comma,
         )
 
         if is_atom_with_invisible_parens(middle):
```

### Comparing `black-23.3.0/src/black/lines.py` & `black-23.7.0/src/black/lines.py`

 * *Files 0% similar despite different names*

```diff
@@ -24,14 +24,15 @@
     STANDALONE_COMMENT,
     TEST_DESCENDANTS,
     child_towards,
     is_import,
     is_multiline_string,
     is_one_sequence_between,
     is_type_comment,
+    is_type_ignore_comment,
     is_with_or_async_with_stmt,
     replace_child,
     syms,
     whitespace,
 )
 from black.strings import str_width
 from blib2to3.pgen2 import token
@@ -247,15 +248,15 @@
         # comments before it (since that could cause it to get hidden
         # behind a comment.
         comment_seen = False
         for leaf_id, comments in self.comments.items():
             for comment in comments:
                 if is_type_comment(comment):
                     if comment_seen or (
-                        not is_type_comment(comment, " ignore")
+                        not is_type_ignore_comment(comment)
                         and leaf_id not in ignored_ids
                     ):
                         return True
 
                 comment_seen = True
 
         return False
@@ -284,15 +285,15 @@
 
         if first_line == last_line:
             # We look at the last two leaves since a comma or an
             # invisible paren could have been added at the end of the
             # line.
             for node in self.leaves[-2:]:
                 for comment in self.comments.get(id(node), []):
-                    if is_type_comment(comment, " ignore"):
+                    if is_type_ignore_comment(comment):
                         return True
 
         return False
 
     def contains_multiline_strings(self) -> bool:
         return any(is_multiline_string(leaf) for leaf in self.leaves)
 
@@ -630,14 +631,16 @@
             return (before or 1), 0
 
         if (
             self.previous_line
             and self.previous_line.is_class
             and current_line.is_triple_quoted_string
         ):
+            if Preview.no_blank_line_before_class_docstring in current_line.mode:
+                return 0, 1
             return before, 1
 
         if self.previous_line and self.previous_line.opens_block:
             return 0, 0
         return before, 0
 
     def _maybe_empty_lines_for_class_or_def(
@@ -786,15 +789,15 @@
     # is needed to determine nesting level of the MLS.
     # Includes special case for trailing commas.
     commas: List[int] = []  # tracks number of commas per depth level
     multiline_string: Optional[Leaf] = None
     # store the leaves that contain parts of the MLS
     multiline_string_contexts: List[LN] = []
 
-    max_level_to_update = math.inf  # track the depth of the MLS
+    max_level_to_update: Union[int, float] = math.inf  # track the depth of the MLS
     for i, leaf in enumerate(line.leaves):
         if max_level_to_update == math.inf:
             had_comma: Optional[int] = None
             if leaf.bracket_depth + 1 > len(commas):
                 commas.append(0)
             elif leaf.bracket_depth + 1 < len(commas):
                 had_comma = commas.pop()
```

### Comparing `black-23.3.0/src/black/mode.py` & `black-23.7.0/src/black/mode.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,39 +1,34 @@
 """Data structures configuring Black behavior.
 
 Mostly around Python language feature support per version and Black configuration
 chosen by the user.
 """
 
-import sys
 from dataclasses import dataclass, field
 from enum import Enum, auto
 from hashlib import sha256
 from operator import attrgetter
-from typing import Dict, Set
+from typing import Dict, Final, Set
 from warnings import warn
 
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
-
 from black.const import DEFAULT_LINE_LENGTH
 
 
 class TargetVersion(Enum):
     PY33 = 3
     PY34 = 4
     PY35 = 5
     PY36 = 6
     PY37 = 7
     PY38 = 8
     PY39 = 9
     PY310 = 10
     PY311 = 11
+    PY312 = 12
 
 
 class Feature(Enum):
     F_STRINGS = 2
     NUMERIC_UNDERSCORES = 3
     TRAILING_COMMA_IN_CALL = 4
     TRAILING_COMMA_IN_DEF = 5
@@ -47,14 +42,15 @@
     PATTERN_MATCHING = 11
     UNPACKING_ON_FLOW = 12
     ANN_ASSIGN_EXTENDED_RHS = 13
     EXCEPT_STAR = 14
     VARIADIC_GENERICS = 15
     DEBUG_F_STRINGS = 16
     PARENTHESIZED_CONTEXT_MANAGERS = 17
+    TYPE_PARAMS = 18
     FORCE_OPTIONAL_PARENTHESES = 50
 
     # __future__ flags
     FUTURE_ANNOTATIONS = 51
 
 
 FUTURE_FLAG_TO_FEATURE: Final = {
@@ -139,14 +135,33 @@
         Feature.UNPACKING_ON_FLOW,
         Feature.ANN_ASSIGN_EXTENDED_RHS,
         Feature.PARENTHESIZED_CONTEXT_MANAGERS,
         Feature.PATTERN_MATCHING,
         Feature.EXCEPT_STAR,
         Feature.VARIADIC_GENERICS,
     },
+    TargetVersion.PY312: {
+        Feature.F_STRINGS,
+        Feature.DEBUG_F_STRINGS,
+        Feature.NUMERIC_UNDERSCORES,
+        Feature.TRAILING_COMMA_IN_CALL,
+        Feature.TRAILING_COMMA_IN_DEF,
+        Feature.ASYNC_KEYWORDS,
+        Feature.FUTURE_ANNOTATIONS,
+        Feature.ASSIGNMENT_EXPRESSIONS,
+        Feature.RELAXED_DECORATORS,
+        Feature.POS_ONLY_ARGUMENTS,
+        Feature.UNPACKING_ON_FLOW,
+        Feature.ANN_ASSIGN_EXTENDED_RHS,
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS,
+        Feature.PATTERN_MATCHING,
+        Feature.EXCEPT_STAR,
+        Feature.VARIADIC_GENERICS,
+        Feature.TYPE_PARAMS,
+    },
 }
 
 
 def supports_feature(target_versions: Set[TargetVersion], feature: Feature) -> bool:
     return all(feature in VERSION_TO_FEATURES[version] for version in target_versions)
 
 
@@ -154,14 +169,15 @@
     """Individual preview style features."""
 
     add_trailing_comma_consistently = auto()
     blank_line_after_nested_stub_class = auto()
     hex_codes_in_unicode_sequences = auto()
     improved_async_statements_handling = auto()
     multiline_string_handling = auto()
+    no_blank_line_before_class_docstring = auto()
     prefer_splitting_right_hand_side_of_assignments = auto()
     # NOTE: string_processing requires wrap_long_dict_values_in_parens
     # for https://github.com/psf/black/issues/3117 to be fixed.
     string_processing = auto()
     parenthesize_conditional_expressions = auto()
     skip_magic_trailing_comma_in_subscript = auto()
     wrap_long_dict_values_in_parens = auto()
@@ -184,18 +200,16 @@
     experimental_string_processing: bool = False
     python_cell_magics: Set[str] = field(default_factory=set)
     preview: bool = False
 
     def __post_init__(self) -> None:
         if self.experimental_string_processing:
             warn(
-                (
-                    "`experimental string processing` has been included in `preview`"
-                    " and deprecated. Use `preview` instead."
-                ),
+                "`experimental string processing` has been included in `preview`"
+                " and deprecated. Use `preview` instead.",
                 Deprecated,
             )
 
     def __contains__(self, feature: Preview) -> bool:
         """
         Provide `Preview.FEATURE in Mode` syntax that mirrors the ``preview`` flag.
```

### Comparing `black-23.3.0/src/black/nodes.py` & `black-23.7.0/src/black/nodes.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,14 @@
 """
 blib2to3 Node/Leaf transformation-related utility functions.
 """
 
 import sys
-from typing import Generic, Iterator, List, Optional, Set, Tuple, TypeVar, Union
+from typing import Final, Generic, Iterator, List, Optional, Set, Tuple, TypeVar, Union
 
-if sys.version_info >= (3, 8):
-    from typing import Final
-else:
-    from typing_extensions import Final
 if sys.version_info >= (3, 10):
     from typing import TypeGuard
 else:
     from typing_extensions import TypeGuard
 
 from mypy_extensions import mypyc_attr
 
@@ -177,17 +173,17 @@
 
 def whitespace(leaf: Leaf, *, complex_subscript: bool) -> str:  # noqa: C901
     """Return whitespace prefix if needed for the given `leaf`.
 
     `complex_subscript` signals whether the given leaf is part of a subscription
     which has non-trivial arguments, like arithmetic expressions or function calls.
     """
-    NO: Final = ""
-    SPACE: Final = " "
-    DOUBLESPACE: Final = "  "
+    NO: Final[str] = ""
+    SPACE: Final[str] = " "
+    DOUBLESPACE: Final[str] = "  "
     t = leaf.type
     p = leaf.parent
     v = leaf.value
     if t in ALWAYS_NO_SPACE:
         return NO
 
     if t == token.COMMENT:
@@ -714,36 +710,45 @@
 def is_multiline_string(leaf: Leaf) -> bool:
     """Return True if `leaf` is a multiline string that actually spans many lines."""
     return has_triple_quotes(leaf.value) and "\n" in leaf.value
 
 
 def is_stub_suite(node: Node) -> bool:
     """Return True if `node` is a suite with a stub body."""
+
+    # If there is a comment, we want to keep it.
+    if node.prefix.strip():
+        return False
+
     if (
         len(node.children) != 4
         or node.children[0].type != token.NEWLINE
         or node.children[1].type != token.INDENT
         or node.children[3].type != token.DEDENT
     ):
         return False
 
+    if node.children[3].prefix.strip():
+        return False
+
     return is_stub_body(node.children[2])
 
 
 def is_stub_body(node: LN) -> bool:
     """Return True if `node` is a simple statement containing an ellipsis."""
     if not isinstance(node, Node) or node.type != syms.simple_stmt:
         return False
 
     if len(node.children) != 2:
         return False
 
     child = node.children[0]
     return (
-        child.type == syms.atom
+        not child.prefix.strip()
+        and child.type == syms.atom
         and len(child.children) == 3
         and all(leaf == Leaf(token.DOT, ".") for leaf in child.children)
     )
 
 
 def is_atom_with_invisible_parens(node: LN) -> bool:
     """Given a `LN`, determines whether it's an atom `node` with invisible
@@ -812,20 +817,35 @@
     return bool(
         leaf.type == token.ASYNC
         and leaf.parent
         and leaf.parent.type in {syms.async_stmt, syms.async_funcdef}
     )
 
 
-def is_type_comment(leaf: Leaf, suffix: str = "") -> bool:
-    """Return True if the given leaf is a special comment.
-    Only returns true for type comments for now."""
+def is_type_comment(leaf: Leaf) -> bool:
+    """Return True if the given leaf is a type comment. This function should only
+    be used for general type comments (excluding ignore annotations, which should
+    use `is_type_ignore_comment`). Note that general type comments are no longer
+    used in modern version of Python, this function may be deprecated in the future."""
     t = leaf.type
     v = leaf.value
-    return t in {token.COMMENT, STANDALONE_COMMENT} and v.startswith("# type:" + suffix)
+    return t in {token.COMMENT, STANDALONE_COMMENT} and v.startswith("# type:")
+
+
+def is_type_ignore_comment(leaf: Leaf) -> bool:
+    """Return True if the given leaf is a type comment with ignore annotation."""
+    t = leaf.type
+    v = leaf.value
+    return t in {token.COMMENT, STANDALONE_COMMENT} and is_type_ignore_comment_string(v)
+
+
+def is_type_ignore_comment_string(value: str) -> bool:
+    """Return True if the given string match with type comment with
+    ignore annotation."""
+    return value.startswith("# type: ignore")
 
 
 def wrap_in_parentheses(parent: Node, child: LN, *, visible: bool = True) -> None:
     """Wrap `child` in parentheses.
 
     This replaces `child` with an atom holding the parentheses and the old
     child.  That requires moving the prefix.
```

### Comparing `black-23.3.0/src/black/numerics.py` & `black-23.7.0/src/black/numerics.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/output.py` & `black-23.7.0/src/black/output.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/parsing.py` & `black-23.7.0/src/black/parsing.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,50 +1,23 @@
 """
 Parse Python code and perform AST validation.
 """
 import ast
-import platform
 import sys
-from typing import Any, Iterable, Iterator, List, Set, Tuple, Type, Union
-
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Final, Iterable, Iterator, List, Set, Tuple
 
 from black.mode import VERSION_TO_FEATURES, Feature, TargetVersion, supports_feature
 from black.nodes import syms
 from blib2to3 import pygram
 from blib2to3.pgen2 import driver
 from blib2to3.pgen2.grammar import Grammar
 from blib2to3.pgen2.parse import ParseError
 from blib2to3.pgen2.tokenize import TokenError
 from blib2to3.pytree import Leaf, Node
 
-ast3: Any
-
-_IS_PYPY = platform.python_implementation() == "PyPy"
-
-try:
-    from typed_ast import ast3
-except ImportError:
-    if sys.version_info < (3, 8) and not _IS_PYPY:
-        print(
-            (
-                "The typed_ast package is required but not installed.\n"
-                "You can upgrade to Python 3.8+ or install typed_ast with\n"
-                "`python3 -m pip install typed-ast`."
-            ),
-            file=sys.stderr,
-        )
-        sys.exit(1)
-    else:
-        ast3 = ast
-
-
 PY2_HINT: Final = "Python 2 support was removed in version 22.0."
 
 
 class InvalidInput(ValueError):
     """Raised when input source code fails all parse attempts."""
 
 
@@ -145,39 +118,22 @@
     """Given a lib2to3 node, return its string representation."""
     code = str(node)
     return code
 
 
 def parse_single_version(
     src: str, version: Tuple[int, int], *, type_comments: bool
-) -> Union[ast.AST, ast3.AST]:
+) -> ast.AST:
     filename = "<unknown>"
-    # typed-ast is needed because of feature version limitations in the builtin ast 3.8>
-    if sys.version_info >= (3, 8) and version >= (3,):
-        return ast.parse(
-            src, filename, feature_version=version, type_comments=type_comments
-        )
-
-    if _IS_PYPY:
-        # PyPy 3.7 doesn't support type comment tracking which is not ideal, but there's
-        # not much we can do as typed-ast won't work either.
-        if sys.version_info >= (3, 8):
-            return ast3.parse(src, filename, type_comments=type_comments)
-        else:
-            return ast3.parse(src, filename)
-    else:
-        if type_comments:
-            # Typed-ast is guaranteed to be used here and automatically tracks type
-            # comments separately.
-            return ast3.parse(src, filename, feature_version=version[1])
-        else:
-            return ast.parse(src, filename)
+    return ast.parse(
+        src, filename, feature_version=version, type_comments=type_comments
+    )
 
 
-def parse_ast(src: str) -> Union[ast.AST, ast3.AST]:
+def parse_ast(src: str) -> ast.AST:
     # TODO: support Python 4+ ;)
     versions = [(3, minor) for minor in range(3, sys.version_info[1] + 1)]
 
     first_error = ""
     for version in sorted(versions, reverse=True):
         try:
             return parse_single_version(src, version, type_comments=True)
@@ -191,99 +147,81 @@
             return parse_single_version(src, version, type_comments=False)
         except SyntaxError:
             pass
 
     raise SyntaxError(first_error)
 
 
-ast3_AST: Final[Type[ast3.AST]] = ast3.AST
-
-
 def _normalize(lineend: str, value: str) -> str:
     # To normalize, we strip any leading and trailing space from
     # each line...
     stripped: List[str] = [i.strip() for i in value.splitlines()]
     normalized = lineend.join(stripped)
     # ...and remove any blank lines at the beginning and end of
     # the whole string
     return normalized.strip()
 
 
-def stringify_ast(node: Union[ast.AST, ast3.AST], depth: int = 0) -> Iterator[str]:
+def stringify_ast(node: ast.AST, depth: int = 0) -> Iterator[str]:
     """Simple visitor generating strings to compare ASTs by content."""
 
-    node = fixup_ast_constants(node)
+    if (
+        isinstance(node, ast.Constant)
+        and isinstance(node.value, str)
+        and node.kind == "u"
+    ):
+        # It's a quirk of history that we strip the u prefix over here. We used to
+        # rewrite the AST nodes for Python version compatibility and we never copied
+        # over the kind
+        node.kind = None
 
     yield f"{'  ' * depth}{node.__class__.__name__}("
 
-    type_ignore_classes: Tuple[Type[Any], ...]
     for field in sorted(node._fields):  # noqa: F402
-        # TypeIgnore will not be present using pypy < 3.8, so need for this
-        if not (_IS_PYPY and sys.version_info < (3, 8)):
-            # TypeIgnore has only one field 'lineno' which breaks this comparison
-            type_ignore_classes = (ast3.TypeIgnore,)
-            if sys.version_info >= (3, 8):
-                type_ignore_classes += (ast.TypeIgnore,)
-            if isinstance(node, type_ignore_classes):
-                break
+        # TypeIgnore has only one field 'lineno' which breaks this comparison
+        if isinstance(node, ast.TypeIgnore):
+            break
 
         try:
             value: object = getattr(node, field)
         except AttributeError:
             continue
 
         yield f"{'  ' * (depth+1)}{field}="
 
         if isinstance(value, list):
             for item in value:
                 # Ignore nested tuples within del statements, because we may insert
                 # parentheses and they change the AST.
                 if (
                     field == "targets"
-                    and isinstance(node, (ast.Delete, ast3.Delete))
-                    and isinstance(item, (ast.Tuple, ast3.Tuple))
+                    and isinstance(node, ast.Delete)
+                    and isinstance(item, ast.Tuple)
                 ):
                     for elt in item.elts:
                         yield from stringify_ast(elt, depth + 2)
 
-                elif isinstance(item, (ast.AST, ast3.AST)):
+                elif isinstance(item, ast.AST):
                     yield from stringify_ast(item, depth + 2)
 
-        # Note that we are referencing the typed-ast ASTs via global variables and not
-        # direct module attribute accesses because that breaks mypyc. It's probably
-        # something to do with the ast3 variables being marked as Any leading
-        # mypy to think this branch is always taken, leaving the rest of the code
-        # unanalyzed. Tighting up the types for the typed-ast AST types avoids the
-        # mypyc crash.
-        elif isinstance(value, (ast.AST, ast3_AST)):
+        elif isinstance(value, ast.AST):
             yield from stringify_ast(value, depth + 2)
 
         else:
             normalized: object
-            # Constant strings may be indented across newlines, if they are
-            # docstrings; fold spaces after newlines when comparing. Similarly,
-            # trailing and leading space may be removed.
             if (
                 isinstance(node, ast.Constant)
                 and field == "value"
                 and isinstance(value, str)
             ):
+                # Constant strings may be indented across newlines, if they are
+                # docstrings; fold spaces after newlines when comparing. Similarly,
+                # trailing and leading space may be removed.
                 normalized = _normalize("\n", value)
+            elif field == "type_comment" and isinstance(value, str):
+                # Trailing whitespace in type comments is removed.
+                normalized = value.rstrip()
             else:
                 normalized = value
             yield f"{'  ' * (depth+2)}{normalized!r},  # {value.__class__.__name__}"
 
     yield f"{'  ' * depth})  # /{node.__class__.__name__}"
-
-
-def fixup_ast_constants(node: Union[ast.AST, ast3.AST]) -> Union[ast.AST, ast3.AST]:
-    """Map ast nodes deprecated in 3.8 to Constant."""
-    if isinstance(node, (ast.Str, ast3.Str, ast.Bytes, ast3.Bytes)):
-        return ast.Constant(value=node.s)
-
-    if isinstance(node, (ast.Num, ast3.Num)):
-        return ast.Constant(value=node.n)
-
-    if isinstance(node, (ast.NameConstant, ast3.NameConstant)):
-        return ast.Constant(value=node.value)
-
-    return node
```

### Comparing `black-23.3.0/src/black/report.py` & `black-23.7.0/src/black/report.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/rusty.py` & `black-23.7.0/src/black/rusty.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/black/strings.py` & `black-23.7.0/src/black/strings.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,24 +1,18 @@
 """
 Simple formatting on strings. Further string formatting code is in trans.py.
 """
 
 import re
 import sys
 from functools import lru_cache
-from typing import List, Match, Pattern
-
-from blib2to3.pytree import Leaf
-
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Final, List, Match, Pattern
 
 from black._width_table import WIDTH_TABLE
+from blib2to3.pytree import Leaf
 
 STRING_PREFIX_CHARS: Final = "furbFURB"  # All possible string prefix characters.
 STRING_PREFIX_RE: Final = re.compile(
     r"^([" + STRING_PREFIX_CHARS + r"]*)(.*)$", re.DOTALL
 )
 FIRST_NON_WHITESPACE_RE: Final = re.compile(r"\s*\t+\s*(\S)")
 UNICODE_ESCAPE_RE: Final = re.compile(
```

### Comparing `black-23.3.0/src/black/trans.py` & `black-23.7.0/src/black/trans.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,37 +1,33 @@
 """
 String transformers that can split and merge strings.
 """
 import re
-import sys
 from abc import ABC, abstractmethod
 from collections import defaultdict
 from dataclasses import dataclass
 from typing import (
     Any,
     Callable,
     ClassVar,
     Collection,
     Dict,
+    Final,
     Iterable,
     Iterator,
     List,
+    Literal,
     Optional,
     Sequence,
     Set,
     Tuple,
     TypeVar,
     Union,
 )
 
-if sys.version_info < (3, 8):
-    from typing_extensions import Final, Literal
-else:
-    from typing import Literal, Final
-
 from mypy_extensions import trait
 
 from black.comments import contains_pragma_comment
 from black.lines import Line, append_leaves
 from black.mode import Feature, Mode
 from black.nodes import (
     CLOSING_BRACKETS,
@@ -201,35 +197,35 @@
         self.normalize_strings = normalize_strings
 
     @abstractmethod
     def do_match(self, line: Line) -> TMatchResult:
         """
         Returns:
             * Ok(string_indices) such that for each index, `line.leaves[index]`
-            is our target string if a match was able to be made. For
-            transformers that don't result in more lines (e.g. StringMerger,
-            StringParenStripper), multiple matches and transforms are done at
-            once to reduce the complexity.
-                OR
+              is our target string if a match was able to be made. For
+              transformers that don't result in more lines (e.g. StringMerger,
+              StringParenStripper), multiple matches and transforms are done at
+              once to reduce the complexity.
+              OR
             * Err(CannotTransform), if no match could be made.
         """
 
     @abstractmethod
     def do_transform(
         self, line: Line, string_indices: List[int]
     ) -> Iterator[TResult[Line]]:
         """
         Yields:
             * Ok(new_line) where new_line is the new transformed line.
-                OR
+              OR
             * Err(CannotTransform) if the transformation failed for some reason. The
-            `do_match(...)` template method should usually be used to reject
-            the form of the given Line, but in some cases it is difficult to
-            know whether or not a Line meets the StringTransformer's
-            requirements until the transformation is already midway.
+              `do_match(...)` template method should usually be used to reject
+              the form of the given Line, but in some cases it is difficult to
+              know whether or not a Line meets the StringTransformer's
+              requirements until the transformation is already midway.
 
         Side Effects:
             This method should NOT mutate @line directly, but it MAY mutate the
             Line's underlying Node structure. (WARNING: If the underlying Node
             structure IS altered, then this method should NOT be allowed to
             yield an CannotTransform after that point.)
         """
@@ -331,16 +327,16 @@
         self._CUSTOM_SPLIT_MAP[key] = tuple(custom_splits)
 
     def pop_custom_splits(self, string: str) -> List[CustomSplit]:
         """Custom Split Map Getter Method
 
         Returns:
             * A list of the custom splits that are mapped to @string, if any
-            exist.
-                OR
+              exist.
+              OR
             * [], otherwise.
 
         Side Effects:
             Deletes the mapping between @string and its associated custom
             splits (which are returned to the caller).
         """
         key = self._get_key(string)
@@ -361,22 +357,22 @@
 
 class StringMerger(StringTransformer, CustomSplitMapMixin):
     """StringTransformer that merges strings together.
 
     Requirements:
         (A) The line contains adjacent strings such that ALL of the validation checks
         listed in StringMerger._validate_msg(...)'s docstring pass.
-            OR
+        OR
         (B) The line contains a string which uses line continuation backslashes.
 
     Transformations:
         Depending on which of the two requirements above where met, either:
 
         (A) The string group associated with the target string is merged.
-            OR
+        OR
         (B) All line-continuation backslashes are removed from the target string.
 
     Collaborations:
         StringMerger provides custom split information to StringSplitter.
     """
 
     def do_match(self, line: Line) -> TMatchResult:
@@ -961,25 +957,28 @@
     """
     Abstract class for StringTransformers which transform a Line's strings by splitting
     them or placing them on their own lines where necessary to avoid going over
     the configured line length.
 
     Requirements:
         * The target string value is responsible for the line going over the
-        line length limit. It follows that after all of black's other line
-        split methods have been exhausted, this line (or one of the resulting
-        lines after all line splits are performed) would still be over the
-        line_length limit unless we split this string.
-            AND
+          line length limit. It follows that after all of black's other line
+          split methods have been exhausted, this line (or one of the resulting
+          lines after all line splits are performed) would still be over the
+          line_length limit unless we split this string.
+          AND
+
         * The target string is NOT a "pointless" string (i.e. a string that has
-        no parent or siblings).
-            AND
+          no parent or siblings).
+          AND
+
         * The target string is not followed by an inline comment that appears
-        to be a pragma.
-            AND
+          to be a pragma.
+          AND
+
         * The target string is not a multiline (i.e. triple-quote) string.
     """
 
     STRING_OPERATORS: Final = [
         token.EQEQUAL,
         token.GREATER,
         token.GREATEREQUAL,
@@ -1023,15 +1022,15 @@
         """
         Checks that @line meets all of the requirements listed in this classes'
         docstring. Refer to `help(BaseStringSplitter)` for a detailed
         description of those requirements.
 
         Returns:
             * Ok(None), if ALL of the requirements are met.
-                OR
+              OR
             * Err(CannotTransform), if ANY of the requirements are NOT met.
         """
         LL = line.leaves
 
         string_leaf = LL[string_idx]
 
         max_string_length = self._get_max_string_length(line, string_idx)
@@ -1182,27 +1181,41 @@
                 OR
             None, otherwise.
         """
         # The line must start with a string.
         if LL[0].type != token.STRING:
             return None
 
-        # If the string is surrounded by commas (or is the first/last child)...
-        prev_sibling = LL[0].prev_sibling
-        next_sibling = LL[0].next_sibling
-        if not prev_sibling and not next_sibling and parent_type(LL[0]) == syms.atom:
-            # If it's an atom string, we need to check the parent atom's siblings.
-            parent = LL[0].parent
-            assert parent is not None  # For type checkers.
-            prev_sibling = parent.prev_sibling
-            next_sibling = parent.next_sibling
-        if (not prev_sibling or prev_sibling.type == token.COMMA) and (
-            not next_sibling or next_sibling.type == token.COMMA
+        matching_nodes = [
+            syms.listmaker,
+            syms.dictsetmaker,
+            syms.testlist_gexp,
+        ]
+        # If the string is an immediate child of a list/set/tuple literal...
+        if (
+            parent_type(LL[0]) in matching_nodes
+            or parent_type(LL[0].parent) in matching_nodes
         ):
-            return 0
+            # And the string is surrounded by commas (or is the first/last child)...
+            prev_sibling = LL[0].prev_sibling
+            next_sibling = LL[0].next_sibling
+            if (
+                not prev_sibling
+                and not next_sibling
+                and parent_type(LL[0]) == syms.atom
+            ):
+                # If it's an atom string, we need to check the parent atom's siblings.
+                parent = LL[0].parent
+                assert parent is not None  # For type checkers.
+                prev_sibling = parent.prev_sibling
+                next_sibling = parent.next_sibling
+            if (not prev_sibling or prev_sibling.type == token.COMMA) and (
+                not next_sibling or next_sibling.type == token.COMMA
+            ):
+                return 0
 
         return None
 
 
 def iter_fexpr_spans(s: str) -> Iterator[Tuple[int, int]]:
     """
     Yields spans corresponding to expressions in a given f-string.
@@ -1281,17 +1294,17 @@
 class StringSplitter(BaseStringSplitter, CustomSplitMapMixin):
     """
     StringTransformer that splits "atom" strings (i.e. strings which exist on
     lines by themselves).
 
     Requirements:
         * The line consists ONLY of a single string (possibly prefixed by a
-        string operator [e.g. '+' or '==']), MAYBE a string trailer, and MAYBE
-        a trailing comma.
-            AND
+          string operator [e.g. '+' or '==']), MAYBE a string trailer, and MAYBE
+          a trailing comma.
+          AND
         * All of the requirements listed in BaseStringSplitter's docstring.
 
     Transformations:
         The string mentioned in the 'Requirements' section is split into as
         many substrings as necessary to adhere to the configured line length.
 
         In the final set of substrings, no substring should be smaller than
@@ -1790,33 +1803,34 @@
     StringTransformer that wraps strings in parens and then splits at the LPAR.
 
     Requirements:
         All of the requirements listed in BaseStringSplitter's docstring in
         addition to the requirements listed below:
 
         * The line is a return/yield statement, which returns/yields a string.
-            OR
+          OR
         * The line is part of a ternary expression (e.g. `x = y if cond else
-        z`) such that the line starts with `else <string>`, where <string> is
-        some string.
-            OR
+          z`) such that the line starts with `else <string>`, where <string> is
+          some string.
+          OR
         * The line is an assert statement, which ends with a string.
-            OR
+          OR
         * The line is an assignment statement (e.g. `x = <string>` or `x +=
-        <string>`) such that the variable is being assigned the value of some
-        string.
-            OR
+          <string>`) such that the variable is being assigned the value of some
+          string.
+          OR
         * The line is a dictionary key assignment where some valid key is being
-        assigned the value of some string.
-            OR
+          assigned the value of some string.
+          OR
         * The line is an lambda expression and the value is a string.
-            OR
+          OR
         * The line starts with an "atom" string that prefers to be wrapped in
-        parens. It's preferred to be wrapped when the string is surrounded by
-        commas (or is the first/last child).
+          parens. It's preferred to be wrapped when it's is an immediate child of
+          a list/set/tuple literal, AND the string is surrounded by commas (or is
+          the first/last child).
 
     Transformations:
         The chosen string is wrapped in parentheses and then split at the LPAR.
 
         We then have one line which ends with an LPAR and another line that
         starts with the chosen string. The latter line is then split again at
         the RPAR. This results in the RPAR (and possibly a trailing comma)
@@ -2254,33 +2268,33 @@
         """
         Pre-conditions:
             * @leaves[@string_idx].type == token.STRING
 
         Returns:
             The index directly after the last leaf which is apart of the string
             trailer, if a "trailer" exists.
-                OR
+            OR
             @string_idx + 1, if no string "trailer" exists.
         """
         assert leaves[string_idx].type == token.STRING
 
         idx = string_idx + 1
         while idx < len(leaves) and self._next_state(leaves[idx]):
             idx += 1
         return idx
 
     def _next_state(self, leaf: Leaf) -> bool:
         """
         Pre-conditions:
             * On the first call to this function, @leaf MUST be the leaf that
-            was directly after the string leaf in question (e.g. if our target
-            string is `line.leaves[i]` then the first call to this method must
-            be `line.leaves[i + 1]`).
+              was directly after the string leaf in question (e.g. if our target
+              string is `line.leaves[i]` then the first call to this method must
+              be `line.leaves[i + 1]`).
             * On the next call to this function, the leaf parameter passed in
-            MUST be the leaf directly following @leaf.
+              MUST be the leaf directly following @leaf.
 
         Returns:
             True iff @leaf is apart of the string's trailer.
         """
         # We ignore empty LPAR or RPAR leaves.
         if is_empty_par(leaf):
             return True
```

### Comparing `black-23.3.0/src/blackd/__init__.py` & `black-23.7.0/src/blackd/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 import asyncio
 import logging
 from concurrent.futures import Executor, ProcessPoolExecutor
-from datetime import datetime
+from datetime import datetime, timezone
 from functools import partial
 from multiprocessing import freeze_support
 from typing import Set, Tuple
 
 try:
     from aiohttp import web
 
@@ -55,17 +55,23 @@
 
 class InvalidVariantHeader(Exception):
     pass
 
 
 @click.command(context_settings={"help_option_names": ["-h", "--help"]})
 @click.option(
-    "--bind-host", type=str, help="Address to bind the server to.", default="localhost"
+    "--bind-host",
+    type=str,
+    help="Address to bind the server to.",
+    default="localhost",
+    show_default=True,
+)
+@click.option(
+    "--bind-port", type=int, help="Port to listen on", default=45484, show_default=True
 )
-@click.option("--bind-port", type=int, help="Port to listen on", default=45484)
 @click.version_option(version=black.__version__)
 def main(bind_host: str, bind_port: int) -> None:
     logging.basicConfig(level=logging.INFO)
     app = make_app()
     ver = black.__version__
     black.out(f"blackd version {ver} listening on {bind_host} port {bind_port}")
     web.run_app(app, host=bind_host, port=bind_port, handle_signals=True, print=None)
@@ -128,15 +134,15 @@
             string_normalization=not skip_string_normalization,
             magic_trailing_comma=not skip_magic_trailing_comma,
             preview=preview,
         )
         req_bytes = await request.content.read()
         charset = request.charset if request.charset is not None else "utf8"
         req_str = req_bytes.decode(charset)
-        then = datetime.utcnow()
+        then = datetime.now(timezone.utc)
 
         header = ""
         if skip_source_first_line:
             first_newline_position: int = req_str.find("\n") + 1
             header = req_str[:first_newline_position]
             req_str = req_str[first_newline_position:]
 
@@ -155,17 +161,17 @@
         # Put the source first line back
         req_str = header + req_str
         formatted_str = header + formatted_str
 
         # Only output the diff in the HTTP response
         only_diff = bool(request.headers.get(DIFF_HEADER, False))
         if only_diff:
-            now = datetime.utcnow()
-            src_name = f"In\t{then} +0000"
-            dst_name = f"Out\t{now} +0000"
+            now = datetime.now(timezone.utc)
+            src_name = f"In\t{then}"
+            dst_name = f"Out\t{now}"
             loop = asyncio.get_event_loop()
             formatted_str = await loop.run_in_executor(
                 executor,
                 partial(black.diff, req_str, formatted_str, src_name, dst_name),
             )
 
         return web.Response(
@@ -215,13 +221,12 @@
                 raise InvalidVariantHeader("expected e.g. '3.7', 'py3.5'") from None
         return False, versions
 
 
 def patched_main() -> None:
     maybe_install_uvloop()
     freeze_support()
-    black.patch_click()
     main()
 
 
 if __name__ == "__main__":
     patched_main()
```

### Comparing `black-23.3.0/src/blackd/middlewares.py` & `black-23.7.0/src/blackd/middlewares.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/blib2to3/Grammar.txt` & `black-23.7.0/src/blib2to3/Grammar.txt`

 * *Files 2% similar despite different names*

```diff
@@ -8,19 +8,25 @@
 #	single_input is a single interactive statement;
 #	eval_input is the input for the eval() and input() functions.
 # NB: compound_stmt in single_input is followed by extra NEWLINE!
 file_input: (NEWLINE | stmt)* ENDMARKER
 single_input: NEWLINE | simple_stmt | compound_stmt NEWLINE
 eval_input: testlist NEWLINE* ENDMARKER
 
+typevar: NAME [':' expr]
+paramspec: '**' NAME
+typevartuple: '*' NAME
+typeparam: typevar | paramspec | typevartuple
+typeparams: '[' typeparam (',' typeparam)* [','] ']'
+
 decorator: '@' namedexpr_test NEWLINE
 decorators: decorator+
 decorated: decorators (classdef | funcdef | async_funcdef)
 async_funcdef: ASYNC funcdef
-funcdef: 'def' NAME parameters ['->' test] ':' suite
+funcdef: 'def' NAME [typeparams] parameters ['->' test] ':' suite
 parameters: '(' [typedargslist] ')'
 
 # The following definition for typedarglist is equivalent to this set of rules:
 #
 #     arguments = argument (',' argument)*
 #     argument = tfpdef ['=' test]
 #     kwargs = '**' tname [',']
@@ -70,15 +76,15 @@
 
 vname: NAME
 vfpdef: vname | '(' vfplist ')'
 vfplist: vfpdef (',' vfpdef)* [',']
 
 stmt: simple_stmt | compound_stmt
 simple_stmt: small_stmt (';' small_stmt)* [';'] NEWLINE
-small_stmt: (expr_stmt | print_stmt  | del_stmt | pass_stmt | flow_stmt |
+small_stmt: (type_stmt | expr_stmt | print_stmt  | del_stmt | pass_stmt | flow_stmt |
              import_stmt | global_stmt | exec_stmt | assert_stmt)
 expr_stmt: testlist_star_expr (annassign | augassign (yield_expr|testlist) |
                      ('=' (yield_expr|testlist_star_expr))*)
 annassign: ':' test ['=' (yield_expr|testlist_star_expr)]
 testlist_star_expr: (test|star_expr) (',' (test|star_expr))* [',']
 augassign: ('+=' | '-=' | '*=' | '@=' | '/=' | '%=' | '&=' | '|=' | '^=' |
             '<<=' | '>>=' | '**=' | '//=')
@@ -101,14 +107,15 @@
 dotted_as_name: dotted_name ['as' NAME]
 import_as_names: import_as_name (',' import_as_name)* [',']
 dotted_as_names: dotted_as_name (',' dotted_as_name)*
 dotted_name: NAME ('.' NAME)*
 global_stmt: ('global' | 'nonlocal') NAME (',' NAME)*
 exec_stmt: 'exec' expr ['in' test [',' test]]
 assert_stmt: 'assert' test [',' test]
+type_stmt: "type" NAME [typeparams] '=' expr
 
 compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt | with_stmt | funcdef | classdef | decorated | async_stmt | match_stmt
 async_stmt: ASYNC (funcdef | with_stmt | for_stmt)
 if_stmt: 'if' namedexpr_test ':' suite ('elif' namedexpr_test ':' suite)* ['else' ':' suite]
 while_stmt: 'while' namedexpr_test ':' suite ['else' ':' suite]
 for_stmt: 'for' exprlist 'in' testlist_star_expr ':' suite ['else' ':' suite]
 try_stmt: ('try' ':' suite
@@ -170,15 +177,15 @@
 exprlist: (expr|star_expr) (',' (expr|star_expr))* [',']
 testlist: test (',' test)* [',']
 dictsetmaker: ( ((test ':' asexpr_test | '**' expr)
                  (comp_for | (',' (test ':' asexpr_test | '**' expr))* [','])) |
                 ((test [':=' test] | star_expr)
 		 (comp_for | (',' (test [':=' test] | star_expr))* [','])) )
 
-classdef: 'class' NAME ['(' [arglist] ')'] ':' suite
+classdef: 'class' NAME [typeparams] ['(' [arglist] ')'] ':' suite
 
 arglist: argument (',' argument)* [',']
 
 # "test '=' test" is really "keyword '=' test", but we have no such token.
 # These need to be in a single rule to avoid grammar that is ambiguous
 # to our LL(1) parser. Even though 'test' includes '*expr' in star_expr,
 # we explicitly match '*' here, too, to give it proper precedence.
```

### Comparing `black-23.3.0/src/blib2to3/LICENSE` & `black-23.7.0/src/blib2to3/LICENSE`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/blib2to3/PatternGrammar.txt` & `black-23.7.0/src/blib2to3/PatternGrammar.txt`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/blib2to3/README` & `black-23.7.0/src/blib2to3/README`

 * *Files identical despite different names*

### Comparing `black-23.3.0/src/blib2to3/pygram.py` & `black-23.7.0/src/blib2to3/pygram.py`

 * *Files 2% similar despite different names*

```diff
@@ -5,27 +5,26 @@
 
 # Python imports
 import os
 
 from typing import Union
 
 # Local imports
-from .pgen2 import token
 from .pgen2 import driver
 
 from .pgen2.grammar import Grammar
 
 # Moved into initialize because mypyc can't handle __file__ (XXX bug)
 # # The grammar file
 # _GRAMMAR_FILE = os.path.join(os.path.dirname(__file__), "Grammar.txt")
 # _PATTERN_GRAMMAR_FILE = os.path.join(os.path.dirname(__file__),
 #                                      "PatternGrammar.txt")
 
 
-class Symbols(object):
+class Symbols:
     def __init__(self, grammar: Grammar) -> None:
         """Initializer.
 
         Creates an attribute for each grammar symbol (nonterminal),
         whose value is the symbol's type (an int >= 256).
         """
         for name, symbol in grammar.symbol2number.items():
@@ -91,14 +90,15 @@
     old_comp_for: int
     old_comp_if: int
     old_comp_iter: int
     old_lambdef: int
     old_test: int
     or_test: int
     parameters: int
+    paramspec: int
     pass_stmt: int
     pattern: int
     patterns: int
     power: int
     print_stmt: int
     raise_stmt: int
     return_stmt: int
@@ -122,15 +122,20 @@
     testlist_star_expr: int
     tfpdef: int
     tfplist: int
     tname: int
     tname_star: int
     trailer: int
     try_stmt: int
+    type_stmt: int
     typedargslist: int
+    typeparam: int
+    typeparams: int
+    typevar: int
+    typevartuple: int
     varargslist: int
     vfpdef: int
     vfplist: int
     vname: int
     while_stmt: int
     with_stmt: int
     xor_expr: int
```

### Comparing `black-23.3.0/src/blib2to3/pytree.py` & `black-23.7.0/src/blib2to3/pytree.py`

 * *Files 1% similar despite different names*

```diff
@@ -14,15 +14,14 @@
 
 from typing import (
     Any,
     Dict,
     Iterator,
     List,
     Optional,
-    Text,
     Tuple,
     TypeVar,
     Union,
     Set,
     Iterable,
 )
 from blib2to3.pgen2.grammar import Grammar
@@ -30,18 +29,18 @@
 __author__ = "Guido van Rossum <guido@python.org>"
 
 import sys
 from io import StringIO
 
 HUGE: int = 0x7FFFFFFF  # maximum repeat count, default max
 
-_type_reprs: Dict[int, Union[Text, int]] = {}
+_type_reprs: Dict[int, Union[str, int]] = {}
 
 
-def type_repr(type_num: int) -> Union[Text, int]:
+def type_repr(type_num: int) -> Union[str, int]:
     global _type_reprs
     if not _type_reprs:
         from .pygram import python_symbols
 
         # printing tokens is possible but not as useful
         # from .pgen2 import token // token.__dict__.items():
         for name in dir(python_symbols):
@@ -50,19 +49,19 @@
                 _type_reprs[val] = name
     return _type_reprs.setdefault(type_num, type_num)
 
 
 _P = TypeVar("_P", bound="Base")
 
 NL = Union["Node", "Leaf"]
-Context = Tuple[Text, Tuple[int, int]]
-RawNode = Tuple[int, Optional[Text], Optional[Context], Optional[List[NL]]]
+Context = Tuple[str, Tuple[int, int]]
+RawNode = Tuple[int, Optional[str], Optional[Context], Optional[List[NL]]]
 
 
-class Base(object):
+class Base:
 
     """
     Abstract base class for Node and Leaf.
 
     This provides some default functionality and boilerplate using the
     template pattern.
 
@@ -88,15 +87,15 @@
         This calls the method _eq().
         """
         if self.__class__ is not other.__class__:
             return NotImplemented
         return self._eq(other)
 
     @property
-    def prefix(self) -> Text:
+    def prefix(self) -> str:
         raise NotImplementedError
 
     def _eq(self: _P, other: _P) -> bool:
         """
         Compare two nodes for equality.
 
         This is called by __eq__ and __ne__.  It is only called if the two nodes
@@ -221,15 +220,15 @@
             yield from child.leaves()
 
     def depth(self) -> int:
         if self.parent is None:
             return 0
         return 1 + self.parent.depth()
 
-    def get_suffix(self) -> Text:
+    def get_suffix(self) -> str:
         """
         Return the string immediately following the invocant node. This is
         effectively equivalent to node.next_sibling.prefix
         """
         next_sib = self.next_sibling
         if next_sib is None:
             return ""
@@ -238,22 +237,22 @@
 
 
 class Node(Base):
 
     """Concrete implementation for interior nodes."""
 
     fixers_applied: Optional[List[Any]]
-    used_names: Optional[Set[Text]]
+    used_names: Optional[Set[str]]
 
     def __init__(
         self,
         type: int,
         children: List[NL],
         context: Optional[Any] = None,
-        prefix: Optional[Text] = None,
+        prefix: Optional[str] = None,
         fixers_applied: Optional[List[Any]] = None,
     ) -> None:
         """
         Initializer.
 
         Takes a type constant (a symbol number >= 256), a sequence of
         child nodes, and an optional context keyword argument.
@@ -270,24 +269,24 @@
         if prefix is not None:
             self.prefix = prefix
         if fixers_applied:
             self.fixers_applied = fixers_applied[:]
         else:
             self.fixers_applied = None
 
-    def __repr__(self) -> Text:
+    def __repr__(self) -> str:
         """Return a canonical string representation."""
         assert self.type is not None
-        return "%s(%s, %r)" % (
+        return "{}({}, {!r})".format(
             self.__class__.__name__,
             type_repr(self.type),
             self.children,
         )
 
-    def __str__(self) -> Text:
+    def __str__(self) -> str:
         """
         Return a pretty string representation.
 
         This reproduces the input source exactly.
         """
         return "".join(map(str, self.children))
 
@@ -313,24 +312,24 @@
     def pre_order(self) -> Iterator[NL]:
         """Return a pre-order iterator for the tree."""
         yield self
         for child in self.children:
             yield from child.pre_order()
 
     @property
-    def prefix(self) -> Text:
+    def prefix(self) -> str:
         """
         The whitespace and comments preceding this node in the input.
         """
         if not self.children:
             return ""
         return self.children[0].prefix
 
     @prefix.setter
-    def prefix(self, prefix: Text) -> None:
+    def prefix(self, prefix: str) -> None:
         if self.children:
             self.children[0].prefix = prefix
 
     def set_child(self, i: int, child: NL) -> None:
         """
         Equivalent to 'node.children[i] = child'. This method also sets the
         child's parent attribute appropriately.
@@ -379,34 +378,34 @@
 
 
 class Leaf(Base):
 
     """Concrete implementation for leaf nodes."""
 
     # Default values for instance variables
-    value: Text
+    value: str
     fixers_applied: List[Any]
     bracket_depth: int
     # Changed later in brackets.py
     opening_bracket: Optional["Leaf"] = None
-    used_names: Optional[Set[Text]]
+    used_names: Optional[Set[str]]
     _prefix = ""  # Whitespace and comments preceding this token in the input
     lineno: int = 0  # Line where this token starts in the input
     column: int = 0  # Column where this token starts in the input
     # If not None, this Leaf is created by converting a block of fmt off/skip
     # code, and `fmt_pass_converted_first_leaf` points to the first Leaf in the
     # converted code.
     fmt_pass_converted_first_leaf: Optional["Leaf"] = None
 
     def __init__(
         self,
         type: int,
-        value: Text,
+        value: str,
         context: Optional[Context] = None,
-        prefix: Optional[Text] = None,
+        prefix: Optional[str] = None,
         fixers_applied: List[Any] = [],
         opening_bracket: Optional["Leaf"] = None,
         fmt_pass_converted_first_leaf: Optional["Leaf"] = None,
     ) -> None:
         """
         Initializer.
 
@@ -427,21 +426,21 @@
         self.fmt_pass_converted_first_leaf = fmt_pass_converted_first_leaf
 
     def __repr__(self) -> str:
         """Return a canonical string representation."""
         from .pgen2.token import tok_name
 
         assert self.type is not None
-        return "%s(%s, %r)" % (
+        return "{}({}, {!r})".format(
             self.__class__.__name__,
             tok_name.get(self.type, self.type),
             self.value,
         )
 
-    def __str__(self) -> Text:
+    def __str__(self) -> str:
         """
         Return a pretty string representation.
 
         This reproduces the input source exactly.
         """
         return self._prefix + str(self.value)
 
@@ -467,22 +466,22 @@
         yield self
 
     def pre_order(self) -> Iterator["Leaf"]:
         """Return a pre-order iterator for the tree."""
         yield self
 
     @property
-    def prefix(self) -> Text:
+    def prefix(self) -> str:
         """
         The whitespace and comments preceding this token in the input.
         """
         return self._prefix
 
     @prefix.setter
-    def prefix(self, prefix: Text) -> None:
+    def prefix(self, prefix: str) -> None:
         self.changed()
         self._prefix = prefix
 
 
 def convert(gr: Grammar, raw_node: RawNode) -> NL:
     """
     Convert raw node information to a Node or Leaf instance.
@@ -499,18 +498,18 @@
         if len(children) == 1:
             return children[0]
         return Node(type, children, context=context)
     else:
         return Leaf(type, value or "", context=context)
 
 
-_Results = Dict[Text, NL]
+_Results = Dict[str, NL]
 
 
-class BasePattern(object):
+class BasePattern:
 
     """
     A pattern is a tree matching pattern.
 
     It looks for a specific node type (token or symbol), and
     optionally for a specific content.
 
@@ -522,27 +521,27 @@
     - WildcardPattern matches a sequence of nodes of variable length.
     """
 
     # Defaults for instance variables
     type: Optional[int]
     type = None  # Node type (token if < 256, symbol if >= 256)
     content: Any = None  # Optional content matching pattern
-    name: Optional[Text] = None  # Optional name used to store match in results dict
+    name: Optional[str] = None  # Optional name used to store match in results dict
 
     def __new__(cls, *args, **kwds):
         """Constructor that prevents BasePattern from being instantiated."""
         assert cls is not BasePattern, "Cannot instantiate BasePattern"
         return object.__new__(cls)
 
-    def __repr__(self) -> Text:
+    def __repr__(self) -> str:
         assert self.type is not None
         args = [type_repr(self.type), self.content, self.name]
         while args and args[-1] is None:
             del args[-1]
-        return "%s(%s)" % (self.__class__.__name__, ", ".join(map(repr, args)))
+        return "{}({})".format(self.__class__.__name__, ", ".join(map(repr, args)))
 
     def _submatch(self, node, results=None) -> bool:
         raise NotImplementedError
 
     def optimize(self) -> "BasePattern":
         """
         A subclass can define this as a hook for optimizations.
@@ -598,16 +597,16 @@
             yield 1, r
 
 
 class LeafPattern(BasePattern):
     def __init__(
         self,
         type: Optional[int] = None,
-        content: Optional[Text] = None,
-        name: Optional[Text] = None,
+        content: Optional[str] = None,
+        name: Optional[str] = None,
     ) -> None:
         """
         Initializer.  Takes optional type, content, and name.
 
         The type, if given must be a token type (< 256).  If not given,
         this matches any *leaf* node; the content may still be required.
 
@@ -649,16 +648,16 @@
 class NodePattern(BasePattern):
 
     wildcards: bool = False
 
     def __init__(
         self,
         type: Optional[int] = None,
-        content: Optional[Iterable[Text]] = None,
-        name: Optional[Text] = None,
+        content: Optional[Iterable[str]] = None,
+        name: Optional[str] = None,
     ) -> None:
         """
         Initializer.  Takes optional type, content, and name.
 
         The type, if given, must be a symbol type (>= 256).  If the
         type is None this matches *any* single node (leaf or not),
         except if content is not None, in which it only matches
@@ -730,18 +729,18 @@
     """
 
     min: int
     max: int
 
     def __init__(
         self,
-        content: Optional[Text] = None,
+        content: Optional[str] = None,
         min: int = 0,
         max: int = HUGE,
-        name: Optional[Text] = None,
+        name: Optional[str] = None,
     ) -> None:
         """
         Initializer.
 
         Args:
             content: optional sequence of subsequences of patterns;
                      if absent, matches one node;
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/conv.py` & `black-23.7.0/src/blib2to3/pgen2/conv.py`

 * *Files 2% similar despite different names*

```diff
@@ -59,24 +59,24 @@
         nonterminals of the grammar as numbers.  We build two tables
         mapping the numbers to names and back.
 
         """
         try:
             f = open(filename)
         except OSError as err:
-            print("Can't open %s: %s" % (filename, err))
+            print(f"Can't open {filename}: {err}")
             return False
         self.symbol2number = {}
         self.number2symbol = {}
         lineno = 0
         for line in f:
             lineno += 1
             mo = re.match(r"^#define\s+(\w+)\s+(\d+)$", line)
             if not mo and line.strip():
-                print("%s(%s): can't parse %s" % (filename, lineno, line.strip()))
+                print(f"{filename}({lineno}): can't parse {line.strip()}")
             else:
                 symbol, number = mo.groups()
                 number = int(number)
                 assert symbol not in self.symbol2number
                 assert number not in self.number2symbol
                 self.symbol2number[symbol] = number
                 self.number2symbol[number] = symbol
@@ -109,15 +109,15 @@
                   ...
           };
 
         """
         try:
             f = open(filename)
         except OSError as err:
-            print("Can't open %s: %s" % (filename, err))
+            print(f"Can't open {filename}: {err}")
             return False
         # The code below essentially uses f's iterator-ness!
         lineno = 0
 
         # Expect the two #include lines
         lineno, line = lineno + 1, next(f)
         assert line == '#include "pgenheaders.h"\n', (lineno, line)
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/driver.py` & `black-23.7.0/src/blib2to3/pgen2/driver.py`

 * *Files 3% similar despite different names*

```diff
@@ -24,19 +24,16 @@
 from typing import (
     Any,
     cast,
     IO,
     Iterable,
     List,
     Optional,
-    Text,
     Iterator,
     Tuple,
-    TypeVar,
-    Generic,
     Union,
 )
 from contextlib import contextmanager
 from dataclasses import dataclass, field
 
 # Pgen imports
 from . import grammar, parse, token, tokenize, pgen
@@ -112,15 +109,15 @@
             self.eat(to)
         except StopIteration:
             return False
         else:
             return True
 
 
-class Driver(object):
+class Driver:
     def __init__(self, grammar: Grammar, logger: Optional[Logger] = None) -> None:
         self.grammar = grammar
         if logger is None:
             logger = logging.getLogger(__name__)
         self.logger = logger
 
     def parse_tokens(self, tokens: Iterable[GoodTokenInfo], debug: bool = False) -> NL:
@@ -185,38 +182,38 @@
         else:
             # We never broke out -- EOF is too soon (how can this happen???)
             assert start is not None
             raise parse.ParseError("incomplete input", type, value, (prefix, start))
         assert p.rootnode is not None
         return p.rootnode
 
-    def parse_stream_raw(self, stream: IO[Text], debug: bool = False) -> NL:
+    def parse_stream_raw(self, stream: IO[str], debug: bool = False) -> NL:
         """Parse a stream and return the syntax tree."""
         tokens = tokenize.generate_tokens(stream.readline, grammar=self.grammar)
         return self.parse_tokens(tokens, debug)
 
-    def parse_stream(self, stream: IO[Text], debug: bool = False) -> NL:
+    def parse_stream(self, stream: IO[str], debug: bool = False) -> NL:
         """Parse a stream and return the syntax tree."""
         return self.parse_stream_raw(stream, debug)
 
     def parse_file(
-        self, filename: Path, encoding: Optional[Text] = None, debug: bool = False
+        self, filename: Path, encoding: Optional[str] = None, debug: bool = False
     ) -> NL:
         """Parse a file and return the syntax tree."""
-        with io.open(filename, "r", encoding=encoding) as stream:
+        with open(filename, encoding=encoding) as stream:
             return self.parse_stream(stream, debug)
 
-    def parse_string(self, text: Text, debug: bool = False) -> NL:
+    def parse_string(self, text: str, debug: bool = False) -> NL:
         """Parse a string and return the syntax tree."""
         tokens = tokenize.generate_tokens(
             io.StringIO(text).readline, grammar=self.grammar
         )
         return self.parse_tokens(tokens, debug)
 
-    def _partially_consume_prefix(self, prefix: Text, column: int) -> Tuple[Text, Text]:
+    def _partially_consume_prefix(self, prefix: str, column: int) -> Tuple[str, str]:
         lines: List[str] = []
         current_line = ""
         current_column = 0
         wait_for_nl = False
         for char in prefix:
             current_line += char
             if wait_for_nl:
@@ -236,28 +233,28 @@
                 current_column = 0
             else:
                 # indent is finished
                 wait_for_nl = True
         return "".join(lines), current_line
 
 
-def _generate_pickle_name(gt: Path, cache_dir: Optional[Path] = None) -> Text:
+def _generate_pickle_name(gt: Path, cache_dir: Optional[Path] = None) -> str:
     head, tail = os.path.splitext(gt)
     if tail == ".txt":
         tail = ""
     name = head + tail + ".".join(map(str, sys.version_info)) + ".pickle"
     if cache_dir:
         return os.path.join(cache_dir, os.path.basename(name))
     else:
         return name
 
 
 def load_grammar(
-    gt: Text = "Grammar.txt",
-    gp: Optional[Text] = None,
+    gt: str = "Grammar.txt",
+    gp: Optional[str] = None,
     save: bool = True,
     force: bool = False,
     logger: Optional[Logger] = None,
 ) -> Grammar:
     """Load the grammar (maybe from a pickle)."""
     if logger is None:
         logger = logging.getLogger(__name__)
@@ -272,25 +269,25 @@
                 pass
     else:
         g = grammar.Grammar()
         g.load(gp)
     return g
 
 
-def _newer(a: Text, b: Text) -> bool:
+def _newer(a: str, b: str) -> bool:
     """Inquire whether file a was written since file b."""
     if not os.path.exists(a):
         return False
     if not os.path.exists(b):
         return True
     return os.path.getmtime(a) >= os.path.getmtime(b)
 
 
 def load_packaged_grammar(
-    package: str, grammar_source: Text, cache_dir: Optional[Path] = None
+    package: str, grammar_source: str, cache_dir: Optional[Path] = None
 ) -> grammar.Grammar:
     """Normally, loads a pickled grammar by doing
         pkgutil.get_data(package, pickled_grammar)
     where *pickled_grammar* is computed from *grammar_source* by adding the
     Python version and using a ``.pickle`` extension.
 
     However, if *grammar_source* is an extant file, load_grammar(grammar_source)
@@ -305,15 +302,15 @@
     data = pkgutil.get_data(package, pickled_name)
     assert data is not None
     g = grammar.Grammar()
     g.loads(data)
     return g
 
 
-def main(*args: Text) -> bool:
+def main(*args: str) -> bool:
     """Main program, when run as a script: produce grammar pickle files.
 
     Calls load_grammar for each argument, a path to a grammar text file.
     """
     if not args:
         args = tuple(sys.argv[1:])
     logging.basicConfig(level=logging.INFO, stream=sys.stdout, format="%(message)s")
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/grammar.py` & `black-23.7.0/src/blib2to3/pgen2/grammar.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,27 +12,27 @@
 
 """
 
 # Python imports
 import os
 import pickle
 import tempfile
-from typing import Any, Dict, List, Optional, Text, Tuple, TypeVar, Union
+from typing import Any, Dict, List, Optional, Tuple, TypeVar, Union
 
 # Local imports
 from . import token
 
 _P = TypeVar("_P", bound="Grammar")
-Label = Tuple[int, Optional[Text]]
+Label = Tuple[int, Optional[str]]
 DFA = List[List[Tuple[int, int]]]
 DFAS = Tuple[DFA, Dict[int, int]]
 Path = Union[str, "os.PathLike[str]"]
 
 
-class Grammar(object):
+class Grammar:
     """Pgen parsing tables conversion class.
 
     Once initialized, this class supplies the grammar tables for the
     parsing engine implemented by parse.py.  The parsing engine
     accesses the instance variables directly.  The class here does not
     provide initialization of the tables; several subclasses exist to
     do this (see the conv and pgen modules).
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/literals.py` & `black-23.7.0/src/blib2to3/pgen2/literals.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,32 +1,32 @@
 # Copyright 2004-2005 Elemental Security, Inc. All Rights Reserved.
 # Licensed to PSF under a Contributor Agreement.
 
 """Safely evaluate Python string literals without using eval()."""
 
 import re
 
-from typing import Dict, Match, Text
+from typing import Dict, Match
 
 
-simple_escapes: Dict[Text, Text] = {
+simple_escapes: Dict[str, str] = {
     "a": "\a",
     "b": "\b",
     "f": "\f",
     "n": "\n",
     "r": "\r",
     "t": "\t",
     "v": "\v",
     "'": "'",
     '"': '"',
     "\\": "\\",
 }
 
 
-def escape(m: Match[Text]) -> Text:
+def escape(m: Match[str]) -> str:
     all, tail = m.group(0, 1)
     assert all.startswith("\\")
     esc = simple_escapes.get(tail)
     if esc is not None:
         return esc
     if tail.startswith("x"):
         hexes = tail[1:]
@@ -40,15 +40,15 @@
         try:
             i = int(tail, 8)
         except ValueError:
             raise ValueError("invalid octal string escape ('\\%s')" % tail) from None
     return chr(i)
 
 
-def evalString(s: Text) -> Text:
+def evalString(s: str) -> str:
     assert s.startswith("'") or s.startswith('"'), repr(s[:1])
     q = s[0]
     if s[:3] == q * 3:
         q = q * 3
     assert s.endswith(q), repr(s[-len(q) :])
     assert len(s) >= 2 * len(q)
     s = s[len(q) : -len(q)]
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/parse.py` & `black-23.7.0/src/blib2to3/pgen2/parse.py`

 * *Files 3% similar despite different names*

```diff
@@ -5,24 +5,22 @@
 
 The grammar table must be loaded first.
 
 See Parser/parser.c in the Python distribution for additional info on
 how this parsing engine works.
 
 """
-import copy
 from contextlib import contextmanager
 
 # Local imports
 from . import grammar, token, tokenize
 from typing import (
     cast,
     Any,
     Optional,
-    Text,
     Union,
     Tuple,
     Dict,
     List,
     Iterator,
     Callable,
     Set,
@@ -31,15 +29,15 @@
 from blib2to3.pgen2.grammar import Grammar
 from blib2to3.pytree import convert, NL, Context, RawNode, Leaf, Node
 
 if TYPE_CHECKING:
     from blib2to3.pgen2.driver import TokenProxy
 
 
-Results = Dict[Text, NL]
+Results = Dict[str, NL]
 Convert = Callable[[Grammar, RawNode], Union[Node, Leaf]]
 DFA = List[List[Tuple[int, int]]]
 DFAS = Tuple[DFA, Dict[int, int]]
 
 
 def lam_sub(grammar: Grammar, node: RawNode) -> NL:
     assert node[3] is not None
@@ -96,29 +94,29 @@
         is_backtracking = self.parser.is_backtracking
         try:
             self.parser.is_backtracking = True
             yield
         finally:
             self.parser.is_backtracking = is_backtracking
 
-    def add_token(self, tok_type: int, tok_val: Text, raw: bool = False) -> None:
+    def add_token(self, tok_type: int, tok_val: str, raw: bool = False) -> None:
         func: Callable[..., Any]
         if raw:
             func = self.parser._addtoken
         else:
             func = self.parser.addtoken
 
         for ilabel in self.ilabels:
             with self.switch_to(ilabel):
                 args = [tok_type, tok_val, self.context]
                 if raw:
                     args.insert(0, ilabel)
                 func(*args)
 
-    def determine_route(self, value: Optional[Text] = None, force: bool = False) -> Optional[int]:
+    def determine_route(self, value: Optional[str] = None, force: bool = False) -> Optional[int]:
         alive_ilabels = self.ilabels
         if len(alive_ilabels) == 0:
             *_, most_successful_ilabel = self._dead_ilabels
             raise ParseError("bad input", most_successful_ilabel, value, self.context)
 
         ilabel, *rest = alive_ilabels
         if force or not rest:
@@ -127,26 +125,26 @@
             return None
 
 
 class ParseError(Exception):
     """Exception to signal the parser is stuck."""
 
     def __init__(
-        self, msg: Text, type: Optional[int], value: Optional[Text], context: Context
+        self, msg: str, type: Optional[int], value: Optional[str], context: Context
     ) -> None:
         Exception.__init__(
-            self, "%s: type=%r, value=%r, context=%r" % (msg, type, value, context)
+            self, f"{msg}: type={type!r}, value={value!r}, context={context!r}"
         )
         self.msg = msg
         self.type = type
         self.value = value
         self.context = context
 
 
-class Parser(object):
+class Parser:
     """Parser engine.
 
     The proper usage sequence is:
 
     p = Parser(grammar, [converter])  # create instance
     p.setup([start])                  # prepare for parsing
     <for each input token>:
@@ -232,15 +230,15 @@
         newnode: RawNode = (start, None, None, [])
         stackentry = (self.grammar.dfas[start], 0, newnode)
         self.stack: List[Tuple[DFAS, int, RawNode]] = [stackentry]
         self.rootnode: Optional[NL] = None
         self.used_names: Set[str] = set()
         self.proxy = proxy
 
-    def addtoken(self, type: int, value: Text, context: Context) -> bool:
+    def addtoken(self, type: int, value: str, context: Context) -> bool:
         """Add a token; return True iff this is the end of the program."""
         # Map from token to label
         ilabels = self.classify(type, value, context)
         assert len(ilabels) >= 1
 
         # If we have only one state to advance, we'll directly
         # take it as is.
@@ -280,15 +278,15 @@
                 counter += 1
 
             ilabel = cast(int, recorder.determine_route(next_token_value, force=force))
             assert ilabel is not None
 
         return self._addtoken(ilabel, type, value, context)
 
-    def _addtoken(self, ilabel: int, type: int, value: Text, context: Context) -> bool:
+    def _addtoken(self, ilabel: int, type: int, value: str, context: Context) -> bool:
         # Loop until the token is shifted; may raise exceptions
         while True:
             dfa, state, node = self.stack[-1]
             states, first = dfa
             arcs = states[state]
             # Look for a state with this label
             for i, newstate in arcs:
@@ -325,15 +323,15 @@
                     if not self.stack:
                         # Done parsing, but another token is input
                         raise ParseError("too much input", type, value, context)
                 else:
                     # No success finding a transition
                     raise ParseError("bad input", type, value, context)
 
-    def classify(self, type: int, value: Text, context: Context) -> List[int]:
+    def classify(self, type: int, value: str, context: Context) -> List[int]:
         """Turn a token into a label.  (Internal)
 
         Depending on whether the value is a soft-keyword or not,
         this function may return multiple labels to choose from."""
         if type == token.NAME:
             # Keep a listing of all used names
             self.used_names.add(value)
@@ -348,15 +346,15 @@
                 ]
 
         ilabel = self.grammar.tokens.get(type)
         if ilabel is None:
             raise ParseError("bad token", type, value, context)
         return [ilabel]
 
-    def shift(self, type: int, value: Text, newstate: int, context: Context) -> None:
+    def shift(self, type: int, value: str, newstate: int, context: Context) -> None:
         """Shift a token.  (Internal)"""
         if self.is_backtracking:
             dfa, state, _ = self.stack[-1]
             self.stack[-1] = (dfa, newstate, DUMMY_NODE)
         else:
             dfa, state, node = self.stack[-1]
             rawnode: RawNode = (type, value, context, None)
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/pgen.py` & `black-23.7.0/src/blib2to3/pgen2/pgen.py`

 * *Files 2% similar despite different names*

```diff
@@ -7,15 +7,14 @@
 from typing import (
     Any,
     Dict,
     IO,
     Iterator,
     List,
     Optional,
-    Text,
     Tuple,
     Union,
     Sequence,
     NoReturn,
 )
 from blib2to3.pgen2 import grammar
 from blib2to3.pgen2.tokenize import GoodTokenInfo
@@ -25,25 +24,24 @@
 Path = Union[str, "os.PathLike[str]"]
 
 
 class PgenGrammar(grammar.Grammar):
     pass
 
 
-class ParserGenerator(object):
-
+class ParserGenerator:
     filename: Path
-    stream: IO[Text]
+    stream: IO[str]
     generator: Iterator[GoodTokenInfo]
-    first: Dict[Text, Optional[Dict[Text, int]]]
+    first: Dict[str, Optional[Dict[str, int]]]
 
-    def __init__(self, filename: Path, stream: Optional[IO[Text]] = None) -> None:
+    def __init__(self, filename: Path, stream: Optional[IO[str]] = None) -> None:
         close_stream = None
         if stream is None:
-            stream = open(filename)
+            stream = open(filename, encoding="utf-8")
             close_stream = stream.close
         self.filename = filename
         self.stream = stream
         self.generator = tokenize.generate_tokens(stream.readline)
         self.gettoken()  # Initialize lookahead
         self.dfas, self.startsymbol = self.parse()
         if close_stream is not None:
@@ -72,25 +70,25 @@
                     arcs.append((0, dfa.index(state)))
                 states.append(arcs)
             c.states.append(states)
             c.dfas[c.symbol2number[name]] = (states, self.make_first(c, name))
         c.start = c.symbol2number[self.startsymbol]
         return c
 
-    def make_first(self, c: PgenGrammar, name: Text) -> Dict[int, int]:
+    def make_first(self, c: PgenGrammar, name: str) -> Dict[int, int]:
         rawfirst = self.first[name]
         assert rawfirst is not None
         first = {}
         for label in sorted(rawfirst):
             ilabel = self.make_label(c, label)
             ##assert ilabel not in first # XXX failed on <> ... !=
             first[ilabel] = 1
         return first
 
-    def make_label(self, c: PgenGrammar, label: Text) -> int:
+    def make_label(self, c: PgenGrammar, label: str) -> int:
         # XXX Maybe this should be a method on a subclass of converter?
         ilabel = len(c.labels)
         if label[0].isalpha():
             # Either a symbol name or a named token
             if label in c.symbol2number:
                 # A symbol name (a non-terminal)
                 if label in c.symbol2label:
@@ -141,15 +139,15 @@
         names = list(self.dfas.keys())
         names.sort()
         for name in names:
             if name not in self.first:
                 self.calcfirst(name)
             # print name, self.first[name].keys()
 
-    def calcfirst(self, name: Text) -> None:
+    def calcfirst(self, name: str) -> None:
         dfa = self.dfas[name]
         self.first[name] = None  # dummy to detect left recursion
         state = dfa[0]
         totalset: Dict[str, int] = {}
         overlapcheck = {}
         for label, next in state.arcs.items():
             if label in self.dfas:
@@ -173,15 +171,15 @@
                     raise ValueError(
                         "rule %s is ambiguous; %s is in the first sets of %s as well"
                         " as %s" % (name, symbol, label, inverse[symbol])
                     )
                 inverse[symbol] = label
         self.first[name] = totalset
 
-    def parse(self) -> Tuple[Dict[Text, List["DFAState"]], Text]:
+    def parse(self) -> Tuple[Dict[str, List["DFAState"]], str]:
         dfas = {}
         startsymbol: Optional[str] = None
         # MSTART: (NEWLINE | RULE)* ENDMARKER
         while self.type != token.ENDMARKER:
             while self.type == token.NEWLINE:
                 self.gettoken()
             # RULE: NAME ':' RHS NEWLINE
@@ -237,15 +235,15 @@
                         break
                 else:
                     st = DFAState(nfaset, finish)
                     states.append(st)
                 state.addarc(st, label)
         return states  # List of DFAState instances; first one is start
 
-    def dump_nfa(self, name: Text, start: "NFAState", finish: "NFAState") -> None:
+    def dump_nfa(self, name: str, start: "NFAState", finish: "NFAState") -> None:
         print("Dump of NFA for", name)
         todo = [start]
         for i, state in enumerate(todo):
             print("  State", i, state is finish and "(final)" or "")
             for label, next in state.arcs:
                 if next in todo:
                     j = todo.index(next)
@@ -253,15 +251,15 @@
                     j = len(todo)
                     todo.append(next)
                 if label is None:
                     print("    -> %d" % j)
                 else:
                     print("    %s -> %d" % (label, j))
 
-    def dump_dfa(self, name: Text, dfa: Sequence["DFAState"]) -> None:
+    def dump_dfa(self, name: str, dfa: Sequence["DFAState"]) -> None:
         print("Dump of DFA for", name)
         for i, state in enumerate(dfa):
             print("  State", i, state.isfinal and "(final)" or "")
             for label, next in sorted(state.arcs.items()):
                 print("    %s -> %d" % (label, dfa.index(next)))
 
     def simplify_dfa(self, dfa: List["DFAState"]) -> None:
@@ -346,15 +344,15 @@
             return a, z
         else:
             self.raise_error(
                 "expected (...) or NAME or STRING, got %s/%s", self.type, self.value
             )
             assert False
 
-    def expect(self, type: int, value: Optional[Any] = None) -> Text:
+    def expect(self, type: int, value: Optional[Any] = None) -> str:
         if self.type != type or (value is not None and self.value != value):
             self.raise_error(
                 "expected %s/%s, got %s/%s", type, value, self.type, self.value
             )
         value = self.value
         self.gettoken()
         return value
@@ -371,40 +369,40 @@
             try:
                 msg = msg % args
             except:
                 msg = " ".join([msg] + list(map(str, args)))
         raise SyntaxError(msg, (self.filename, self.end[0], self.end[1], self.line))
 
 
-class NFAState(object):
-    arcs: List[Tuple[Optional[Text], "NFAState"]]
+class NFAState:
+    arcs: List[Tuple[Optional[str], "NFAState"]]
 
     def __init__(self) -> None:
         self.arcs = []  # list of (label, NFAState) pairs
 
-    def addarc(self, next: "NFAState", label: Optional[Text] = None) -> None:
+    def addarc(self, next: "NFAState", label: Optional[str] = None) -> None:
         assert label is None or isinstance(label, str)
         assert isinstance(next, NFAState)
         self.arcs.append((label, next))
 
 
-class DFAState(object):
+class DFAState:
     nfaset: Dict[NFAState, Any]
     isfinal: bool
-    arcs: Dict[Text, "DFAState"]
+    arcs: Dict[str, "DFAState"]
 
     def __init__(self, nfaset: Dict[NFAState, Any], final: NFAState) -> None:
         assert isinstance(nfaset, dict)
         assert isinstance(next(iter(nfaset)), NFAState)
         assert isinstance(final, NFAState)
         self.nfaset = nfaset
         self.isfinal = final in nfaset
         self.arcs = {}  # map from label to DFAState
 
-    def addarc(self, next: "DFAState", label: Text) -> None:
+    def addarc(self, next: "DFAState", label: str) -> None:
         assert isinstance(label, str)
         assert label not in self.arcs
         assert isinstance(next, DFAState)
         self.arcs[label] = next
 
     def unifystate(self, old: "DFAState", new: "DFAState") -> None:
         for label, next in self.arcs.items():
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/token.py` & `black-23.7.0/src/blib2to3/pgen2/token.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,16 +1,12 @@
 """Token constants (from "token.h")."""
 
-import sys
 from typing import Dict
 
-if sys.version_info < (3, 8):
-    from typing_extensions import Final
-else:
-    from typing import Final
+from typing import Final
 
 #  Taken from Python (r53757) and modified to include some tokens
 #   originally monkeypatched in by pgen2.tokenize
 
 # --start constants--
 ENDMARKER: Final = 0
 NAME: Final = 1
@@ -74,15 +70,15 @@
 COLONEQUAL: Final = 59
 N_TOKENS: Final = 60
 NT_OFFSET: Final = 256
 # --end constants--
 
 tok_name: Final[Dict[int, str]] = {}
 for _name, _value in list(globals().items()):
-    if type(_value) is type(0):
+    if type(_value) is int:
         tok_name[_value] = _name
 
 
 def ISTERMINAL(x: int) -> bool:
     return x < NT_OFFSET
```

### Comparing `black-23.3.0/src/blib2to3/pgen2/tokenize.py` & `black-23.7.0/src/blib2to3/pgen2/tokenize.py`

 * *Files 3% similar despite different names*

```diff
@@ -30,25 +30,22 @@
 import sys
 from typing import (
     Callable,
     Iterable,
     Iterator,
     List,
     Optional,
-    Text,
+    Set,
     Tuple,
     Pattern,
     Union,
     cast,
 )
 
-if sys.version_info >= (3, 8):
-    from typing import Final
-else:
-    from typing_extensions import Final
+from typing import Final
 
 from blib2to3.pgen2.token import *
 from blib2to3.pgen2.grammar import Grammar
 
 __author__ = "Ka-Ping Yee <ping@lfw.org>"
 __credits__ = "GvR, ESR, Tim Peters, Thomas Wouters, Fred Drake, Skip Montanaro"
 
@@ -62,28 +59,28 @@
     "tokenize",
     "generate_tokens",
     "untokenize",
 ]
 del token
 
 
-def group(*choices):
+def group(*choices: str) -> str:
     return "(" + "|".join(choices) + ")"
 
 
-def any(*choices):
+def any(*choices: str) -> str:
     return group(*choices) + "*"
 
 
-def maybe(*choices):
+def maybe(*choices: str) -> str:
     return group(*choices) + "?"
 
 
-def _combinations(*l):
-    return set(x + y for x in l for y in l + ("",) if x.casefold() != y.casefold())
+def _combinations(*l: str) -> Set[str]:
+    return {x + y for x in l for y in l + ("",) if x.casefold() != y.casefold()}
 
 
 Whitespace = r"[ \f\t]*"
 Comment = r"#[^\r\n]*"
 Ignore = Whitespace + any(r"\\\r?\n" + Whitespace) + maybe(Comment)
 Name = (  # this is invalid but it's fine because Name comes after Number in all groups
     r"[^\s#\(\)\[\]\{\}+\-*/!@$%^&=|;:'\",\.<>/?`~\\]+"
@@ -159,15 +156,14 @@
 endprogs: Final = {
     "'": re.compile(Single),
     '"': re.compile(Double),
     "'''": single3prog,
     '"""': double3prog,
     **{f"{prefix}'''": single3prog for prefix in _strprefixes},
     **{f'{prefix}"""': double3prog for prefix in _strprefixes},
-    **{prefix: None for prefix in _strprefixes},
 }
 
 triple_quoted: Final = (
     {"'''", '"""'}
     | {f"{prefix}'''" for prefix in _strprefixes}
     | {f'{prefix}"""' for prefix in _strprefixes}
 )
@@ -184,27 +180,31 @@
     pass
 
 
 class StopTokenizing(Exception):
     pass
 
 
-def printtoken(type, token, xxx_todo_changeme, xxx_todo_changeme1, line):  # for testing
-    (srow, scol) = xxx_todo_changeme
-    (erow, ecol) = xxx_todo_changeme1
+Coord = Tuple[int, int]
+
+
+def printtoken(
+    type: int, token: str, srow_col: Coord, erow_col: Coord, line: str
+) -> None:  # for testing
+    (srow, scol) = srow_col
+    (erow, ecol) = erow_col
     print(
         "%d,%d-%d,%d:\t%s\t%s" % (srow, scol, erow, ecol, tok_name[type], repr(token))
     )
 
 
-Coord = Tuple[int, int]
-TokenEater = Callable[[int, Text, Coord, Coord, Text], None]
+TokenEater = Callable[[int, str, Coord, Coord, str], None]
 
 
-def tokenize(readline: Callable[[], Text], tokeneater: TokenEater = printtoken) -> None:
+def tokenize(readline: Callable[[], str], tokeneater: TokenEater = printtoken) -> None:
     """
     The tokenize() function accepts two parameters: one representing the
     input stream, and one providing an output mechanism for tokenize().
 
     The first parameter, readline, must be a callable object which provides
     the same interface as the readline() method of built-in file objects.
     Each call to the function should return one line of input as a string.
@@ -216,26 +216,25 @@
     try:
         tokenize_loop(readline, tokeneater)
     except StopTokenizing:
         pass
 
 
 # backwards compatible interface
-def tokenize_loop(readline, tokeneater):
+def tokenize_loop(readline: Callable[[], str], tokeneater: TokenEater) -> None:
     for token_info in generate_tokens(readline):
         tokeneater(*token_info)
 
 
-GoodTokenInfo = Tuple[int, Text, Coord, Coord, Text]
+GoodTokenInfo = Tuple[int, str, Coord, Coord, str]
 TokenInfo = Union[Tuple[int, str], GoodTokenInfo]
 
 
 class Untokenizer:
-
-    tokens: List[Text]
+    tokens: List[str]
     prev_row: int
     prev_col: int
 
     def __init__(self) -> None:
         self.tokens = []
         self.prev_row = 1
         self.prev_col = 0
@@ -243,31 +242,31 @@
     def add_whitespace(self, start: Coord) -> None:
         row, col = start
         assert row <= self.prev_row
         col_offset = col - self.prev_col
         if col_offset:
             self.tokens.append(" " * col_offset)
 
-    def untokenize(self, iterable: Iterable[TokenInfo]) -> Text:
+    def untokenize(self, iterable: Iterable[TokenInfo]) -> str:
         for t in iterable:
             if len(t) == 2:
                 self.compat(cast(Tuple[int, str], t), iterable)
                 break
             tok_type, token, start, end, line = cast(
-                Tuple[int, Text, Coord, Coord, Text], t
+                Tuple[int, str, Coord, Coord, str], t
             )
             self.add_whitespace(start)
             self.tokens.append(token)
             self.prev_row, self.prev_col = end
             if tok_type in (NEWLINE, NL):
                 self.prev_row += 1
                 self.prev_col = 0
         return "".join(self.tokens)
 
-    def compat(self, token: Tuple[int, Text], iterable: Iterable[TokenInfo]) -> None:
+    def compat(self, token: Tuple[int, str], iterable: Iterable[TokenInfo]) -> None:
         startline = False
         indents = []
         toks_append = self.tokens.append
         toknum, tokval = token
         if toknum in (NAME, NUMBER):
             tokval += " "
         if toknum in (NEWLINE, NL):
@@ -331,15 +330,15 @@
     encoding = None
     default = "utf-8"
 
     def read_or_stop() -> bytes:
         try:
             return readline()
         except StopIteration:
-            return bytes()
+            return b''
 
     def find_cookie(line: bytes) -> Optional[str]:
         try:
             line_string = line.decode("ascii")
         except UnicodeDecodeError:
             return None
         match = cookie_re.match(line_string)
@@ -380,15 +379,15 @@
     encoding = find_cookie(second)
     if encoding:
         return encoding, [first, second]
 
     return default, [first, second]
 
 
-def untokenize(iterable: Iterable[TokenInfo]) -> Text:
+def untokenize(iterable: Iterable[TokenInfo]) -> str:
     """Transform tokens back into Python source code.
 
     Each element returned by the iterable must be a token sequence
     with at least two elements, a token number and token value.  If
     only two tokens are passed, the resulting output is poor.
 
     Round-trip invariant for full input:
@@ -403,15 +402,15 @@
         assert t1 == t2
     """
     ut = Untokenizer()
     return ut.untokenize(iterable)
 
 
 def generate_tokens(
-    readline: Callable[[], Text], grammar: Optional[Grammar] = None
+    readline: Callable[[], str], grammar: Optional[Grammar] = None
 ) -> Iterator[GoodTokenInfo]:
     """
     The generate_tokens() generator requires one argument, readline, which
     must be a callable object which provides the same interface as the
     readline() method of built-in file objects. Each call to the function
     should return one line of input as a string.  Alternately, readline
     can be a callable function terminating with StopIteration:
@@ -421,15 +420,15 @@
     token string; a 2-tuple (srow, scol) of ints specifying the row and
     column where the token begins in the source; a 2-tuple (erow, ecol) of
     ints specifying the row and column where the token ends in the source;
     and the line on which the token was found. The line passed is the
     logical line; continuation lines are included.
     """
     lnum = parenlev = continued = 0
-    numchars: Final = "0123456789"
+    numchars: Final[str] = "0123456789"
     contstr, needcont = "", 0
     contline: Optional[str] = None
     indents = [0]
 
     # If we know we're parsing 3.7+, we can unconditionally parse `async` and
     # `await` as keywords.
     async_keywords = False if grammar is None else grammar.async_keywords
@@ -595,19 +594,23 @@
                 elif (
                     initial in single_quoted
                     or token[:2] in single_quoted
                     or token[:3] in single_quoted
                 ):
                     if token[-1] == "\n":  # continued string
                         strstart = (lnum, start)
-                        endprog = (
-                            endprogs[initial]
-                            or endprogs[token[1]]
-                            or endprogs[token[2]]
+                        maybe_endprog = (
+                            endprogs.get(initial)
+                            or endprogs.get(token[1])
+                            or endprogs.get(token[2])
                         )
+                        assert (
+                            maybe_endprog is not None
+                        ), f"endprog not found for {token}"
+                        endprog = maybe_endprog
                         contstr, needcont = line[start:], 1
                         contline = line
                         break
                     else:  # ordinary string
                         if stashed:
                             yield stashed
                             stashed = None
@@ -627,15 +630,14 @@
                     tok = (NAME, token, spos, epos, line)
                     if token == "async" and not stashed:
                         stashed = tok
                         continue
 
                     if token in ("def", "for"):
                         if stashed and stashed[0] == NAME and stashed[1] == "async":
-
                             if token == "def":
                                 async_def = True
                                 async_def_indent = indents[-1]
 
                             yield (
                                 ASYNC,
                                 stashed[1],
```

### Comparing `black-23.3.0/tests/optional.py` & `black-23.7.0/tests/optional.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/test_black.py` & `black-23.7.0/tests/test_black.py`

 * *Files 2% similar despite different names*

```diff
@@ -151,6162 +151,6164 @@
 00000960: 656e 2063 616c 6c69 6e67 2066 756e 6374  en calling funct
 00000970: 696f 6e73 2074 6861 7420 6e65 6564 2069  ions that need i
 00000980: 742e 2222 220a 0a20 2020 2064 6566 205f  t."""..    def _
 00000990: 5f69 6e69 745f 5f28 7365 6c66 2920 2d3e  _init__(self) ->
 000009a0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
 000009b0: 656c 662e 6465 6661 756c 745f 6d61 703a  elf.default_map:
 000009c0: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
-000009d0: 3d20 7b7d 0a20 2020 2020 2020 2023 2044  = {}.        # D
-000009e0: 756d 6d79 2072 6f6f 742c 2073 696e 6365  ummy root, since
-000009f0: 206d 6f73 7420 6f66 2074 6865 2074 6573   most of the tes
-00000a00: 7473 2064 6f6e 2774 2063 6172 6520 6162  ts don't care ab
-00000a10: 6f75 7420 6974 0a20 2020 2020 2020 2073  out it.        s
-00000a20: 656c 662e 6f62 6a3a 2044 6963 745b 7374  elf.obj: Dict[st
-00000a30: 722c 2041 6e79 5d20 3d20 7b22 726f 6f74  r, Any] = {"root
-00000a40: 223a 2050 524f 4a45 4354 5f52 4f4f 547d  ": PROJECT_ROOT}
-00000a50: 0a0a 0a63 6c61 7373 2046 616b 6550 6172  ...class FakePar
-00000a60: 616d 6574 6572 2863 6c69 636b 2e50 6172  ameter(click.Par
-00000a70: 616d 6574 6572 293a 0a20 2020 2022 2222  ameter):.    """
-00000a80: 4120 6661 6b65 2063 6c69 636b 2050 6172  A fake click Par
-00000a90: 616d 6574 6572 2066 6f72 2077 6865 6e20  ameter for when 
-00000aa0: 6361 6c6c 696e 6720 6675 6e63 7469 6f6e  calling function
-00000ab0: 7320 7468 6174 206e 6565 6420 6974 2e22  s that need it."
-00000ac0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00000ad0: 6974 5f5f 2873 656c 6629 202d 3e20 4e6f  it__(self) -> No
-00000ae0: 6e65 3a0a 2020 2020 2020 2020 7061 7373  ne:.        pass
-00000af0: 0a0a 0a63 6c61 7373 2042 6c61 636b 5275  ...class BlackRu
-00000b00: 6e6e 6572 2843 6c69 5275 6e6e 6572 293a  nner(CliRunner):
-00000b10: 0a20 2020 2022 2222 4d61 6b65 2073 7572  .    """Make sur
-00000b20: 6520 5354 444f 5554 2061 6e64 2053 5444  e STDOUT and STD
-00000b30: 4552 5220 6172 6520 6b65 7074 2073 6570  ERR are kept sep
-00000b40: 6172 6174 6520 7768 656e 2074 6573 7469  arate when testi
-00000b50: 6e67 2042 6c61 636b 2076 6961 2069 7473  ng Black via its
-00000b60: 2043 4c49 2e22 2222 0a0a 2020 2020 6465   CLI."""..    de
-00000b70: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-00000b80: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00000b90: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
-00000ba0: 5f5f 286d 6978 5f73 7464 6572 723d 4661  __(mix_stderr=Fa
-00000bb0: 6c73 6529 0a0a 0a64 6566 2069 6e76 6f6b  lse)...def invok
-00000bc0: 6542 6c61 636b 280a 2020 2020 6172 6773  eBlack(.    args
-00000bd0: 3a20 4c69 7374 5b73 7472 5d2c 2065 7869  : List[str], exi
-00000be0: 745f 636f 6465 3a20 696e 7420 3d20 302c  t_code: int = 0,
-00000bf0: 2069 676e 6f72 655f 636f 6e66 6967 3a20   ignore_config: 
-00000c00: 626f 6f6c 203d 2054 7275 650a 2920 2d3e  bool = True.) ->
-00000c10: 204e 6f6e 653a 0a20 2020 2072 756e 6e65   None:.    runne
-00000c20: 7220 3d20 426c 6163 6b52 756e 6e65 7228  r = BlackRunner(
-00000c30: 290a 2020 2020 6966 2069 676e 6f72 655f  ).    if ignore_
-00000c40: 636f 6e66 6967 3a0a 2020 2020 2020 2020  config:.        
-00000c50: 6172 6773 203d 205b 222d 2d76 6572 626f  args = ["--verbo
-00000c60: 7365 222c 2022 2d2d 636f 6e66 6967 222c  se", "--config",
-00000c70: 2073 7472 2854 4849 535f 4449 5220 2f20   str(THIS_DIR / 
-00000c80: 2265 6d70 7479 2e74 6f6d 6c22 292c 202a  "empty.toml"), *
-00000c90: 6172 6773 5d0a 2020 2020 7265 7375 6c74  args].    result
-00000ca0: 203d 2072 756e 6e65 722e 696e 766f 6b65   = runner.invoke
-00000cb0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-00000cc0: 732c 2063 6174 6368 5f65 7863 6570 7469  s, catch_excepti
-00000cd0: 6f6e 733d 4661 6c73 6529 0a20 2020 2061  ons=False).    a
-00000ce0: 7373 6572 7420 7265 7375 6c74 2e73 7464  ssert result.std
-00000cf0: 6f75 745f 6279 7465 7320 6973 206e 6f74  out_bytes is not
-00000d00: 204e 6f6e 650a 2020 2020 6173 7365 7274   None.    assert
-00000d10: 2072 6573 756c 742e 7374 6465 7272 5f62   result.stderr_b
-00000d20: 7974 6573 2069 7320 6e6f 7420 4e6f 6e65  ytes is not None
-00000d30: 0a20 2020 206d 7367 203d 2028 0a20 2020  .    msg = (.   
-00000d40: 2020 2020 2066 2246 6169 6c65 6420 7769       f"Failed wi
-00000d50: 7468 2061 7267 733a 207b 6172 6773 7d5c  th args: {args}\
-00000d60: 6e22 0a20 2020 2020 2020 2066 2273 7464  n".        f"std
-00000d70: 6f75 743a 207b 7265 7375 6c74 2e73 7464  out: {result.std
-00000d80: 6f75 745f 6279 7465 732e 6465 636f 6465  out_bytes.decode
-00000d90: 2829 2172 7d5c 6e22 0a20 2020 2020 2020  ()!r}\n".       
-00000da0: 2066 2273 7464 6572 723a 207b 7265 7375   f"stderr: {resu
-00000db0: 6c74 2e73 7464 6572 725f 6279 7465 732e  lt.stderr_bytes.
-00000dc0: 6465 636f 6465 2829 2172 7d5c 6e22 0a20  decode()!r}\n". 
-00000dd0: 2020 2020 2020 2066 2265 7863 6570 7469         f"excepti
-00000de0: 6f6e 3a20 7b72 6573 756c 742e 6578 6365  on: {result.exce
-00000df0: 7074 696f 6e7d 220a 2020 2020 290a 2020  ption}".    ).  
-00000e00: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
-00000e10: 6578 6974 5f63 6f64 6520 3d3d 2065 7869  exit_code == exi
-00000e20: 745f 636f 6465 2c20 6d73 670a 0a0a 636c  t_code, msg...cl
-00000e30: 6173 7320 426c 6163 6b54 6573 7443 6173  ass BlackTestCas
-00000e40: 6528 426c 6163 6b42 6173 6554 6573 7443  e(BlackBaseTestC
-00000e50: 6173 6529 3a0a 2020 2020 696e 766f 6b65  ase):.    invoke
-00000e60: 426c 6163 6b20 3d20 7374 6174 6963 6d65  Black = staticme
-00000e70: 7468 6f64 2869 6e76 6f6b 6542 6c61 636b  thod(invokeBlack
-00000e80: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00000e90: 656d 7074 795f 6666 2873 656c 6629 202d  empty_ff(self) -
-00000ea0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00000eb0: 6578 7065 6374 6564 203d 2022 220a 2020  expected = "".  
-00000ec0: 2020 2020 2020 746d 705f 6669 6c65 203d        tmp_file =
-00000ed0: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
-00000ee0: 5f74 6f5f 6669 6c65 2829 290a 2020 2020  _to_file()).    
-00000ef0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00000f00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00000f10: 4661 6c73 6528 6666 2874 6d70 5f66 696c  False(ff(tmp_fil
-00000f20: 652c 2077 7269 7465 5f62 6163 6b3d 626c  e, write_back=bl
-00000f30: 6163 6b2e 5772 6974 6542 6163 6b2e 5945  ack.WriteBack.YE
-00000f40: 5329 290a 2020 2020 2020 2020 2020 2020  S)).            
-00000f50: 7769 7468 206f 7065 6e28 746d 705f 6669  with open(tmp_fi
-00000f60: 6c65 2c20 656e 636f 6469 6e67 3d22 7574  le, encoding="ut
-00000f70: 6638 2229 2061 7320 663a 0a20 2020 2020  f8") as f:.     
-00000f80: 2020 2020 2020 2020 2020 2061 6374 7561             actua
-00000f90: 6c20 3d20 662e 7265 6164 2829 0a20 2020  l = f.read().   
-00000fa0: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
-00000fb0: 2020 2020 2020 2020 2020 6f73 2e75 6e6c            os.unl
-00000fc0: 696e 6b28 746d 705f 6669 6c65 290a 2020  ink(tmp_file).  
-00000fd0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00000fe0: 7446 6f72 6d61 7445 7175 616c 2865 7870  tFormatEqual(exp
-00000ff0: 6563 7465 642c 2061 6374 7561 6c29 0a0a  ected, actual)..
-00001000: 2020 2020 4070 6174 6368 2822 626c 6163      @patch("blac
-00001010: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 222c  k.dump_to_file",
-00001020: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
-00001030: 0a20 2020 2064 6566 2074 6573 745f 6f6e  .    def test_on
-00001040: 655f 656d 7074 795f 6c69 6e65 2873 656c  e_empty_line(sel
-00001050: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00001060: 2020 2020 6d6f 6465 203d 2062 6c61 636b      mode = black
-00001070: 2e4d 6f64 6528 7072 6576 6965 773d 5472  .Mode(preview=Tr
-00001080: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
-00001090: 6e6c 2069 6e20 5b22 5c6e 222c 2022 5c72  nl in ["\n", "\r
-000010a0: 5c6e 225d 3a0a 2020 2020 2020 2020 2020  \n"]:.          
-000010b0: 2020 736f 7572 6365 203d 2065 7870 6563    source = expec
-000010c0: 7465 6420 3d20 6e6c 0a20 2020 2020 2020  ted = nl.       
-000010d0: 2020 2020 2061 7373 6572 745f 666f 726d       assert_form
-000010e0: 6174 2873 6f75 7263 652c 2065 7870 6563  at(source, expec
-000010f0: 7465 642c 206d 6f64 653d 6d6f 6465 290a  ted, mode=mode).
-00001100: 0a20 2020 2064 6566 2074 6573 745f 6f6e  .    def test_on
-00001110: 655f 656d 7074 795f 6c69 6e65 5f66 6628  e_empty_line_ff(
-00001120: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00001130: 2020 2020 2020 206d 6f64 6520 3d20 626c         mode = bl
-00001140: 6163 6b2e 4d6f 6465 2870 7265 7669 6577  ack.Mode(preview
-00001150: 3d54 7275 6529 0a20 2020 2020 2020 2066  =True).        f
-00001160: 6f72 206e 6c20 696e 205b 225c 6e22 2c20  or nl in ["\n", 
-00001170: 225c 725c 6e22 5d3a 0a20 2020 2020 2020  "\r\n"]:.       
-00001180: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-00001190: 6e6c 0a20 2020 2020 2020 2020 2020 2074  nl.            t
-000011a0: 6d70 5f66 696c 6520 3d20 5061 7468 2862  mp_file = Path(b
-000011b0: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
-000011c0: 6528 6e6c 2929 0a20 2020 2020 2020 2020  e(nl)).         
-000011d0: 2020 2069 6620 7379 7374 656d 2829 203d     if system() =
-000011e0: 3d20 2257 696e 646f 7773 223a 0a20 2020  = "Windows":.   
-000011f0: 2020 2020 2020 2020 2020 2020 2023 2057               # W
-00001200: 7269 7469 6e67 2066 696c 6573 2069 6e20  riting files in 
-00001210: 7465 7874 206d 6f64 6520 6175 746f 6d61  text mode automa
-00001220: 7469 6361 6c6c 7920 7573 6573 2074 6865  tically uses the
-00001230: 2073 7973 7465 6d20 6e65 776c 696e 652c   system newline,
-00001240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001250: 2023 2062 7574 2069 6e20 7468 6973 2063   # but in this c
-00001260: 6173 6520 7765 2064 6f6e 2774 2077 616e  ase we don't wan
-00001270: 7420 7468 6973 2066 6f72 2074 6573 7469  t this for testi
-00001280: 6e67 2072 6561 736f 6e73 2e20 5365 653a  ng reasons. See:
-00001290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000012a0: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
-000012b0: 622e 636f 6d2f 7073 662f 626c 6163 6b2f  b.com/psf/black/
-000012c0: 7075 6c6c 2f33 3334 380a 2020 2020 2020  pull/3348.      
-000012d0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-000012e0: 7065 6e28 746d 705f 6669 6c65 2c20 2277  pen(tmp_file, "w
-000012f0: 6222 2920 6173 2066 3a0a 2020 2020 2020  b") as f:.      
-00001300: 2020 2020 2020 2020 2020 2020 2020 662e                f.
-00001310: 7772 6974 6528 6e6c 2e65 6e63 6f64 6528  write(nl.encode(
-00001320: 2275 7466 2d38 2229 290a 2020 2020 2020  "utf-8")).      
-00001330: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00001340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001350: 6173 7365 7274 4661 6c73 6528 0a20 2020  assertFalse(.   
-00001360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001370: 2066 6628 746d 705f 6669 6c65 2c20 6d6f   ff(tmp_file, mo
-00001380: 6465 3d6d 6f64 652c 2077 7269 7465 5f62  de=mode, write_b
-00001390: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-000013a0: 6163 6b2e 5945 5329 0a20 2020 2020 2020  ack.YES).       
-000013b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000013c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000013d0: 6f70 656e 2874 6d70 5f66 696c 652c 2022  open(tmp_file, "
-000013e0: 7262 2229 2061 7320 663a 0a20 2020 2020  rb") as f:.     
-000013f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00001400: 6374 7561 6c20 3d20 662e 7265 6164 2829  ctual = f.read()
-00001410: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
-00001420: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-00001430: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-00001440: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
-00001450: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
-00001460: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001470: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
-00001480: 6374 6564 2c20 6163 7475 616c 290a 0a20  cted, actual).. 
-00001490: 2020 2064 6566 2074 6573 745f 6578 7065     def test_expe
-000014a0: 7269 6d65 6e74 616c 5f73 7472 696e 675f  rimental_string_
-000014b0: 7072 6f63 6573 7369 6e67 5f77 6172 6e73  processing_warns
-000014c0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000014d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000014e0: 6572 7457 6172 6e73 280a 2020 2020 2020  ertWarns(.      
-000014f0: 2020 2020 2020 626c 6163 6b2e 6d6f 6465        black.mode
-00001500: 2e44 6570 7265 6361 7465 642c 2062 6c61  .Deprecated, bla
-00001510: 636b 2e4d 6f64 652c 2065 7870 6572 696d  ck.Mode, experim
-00001520: 656e 7461 6c5f 7374 7269 6e67 5f70 726f  ental_string_pro
-00001530: 6365 7373 696e 673d 5472 7565 0a20 2020  cessing=True.   
-00001540: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00001550: 7465 7374 5f70 6970 696e 6728 7365 6c66  test_piping(self
-00001560: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00001570: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
-00001580: 7465 6420 3d20 7265 6164 5f64 6174 615f  ted = read_data_
-00001590: 6672 6f6d 5f66 696c 6528 5052 4f4a 4543  from_file(PROJEC
-000015a0: 545f 524f 4f54 202f 2022 7372 632f 626c  T_ROOT / "src/bl
-000015b0: 6163 6b2f 5f5f 696e 6974 5f5f 2e70 7922  ack/__init__.py"
-000015c0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-000015d0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-000015e0: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-000015f0: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
-00001600: 0a20 2020 2020 2020 2020 2020 205b 0a20  .            [. 
-00001610: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00001620: 2d22 2c0a 2020 2020 2020 2020 2020 2020  -",.            
-00001630: 2020 2020 222d 2d66 6173 7422 2c0a 2020      "--fast",.  
-00001640: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00001650: 2d2d 6c69 6e65 2d6c 656e 6774 683d 7b62  --line-length={b
-00001660: 6c61 636b 2e44 4546 4155 4c54 5f4c 494e  lack.DEFAULT_LIN
-00001670: 455f 4c45 4e47 5448 7d22 2c0a 2020 2020  E_LENGTH}",.    
-00001680: 2020 2020 2020 2020 2020 2020 6622 2d2d              f"--
-00001690: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
-000016a0: 4e46 4947 7d22 2c0a 2020 2020 2020 2020  NFIG}",.        
-000016b0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
-000016c0: 2020 2069 6e70 7574 3d42 7974 6573 494f     input=BytesIO
-000016d0: 2873 6f75 7263 652e 656e 636f 6465 2822  (source.encode("
-000016e0: 7574 6638 2229 292c 0a20 2020 2020 2020  utf8")),.       
-000016f0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-00001700: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-00001710: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-00001720: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001730: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
-00001740: 6578 7065 6374 6564 2c20 7265 7375 6c74  expected, result
-00001750: 2e6f 7574 7075 7429 0a20 2020 2020 2020  .output).       
-00001760: 2069 6620 736f 7572 6365 2021 3d20 7265   if source != re
-00001770: 7375 6c74 2e6f 7574 7075 743a 0a20 2020  sult.output:.   
-00001780: 2020 2020 2020 2020 2062 6c61 636b 2e61           black.a
-00001790: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
-000017a0: 2873 6f75 7263 652c 2072 6573 756c 742e  (source, result.
-000017b0: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
-000017c0: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
-000017d0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
-000017e0: 7265 7375 6c74 2e6f 7574 7075 742c 2044  result.output, D
-000017f0: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
-00001800: 2020 6465 6620 7465 7374 5f70 6970 696e    def test_pipin
-00001810: 675f 6469 6666 2873 656c 6629 202d 3e20  g_diff(self) -> 
-00001820: 4e6f 6e65 3a0a 2020 2020 2020 2020 6469  None:.        di
-00001830: 6666 5f68 6561 6465 7220 3d20 7265 2e63  ff_header = re.c
-00001840: 6f6d 7069 6c65 280a 2020 2020 2020 2020  ompile(.        
-00001850: 2020 2020 7222 2853 5444 494e 7c53 5444      r"(STDIN|STD
-00001860: 4f55 5429 5c74 5c64 5c64 5c64 5c64 2d5c  OUT)\t\d\d\d\d-\
-00001870: 645c 642d 5c64 5c64 205c 645c 643a 5c64  d\d-\d\d \d\d:\d
-00001880: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
-00001890: 645c 645c 6420 220a 2020 2020 2020 2020  d\d\d ".        
-000018a0: 2020 2020 7222 5c2b 5c64 5c64 5c64 5c64      r"\+\d\d\d\d
-000018b0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-000018c0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
-000018d0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
-000018e0: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
-000018f0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
-00001900: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
-00001910: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
-00001920: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
-00001930: 6573 7369 6f6e 2e64 6966 6622 290a 2020  ession.diff").  
-00001940: 2020 2020 2020 6172 6773 203d 205b 0a20        args = [. 
-00001950: 2020 2020 2020 2020 2020 2022 2d22 2c0a             "-",.
-00001960: 2020 2020 2020 2020 2020 2020 222d 2d66              "--f
-00001970: 6173 7422 2c0a 2020 2020 2020 2020 2020  ast",.          
-00001980: 2020 6622 2d2d 6c69 6e65 2d6c 656e 6774    f"--line-lengt
-00001990: 683d 7b62 6c61 636b 2e44 4546 4155 4c54  h={black.DEFAULT
-000019a0: 5f4c 494e 455f 4c45 4e47 5448 7d22 2c0a  _LINE_LENGTH}",.
-000019b0: 2020 2020 2020 2020 2020 2020 222d 2d64              "--d
-000019c0: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
-000019d0: 2020 6622 2d2d 636f 6e66 6967 3d7b 454d    f"--config={EM
-000019e0: 5054 595f 434f 4e46 4947 7d22 2c0a 2020  PTY_CONFIG}",.  
-000019f0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00001a00: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
-00001a10: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
-00001a20: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00001a30: 2e6d 6169 6e2c 2061 7267 732c 2069 6e70  .main, args, inp
-00001a40: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
-00001a50: 652e 656e 636f 6465 2822 7574 6638 2229  e.encode("utf8")
-00001a60: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
-00001a70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00001a80: 7175 616c 2872 6573 756c 742e 6578 6974  qual(result.exit
-00001a90: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
-00001aa0: 2020 6163 7475 616c 203d 2064 6966 665f    actual = diff_
-00001ab0: 6865 6164 6572 2e73 7562 2844 4554 4552  header.sub(DETER
-00001ac0: 4d49 4e49 5354 4943 5f48 4541 4445 522c  MINISTIC_HEADER,
-00001ad0: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
-00001ae0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-00001af0: 2061 6374 7561 6c2e 7273 7472 6970 2829   actual.rstrip()
-00001b00: 202b 2022 5c6e 2220 2023 2074 6865 2064   + "\n"  # the d
-00001b10: 6966 6620 6f75 7470 7574 2068 6173 2061  iff output has a
-00001b20: 2074 7261 696c 696e 6720 7370 6163 650a   trailing space.
-00001b30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001b40: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
-00001b50: 642c 2061 6374 7561 6c29 0a0a 2020 2020  d, actual)..    
-00001b60: 6465 6620 7465 7374 5f70 6970 696e 675f  def test_piping_
-00001b70: 6469 6666 5f77 6974 685f 636f 6c6f 7228  diff_with_color(
-00001b80: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00001b90: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-00001ba0: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
-00001bb0: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
-00001bc0: 7072 6573 7369 6f6e 2e70 7922 290a 2020  pression.py").  
-00001bd0: 2020 2020 2020 6172 6773 203d 205b 0a20        args = [. 
-00001be0: 2020 2020 2020 2020 2020 2022 2d22 2c0a             "-",.
-00001bf0: 2020 2020 2020 2020 2020 2020 222d 2d66              "--f
-00001c00: 6173 7422 2c0a 2020 2020 2020 2020 2020  ast",.          
-00001c10: 2020 6622 2d2d 6c69 6e65 2d6c 656e 6774    f"--line-lengt
-00001c20: 683d 7b62 6c61 636b 2e44 4546 4155 4c54  h={black.DEFAULT
-00001c30: 5f4c 494e 455f 4c45 4e47 5448 7d22 2c0a  _LINE_LENGTH}",.
-00001c40: 2020 2020 2020 2020 2020 2020 222d 2d64              "--d
-00001c50: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
-00001c60: 2020 222d 2d63 6f6c 6f72 222c 0a20 2020    "--color",.   
-00001c70: 2020 2020 2020 2020 2066 222d 2d63 6f6e           f"--con
-00001c80: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
-00001c90: 477d 222c 0a20 2020 2020 2020 205d 0a20  G}",.        ]. 
-00001ca0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00001cb0: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
-00001cc0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
-00001cd0: 2020 626c 6163 6b2e 6d61 696e 2c20 6172    black.main, ar
-00001ce0: 6773 2c20 696e 7075 743d 4279 7465 7349  gs, input=BytesI
-00001cf0: 4f28 736f 7572 6365 2e65 6e63 6f64 6528  O(source.encode(
-00001d00: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
-00001d10: 2029 0a20 2020 2020 2020 2061 6374 7561   ).        actua
-00001d20: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
-00001d30: 740a 2020 2020 2020 2020 2320 4167 6169  t.        # Agai
-00001d40: 6e2c 2074 6865 2063 6f6e 7465 6e74 7320  n, the contents 
-00001d50: 6172 6520 6368 6563 6b65 6420 696e 2061  are checked in a
-00001d60: 2064 6966 6665 7265 6e74 2074 6573 742c   different test,
-00001d70: 2073 6f20 6f6e 6c79 206c 6f6f 6b20 666f   so only look fo
-00001d80: 7220 636f 6c6f 7273 2e0a 2020 2020 2020  r colors..      
-00001d90: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00001da0: 225c 3033 335b 316d 222c 2061 6374 7561  "\033[1m", actua
-00001db0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
-00001dc0: 6173 7365 7274 496e 2822 5c30 3333 5b33  assertIn("\033[3
-00001dd0: 366d 222c 2061 6374 7561 6c29 0a20 2020  6m", actual).   
-00001de0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001df0: 496e 2822 5c30 3333 5b33 326d 222c 2061  In("\033[32m", a
-00001e00: 6374 7561 6c29 0a20 2020 2020 2020 2073  ctual).        s
-00001e10: 656c 662e 6173 7365 7274 496e 2822 5c30  elf.assertIn("\0
-00001e20: 3333 5b33 316d 222c 2061 6374 7561 6c29  33[31m", actual)
-00001e30: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001e40: 7365 7274 496e 2822 5c30 3333 5b30 6d22  sertIn("\033[0m"
-00001e50: 2c20 6163 7475 616c 290a 0a20 2020 2040  , actual)..    @
-00001e60: 7061 7463 6828 2262 6c61 636b 2e64 756d  patch("black.dum
-00001e70: 705f 746f 5f66 696c 6522 2c20 6475 6d70  p_to_file", dump
-00001e80: 5f74 6f5f 7374 6465 7272 290a 2020 2020  _to_stderr).    
-00001e90: 6465 6620 5f74 6573 745f 7769 7028 7365  def _test_wip(se
-00001ea0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00001eb0: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
-00001ec0: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
-00001ed0: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
-00001ee0: 222c 2022 7769 7022 290a 2020 2020 2020  ", "wip").      
-00001ef0: 2020 7379 732e 7365 7474 7261 6365 2874    sys.settrace(t
-00001f00: 7261 6365 6675 6e63 290a 2020 2020 2020  racefunc).      
-00001f10: 2020 6d6f 6465 203d 2072 6570 6c61 6365    mode = replace
-00001f20: 280a 2020 2020 2020 2020 2020 2020 4445  (.            DE
-00001f30: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
-00001f40: 2020 2020 2020 2020 6578 7065 7269 6d65          experime
-00001f50: 6e74 616c 5f73 7472 696e 675f 7072 6f63  ntal_string_proc
-00001f60: 6573 7369 6e67 3d46 616c 7365 2c0a 2020  essing=False,.  
-00001f70: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00001f80: 5f76 6572 7369 6f6e 733d 7b62 6c61 636b  _versions={black
-00001f90: 2e54 6172 6765 7456 6572 7369 6f6e 2e50  .TargetVersion.P
-00001fa0: 5933 387d 2c0a 2020 2020 2020 2020 290a  Y38},.        ).
-00001fb0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-00001fc0: 2066 7328 736f 7572 6365 2c20 6d6f 6465   fs(source, mode
-00001fd0: 3d6d 6f64 6529 0a20 2020 2020 2020 2073  =mode).        s
-00001fe0: 7973 2e73 6574 7472 6163 6528 4e6f 6e65  ys.settrace(None
-00001ff0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002000: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-00002010: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
-00002020: 6c29 0a20 2020 2020 2020 2062 6c61 636b  l).        black
-00002030: 2e61 7373 6572 745f 6571 7569 7661 6c65  .assert_equivale
-00002040: 6e74 2873 6f75 7263 652c 2061 6374 7561  nt(source, actua
-00002050: 6c29 0a20 2020 2020 2020 2062 6c61 636b  l).        black
-00002060: 2e61 7373 6572 745f 7374 6162 6c65 2873  .assert_stable(s
-00002070: 6f75 7263 652c 2061 6374 7561 6c2c 2062  ource, actual, b
-00002080: 6c61 636b 2e46 696c 654d 6f64 6528 2929  lack.FileMode())
-00002090: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
-000020a0: 6570 5f35 3732 5f76 6572 7369 6f6e 5f64  ep_572_version_d
-000020b0: 6574 6563 7469 6f6e 2873 656c 6629 202d  etection(self) -
-000020c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000020d0: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
-000020e0: 5f64 6174 6128 2270 795f 3338 222c 2022  _data("py_38", "
-000020f0: 7065 705f 3537 3222 290a 2020 2020 2020  pep_572").      
-00002100: 2020 726f 6f74 203d 2062 6c61 636b 2e6c    root = black.l
-00002110: 6962 3274 6f33 5f70 6172 7365 2873 6f75  ib2to3_parse(sou
-00002120: 7263 6529 0a20 2020 2020 2020 2066 6561  rce).        fea
-00002130: 7475 7265 7320 3d20 626c 6163 6b2e 6765  tures = black.ge
-00002140: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00002150: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
-00002160: 6c66 2e61 7373 6572 7449 6e28 626c 6163  lf.assertIn(blac
-00002170: 6b2e 4665 6174 7572 652e 4153 5349 474e  k.Feature.ASSIGN
-00002180: 4d45 4e54 5f45 5850 5245 5353 494f 4e53  MENT_EXPRESSIONS
-00002190: 2c20 6665 6174 7572 6573 290a 2020 2020  , features).    
-000021a0: 2020 2020 7665 7273 696f 6e73 203d 2062      versions = b
-000021b0: 6c61 636b 2e64 6574 6563 745f 7461 7267  lack.detect_targ
-000021c0: 6574 5f76 6572 7369 6f6e 7328 726f 6f74  et_versions(root
-000021d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000021e0: 7373 6572 7449 6e28 626c 6163 6b2e 5461  ssertIn(black.Ta
-000021f0: 7267 6574 5665 7273 696f 6e2e 5059 3338  rgetVersion.PY38
-00002200: 2c20 7665 7273 696f 6e73 290a 0a20 2020  , versions)..   
-00002210: 2064 6566 2074 6573 745f 6578 7072 6573   def test_expres
-00002220: 7369 6f6e 5f66 6628 7365 6c66 2920 2d3e  sion_ff(self) ->
-00002230: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-00002240: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
-00002250: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
-00002260: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
-00002270: 7265 7373 696f 6e2e 7079 2229 0a20 2020  ression.py").   
-00002280: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
-00002290: 5061 7468 2862 6c61 636b 2e64 756d 705f  Path(black.dump_
-000022a0: 746f 5f66 696c 6528 736f 7572 6365 2929  to_file(source))
-000022b0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000022c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000022d0: 7373 6572 7454 7275 6528 6666 2874 6d70  ssertTrue(ff(tmp
-000022e0: 5f66 696c 652c 2077 7269 7465 5f62 6163  _file, write_bac
-000022f0: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
-00002300: 6b2e 5945 5329 290a 2020 2020 2020 2020  k.YES)).        
-00002310: 2020 2020 7769 7468 206f 7065 6e28 746d      with open(tm
-00002320: 705f 6669 6c65 2c20 656e 636f 6469 6e67  p_file, encoding
-00002330: 3d22 7574 6638 2229 2061 7320 663a 0a20  ="utf8") as f:. 
-00002340: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00002350: 6374 7561 6c20 3d20 662e 7265 6164 2829  ctual = f.read()
-00002360: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-00002370: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-00002380: 2e75 6e6c 696e 6b28 746d 705f 6669 6c65  .unlink(tmp_file
-00002390: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000023a0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-000023b0: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
-000023c0: 6c29 0a20 2020 2020 2020 2077 6974 6820  l).        with 
-000023d0: 7061 7463 6828 2262 6c61 636b 2e64 756d  patch("black.dum
-000023e0: 705f 746f 5f66 696c 6522 2c20 6475 6d70  p_to_file", dump
-000023f0: 5f74 6f5f 7374 6465 7272 293a 0a20 2020  _to_stderr):.   
-00002400: 2020 2020 2020 2020 2062 6c61 636b 2e61           black.a
-00002410: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
-00002420: 2873 6f75 7263 652c 2061 6374 7561 6c29  (source, actual)
-00002430: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-00002440: 636b 2e61 7373 6572 745f 7374 6162 6c65  ck.assert_stable
-00002450: 2873 6f75 7263 652c 2061 6374 7561 6c2c  (source, actual,
-00002460: 2044 4546 4155 4c54 5f4d 4f44 4529 0a0a   DEFAULT_MODE)..
-00002470: 2020 2020 6465 6620 7465 7374 5f65 7870      def test_exp
-00002480: 7265 7373 696f 6e5f 6469 6666 2873 656c  ression_diff(sel
-00002490: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000024a0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
-000024b0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
-000024c0: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
-000024d0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
-000024e0: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
-000024f0: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
-00002500: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
-00002510: 6573 7369 6f6e 2e64 6966 6622 290a 2020  ession.diff").  
-00002520: 2020 2020 2020 746d 705f 6669 6c65 203d        tmp_file =
-00002530: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
-00002540: 5f74 6f5f 6669 6c65 2873 6f75 7263 6529  _to_file(source)
-00002550: 290a 2020 2020 2020 2020 6469 6666 5f68  ).        diff_h
-00002560: 6561 6465 7220 3d20 7265 2e63 6f6d 7069  eader = re.compi
-00002570: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00002580: 7266 227b 7265 2e65 7363 6170 6528 7374  rf"{re.escape(st
-00002590: 7228 746d 705f 6669 6c65 2929 7d5c 745c  r(tmp_file))}\t\
-000025a0: 645c 645c 645c 642d 5c64 5c64 2d5c 645c  d\d\d\d-\d\d-\d\
-000025b0: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
-000025c0: 7222 5c64 5c64 3a5c 645c 643a 5c64 5c64  r"\d\d:\d\d:\d\d
-000025d0: 5c2e 5c64 5c64 5c64 5c64 5c64 5c64 205c  \.\d\d\d\d\d\d \
-000025e0: 2b5c 645c 645c 645c 6422 0a20 2020 2020  +\d\d\d\d".     
-000025f0: 2020 2029 0a20 2020 2020 2020 2074 7279     ).        try
-00002600: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002610: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
-00002620: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
-00002630: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
-00002640: 636b 2e6d 6169 6e2c 205b 222d 2d64 6966  ck.main, ["--dif
-00002650: 6622 2c20 7374 7228 746d 705f 6669 6c65  f", str(tmp_file
-00002660: 292c 2066 222d 2d63 6f6e 6669 673d 7b45  ), f"--config={E
-00002670: 4d50 5459 5f43 4f4e 4649 477d 225d 0a20  MPTY_CONFIG}"]. 
-00002680: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00002690: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000026a0: 7365 7274 4571 7561 6c28 7265 7375 6c74  sertEqual(result
-000026b0: 2e65 7869 745f 636f 6465 2c20 3029 0a20  .exit_code, 0). 
-000026c0: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
-000026d0: 2020 2020 2020 2020 2020 2020 6f73 2e75              os.u
-000026e0: 6e6c 696e 6b28 746d 705f 6669 6c65 290a  nlink(tmp_file).
-000026f0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-00002700: 2072 6573 756c 742e 6f75 7470 7574 0a20   result.output. 
-00002710: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
-00002720: 6469 6666 5f68 6561 6465 722e 7375 6228  diff_header.sub(
-00002730: 4445 5445 524d 494e 4953 5449 435f 4845  DETERMINISTIC_HE
-00002740: 4144 4552 2c20 6163 7475 616c 290a 2020  ADER, actual).  
-00002750: 2020 2020 2020 6966 2065 7870 6563 7465        if expecte
-00002760: 6420 213d 2061 6374 7561 6c3a 0a20 2020  d != actual:.   
-00002770: 2020 2020 2020 2020 2064 756d 7020 3d20           dump = 
-00002780: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
-00002790: 6c65 2861 6374 7561 6c29 0a20 2020 2020  le(actual).     
-000027a0: 2020 2020 2020 206d 7367 203d 2028 0a20         msg = (. 
-000027b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000027c0: 4578 7065 6374 6564 2064 6966 6620 6973  Expected diff is
-000027d0: 6e27 7420 6571 7561 6c20 746f 2074 6865  n't equal to the
-000027e0: 2061 6374 7561 6c2e 2049 6620 796f 7520   actual. If you 
-000027f0: 6d61 6465 2063 6861 6e67 6573 2074 6f22  made changes to"
-00002800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002810: 2022 2065 7870 7265 7373 696f 6e2e 7079   " expression.py
-00002820: 2061 6e64 2074 6869 7320 6973 2061 6e20   and this is an 
-00002830: 616e 7469 6369 7061 7465 6420 6469 6666  anticipated diff
-00002840: 6572 656e 6365 2c20 6f76 6572 7772 6974  erence, overwrit
-00002850: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
-00002860: 2020 2066 2220 7465 7374 732f 6461 7461     f" tests/data
-00002870: 2f65 7870 7265 7373 696f 6e2e 6469 6666  /expression.diff
-00002880: 2077 6974 6820 7b64 756d 707d 220a 2020   with {dump}".  
-00002890: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000028a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000028b0: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
-000028c0: 642c 2061 6374 7561 6c2c 206d 7367 290a  d, actual, msg).
-000028d0: 0a20 2020 2064 6566 2074 6573 745f 6578  .    def test_ex
-000028e0: 7072 6573 7369 6f6e 5f64 6966 665f 7769  pression_diff_wi
-000028f0: 7468 5f63 6f6c 6f72 2873 656c 6629 202d  th_color(self) -
-00002900: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00002910: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
-00002920: 5f64 6174 6128 2273 696d 706c 655f 6361  _data("simple_ca
-00002930: 7365 7322 2c20 2265 7870 7265 7373 696f  ses", "expressio
-00002940: 6e2e 7079 2229 0a20 2020 2020 2020 2065  n.py").        e
-00002950: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
-00002960: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
-00002970: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
-00002980: 6f6e 2e64 6966 6622 290a 2020 2020 2020  on.diff").      
-00002990: 2020 746d 705f 6669 6c65 203d 2050 6174    tmp_file = Pat
-000029a0: 6828 626c 6163 6b2e 6475 6d70 5f74 6f5f  h(black.dump_to_
-000029b0: 6669 6c65 2873 6f75 7263 6529 290a 2020  file(source)).  
-000029c0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000029d0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000029e0: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
-000029f0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
-00002a00: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
-00002a10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002a20: 2020 5b22 2d2d 6469 6666 222c 2022 2d2d    ["--diff", "--
-00002a30: 636f 6c6f 7222 2c20 7374 7228 746d 705f  color", str(tmp_
-00002a40: 6669 6c65 292c 2066 222d 2d63 6f6e 6669  file), f"--confi
-00002a50: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
-00002a60: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00002a70: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
-00002a80: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-00002a90: 732e 756e 6c69 6e6b 2874 6d70 5f66 696c  s.unlink(tmp_fil
-00002aa0: 6529 0a20 2020 2020 2020 2061 6374 7561  e).        actua
-00002ab0: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
-00002ac0: 740a 2020 2020 2020 2020 2320 5765 2063  t.        # We c
-00002ad0: 6865 636b 2074 6865 2063 6f6e 7465 6e74  heck the content
-00002ae0: 7320 6f66 2074 6865 2064 6966 6620 696e  s of the diff in
-00002af0: 2060 7465 7374 5f65 7870 7265 7373 696f   `test_expressio
-00002b00: 6e5f 6469 6666 602e 2041 6c6c 0a20 2020  n_diff`. All.   
-00002b10: 2020 2020 2023 2077 6520 6e65 6564 2074       # we need t
-00002b20: 6f20 6368 6563 6b20 6865 7265 2069 7320  o check here is 
-00002b30: 7468 6174 2063 6f6c 6f72 2063 6f64 6573  that color codes
-00002b40: 2065 7869 7374 2069 6e20 7468 6520 7265   exist in the re
-00002b50: 7375 6c74 2e0a 2020 2020 2020 2020 7365  sult..        se
-00002b60: 6c66 2e61 7373 6572 7449 6e28 225c 3033  lf.assertIn("\03
-00002b70: 335b 316d 222c 2061 6374 7561 6c29 0a20  3[1m", actual). 
-00002b80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002b90: 7274 496e 2822 5c30 3333 5b33 366d 222c  rtIn("\033[36m",
-00002ba0: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
-00002bb0: 2073 656c 662e 6173 7365 7274 496e 2822   self.assertIn("
-00002bc0: 5c30 3333 5b33 326d 222c 2061 6374 7561  \033[32m", actua
-00002bd0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
-00002be0: 6173 7365 7274 496e 2822 5c30 3333 5b33  assertIn("\033[3
-00002bf0: 316d 222c 2061 6374 7561 6c29 0a20 2020  1m", actual).   
-00002c00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00002c10: 496e 2822 5c30 3333 5b30 6d22 2c20 6163  In("\033[0m", ac
-00002c20: 7475 616c 290a 0a20 2020 2064 6566 2074  tual)..    def t
-00002c30: 6573 745f 6465 7465 6374 5f70 6f73 5f6f  est_detect_pos_o
-00002c40: 6e6c 795f 6172 6775 6d65 6e74 7328 7365  nly_arguments(se
-00002c50: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00002c60: 2020 2020 2073 6f75 7263 652c 205f 203d       source, _ =
-00002c70: 2072 6561 645f 6461 7461 2822 7079 5f33   read_data("py_3
-00002c80: 3822 2c20 2270 6570 5f35 3730 2229 0a20  8", "pep_570"). 
-00002c90: 2020 2020 2020 2072 6f6f 7420 3d20 626c         root = bl
-00002ca0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00002cb0: 6528 736f 7572 6365 290a 2020 2020 2020  e(source).      
-00002cc0: 2020 6665 6174 7572 6573 203d 2062 6c61    features = bla
-00002cd0: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00002ce0: 7573 6564 2872 6f6f 7429 0a20 2020 2020  used(root).     
-00002cf0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00002d00: 2862 6c61 636b 2e46 6561 7475 7265 2e50  (black.Feature.P
-00002d10: 4f53 5f4f 4e4c 595f 4152 4755 4d45 4e54  OS_ONLY_ARGUMENT
-00002d20: 532c 2066 6561 7475 7265 7329 0a20 2020  S, features).   
-00002d30: 2020 2020 2076 6572 7369 6f6e 7320 3d20       versions = 
-00002d40: 626c 6163 6b2e 6465 7465 6374 5f74 6172  black.detect_tar
-00002d50: 6765 745f 7665 7273 696f 6e73 2872 6f6f  get_versions(roo
-00002d60: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
-00002d70: 6173 7365 7274 496e 2862 6c61 636b 2e54  assertIn(black.T
-00002d80: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-00002d90: 382c 2076 6572 7369 6f6e 7329 0a0a 2020  8, versions)..  
-00002da0: 2020 6465 6620 7465 7374 5f64 6574 6563    def test_detec
-00002db0: 745f 6465 6275 675f 665f 7374 7269 6e67  t_debug_f_string
-00002dc0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-00002dd0: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
-00002de0: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00002df0: 7273 6528 2222 2266 227b 783d 7d22 2022  rse("""f"{x=}" "
-00002e00: 2222 290a 2020 2020 2020 2020 6665 6174  "").        feat
-00002e10: 7572 6573 203d 2062 6c61 636b 2e67 6574  ures = black.get
-00002e20: 5f66 6561 7475 7265 735f 7573 6564 2872  _features_used(r
-00002e30: 6f6f 7429 0a20 2020 2020 2020 2073 656c  oot).        sel
-00002e40: 662e 6173 7365 7274 496e 2862 6c61 636b  f.assertIn(black
-00002e50: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
-00002e60: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
-00002e70: 6573 290a 2020 2020 2020 2020 7665 7273  es).        vers
-00002e80: 696f 6e73 203d 2062 6c61 636b 2e64 6574  ions = black.det
-00002e90: 6563 745f 7461 7267 6574 5f76 6572 7369  ect_target_versi
-00002ea0: 6f6e 7328 726f 6f74 290a 2020 2020 2020  ons(root).      
-00002eb0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00002ec0: 626c 6163 6b2e 5461 7267 6574 5665 7273  black.TargetVers
-00002ed0: 696f 6e2e 5059 3338 2c20 7665 7273 696f  ion.PY38, versio
-00002ee0: 6e73 290a 0a20 2020 2020 2020 2072 6f6f  ns)..        roo
-00002ef0: 7420 3d20 626c 6163 6b2e 6c69 6232 746f  t = black.lib2to
-00002f00: 335f 7061 7273 6528 0a20 2020 2020 2020  3_parse(.       
-00002f10: 2020 2020 2022 2222 6622 7b78 7d22 5c6e       """f"{x}"\n
-00002f20: 6627 7b22 3d22 7d27 5c6e 6627 7b28 783a  f'{"="}'\nf'{(x:
-00002f30: 3d35 297d 275c 6e66 277b 6628 613d 2233  =5)}'\nf'{f(a="3
-00002f40: 3d22 297d 275c 6e66 277b 783a 3d31 307d  =")}'\nf'{x:=10}
-00002f50: 275c 6e22 2222 0a20 2020 2020 2020 2029  '\n""".        )
-00002f60: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00002f70: 7320 3d20 626c 6163 6b2e 6765 745f 6665  s = black.get_fe
-00002f80: 6174 7572 6573 5f75 7365 6428 726f 6f74  atures_used(root
-00002f90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002fa0: 7373 6572 744e 6f74 496e 2862 6c61 636b  ssertNotIn(black
-00002fb0: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
-00002fc0: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
-00002fd0: 6573 290a 0a20 2020 2020 2020 2023 2057  es)..        # W
-00002fe0: 6520 646f 6e27 7420 7965 7420 7375 7070  e don't yet supp
-00002ff0: 6f72 7420 6665 6174 7572 6520 7665 7273  ort feature vers
-00003000: 696f 6e20 6465 7465 6374 696f 6e20 696e  ion detection in
-00003010: 206e 6573 7465 6420 662d 7374 7269 6e67   nested f-string
-00003020: 730a 2020 2020 2020 2020 726f 6f74 203d  s.        root =
-00003030: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-00003040: 6172 7365 280a 2020 2020 2020 2020 2020  arse(.          
-00003050: 2020 2222 2266 2268 6561 7264 2061 2072    """f"heard a r
-00003060: 756d 6f75 7220 7468 6174 207b 2066 277b  umour that { f'{
-00003070: 312b 313d 7d27 207d 202e 2e2e 2073 6565  1+1=}' } ... see
-00003080: 6d73 206c 696b 6520 6974 2063 6f75 6c64  ms like it could
-00003090: 2062 6520 7472 7565 2220 2222 220a 2020   be true" """.  
-000030a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000030b0: 6665 6174 7572 6573 203d 2062 6c61 636b  features = black
-000030c0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-000030d0: 6564 2872 6f6f 7429 0a20 2020 2020 2020  ed(root).       
-000030e0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
-000030f0: 6e28 626c 6163 6b2e 4665 6174 7572 652e  n(black.Feature.
-00003100: 4445 4255 475f 465f 5354 5249 4e47 532c  DEBUG_F_STRINGS,
-00003110: 2066 6561 7475 7265 7329 0a0a 2020 2020   features)..    
-00003120: 4070 6174 6368 2822 626c 6163 6b2e 6475  @patch("black.du
-00003130: 6d70 5f74 6f5f 6669 6c65 222c 2064 756d  mp_to_file", dum
-00003140: 705f 746f 5f73 7464 6572 7229 0a20 2020  p_to_stderr).   
-00003150: 2064 6566 2074 6573 745f 7374 7269 6e67   def test_string
-00003160: 5f71 756f 7465 7328 7365 6c66 2920 2d3e  _quotes(self) ->
-00003170: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-00003180: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
-00003190: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-000031a0: 6365 6c6c 616e 656f 7573 222c 2022 7374  cellaneous", "st
-000031b0: 7269 6e67 5f71 756f 7465 7322 290a 2020  ring_quotes").  
-000031c0: 2020 2020 2020 6d6f 6465 203d 2062 6c61        mode = bla
-000031d0: 636b 2e4d 6f64 6528 7072 6576 6965 773d  ck.Mode(preview=
-000031e0: 5472 7565 290a 2020 2020 2020 2020 6173  True).        as
-000031f0: 7365 7274 5f66 6f72 6d61 7428 736f 7572  sert_format(sour
-00003200: 6365 2c20 6578 7065 6374 6564 2c20 6d6f  ce, expected, mo
-00003210: 6465 290a 2020 2020 2020 2020 6d6f 6465  de).        mode
-00003220: 203d 2072 6570 6c61 6365 286d 6f64 652c   = replace(mode,
-00003230: 2073 7472 696e 675f 6e6f 726d 616c 697a   string_normaliz
-00003240: 6174 696f 6e3d 4661 6c73 6529 0a20 2020  ation=False).   
-00003250: 2020 2020 206e 6f74 5f6e 6f72 6d61 6c69       not_normali
-00003260: 7a65 6420 3d20 6673 2873 6f75 7263 652c  zed = fs(source,
-00003270: 206d 6f64 653d 6d6f 6465 290a 2020 2020   mode=mode).    
-00003280: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00003290: 6f72 6d61 7445 7175 616c 2873 6f75 7263  ormatEqual(sourc
-000032a0: 652e 7265 706c 6163 6528 225c 5c5c 6e22  e.replace("\\\n"
-000032b0: 2c20 2222 292c 206e 6f74 5f6e 6f72 6d61  , ""), not_norma
-000032c0: 6c69 7a65 6429 0a20 2020 2020 2020 2062  lized).        b
-000032d0: 6c61 636b 2e61 7373 6572 745f 6571 7569  lack.assert_equi
-000032e0: 7661 6c65 6e74 2873 6f75 7263 652c 206e  valent(source, n
-000032f0: 6f74 5f6e 6f72 6d61 6c69 7a65 6429 0a20  ot_normalized). 
-00003300: 2020 2020 2020 2062 6c61 636b 2e61 7373         black.ass
-00003310: 6572 745f 7374 6162 6c65 2873 6f75 7263  ert_stable(sourc
-00003320: 652c 206e 6f74 5f6e 6f72 6d61 6c69 7a65  e, not_normalize
-00003330: 642c 206d 6f64 653d 6d6f 6465 290a 0a20  d, mode=mode).. 
-00003340: 2020 2064 6566 2074 6573 745f 736b 6970     def test_skip
-00003350: 5f73 6f75 7263 655f 6669 7273 745f 6c69  _source_first_li
-00003360: 6e65 2873 656c 6629 202d 3e20 4e6f 6e65  ne(self) -> None
-00003370: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
-00003380: 2c20 5f20 3d20 7265 6164 5f64 6174 6128  , _ = read_data(
-00003390: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
-000033a0: 2022 696e 7661 6c69 645f 6865 6164 6572   "invalid_header
-000033b0: 2229 0a20 2020 2020 2020 2074 6d70 5f66  ").        tmp_f
-000033c0: 696c 6520 3d20 5061 7468 2862 6c61 636b  ile = Path(black
-000033d0: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
-000033e0: 7572 6365 2929 0a20 2020 2020 2020 2023  urce)).        #
-000033f0: 2046 756c 6c20 736f 7572 6365 2073 686f   Full source sho
-00003400: 756c 6420 6661 696c 2028 696e 7661 6c69  uld fail (invali
-00003410: 6420 7379 6e74 6178 2061 7420 6865 6164  d syntax at head
-00003420: 6572 290a 2020 2020 2020 2020 7365 6c66  er).        self
-00003430: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-00003440: 7228 746d 705f 6669 6c65 292c 2022 2d2d  r(tmp_file), "--
-00003450: 6469 6666 222c 2022 2d2d 6368 6563 6b22  diff", "--check"
-00003460: 5d2c 2065 7869 745f 636f 6465 3d31 3233  ], exit_code=123
-00003470: 290a 2020 2020 2020 2020 2320 536f 2c20  ).        # So, 
-00003480: 736b 6970 7069 6e67 2074 6865 2066 6972  skipping the fir
-00003490: 7374 206c 696e 6520 7368 6f75 6c64 2077  st line should w
-000034a0: 6f72 6b0a 2020 2020 2020 2020 7265 7375  ork.        resu
-000034b0: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
-000034c0: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-000034d0: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
-000034e0: 6e2c 205b 7374 7228 746d 705f 6669 6c65  n, [str(tmp_file
-000034f0: 292c 2022 2d78 222c 2066 222d 2d63 6f6e  ), "-x", f"--con
-00003500: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
-00003510: 477d 225d 0a20 2020 2020 2020 2029 0a20  G}"].        ). 
-00003520: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00003530: 7274 4571 7561 6c28 7265 7375 6c74 2e65  rtEqual(result.e
-00003540: 7869 745f 636f 6465 2c20 3029 0a20 2020  xit_code, 0).   
-00003550: 2020 2020 2077 6974 6820 6f70 656e 2874       with open(t
-00003560: 6d70 5f66 696c 652c 2065 6e63 6f64 696e  mp_file, encodin
-00003570: 673d 2275 7466 3822 2920 6173 2066 3a0a  g="utf8") as f:.
-00003580: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-00003590: 616c 203d 2066 2e72 6561 6428 290a 2020  al = f.read().  
-000035a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000035b0: 7446 6f72 6d61 7445 7175 616c 2873 6f75  tFormatEqual(sou
-000035c0: 7263 652c 2061 6374 7561 6c29 0a0a 2020  rce, actual)..  
-000035d0: 2020 6465 6620 7465 7374 5f73 6b69 705f    def test_skip_
-000035e0: 736f 7572 6365 5f66 6972 7374 5f6c 696e  source_first_lin
-000035f0: 655f 7768 656e 5f6d 6978 696e 675f 6e65  e_when_mixing_ne
-00003600: 776c 696e 6573 2873 656c 6629 202d 3e20  wlines(self) -> 
-00003610: 4e6f 6e65 3a0a 2020 2020 2020 2020 636f  None:.        co
-00003620: 6465 5f6d 6978 696e 675f 6e65 776c 696e  de_mixing_newlin
-00003630: 6573 203d 2062 2248 6561 6465 7220 7769  es = b"Header wi
-00003640: 6c6c 2062 6520 736b 6970 7065 645c 725c  ll be skipped\r\
-00003650: 6e69 203d 205b 312c 322c 335d 5c6e 6a20  ni = [1,2,3]\nj 
-00003660: 3d20 5b31 2c32 2c33 5d5c 6e22 0a20 2020  = [1,2,3]\n".   
-00003670: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-00003680: 6222 4865 6164 6572 2077 696c 6c20 6265  b"Header will be
-00003690: 2073 6b69 7070 6564 5c72 5c6e 6920 3d20   skipped\r\ni = 
-000036a0: 5b31 2c20 322c 2033 5d5c 6e6a 203d 205b  [1, 2, 3]\nj = [
-000036b0: 312c 2032 2c20 335d 5c6e 220a 2020 2020  1, 2, 3]\n".    
-000036c0: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-000036d0: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-000036e0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
-000036f0: 2020 2020 2020 2020 7465 7374 5f66 696c          test_fil
-00003700: 6520 3d20 5061 7468 2877 6f72 6b73 7061  e = Path(workspa
-00003710: 6365 2920 2f20 2273 6b69 705f 6865 6164  ce) / "skip_head
-00003720: 6572 2e70 7922 0a20 2020 2020 2020 2020  er.py".         
-00003730: 2020 2074 6573 745f 6669 6c65 2e77 7269     test_file.wri
-00003740: 7465 5f62 7974 6573 2863 6f64 655f 6d69  te_bytes(code_mi
-00003750: 7869 6e67 5f6e 6577 6c69 6e65 7329 0a20  xing_newlines). 
-00003760: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
-00003770: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
-00003780: 545f 4d4f 4445 2c20 736b 6970 5f73 6f75  T_MODE, skip_sou
-00003790: 7263 655f 6669 7273 745f 6c69 6e65 3d54  rce_first_line=T
-000037a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000037b0: 2066 6628 7465 7374 5f66 696c 652c 206d   ff(test_file, m
-000037c0: 6f64 653d 6d6f 6465 2c20 7772 6974 655f  ode=mode, write_
-000037d0: 6261 636b 3d62 6c61 636b 2e57 7269 7465  back=black.Write
-000037e0: 4261 636b 2e59 4553 290a 2020 2020 2020  Back.YES).      
-000037f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00003800: 7445 7175 616c 2874 6573 745f 6669 6c65  tEqual(test_file
-00003810: 2e72 6561 645f 6279 7465 7328 292c 2065  .read_bytes(), e
-00003820: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
-00003830: 6620 7465 7374 5f73 6b69 705f 6d61 6769  f test_skip_magi
-00003840: 635f 7472 6169 6c69 6e67 5f63 6f6d 6d61  c_trailing_comma
-00003850: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00003860: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
-00003870: 5f20 3d20 7265 6164 5f64 6174 6128 2273  _ = read_data("s
-00003880: 696d 706c 655f 6361 7365 7322 2c20 2265  imple_cases", "e
-00003890: 7870 7265 7373 696f 6e22 290a 2020 2020  xpression").    
-000038a0: 2020 2020 6578 7065 6374 6564 2c20 5f20      expected, _ 
-000038b0: 3d20 7265 6164 5f64 6174 6128 0a20 2020  = read_data(.   
-000038c0: 2020 2020 2020 2020 2022 6d69 7363 656c           "miscel
-000038d0: 6c61 6e65 6f75 7322 2c20 2265 7870 7265  laneous", "expre
-000038e0: 7373 696f 6e5f 736b 6970 5f6d 6167 6963  ssion_skip_magic
-000038f0: 5f74 7261 696c 696e 675f 636f 6d6d 612e  _trailing_comma.
-00003900: 6469 6666 220a 2020 2020 2020 2020 290a  diff".        ).
-00003910: 2020 2020 2020 2020 746d 705f 6669 6c65          tmp_file
-00003920: 203d 2050 6174 6828 626c 6163 6b2e 6475   = Path(black.du
-00003930: 6d70 5f74 6f5f 6669 6c65 2873 6f75 7263  mp_to_file(sourc
-00003940: 6529 290a 2020 2020 2020 2020 6469 6666  e)).        diff
-00003950: 5f68 6561 6465 7220 3d20 7265 2e63 6f6d  _header = re.com
-00003960: 7069 6c65 280a 2020 2020 2020 2020 2020  pile(.          
-00003970: 2020 7266 227b 7265 2e65 7363 6170 6528    rf"{re.escape(
-00003980: 7374 7228 746d 705f 6669 6c65 2929 7d5c  str(tmp_file))}\
-00003990: 745c 645c 645c 645c 642d 5c64 5c64 2d5c  t\d\d\d\d-\d\d-\
-000039a0: 645c 6420 220a 2020 2020 2020 2020 2020  d\d ".          
-000039b0: 2020 7222 5c64 5c64 3a5c 645c 643a 5c64    r"\d\d:\d\d:\d
-000039c0: 5c64 5c2e 5c64 5c64 5c64 5c64 5c64 5c64  \d\.\d\d\d\d\d\d
-000039d0: 205c 2b5c 645c 645c 645c 6422 0a20 2020   \+\d\d\d\d".   
-000039e0: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-000039f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00003a00: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
-00003a10: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
-00003a20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00003a30: 6c61 636b 2e6d 6169 6e2c 205b 222d 4322  lack.main, ["-C"
-00003a40: 2c20 222d 2d64 6966 6622 2c20 7374 7228  , "--diff", str(
-00003a50: 746d 705f 6669 6c65 292c 2066 222d 2d63  tmp_file), f"--c
-00003a60: 6f6e 6669 673d 7b45 4d50 5459 5f43 4f4e  onfig={EMPTY_CON
-00003a70: 4649 477d 225d 0a20 2020 2020 2020 2020  FIG}"].         
-00003a80: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00003a90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00003aa0: 6c28 7265 7375 6c74 2e65 7869 745f 636f  l(result.exit_co
-00003ab0: 6465 2c20 3029 0a20 2020 2020 2020 2066  de, 0).        f
-00003ac0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
-00003ad0: 2020 2020 6f73 2e75 6e6c 696e 6b28 746d      os.unlink(tm
-00003ae0: 705f 6669 6c65 290a 2020 2020 2020 2020  p_file).        
-00003af0: 6163 7475 616c 203d 2072 6573 756c 742e  actual = result.
-00003b00: 6f75 7470 7574 0a20 2020 2020 2020 2061  output.        a
-00003b10: 6374 7561 6c20 3d20 6469 6666 5f68 6561  ctual = diff_hea
-00003b20: 6465 722e 7375 6228 4445 5445 524d 494e  der.sub(DETERMIN
-00003b30: 4953 5449 435f 4845 4144 4552 2c20 6163  ISTIC_HEADER, ac
-00003b40: 7475 616c 290a 2020 2020 2020 2020 6163  tual).        ac
-00003b50: 7475 616c 203d 2061 6374 7561 6c2e 7273  tual = actual.rs
-00003b60: 7472 6970 2829 202b 2022 5c6e 2220 2023  trip() + "\n"  #
-00003b70: 2074 6865 2064 6966 6620 6f75 7470 7574   the diff output
-00003b80: 2068 6173 2061 2074 7261 696c 696e 6720   has a trailing 
-00003b90: 7370 6163 650a 2020 2020 2020 2020 6966  space.        if
-00003ba0: 2065 7870 6563 7465 6420 213d 2061 6374   expected != act
-00003bb0: 7561 6c3a 0a20 2020 2020 2020 2020 2020  ual:.           
-00003bc0: 2064 756d 7020 3d20 626c 6163 6b2e 6475   dump = black.du
-00003bd0: 6d70 5f74 6f5f 6669 6c65 2861 6374 7561  mp_to_file(actua
-00003be0: 6c29 0a20 2020 2020 2020 2020 2020 206d  l).            m
-00003bf0: 7367 203d 2028 0a20 2020 2020 2020 2020  sg = (.         
-00003c00: 2020 2020 2020 2022 4578 7065 6374 6564         "Expected
-00003c10: 2064 6966 6620 6973 6e27 7420 6571 7561   diff isn't equa
-00003c20: 6c20 746f 2074 6865 2061 6374 7561 6c2e  l to the actual.
-00003c30: 2049 6620 796f 7520 6d61 6465 2063 6861   If you made cha
-00003c40: 6e67 6573 2074 6f22 0a20 2020 2020 2020  nges to".       
-00003c50: 2020 2020 2020 2020 2022 2065 7870 7265           " expre
-00003c60: 7373 696f 6e2e 7079 2061 6e64 2074 6869  ssion.py and thi
-00003c70: 7320 6973 2061 6e20 616e 7469 6369 7061  s is an anticipa
-00003c80: 7465 6420 6469 6666 6572 656e 6365 2c20  ted difference, 
-00003c90: 6f76 6572 7772 6974 6522 0a20 2020 2020  overwrite".     
-00003ca0: 2020 2020 2020 2020 2020 2022 2074 6573             " tes
-00003cb0: 7473 2f64 6174 612f 6d69 7363 656c 6c61  ts/data/miscella
-00003cc0: 6e65 6f75 732f 6578 7072 6573 7369 6f6e  neous/expression
-00003cd0: 5f73 6b69 705f 6d61 6769 635f 7472 6169  _skip_magic_trai
-00003ce0: 6c69 6e67 5f63 6f6d 6d61 2e64 6966 6622  ling_comma.diff"
-00003cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003d00: 2066 2220 7769 7468 207b 6475 6d70 7d22   f" with {dump}"
-00003d10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00003d20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003d30: 6173 7365 7274 4571 7561 6c28 6578 7065  assertEqual(expe
-00003d40: 6374 6564 2c20 6163 7475 616c 2c20 6d73  cted, actual, ms
-00003d50: 6729 0a0a 2020 2020 4070 6174 6368 2822  g)..    @patch("
-00003d60: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
-00003d70: 6c65 222c 2064 756d 705f 746f 5f73 7464  le", dump_to_std
-00003d80: 6572 7229 0a20 2020 2064 6566 2074 6573  err).    def tes
-00003d90: 745f 6173 796e 635f 6173 5f69 6465 6e74  t_async_as_ident
-00003da0: 6966 6965 7228 7365 6c66 2920 2d3e 204e  ifier(self) -> N
-00003db0: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
-00003dc0: 7263 655f 7061 7468 203d 2067 6574 5f63  rce_path = get_c
-00003dd0: 6173 655f 7061 7468 2822 6d69 7363 656c  ase_path("miscel
-00003de0: 6c61 6e65 6f75 7322 2c20 2261 7379 6e63  laneous", "async
-00003df0: 5f61 735f 6964 656e 7469 6669 6572 2229  _as_identifier")
-00003e00: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
-00003e10: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
-00003e20: 5f64 6174 615f 6672 6f6d 5f66 696c 6528  _data_from_file(
-00003e30: 736f 7572 6365 5f70 6174 6829 0a20 2020  source_path).   
-00003e40: 2020 2020 2061 6374 7561 6c20 3d20 6673       actual = fs
-00003e50: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
-00003e60: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-00003e70: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
-00003e80: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00003e90: 2020 6d61 6a6f 722c 206d 696e 6f72 203d    major, minor =
-00003ea0: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
-00003eb0: 6f5b 3a32 5d0a 2020 2020 2020 2020 6966  o[:2].        if
-00003ec0: 206d 616a 6f72 203c 2033 206f 7220 286d   major < 3 or (m
-00003ed0: 616a 6f72 203c 3d20 3320 616e 6420 6d69  ajor <= 3 and mi
-00003ee0: 6e6f 7220 3c20 3729 3a0a 2020 2020 2020  nor < 7):.      
-00003ef0: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
-00003f00: 7274 5f65 7175 6976 616c 656e 7428 736f  rt_equivalent(so
-00003f10: 7572 6365 2c20 6163 7475 616c 290a 2020  urce, actual).  
-00003f20: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
-00003f30: 7274 5f73 7461 626c 6528 736f 7572 6365  rt_stable(source
-00003f40: 2c20 6163 7475 616c 2c20 4445 4641 554c  , actual, DEFAUL
-00003f50: 545f 4d4f 4445 290a 2020 2020 2020 2020  T_MODE).        
-00003f60: 2320 656e 7375 7265 2062 6c61 636b 2063  # ensure black c
-00003f70: 616e 2070 6172 7365 2074 6869 7320 7768  an parse this wh
-00003f80: 656e 2074 6865 2074 6172 6765 7420 6973  en the target is
-00003f90: 2033 2e36 0a20 2020 2020 2020 2073 656c   3.6.        sel
-00003fa0: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
-00003fb0: 7472 2873 6f75 7263 655f 7061 7468 292c  tr(source_path),
-00003fc0: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
-00003fd0: 6f6e 222c 2022 7079 3336 225d 290a 2020  on", "py36"]).  
-00003fe0: 2020 2020 2020 2320 6275 7420 6e6f 7420        # but not 
-00003ff0: 6f6e 2033 2e37 2c20 6265 6361 7573 6520  on 3.7, because 
-00004000: 6173 796e 632f 6177 6169 7420 6973 206e  async/await is n
-00004010: 6f20 6c6f 6e67 6572 2061 6e20 6964 656e  o longer an iden
-00004020: 7469 6669 6572 0a20 2020 2020 2020 2073  tifier.        s
-00004030: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
-00004040: 5b73 7472 2873 6f75 7263 655f 7061 7468  [str(source_path
-00004050: 292c 2022 2d2d 7461 7267 6574 2d76 6572  ), "--target-ver
-00004060: 7369 6f6e 222c 2022 7079 3337 225d 2c20  sion", "py37"], 
-00004070: 6578 6974 5f63 6f64 653d 3132 3329 0a0a  exit_code=123)..
-00004080: 2020 2020 4070 6174 6368 2822 626c 6163      @patch("blac
-00004090: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 222c  k.dump_to_file",
-000040a0: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
-000040b0: 0a20 2020 2064 6566 2074 6573 745f 7079  .    def test_py
-000040c0: 7468 6f6e 3337 2873 656c 6629 202d 3e20  thon37(self) -> 
-000040d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
-000040e0: 7572 6365 5f70 6174 6820 3d20 6765 745f  urce_path = get_
-000040f0: 6361 7365 5f70 6174 6828 2270 795f 3337  case_path("py_37
-00004100: 222c 2022 7079 7468 6f6e 3337 2229 0a20  ", "python37"). 
-00004110: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
-00004120: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
-00004130: 6174 615f 6672 6f6d 5f66 696c 6528 736f  ata_from_file(so
-00004140: 7572 6365 5f70 6174 6829 0a20 2020 2020  urce_path).     
-00004150: 2020 2061 6374 7561 6c20 3d20 6673 2873     actual = fs(s
-00004160: 6f75 7263 6529 0a20 2020 2020 2020 2073  ource).        s
-00004170: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
-00004180: 4571 7561 6c28 6578 7065 6374 6564 2c20  Equal(expected, 
-00004190: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
-000041a0: 6d61 6a6f 722c 206d 696e 6f72 203d 2073  major, minor = s
-000041b0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
-000041c0: 3a32 5d0a 2020 2020 2020 2020 6966 206d  :2].        if m
-000041d0: 616a 6f72 203e 2033 206f 7220 286d 616a  ajor > 3 or (maj
-000041e0: 6f72 203d 3d20 3320 616e 6420 6d69 6e6f  or == 3 and mino
-000041f0: 7220 3e3d 2037 293a 0a20 2020 2020 2020  r >= 7):.       
-00004200: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00004210: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
-00004220: 7263 652c 2061 6374 7561 6c29 0a20 2020  rce, actual).   
-00004230: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00004240: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
-00004250: 2061 6374 7561 6c2c 2044 4546 4155 4c54   actual, DEFAULT
-00004260: 5f4d 4f44 4529 0a20 2020 2020 2020 2023  _MODE).        #
-00004270: 2065 6e73 7572 6520 626c 6163 6b20 6361   ensure black ca
-00004280: 6e20 7061 7273 6520 7468 6973 2077 6865  n parse this whe
-00004290: 6e20 7468 6520 7461 7267 6574 2069 7320  n the target is 
-000042a0: 332e 370a 2020 2020 2020 2020 7365 6c66  3.7.        self
-000042b0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-000042c0: 7228 736f 7572 6365 5f70 6174 6829 2c20  r(source_path), 
-000042d0: 222d 2d74 6172 6765 742d 7665 7273 696f  "--target-versio
-000042e0: 6e22 2c20 2270 7933 3722 5d29 0a20 2020  n", "py37"]).   
-000042f0: 2020 2020 2023 2062 7574 206e 6f74 206f       # but not o
-00004300: 6e20 332e 362c 2062 6563 6175 7365 2077  n 3.6, because w
-00004310: 6520 7573 6520 6173 796e 6320 6173 2061  e use async as a
-00004320: 2072 6573 6572 7665 6420 6b65 7977 6f72   reserved keywor
-00004330: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
-00004340: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-00004350: 736f 7572 6365 5f70 6174 6829 2c20 222d  source_path), "-
-00004360: 2d74 6172 6765 742d 7665 7273 696f 6e22  -target-version"
-00004370: 2c20 2270 7933 3622 5d2c 2065 7869 745f  , "py36"], exit_
-00004380: 636f 6465 3d31 3233 290a 0a20 2020 2064  code=123)..    d
-00004390: 6566 2074 6573 745f 7461 625f 636f 6d6d  ef test_tab_comm
-000043a0: 656e 745f 696e 6465 6e74 6174 696f 6e28  ent_indentation(
-000043b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000043c0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
-000043d0: 7461 6220 3d20 2269 6620 313a 5c6e 5c74  tab = "if 1:\n\t
-000043e0: 6966 2032 3a5c 6e5c 745c 7470 6173 735c  if 2:\n\t\tpass\
-000043f0: 6e5c 7423 2063 6f6d 6d65 6e74 5c6e 5c74  n\t# comment\n\t
-00004400: 7061 7373 5c6e 220a 2020 2020 2020 2020  pass\n".        
-00004410: 636f 6e74 656e 7473 5f73 7063 203d 2022  contents_spc = "
-00004420: 6966 2031 3a5c 6e20 2020 2069 6620 323a  if 1:\n    if 2:
-00004430: 5c6e 2020 2020 2020 2020 7061 7373 5c6e  \n        pass\n
-00004440: 2020 2020 2320 636f 6d6d 656e 745c 6e20      # comment\n 
-00004450: 2020 2070 6173 735c 6e22 0a20 2020 2020     pass\n".     
-00004460: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
-00004470: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
-00004480: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
-00004490: 6e74 735f 7370 6329 290a 2020 2020 2020  nts_spc)).      
-000044a0: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
-000044b0: 6d61 7445 7175 616c 2863 6f6e 7465 6e74  matEqual(content
-000044c0: 735f 7370 632c 2066 7328 636f 6e74 656e  s_spc, fs(conten
-000044d0: 7473 5f74 6162 2929 0a0a 2020 2020 2020  ts_tab))..      
-000044e0: 2020 636f 6e74 656e 7473 5f74 6162 203d    contents_tab =
-000044f0: 2022 6966 2031 3a5c 6e5c 7469 6620 323a   "if 1:\n\tif 2:
-00004500: 5c6e 5c74 5c74 7061 7373 5c6e 5c74 5c74  \n\t\tpass\n\t\t
-00004510: 2320 636f 6d6d 656e 745c 6e5c 7470 6173  # comment\n\tpas
-00004520: 735c 6e22 0a20 2020 2020 2020 2063 6f6e  s\n".        con
-00004530: 7465 6e74 735f 7370 6320 3d20 2269 6620  tents_spc = "if 
-00004540: 313a 5c6e 2020 2020 6966 2032 3a5c 6e20  1:\n    if 2:\n 
-00004550: 2020 2020 2020 2070 6173 735c 6e20 2020         pass\n   
-00004560: 2020 2020 2023 2063 6f6d 6d65 6e74 5c6e       # comment\n
-00004570: 2020 2020 7061 7373 5c6e 220a 2020 2020      pass\n".    
-00004580: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00004590: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
-000045a0: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
-000045b0: 656e 7473 5f73 7063 2929 0a20 2020 2020  ents_spc)).     
-000045c0: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
-000045d0: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
-000045e0: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
-000045f0: 6e74 735f 7461 6229 290a 0a20 2020 2020  nts_tab))..     
-00004600: 2020 2023 206d 6978 6564 2074 6162 7320     # mixed tabs 
-00004610: 616e 6420 7370 6163 6573 2028 7661 6c69  and spaces (vali
-00004620: 6420 5079 7468 6f6e 2032 2063 6f64 6529  d Python 2 code)
-00004630: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-00004640: 735f 7461 6220 3d20 2269 6620 313a 5c6e  s_tab = "if 1:\n
-00004650: 2020 2020 2020 2020 6966 2032 3a5c 6e5c          if 2:\n\
-00004660: 745c 7470 6173 735c 6e5c 7423 2063 6f6d  t\tpass\n\t# com
-00004670: 6d65 6e74 5c6e 2020 2020 2020 2020 7061  ment\n        pa
-00004680: 7373 5c6e 220a 2020 2020 2020 2020 636f  ss\n".        co
-00004690: 6e74 656e 7473 5f73 7063 203d 2022 6966  ntents_spc = "if
-000046a0: 2031 3a5c 6e20 2020 2069 6620 323a 5c6e   1:\n    if 2:\n
-000046b0: 2020 2020 2020 2020 7061 7373 5c6e 2020          pass\n  
-000046c0: 2020 2320 636f 6d6d 656e 745c 6e20 2020    # comment\n   
-000046d0: 2070 6173 735c 6e22 0a20 2020 2020 2020   pass\n".       
-000046e0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-000046f0: 6174 4571 7561 6c28 636f 6e74 656e 7473  atEqual(contents
-00004700: 5f73 7063 2c20 6673 2863 6f6e 7465 6e74  _spc, fs(content
-00004710: 735f 7370 6329 290a 2020 2020 2020 2020  s_spc)).        
-00004720: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
-00004730: 7445 7175 616c 2863 6f6e 7465 6e74 735f  tEqual(contents_
-00004740: 7370 632c 2066 7328 636f 6e74 656e 7473  spc, fs(contents
-00004750: 5f74 6162 2929 0a0a 2020 2020 2020 2020  _tab))..        
-00004760: 636f 6e74 656e 7473 5f74 6162 203d 2022  contents_tab = "
-00004770: 6966 2031 3a5c 6e20 2020 2020 2020 2069  if 1:\n        i
-00004780: 6620 323a 5c6e 5c74 5c74 7061 7373 5c6e  f 2:\n\t\tpass\n
-00004790: 5c74 5c74 2320 636f 6d6d 656e 745c 6e20  \t\t# comment\n 
-000047a0: 2020 2020 2020 2070 6173 735c 6e22 0a20         pass\n". 
-000047b0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
-000047c0: 7370 6320 3d20 2269 6620 313a 5c6e 2020  spc = "if 1:\n  
-000047d0: 2020 6966 2032 3a5c 6e20 2020 2020 2020    if 2:\n       
-000047e0: 2070 6173 735c 6e20 2020 2020 2020 2023   pass\n        #
-000047f0: 2063 6f6d 6d65 6e74 5c6e 2020 2020 7061   comment\n    pa
-00004800: 7373 5c6e 220a 2020 2020 2020 2020 7365  ss\n".        se
-00004810: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
-00004820: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
-00004830: 632c 2066 7328 636f 6e74 656e 7473 5f73  c, fs(contents_s
-00004840: 7063 2929 0a20 2020 2020 2020 2073 656c  pc)).        sel
-00004850: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-00004860: 7561 6c28 636f 6e74 656e 7473 5f73 7063  ual(contents_spc
-00004870: 2c20 6673 2863 6f6e 7465 6e74 735f 7461  , fs(contents_ta
-00004880: 6229 290a 0a20 2020 2064 6566 2074 6573  b))..    def tes
-00004890: 745f 6661 6c73 655f 706f 7369 7469 7665  t_false_positive
-000048a0: 5f73 796d 6c69 6e6b 5f6f 7574 7075 745f  _symlink_output_
-000048b0: 6973 7375 655f 3333 3834 2873 656c 6629  issue_3384(self)
-000048c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000048d0: 2020 2320 456d 756c 6174 6520 7468 6520    # Emulate the 
-000048e0: 6265 6861 7669 6f72 2077 6865 6e20 7573  behavior when us
-000048f0: 696e 6720 7468 6520 434c 4920 2860 626c  ing the CLI (`bl
-00004900: 6163 6b20 2e2f 6368 696c 6420 202d 2d76  ack ./child  --v
-00004910: 6572 626f 7365 6029 2c20 7768 6963 680a  erbose`), which.
-00004920: 2020 2020 2020 2020 2320 696e 766f 6c76          # involv
-00004930: 6573 2070 6174 6368 696e 6720 736f 6d65  es patching some
-00004940: 2060 7061 7468 6c69 622e 5061 7468 6020   `pathlib.Path` 
-00004950: 6d65 7468 6f64 732e 2049 6e20 7061 7274  methods. In part
-00004960: 6963 756c 6172 2c20 6069 735f 6469 7260  icular, `is_dir`
-00004970: 2069 730a 2020 2020 2020 2020 2320 7061   is.        # pa
-00004980: 7463 6865 6420 6f6e 6c79 206f 6e20 6974  tched only on it
-00004990: 7320 6669 7273 7420 6361 6c6c 3a20 7768  s first call: wh
-000049a0: 656e 2063 6865 636b 696e 6720 6966 2022  en checking if "
-000049b0: 2e2f 6368 696c 6422 2069 7320 6120 6469  ./child" is a di
-000049c0: 7265 6374 6f72 7920 6974 0a20 2020 2020  rectory it.     
-000049d0: 2020 2023 2073 686f 756c 6420 7265 7475     # should retu
-000049e0: 726e 2054 7275 652e 2054 6865 2022 2e2f  rn True. The "./
-000049f0: 6368 696c 6422 2066 6f6c 6465 7220 6578  child" folder ex
-00004a00: 6973 7473 2072 656c 6174 6976 6520 746f  ists relative to
-00004a10: 2074 6865 2063 7764 2077 6865 6e0a 2020   the cwd when.  
-00004a20: 2020 2020 2020 2320 7275 6e6e 696e 6720        # running 
-00004a30: 6672 6f6d 2043 4c49 2c20 6275 7420 6661  from CLI, but fa
-00004a40: 696c 7320 7768 656e 2072 756e 6e69 6e67  ils when running
-00004a50: 2074 6865 2074 6573 7473 2062 6563 6175   the tests becau
-00004a60: 7365 2063 7764 2069 7320 6469 6666 6572  se cwd is differ
-00004a70: 656e 740a 2020 2020 2020 2020 7072 6f6a  ent.        proj
-00004a80: 6563 745f 726f 6f74 203d 2050 6174 6828  ect_root = Path(
-00004a90: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
-00004aa0: 2220 2f20 226e 6573 7465 645f 6769 7469  " / "nested_giti
-00004ab0: 676e 6f72 655f 7465 7374 7322 290a 2020  gnore_tests").  
-00004ac0: 2020 2020 2020 776f 726b 696e 675f 6469        working_di
-00004ad0: 7265 6374 6f72 7920 3d20 7072 6f6a 6563  rectory = projec
-00004ae0: 745f 726f 6f74 202f 2022 726f 6f74 220a  t_root / "root".
-00004af0: 2020 2020 2020 2020 7461 7267 6574 5f61          target_a
-00004b00: 6273 7061 7468 203d 2077 6f72 6b69 6e67  bspath = working
-00004b10: 5f64 6972 6563 746f 7279 202f 2022 6368  _directory / "ch
-00004b20: 696c 6422 0a20 2020 2020 2020 2074 6172  ild".        tar
-00004b30: 6765 745f 636f 6e74 656e 7473 203d 2028  get_contents = (
-00004b40: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00004b50: 2e72 656c 6174 6976 655f 746f 2877 6f72  .relative_to(wor
-00004b60: 6b69 6e67 5f64 6972 6563 746f 7279 2920  king_directory) 
-00004b70: 666f 7220 7372 6320 696e 2074 6172 6765  for src in targe
-00004b80: 745f 6162 7370 6174 682e 6974 6572 6469  t_abspath.iterdi
-00004b90: 7228 290a 2020 2020 2020 2020 290a 0a20  r().        ).. 
-00004ba0: 2020 2020 2020 2064 6566 206d 6f63 6b5f         def mock_
-00004bb0: 6e5f 6361 6c6c 7328 7265 7370 6f6e 7365  n_calls(response
-00004bc0: 733a 204c 6973 745b 626f 6f6c 5d29 202d  s: List[bool]) -
-00004bd0: 3e20 4361 6c6c 6162 6c65 5b5b 5d2c 2062  > Callable[[], b
-00004be0: 6f6f 6c5d 3a0a 2020 2020 2020 2020 2020  ool]:.          
-00004bf0: 2020 6465 6620 5f6d 6f63 6b65 645f 6361    def _mocked_ca
-00004c00: 6c6c 7328 2920 2d3e 2062 6f6f 6c3a 0a20  lls() -> bool:. 
-00004c10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004c20: 6620 7265 7370 6f6e 7365 733a 0a20 2020  f responses:.   
-00004c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c40: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
-00004c50: 732e 706f 7028 3029 0a20 2020 2020 2020  s.pop(0).       
-00004c60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004c70: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
-00004c80: 2020 2072 6574 7572 6e20 5f6d 6f63 6b65     return _mocke
-00004c90: 645f 6361 6c6c 730a 0a20 2020 2020 2020  d_calls..       
-00004ca0: 2077 6974 6820 7061 7463 6828 2270 6174   with patch("pat
-00004cb0: 686c 6962 2e50 6174 682e 6974 6572 6469  hlib.Path.iterdi
-00004cc0: 7222 2c20 7265 7475 726e 5f76 616c 7565  r", return_value
-00004cd0: 3d74 6172 6765 745f 636f 6e74 656e 7473  =target_contents
-00004ce0: 292c 2070 6174 6368 280a 2020 2020 2020  ), patch(.      
-00004cf0: 2020 2020 2020 2270 6174 686c 6962 2e50        "pathlib.P
-00004d00: 6174 682e 6377 6422 2c20 7265 7475 726e  ath.cwd", return
-00004d10: 5f76 616c 7565 3d77 6f72 6b69 6e67 5f64  _value=working_d
-00004d20: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
-00004d30: 2029 2c20 7061 7463 6828 2270 6174 686c   ), patch("pathl
-00004d40: 6962 2e50 6174 682e 6973 5f64 6972 222c  ib.Path.is_dir",
-00004d50: 2073 6964 655f 6566 6665 6374 3d6d 6f63   side_effect=moc
-00004d60: 6b5f 6e5f 6361 6c6c 7328 5b54 7275 655d  k_n_calls([True]
-00004d70: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00004d80: 6374 7820 3d20 4661 6b65 436f 6e74 6578  ctx = FakeContex
-00004d90: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00004da0: 6374 782e 6f62 6a5b 2272 6f6f 7422 5d20  ctx.obj["root"] 
-00004db0: 3d20 7072 6f6a 6563 745f 726f 6f74 0a20  = project_root. 
-00004dc0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00004dd0: 7420 3d20 4d61 6769 634d 6f63 6b28 7665  t = MagicMock(ve
-00004de0: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
-00004df0: 2020 2020 2020 2020 626c 6163 6b2e 6765          black.ge
-00004e00: 745f 736f 7572 6365 7328 0a20 2020 2020  t_sources(.     
-00004e10: 2020 2020 2020 2020 2020 2063 7478 3d63             ctx=c
-00004e20: 7478 2c0a 2020 2020 2020 2020 2020 2020  tx,.            
-00004e30: 2020 2020 7372 633d 2822 2e2f 6368 696c      src=("./chil
-00004e40: 6422 2c29 2c0a 2020 2020 2020 2020 2020  d",),.          
-00004e50: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
-00004e60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00004e70: 2020 2076 6572 626f 7365 3d54 7275 652c     verbose=True,
-00004e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004e90: 2069 6e63 6c75 6465 3d44 4546 4155 4c54   include=DEFAULT
-00004ea0: 5f49 4e43 4c55 4445 2c0a 2020 2020 2020  _INCLUDE,.      
-00004eb0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00004ec0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00004ed0: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
-00004ee0: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
-00004ef0: 2020 2020 2020 2065 7874 656e 645f 6578         extend_ex
-00004f00: 636c 7564 653d 4e6f 6e65 2c0a 2020 2020  clude=None,.    
-00004f10: 2020 2020 2020 2020 2020 2020 666f 7263              forc
-00004f20: 655f 6578 636c 7564 653d 4e6f 6e65 2c0a  e_exclude=None,.
-00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f40: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d4e  stdin_filename=N
-00004f50: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00004f60: 2029 0a20 2020 2020 2020 2061 7373 6572   ).        asser
-00004f70: 7420 6e6f 7420 616e 7928 0a20 2020 2020  t not any(.     
-00004f80: 2020 2020 2020 206d 6f63 6b5f 6172 6773         mock_args
-00004f90: 5b31 5d2e 7374 6172 7473 7769 7468 2822  [1].startswith("
-00004fa0: 6973 2061 2073 796d 626f 6c69 6320 6c69  is a symbolic li
-00004fb0: 6e6b 2074 6861 7420 706f 696e 7473 206f  nk that points o
-00004fc0: 7574 7369 6465 2229 0a20 2020 2020 2020  utside").       
-00004fd0: 2020 2020 2066 6f72 205f 2c20 6d6f 636b       for _, mock
-00004fe0: 5f61 7267 732c 205f 2069 6e20 7265 706f  _args, _ in repo
-00004ff0: 7274 2e70 6174 685f 6967 6e6f 7265 642e  rt.path_ignored.
-00005000: 6d6f 636b 5f63 616c 6c73 0a20 2020 2020  mock_calls.     
-00005010: 2020 2029 2c20 2241 2073 796d 626f 6c69     ), "A symboli
-00005020: 6320 6c69 6e6b 2077 6173 2072 6570 6f72  c link was repor
-00005030: 7465 642e 220a 2020 2020 2020 2020 7265  ted.".        re
-00005040: 706f 7274 2e70 6174 685f 6967 6e6f 7265  port.path_ignore
-00005050: 642e 6173 7365 7274 5f63 616c 6c65 645f  d.assert_called_
-00005060: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
-00005070: 2020 2020 2020 2050 6174 6828 2263 6869         Path("chi
-00005080: 6c64 222c 2022 622e 7079 2229 2c20 226d  ld", "b.py"), "m
-00005090: 6174 6368 6573 2061 202e 6769 7469 676e  atches a .gitign
-000050a0: 6f72 6520 6669 6c65 2063 6f6e 7465 6e74  ore file content
-000050b0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-000050c0: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
-000050d0: 5f76 6572 626f 7365 2873 656c 6629 202d  _verbose(self) -
-000050e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000050f0: 7265 706f 7274 203d 2052 6570 6f72 7428  report = Report(
-00005100: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
-00005110: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
-00005120: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
-00005130: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
-00005140: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
-00005150: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-00005160: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-00005170: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
-00005180: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-00005190: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
-000051a0: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
-000051b0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-000051c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000051d0: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
-000051e0: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
-000051f0: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
-00005200: 2e6f 7574 7075 742e 5f6f 7574 222c 206f  .output._out", o
-00005210: 7574 292c 2070 6174 6368 2822 626c 6163  ut), patch("blac
-00005220: 6b2e 6f75 7470 7574 2e5f 6572 7222 2c20  k.output._err", 
-00005230: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
-00005240: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
-00005250: 7468 2822 6631 2229 2c20 626c 6163 6b2e  th("f1"), black.
-00005260: 4368 616e 6765 642e 4e4f 290a 2020 2020  Changed.NO).    
-00005270: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005280: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00005290: 5f6c 696e 6573 292c 2031 290a 2020 2020  _lines), 1).    
-000052a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000052b0: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-000052c0: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-000052d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000052e0: 6572 7445 7175 616c 286f 7574 5f6c 696e  ertEqual(out_lin
-000052f0: 6573 5b2d 315d 2c20 2266 3120 616c 7265  es[-1], "f1 alre
-00005300: 6164 7920 7765 6c6c 2066 6f72 6d61 7474  ady well formatt
-00005310: 6564 2c20 676f 6f64 206a 6f62 2e22 290a  ed, good job.").
-00005320: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005330: 2e61 7373 6572 7445 7175 616c 2875 6e73  .assertEqual(uns
-00005340: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00005350: 292c 2022 3120 6669 6c65 206c 6566 7420  ), "1 file left 
-00005360: 756e 6368 616e 6765 642e 2229 0a20 2020  unchanged.").   
-00005370: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00005380: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00005390: 2e72 6574 7572 6e5f 636f 6465 2c20 3029  .return_code, 0)
-000053a0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-000053b0: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-000053c0: 3222 292c 2062 6c61 636b 2e43 6861 6e67  2"), black.Chang
-000053d0: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
-000053e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000053f0: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005400: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00005410: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005420: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00005430: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00005440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005450: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
-00005460: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
-00005470: 2066 3222 290a 2020 2020 2020 2020 2020   f2").          
-00005480: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005490: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-000054a0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-000054b0: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
-000054c0: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
-000054d0: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
-000054e0: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
-000054f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00005500: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
-00005510: 6828 2266 3322 292c 2062 6c61 636b 2e43  h("f3"), black.C
-00005520: 6861 6e67 6564 2e43 4143 4845 4429 0a20  hanged.CACHED). 
-00005530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005540: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00005550: 6f75 745f 6c69 6e65 7329 2c20 3329 0a20  out_lines), 3). 
-00005560: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005570: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00005580: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
-00005590: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000055a0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-000055b0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-000055c0: 5f6c 696e 6573 5b2d 315d 2c20 2266 3320  _lines[-1], "f3 
-000055d0: 7761 736e 2774 206d 6f64 6966 6965 6420  wasn't modified 
-000055e0: 6f6e 2064 6973 6b20 7369 6e63 6520 6c61  on disk since la
-000055f0: 7374 2072 756e 2e22 0a20 2020 2020 2020  st run.".       
-00005600: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00005610: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005620: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00005630: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00005640: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
-00005650: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
-00005660: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
-00005670: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
-00005680: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000009d0: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+000009e0: 662e 7061 7261 6d73 3a20 4469 6374 5b73  f.params: Dict[s
+000009f0: 7472 2c20 416e 795d 203d 207b 7d0a 2020  tr, Any] = {}.  
+00000a00: 2020 2020 2020 2320 4475 6d6d 7920 726f        # Dummy ro
+00000a10: 6f74 2c20 7369 6e63 6520 6d6f 7374 206f  ot, since most o
+00000a20: 6620 7468 6520 7465 7374 7320 646f 6e27  f the tests don'
+00000a30: 7420 6361 7265 2061 626f 7574 2069 740a  t care about it.
+00000a40: 2020 2020 2020 2020 7365 6c66 2e6f 626a          self.obj
+00000a50: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
+00000a60: 203d 207b 2272 6f6f 7422 3a20 5052 4f4a   = {"root": PROJ
+00000a70: 4543 545f 524f 4f54 7d0a 0a0a 636c 6173  ECT_ROOT}...clas
+00000a80: 7320 4661 6b65 5061 7261 6d65 7465 7228  s FakeParameter(
+00000a90: 636c 6963 6b2e 5061 7261 6d65 7465 7229  click.Parameter)
+00000aa0: 3a0a 2020 2020 2222 2241 2066 616b 6520  :.    """A fake 
+00000ab0: 636c 6963 6b20 5061 7261 6d65 7465 7220  click Parameter 
+00000ac0: 666f 7220 7768 656e 2063 616c 6c69 6e67  for when calling
+00000ad0: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
+00000ae0: 6e65 6564 2069 742e 2222 220a 0a20 2020  need it."""..   
+00000af0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00000b00: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00000b10: 2020 2020 2070 6173 730a 0a0a 636c 6173       pass...clas
+00000b20: 7320 426c 6163 6b52 756e 6e65 7228 436c  s BlackRunner(Cl
+00000b30: 6952 756e 6e65 7229 3a0a 2020 2020 2222  iRunner):.    ""
+00000b40: 224d 616b 6520 7375 7265 2053 5444 4f55  "Make sure STDOU
+00000b50: 5420 616e 6420 5354 4445 5252 2061 7265  T and STDERR are
+00000b60: 206b 6570 7420 7365 7061 7261 7465 2077   kept separate w
+00000b70: 6865 6e20 7465 7374 696e 6720 426c 6163  hen testing Blac
+00000b80: 6b20 7669 6120 6974 7320 434c 492e 2222  k via its CLI.""
+00000b90: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00000ba0: 745f 5f28 7365 6c66 2920 2d3e 204e 6f6e  t__(self) -> Non
+00000bb0: 653a 0a20 2020 2020 2020 2073 7570 6572  e:.        super
+00000bc0: 2829 2e5f 5f69 6e69 745f 5f28 6d69 785f  ().__init__(mix_
+00000bd0: 7374 6465 7272 3d46 616c 7365 290a 0a0a  stderr=False)...
+00000be0: 6465 6620 696e 766f 6b65 426c 6163 6b28  def invokeBlack(
+00000bf0: 0a20 2020 2061 7267 733a 204c 6973 745b  .    args: List[
+00000c00: 7374 725d 2c20 6578 6974 5f63 6f64 653a  str], exit_code:
+00000c10: 2069 6e74 203d 2030 2c20 6967 6e6f 7265   int = 0, ignore
+00000c20: 5f63 6f6e 6669 673a 2062 6f6f 6c20 3d20  _config: bool = 
+00000c30: 5472 7565 0a29 202d 3e20 4e6f 6e65 3a0a  True.) -> None:.
+00000c40: 2020 2020 7275 6e6e 6572 203d 2042 6c61      runner = Bla
+00000c50: 636b 5275 6e6e 6572 2829 0a20 2020 2069  ckRunner().    i
+00000c60: 6620 6967 6e6f 7265 5f63 6f6e 6669 673a  f ignore_config:
+00000c70: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
+00000c80: 5b22 2d2d 7665 7262 6f73 6522 2c20 222d  ["--verbose", "-
+00000c90: 2d63 6f6e 6669 6722 2c20 7374 7228 5448  -config", str(TH
+00000ca0: 4953 5f44 4952 202f 2022 656d 7074 792e  IS_DIR / "empty.
+00000cb0: 746f 6d6c 2229 2c20 2a61 7267 735d 0a20  toml"), *args]. 
+00000cc0: 2020 2072 6573 756c 7420 3d20 7275 6e6e     result = runn
+00000cd0: 6572 2e69 6e76 6f6b 6528 626c 6163 6b2e  er.invoke(black.
+00000ce0: 6d61 696e 2c20 6172 6773 2c20 6361 7463  main, args, catc
+00000cf0: 685f 6578 6365 7074 696f 6e73 3d46 616c  h_exceptions=Fal
+00000d00: 7365 290a 2020 2020 6173 7365 7274 2072  se).    assert r
+00000d10: 6573 756c 742e 7374 646f 7574 5f62 7974  esult.stdout_byt
+00000d20: 6573 2069 7320 6e6f 7420 4e6f 6e65 0a20  es is not None. 
+00000d30: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
+00000d40: 2e73 7464 6572 725f 6279 7465 7320 6973  .stderr_bytes is
+00000d50: 206e 6f74 204e 6f6e 650a 2020 2020 6d73   not None.    ms
+00000d60: 6720 3d20 280a 2020 2020 2020 2020 6622  g = (.        f"
+00000d70: 4661 696c 6564 2077 6974 6820 6172 6773  Failed with args
+00000d80: 3a20 7b61 7267 737d 5c6e 220a 2020 2020  : {args}\n".    
+00000d90: 2020 2020 6622 7374 646f 7574 3a20 7b72      f"stdout: {r
+00000da0: 6573 756c 742e 7374 646f 7574 5f62 7974  esult.stdout_byt
+00000db0: 6573 2e64 6563 6f64 6528 2921 727d 5c6e  es.decode()!r}\n
+00000dc0: 220a 2020 2020 2020 2020 6622 7374 6465  ".        f"stde
+00000dd0: 7272 3a20 7b72 6573 756c 742e 7374 6465  rr: {result.stde
+00000de0: 7272 5f62 7974 6573 2e64 6563 6f64 6528  rr_bytes.decode(
+00000df0: 2921 727d 5c6e 220a 2020 2020 2020 2020  )!r}\n".        
+00000e00: 6622 6578 6365 7074 696f 6e3a 207b 7265  f"exception: {re
+00000e10: 7375 6c74 2e65 7863 6570 7469 6f6e 7d22  sult.exception}"
+00000e20: 0a20 2020 2029 0a20 2020 2061 7373 6572  .    ).    asser
+00000e30: 7420 7265 7375 6c74 2e65 7869 745f 636f  t result.exit_co
+00000e40: 6465 203d 3d20 6578 6974 5f63 6f64 652c  de == exit_code,
+00000e50: 206d 7367 0a0a 0a63 6c61 7373 2042 6c61   msg...class Bla
+00000e60: 636b 5465 7374 4361 7365 2842 6c61 636b  ckTestCase(Black
+00000e70: 4261 7365 5465 7374 4361 7365 293a 0a20  BaseTestCase):. 
+00000e80: 2020 2069 6e76 6f6b 6542 6c61 636b 203d     invokeBlack =
+00000e90: 2073 7461 7469 636d 6574 686f 6428 696e   staticmethod(in
+00000ea0: 766f 6b65 426c 6163 6b29 0a0a 2020 2020  vokeBlack)..    
+00000eb0: 6465 6620 7465 7374 5f65 6d70 7479 5f66  def test_empty_f
+00000ec0: 6628 7365 6c66 2920 2d3e 204e 6f6e 653a  f(self) -> None:
+00000ed0: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00000ee0: 6420 3d20 2222 0a20 2020 2020 2020 2074  d = "".        t
+00000ef0: 6d70 5f66 696c 6520 3d20 5061 7468 2862  mp_file = Path(b
+00000f00: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
+00000f10: 6528 2929 0a20 2020 2020 2020 2074 7279  e()).        try
+00000f20: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00000f30: 6c66 2e61 7373 6572 7446 616c 7365 2866  lf.assertFalse(f
+00000f40: 6628 746d 705f 6669 6c65 2c20 7772 6974  f(tmp_file, writ
+00000f50: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
+00000f60: 7465 4261 636b 2e59 4553 2929 0a20 2020  teBack.YES)).   
+00000f70: 2020 2020 2020 2020 2061 6374 7561 6c20           actual 
+00000f80: 3d20 746d 705f 6669 6c65 2e72 6561 645f  = tmp_file.read_
+00000f90: 7465 7874 2865 6e63 6f64 696e 673d 2275  text(encoding="u
+00000fa0: 7466 2d38 2229 0a20 2020 2020 2020 2066  tf-8").        f
+00000fb0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
+00000fc0: 2020 2020 6f73 2e75 6e6c 696e 6b28 746d      os.unlink(tm
+00000fd0: 705f 6669 6c65 290a 2020 2020 2020 2020  p_file).        
+00000fe0: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
+00000ff0: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
+00001000: 2061 6374 7561 6c29 0a0a 2020 2020 4070   actual)..    @p
+00001010: 6174 6368 2822 626c 6163 6b2e 6475 6d70  atch("black.dump
+00001020: 5f74 6f5f 6669 6c65 222c 2064 756d 705f  _to_file", dump_
+00001030: 746f 5f73 7464 6572 7229 0a20 2020 2064  to_stderr).    d
+00001040: 6566 2074 6573 745f 6f6e 655f 656d 7074  ef test_one_empt
+00001050: 795f 6c69 6e65 2873 656c 6629 202d 3e20  y_line(self) -> 
+00001060: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+00001070: 6465 203d 2062 6c61 636b 2e4d 6f64 6528  de = black.Mode(
+00001080: 7072 6576 6965 773d 5472 7565 290a 2020  preview=True).  
+00001090: 2020 2020 2020 666f 7220 6e6c 2069 6e20        for nl in 
+000010a0: 5b22 5c6e 222c 2022 5c72 5c6e 225d 3a0a  ["\n", "\r\n"]:.
+000010b0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+000010c0: 6365 203d 2065 7870 6563 7465 6420 3d20  ce = expected = 
+000010d0: 6e6c 0a20 2020 2020 2020 2020 2020 2061  nl.            a
+000010e0: 7373 6572 745f 666f 726d 6174 2873 6f75  ssert_format(sou
+000010f0: 7263 652c 2065 7870 6563 7465 642c 206d  rce, expected, m
+00001100: 6f64 653d 6d6f 6465 290a 0a20 2020 2064  ode=mode)..    d
+00001110: 6566 2074 6573 745f 6f6e 655f 656d 7074  ef test_one_empt
+00001120: 795f 6c69 6e65 5f66 6628 7365 6c66 2920  y_line_ff(self) 
+00001130: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00001140: 206d 6f64 6520 3d20 626c 6163 6b2e 4d6f   mode = black.Mo
+00001150: 6465 2870 7265 7669 6577 3d54 7275 6529  de(preview=True)
+00001160: 0a20 2020 2020 2020 2066 6f72 206e 6c20  .        for nl 
+00001170: 696e 205b 225c 6e22 2c20 225c 725c 6e22  in ["\n", "\r\n"
+00001180: 5d3a 0a20 2020 2020 2020 2020 2020 2065  ]:.            e
+00001190: 7870 6563 7465 6420 3d20 6e6c 0a20 2020  xpected = nl.   
+000011a0: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
+000011b0: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
+000011c0: 756d 705f 746f 5f66 696c 6528 6e6c 2929  ump_to_file(nl))
+000011d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000011e0: 7379 7374 656d 2829 203d 3d20 2257 696e  system() == "Win
+000011f0: 646f 7773 223a 0a20 2020 2020 2020 2020  dows":.         
+00001200: 2020 2020 2020 2023 2057 7269 7469 6e67         # Writing
+00001210: 2066 696c 6573 2069 6e20 7465 7874 206d   files in text m
+00001220: 6f64 6520 6175 746f 6d61 7469 6361 6c6c  ode automaticall
+00001230: 7920 7573 6573 2074 6865 2073 7973 7465  y uses the syste
+00001240: 6d20 6e65 776c 696e 652c 0a20 2020 2020  m newline,.     
+00001250: 2020 2020 2020 2020 2020 2023 2062 7574             # but
+00001260: 2069 6e20 7468 6973 2063 6173 6520 7765   in this case we
+00001270: 2064 6f6e 2774 2077 616e 7420 7468 6973   don't want this
+00001280: 2066 6f72 2074 6573 7469 6e67 2072 6561   for testing rea
+00001290: 736f 6e73 2e20 5365 653a 0a20 2020 2020  sons. See:.     
+000012a0: 2020 2020 2020 2020 2020 2023 2068 7474             # htt
+000012b0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+000012c0: 7073 662f 626c 6163 6b2f 7075 6c6c 2f33  psf/black/pull/3
+000012d0: 3334 380a 2020 2020 2020 2020 2020 2020  348.            
+000012e0: 2020 2020 7769 7468 206f 7065 6e28 746d      with open(tm
+000012f0: 705f 6669 6c65 2c20 2277 6222 2920 6173  p_file, "wb") as
+00001300: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00001310: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00001320: 6e6c 2e65 6e63 6f64 6528 2275 7466 2d38  nl.encode("utf-8
+00001330: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+00001340: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00001350: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001360: 4661 6c73 6528 0a20 2020 2020 2020 2020  False(.         
+00001370: 2020 2020 2020 2020 2020 2066 6628 746d             ff(tm
+00001380: 705f 6669 6c65 2c20 6d6f 6465 3d6d 6f64  p_file, mode=mod
+00001390: 652c 2077 7269 7465 5f62 6163 6b3d 626c  e, write_back=bl
+000013a0: 6163 6b2e 5772 6974 6542 6163 6b2e 5945  ack.WriteBack.YE
+000013b0: 5329 0a20 2020 2020 2020 2020 2020 2020  S).             
+000013c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000013d0: 2020 2020 2077 6974 6820 6f70 656e 2874       with open(t
+000013e0: 6d70 5f66 696c 652c 2022 7262 2229 2061  mp_file, "rb") a
+000013f0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+00001400: 2020 2020 2020 2020 2061 6374 7561 6c20           actual 
+00001410: 3d20 662e 7265 6164 2829 2e64 6563 6f64  = f.read().decod
+00001420: 6528 2275 7466 2d38 2229 0a20 2020 2020  e("utf-8").     
+00001430: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
+00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001450: 6f73 2e75 6e6c 696e 6b28 746d 705f 6669  os.unlink(tmp_fi
+00001460: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+00001470: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
+00001480: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
+00001490: 2061 6374 7561 6c29 0a0a 2020 2020 6465   actual)..    de
+000014a0: 6620 7465 7374 5f65 7870 6572 696d 656e  f test_experimen
+000014b0: 7461 6c5f 7374 7269 6e67 5f70 726f 6365  tal_string_proce
+000014c0: 7373 696e 675f 7761 726e 7328 7365 6c66  ssing_warns(self
+000014d0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000014e0: 2020 2073 656c 662e 6173 7365 7274 5761     self.assertWa
+000014f0: 726e 7328 0a20 2020 2020 2020 2020 2020  rns(.           
+00001500: 2062 6c61 636b 2e6d 6f64 652e 4465 7072   black.mode.Depr
+00001510: 6563 6174 6564 2c20 626c 6163 6b2e 4d6f  ecated, black.Mo
+00001520: 6465 2c20 6578 7065 7269 6d65 6e74 616c  de, experimental
+00001530: 5f73 7472 696e 675f 7072 6f63 6573 7369  _string_processi
+00001540: 6e67 3d54 7275 650a 2020 2020 2020 2020  ng=True.        
+00001550: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00001560: 7069 7069 6e67 2873 656c 6629 202d 3e20  piping(self) -> 
+00001570: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+00001580: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
+00001590: 2072 6561 645f 6461 7461 5f66 726f 6d5f   read_data_from_
+000015a0: 6669 6c65 2850 524f 4a45 4354 5f52 4f4f  file(PROJECT_ROO
+000015b0: 5420 2f20 2273 7263 2f62 6c61 636b 2f5f  T / "src/black/_
+000015c0: 5f69 6e69 745f 5f2e 7079 2229 0a20 2020  _init__.py").   
+000015d0: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
+000015e0: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
+000015f0: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+00001600: 626c 6163 6b2e 6d61 696e 2c0a 2020 2020  black.main,.    
+00001610: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+00001620: 2020 2020 2020 2020 2020 222d 222c 0a20            "-",. 
+00001630: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00001640: 2d2d 6661 7374 222c 0a20 2020 2020 2020  --fast",.       
+00001650: 2020 2020 2020 2020 2066 222d 2d6c 696e           f"--lin
+00001660: 652d 6c65 6e67 7468 3d7b 626c 6163 6b2e  e-length={black.
+00001670: 4445 4641 554c 545f 4c49 4e45 5f4c 454e  DEFAULT_LINE_LEN
+00001680: 4754 487d 222c 0a20 2020 2020 2020 2020  GTH}",.         
+00001690: 2020 2020 2020 2066 222d 2d63 6f6e 6669         f"--confi
+000016a0: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
+000016b0: 222c 0a20 2020 2020 2020 2020 2020 205d  ",.            ]
+000016c0: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+000016d0: 7075 743d 4279 7465 7349 4f28 736f 7572  put=BytesIO(sour
+000016e0: 6365 2e65 6e63 6f64 6528 2275 7466 2d38  ce.encode("utf-8
+000016f0: 2229 292c 0a20 2020 2020 2020 2029 0a20  ")),.        ). 
+00001700: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00001710: 7274 4571 7561 6c28 7265 7375 6c74 2e65  rtEqual(result.e
+00001720: 7869 745f 636f 6465 2c20 3029 0a20 2020  xit_code, 0).   
+00001730: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001740: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
+00001750: 6374 6564 2c20 7265 7375 6c74 2e6f 7574  cted, result.out
+00001760: 7075 7429 0a20 2020 2020 2020 2069 6620  put).        if 
+00001770: 736f 7572 6365 2021 3d20 7265 7375 6c74  source != result
+00001780: 2e6f 7574 7075 743a 0a20 2020 2020 2020  .output:.       
+00001790: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+000017a0: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
+000017b0: 7263 652c 2072 6573 756c 742e 6f75 7470  rce, result.outp
+000017c0: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
+000017d0: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
+000017e0: 626c 6528 736f 7572 6365 2c20 7265 7375  ble(source, resu
+000017f0: 6c74 2e6f 7574 7075 742c 2044 4546 4155  lt.output, DEFAU
+00001800: 4c54 5f4d 4f44 4529 0a0a 2020 2020 6465  LT_MODE)..    de
+00001810: 6620 7465 7374 5f70 6970 696e 675f 6469  f test_piping_di
+00001820: 6666 2873 656c 6629 202d 3e20 4e6f 6e65  ff(self) -> None
+00001830: 3a0a 2020 2020 2020 2020 6469 6666 5f68  :.        diff_h
+00001840: 6561 6465 7220 3d20 7265 2e63 6f6d 7069  eader = re.compi
+00001850: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00001860: 7222 2853 5444 494e 7c53 5444 4f55 5429  r"(STDIN|STDOUT)
+00001870: 5c74 5c64 5c64 5c64 5c64 2d5c 645c 642d  \t\d\d\d\d-\d\d-
+00001880: 5c64 5c64 205c 645c 643a 5c64 5c64 3a5c  \d\d \d\d:\d\d:\
+00001890: 645c 645c 2e5c 645c 645c 645c 645c 645c  d\d\.\d\d\d\d\d\
+000018a0: 6422 0a20 2020 2020 2020 2020 2020 2072  d".            r
+000018b0: 225c 2b5c 645c 643a 5c64 5c64 220a 2020  "\+\d\d:\d\d".  
+000018c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000018d0: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+000018e0: 5f64 6174 6128 2273 696d 706c 655f 6361  _data("simple_ca
+000018f0: 7365 7322 2c20 2265 7870 7265 7373 696f  ses", "expressio
+00001900: 6e2e 7079 2229 0a20 2020 2020 2020 2065  n.py").        e
+00001910: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
+00001920: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
+00001930: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
+00001940: 6f6e 2e64 6966 6622 290a 2020 2020 2020  on.diff").      
+00001950: 2020 6172 6773 203d 205b 0a20 2020 2020    args = [.     
+00001960: 2020 2020 2020 2022 2d22 2c0a 2020 2020         "-",.    
+00001970: 2020 2020 2020 2020 222d 2d66 6173 7422          "--fast"
+00001980: 2c0a 2020 2020 2020 2020 2020 2020 6622  ,.            f"
+00001990: 2d2d 6c69 6e65 2d6c 656e 6774 683d 7b62  --line-length={b
+000019a0: 6c61 636b 2e44 4546 4155 4c54 5f4c 494e  lack.DEFAULT_LIN
+000019b0: 455f 4c45 4e47 5448 7d22 2c0a 2020 2020  E_LENGTH}",.    
+000019c0: 2020 2020 2020 2020 222d 2d64 6966 6622          "--diff"
+000019d0: 2c0a 2020 2020 2020 2020 2020 2020 6622  ,.            f"
+000019e0: 2d2d 636f 6e66 6967 3d7b 454d 5054 595f  --config={EMPTY_
+000019f0: 434f 4e46 4947 7d22 2c0a 2020 2020 2020  CONFIG}",.      
+00001a00: 2020 5d0a 2020 2020 2020 2020 7265 7375    ].        resu
+00001a10: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
+00001a20: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
+00001a30: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
+00001a40: 6e2c 2061 7267 732c 2069 6e70 7574 3d42  n, args, input=B
+00001a50: 7974 6573 494f 2873 6f75 7263 652e 656e  ytesIO(source.en
+00001a60: 636f 6465 2822 7574 662d 3822 2929 0a20  code("utf-8")). 
+00001a70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001a80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00001a90: 6c28 7265 7375 6c74 2e65 7869 745f 636f  l(result.exit_co
+00001aa0: 6465 2c20 3029 0a20 2020 2020 2020 2061  de, 0).        a
+00001ab0: 6374 7561 6c20 3d20 6469 6666 5f68 6561  ctual = diff_hea
+00001ac0: 6465 722e 7375 6228 4445 5445 524d 494e  der.sub(DETERMIN
+00001ad0: 4953 5449 435f 4845 4144 4552 2c20 7265  ISTIC_HEADER, re
+00001ae0: 7375 6c74 2e6f 7574 7075 7429 0a20 2020  sult.output).   
+00001af0: 2020 2020 2061 6374 7561 6c20 3d20 6163       actual = ac
+00001b00: 7475 616c 2e72 7374 7269 7028 2920 2b20  tual.rstrip() + 
+00001b10: 225c 6e22 2020 2320 7468 6520 6469 6666  "\n"  # the diff
+00001b20: 206f 7574 7075 7420 6861 7320 6120 7472   output has a tr
+00001b30: 6169 6c69 6e67 2073 7061 6365 0a20 2020  ailing space.   
+00001b40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001b50: 4571 7561 6c28 6578 7065 6374 6564 2c20  Equal(expected, 
+00001b60: 6163 7475 616c 290a 0a20 2020 2064 6566  actual)..    def
+00001b70: 2074 6573 745f 7069 7069 6e67 5f64 6966   test_piping_dif
+00001b80: 665f 7769 7468 5f63 6f6c 6f72 2873 656c  f_with_color(sel
+00001b90: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00001ba0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+00001bb0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
+00001bc0: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
+00001bd0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
+00001be0: 2020 2061 7267 7320 3d20 5b0a 2020 2020     args = [.    
+00001bf0: 2020 2020 2020 2020 222d 222c 0a20 2020          "-",.   
+00001c00: 2020 2020 2020 2020 2022 2d2d 6661 7374           "--fast
+00001c10: 222c 0a20 2020 2020 2020 2020 2020 2066  ",.            f
+00001c20: 222d 2d6c 696e 652d 6c65 6e67 7468 3d7b  "--line-length={
+00001c30: 626c 6163 6b2e 4445 4641 554c 545f 4c49  black.DEFAULT_LI
+00001c40: 4e45 5f4c 454e 4754 487d 222c 0a20 2020  NE_LENGTH}",.   
+00001c50: 2020 2020 2020 2020 2022 2d2d 6469 6666           "--diff
+00001c60: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00001c70: 2d2d 636f 6c6f 7222 2c0a 2020 2020 2020  --color",.      
+00001c80: 2020 2020 2020 6622 2d2d 636f 6e66 6967        f"--config
+00001c90: 3d7b 454d 5054 595f 434f 4e46 4947 7d22  ={EMPTY_CONFIG}"
+00001ca0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
+00001cb0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
+00001cc0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
+00001cd0: 6528 0a20 2020 2020 2020 2020 2020 2062  e(.            b
+00001ce0: 6c61 636b 2e6d 6169 6e2c 2061 7267 732c  lack.main, args,
+00001cf0: 2069 6e70 7574 3d42 7974 6573 494f 2873   input=BytesIO(s
+00001d00: 6f75 7263 652e 656e 636f 6465 2822 7574  ource.encode("ut
+00001d10: 662d 3822 2929 0a20 2020 2020 2020 2029  f-8")).        )
+00001d20: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
+00001d30: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
+00001d40: 2020 2020 2020 2020 2320 4167 6169 6e2c          # Again,
+00001d50: 2074 6865 2063 6f6e 7465 6e74 7320 6172   the contents ar
+00001d60: 6520 6368 6563 6b65 6420 696e 2061 2064  e checked in a d
+00001d70: 6966 6665 7265 6e74 2074 6573 742c 2073  ifferent test, s
+00001d80: 6f20 6f6e 6c79 206c 6f6f 6b20 666f 7220  o only look for 
+00001d90: 636f 6c6f 7273 2e0a 2020 2020 2020 2020  colors..        
+00001da0: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
+00001db0: 3033 335b 316d 222c 2061 6374 7561 6c29  033[1m", actual)
+00001dc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001dd0: 7365 7274 496e 2822 5c30 3333 5b33 366d  sertIn("\033[36m
+00001de0: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
+00001df0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00001e00: 2822 5c30 3333 5b33 326d 222c 2061 6374  ("\033[32m", act
+00001e10: 7561 6c29 0a20 2020 2020 2020 2073 656c  ual).        sel
+00001e20: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
+00001e30: 5b33 316d 222c 2061 6374 7561 6c29 0a20  [31m", actual). 
+00001e40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00001e50: 7274 496e 2822 5c30 3333 5b30 6d22 2c20  rtIn("\033[0m", 
+00001e60: 6163 7475 616c 290a 0a20 2020 2040 7061  actual)..    @pa
+00001e70: 7463 6828 2262 6c61 636b 2e64 756d 705f  tch("black.dump_
+00001e80: 746f 5f66 696c 6522 2c20 6475 6d70 5f74  to_file", dump_t
+00001e90: 6f5f 7374 6465 7272 290a 2020 2020 6465  o_stderr).    de
+00001ea0: 6620 5f74 6573 745f 7769 7028 7365 6c66  f _test_wip(self
+00001eb0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00001ec0: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
+00001ed0: 7465 6420 3d20 7265 6164 5f64 6174 6128  ted = read_data(
+00001ee0: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
+00001ef0: 2022 7769 7022 290a 2020 2020 2020 2020   "wip").        
+00001f00: 7379 732e 7365 7474 7261 6365 2874 7261  sys.settrace(tra
+00001f10: 6365 6675 6e63 290a 2020 2020 2020 2020  cefunc).        
+00001f20: 6d6f 6465 203d 2072 6570 6c61 6365 280a  mode = replace(.
+00001f30: 2020 2020 2020 2020 2020 2020 4445 4641              DEFA
+00001f40: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
+00001f50: 2020 2020 2020 6578 7065 7269 6d65 6e74        experiment
+00001f60: 616c 5f73 7472 696e 675f 7072 6f63 6573  al_string_proces
+00001f70: 7369 6e67 3d46 616c 7365 2c0a 2020 2020  sing=False,.    
+00001f80: 2020 2020 2020 2020 7461 7267 6574 5f76          target_v
+00001f90: 6572 7369 6f6e 733d 7b62 6c61 636b 2e54  ersions={black.T
+00001fa0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00001fb0: 387d 2c0a 2020 2020 2020 2020 290a 2020  8},.        ).  
+00001fc0: 2020 2020 2020 6163 7475 616c 203d 2066        actual = f
+00001fd0: 7328 736f 7572 6365 2c20 6d6f 6465 3d6d  s(source, mode=m
+00001fe0: 6f64 6529 0a20 2020 2020 2020 2073 7973  ode).        sys
+00001ff0: 2e73 6574 7472 6163 6528 4e6f 6e65 290a  .settrace(None).
+00002000: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00002010: 6572 7446 6f72 6d61 7445 7175 616c 2865  ertFormatEqual(e
+00002020: 7870 6563 7465 642c 2061 6374 7561 6c29  xpected, actual)
+00002030: 0a20 2020 2020 2020 2062 6c61 636b 2e61  .        black.a
+00002040: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00002050: 2873 6f75 7263 652c 2061 6374 7561 6c29  (source, actual)
+00002060: 0a20 2020 2020 2020 2062 6c61 636b 2e61  .        black.a
+00002070: 7373 6572 745f 7374 6162 6c65 2873 6f75  ssert_stable(sou
+00002080: 7263 652c 2061 6374 7561 6c2c 2062 6c61  rce, actual, bla
+00002090: 636b 2e46 696c 654d 6f64 6528 2929 0a0a  ck.FileMode())..
+000020a0: 2020 2020 6465 6620 7465 7374 5f70 6570      def test_pep
+000020b0: 5f35 3732 5f76 6572 7369 6f6e 5f64 6574  _572_version_det
+000020c0: 6563 7469 6f6e 2873 656c 6629 202d 3e20  ection(self) -> 
+000020d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+000020e0: 7572 6365 2c20 5f20 3d20 7265 6164 5f64  urce, _ = read_d
+000020f0: 6174 6128 2270 795f 3338 222c 2022 7065  ata("py_38", "pe
+00002100: 705f 3537 3222 290a 2020 2020 2020 2020  p_572").        
+00002110: 726f 6f74 203d 2062 6c61 636b 2e6c 6962  root = black.lib
+00002120: 3274 6f33 5f70 6172 7365 2873 6f75 7263  2to3_parse(sourc
+00002130: 6529 0a20 2020 2020 2020 2066 6561 7475  e).        featu
+00002140: 7265 7320 3d20 626c 6163 6b2e 6765 745f  res = black.get_
+00002150: 6665 6174 7572 6573 5f75 7365 6428 726f  features_used(ro
+00002160: 6f74 290a 2020 2020 2020 2020 7365 6c66  ot).        self
+00002170: 2e61 7373 6572 7449 6e28 626c 6163 6b2e  .assertIn(black.
+00002180: 4665 6174 7572 652e 4153 5349 474e 4d45  Feature.ASSIGNME
+00002190: 4e54 5f45 5850 5245 5353 494f 4e53 2c20  NT_EXPRESSIONS, 
+000021a0: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
+000021b0: 2020 7665 7273 696f 6e73 203d 2062 6c61    versions = bla
+000021c0: 636b 2e64 6574 6563 745f 7461 7267 6574  ck.detect_target
+000021d0: 5f76 6572 7369 6f6e 7328 726f 6f74 290a  _versions(root).
+000021e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000021f0: 6572 7449 6e28 626c 6163 6b2e 5461 7267  ertIn(black.Targ
+00002200: 6574 5665 7273 696f 6e2e 5059 3338 2c20  etVersion.PY38, 
+00002210: 7665 7273 696f 6e73 290a 0a20 2020 2064  versions)..    d
+00002220: 6566 2074 6573 745f 7065 705f 3639 355f  ef test_pep_695_
+00002230: 7665 7273 696f 6e5f 6465 7465 6374 696f  version_detectio
+00002240: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+00002250: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
+00002260: 6520 696e 2028 2274 7970 655f 616c 6961  e in ("type_alia
+00002270: 7365 7322 2c20 2274 7970 655f 7061 7261  ses", "type_para
+00002280: 6d73 2229 3a0a 2020 2020 2020 2020 2020  ms"):.          
+00002290: 2020 736f 7572 6365 2c20 5f20 3d20 7265    source, _ = re
+000022a0: 6164 5f64 6174 6128 2270 795f 3331 3222  ad_data("py_312"
+000022b0: 2c20 6669 6c65 290a 2020 2020 2020 2020  , file).        
+000022c0: 2020 2020 726f 6f74 203d 2062 6c61 636b      root = black
+000022d0: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
+000022e0: 6f75 7263 6529 0a20 2020 2020 2020 2020  ource).         
+000022f0: 2020 2066 6561 7475 7265 7320 3d20 626c     features = bl
+00002300: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
+00002310: 5f75 7365 6428 726f 6f74 290a 2020 2020  _used(root).    
+00002320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00002330: 6572 7449 6e28 626c 6163 6b2e 4665 6174  ertIn(black.Feat
+00002340: 7572 652e 5459 5045 5f50 4152 414d 532c  ure.TYPE_PARAMS,
+00002350: 2066 6561 7475 7265 7329 0a20 2020 2020   features).     
+00002360: 2020 2020 2020 2076 6572 7369 6f6e 7320         versions 
+00002370: 3d20 626c 6163 6b2e 6465 7465 6374 5f74  = black.detect_t
+00002380: 6172 6765 745f 7665 7273 696f 6e73 2872  arget_versions(r
+00002390: 6f6f 7429 0a20 2020 2020 2020 2020 2020  oot).           
+000023a0: 2073 656c 662e 6173 7365 7274 496e 2862   self.assertIn(b
+000023b0: 6c61 636b 2e54 6172 6765 7456 6572 7369  lack.TargetVersi
+000023c0: 6f6e 2e50 5933 3132 2c20 7665 7273 696f  on.PY312, versio
+000023d0: 6e73 290a 0a20 2020 2064 6566 2074 6573  ns)..    def tes
+000023e0: 745f 6578 7072 6573 7369 6f6e 5f66 6628  t_expression_ff(
+000023f0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00002400: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+00002410: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+00002420: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
+00002430: 7322 2c20 2265 7870 7265 7373 696f 6e2e  s", "expression.
+00002440: 7079 2229 0a20 2020 2020 2020 2074 6d70  py").        tmp
+00002450: 5f66 696c 6520 3d20 5061 7468 2862 6c61  _file = Path(bla
+00002460: 636b 2e64 756d 705f 746f 5f66 696c 6528  ck.dump_to_file(
+00002470: 736f 7572 6365 2929 0a20 2020 2020 2020  source)).       
+00002480: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00002490: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+000024a0: 6528 6666 2874 6d70 5f66 696c 652c 2077  e(ff(tmp_file, w
+000024b0: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+000024c0: 5772 6974 6542 6163 6b2e 5945 5329 290a  WriteBack.YES)).
+000024d0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+000024e0: 616c 203d 2074 6d70 5f66 696c 652e 7265  al = tmp_file.re
+000024f0: 6164 5f74 6578 7428 656e 636f 6469 6e67  ad_text(encoding
+00002500: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
+00002510: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
+00002520: 2020 2020 2020 206f 732e 756e 6c69 6e6b         os.unlink
+00002530: 2874 6d70 5f66 696c 6529 0a20 2020 2020  (tmp_file).     
+00002540: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+00002550: 726d 6174 4571 7561 6c28 6578 7065 6374  rmatEqual(expect
+00002560: 6564 2c20 6163 7475 616c 290a 2020 2020  ed, actual).    
+00002570: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+00002580: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00002590: 6c65 222c 2064 756d 705f 746f 5f73 7464  le", dump_to_std
+000025a0: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
+000025b0: 2020 626c 6163 6b2e 6173 7365 7274 5f65    black.assert_e
+000025c0: 7175 6976 616c 656e 7428 736f 7572 6365  quivalent(source
+000025d0: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+000025e0: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
+000025f0: 7274 5f73 7461 626c 6528 736f 7572 6365  rt_stable(source
+00002600: 2c20 6163 7475 616c 2c20 4445 4641 554c  , actual, DEFAUL
+00002610: 545f 4d4f 4445 290a 0a20 2020 2064 6566  T_MODE)..    def
+00002620: 2074 6573 745f 6578 7072 6573 7369 6f6e   test_expression
+00002630: 5f64 6966 6628 7365 6c66 2920 2d3e 204e  _diff(self) -> N
+00002640: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+00002650: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
+00002660: 7461 2822 7369 6d70 6c65 5f63 6173 6573  ta("simple_cases
+00002670: 222c 2022 6578 7072 6573 7369 6f6e 2e70  ", "expression.p
+00002680: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
+00002690: 6374 6564 2c20 5f20 3d20 7265 6164 5f64  cted, _ = read_d
+000026a0: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
+000026b0: 7322 2c20 2265 7870 7265 7373 696f 6e2e  s", "expression.
+000026c0: 6469 6666 2229 0a20 2020 2020 2020 2074  diff").        t
+000026d0: 6d70 5f66 696c 6520 3d20 5061 7468 2862  mp_file = Path(b
+000026e0: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
+000026f0: 6528 736f 7572 6365 2929 0a20 2020 2020  e(source)).     
+00002700: 2020 2064 6966 665f 6865 6164 6572 203d     diff_header =
+00002710: 2072 652e 636f 6d70 696c 6528 0a20 2020   re.compile(.   
+00002720: 2020 2020 2020 2020 2072 6622 7b72 652e           rf"{re.
+00002730: 6573 6361 7065 2873 7472 2874 6d70 5f66  escape(str(tmp_f
+00002740: 696c 6529 297d 5c74 5c64 5c64 5c64 5c64  ile))}\t\d\d\d\d
+00002750: 2d5c 645c 642d 5c64 5c64 2022 0a20 2020  -\d\d-\d\d ".   
+00002760: 2020 2020 2020 2020 2072 225c 645c 643a           r"\d\d:
+00002770: 5c64 5c64 3a5c 645c 645c 2e5c 645c 645c  \d\d:\d\d\.\d\d\
+00002780: 645c 645c 645c 645c 2b5c 645c 643a 5c64  d\d\d\d\+\d\d:\d
+00002790: 5c64 220a 2020 2020 2020 2020 290a 2020  \d".        ).  
+000027a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000027b0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000027c0: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
+000027d0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
+000027e0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
+000027f0: 2c20 5b22 2d2d 6469 6666 222c 2073 7472  , ["--diff", str
+00002800: 2874 6d70 5f66 696c 6529 2c20 6622 2d2d  (tmp_file), f"--
+00002810: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
+00002820: 4e46 4947 7d22 5d0a 2020 2020 2020 2020  NFIG}"].        
+00002830: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00002840: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00002850: 616c 2872 6573 756c 742e 6578 6974 5f63  al(result.exit_c
+00002860: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
+00002870: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+00002880: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
+00002890: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
+000028a0: 2061 6374 7561 6c20 3d20 7265 7375 6c74   actual = result
+000028b0: 2e6f 7574 7075 740a 2020 2020 2020 2020  .output.        
+000028c0: 6163 7475 616c 203d 2064 6966 665f 6865  actual = diff_he
+000028d0: 6164 6572 2e73 7562 2844 4554 4552 4d49  ader.sub(DETERMI
+000028e0: 4e49 5354 4943 5f48 4541 4445 522c 2061  NISTIC_HEADER, a
+000028f0: 6374 7561 6c29 0a20 2020 2020 2020 2069  ctual).        i
+00002900: 6620 6578 7065 6374 6564 2021 3d20 6163  f expected != ac
+00002910: 7475 616c 3a0a 2020 2020 2020 2020 2020  tual:.          
+00002920: 2020 6475 6d70 203d 2062 6c61 636b 2e64    dump = black.d
+00002930: 756d 705f 746f 5f66 696c 6528 6163 7475  ump_to_file(actu
+00002940: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00002950: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
+00002960: 2020 2020 2020 2020 2245 7870 6563 7465          "Expecte
+00002970: 6420 6469 6666 2069 736e 2774 2065 7175  d diff isn't equ
+00002980: 616c 2074 6f20 7468 6520 6163 7475 616c  al to the actual
+00002990: 2e20 4966 2079 6f75 206d 6164 6520 6368  . If you made ch
+000029a0: 616e 6765 7320 746f 220a 2020 2020 2020  anges to".      
+000029b0: 2020 2020 2020 2020 2020 2220 6578 7072            " expr
+000029c0: 6573 7369 6f6e 2e70 7920 616e 6420 7468  ession.py and th
+000029d0: 6973 2069 7320 616e 2061 6e74 6963 6970  is is an anticip
+000029e0: 6174 6564 2064 6966 6665 7265 6e63 652c  ated difference,
+000029f0: 206f 7665 7277 7269 7465 220a 2020 2020   overwrite".    
+00002a00: 2020 2020 2020 2020 2020 2020 6622 2074              f" t
+00002a10: 6573 7473 2f64 6174 612f 6578 7072 6573  ests/data/expres
+00002a20: 7369 6f6e 2e64 6966 6620 7769 7468 207b  sion.diff with {
+00002a30: 6475 6d70 7d22 0a20 2020 2020 2020 2020  dump}".         
+00002a40: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00002a50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00002a60: 6c28 6578 7065 6374 6564 2c20 6163 7475  l(expected, actu
+00002a70: 616c 2c20 6d73 6729 0a0a 2020 2020 6465  al, msg)..    de
+00002a80: 6620 7465 7374 5f65 7870 7265 7373 696f  f test_expressio
+00002a90: 6e5f 6469 6666 5f77 6974 685f 636f 6c6f  n_diff_with_colo
+00002aa0: 7228 7365 6c66 2920 2d3e 204e 6f6e 653a  r(self) -> None:
+00002ab0: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
+00002ac0: 205f 203d 2072 6561 645f 6461 7461 2822   _ = read_data("
+00002ad0: 7369 6d70 6c65 5f63 6173 6573 222c 2022  simple_cases", "
+00002ae0: 6578 7072 6573 7369 6f6e 2e70 7922 290a  expression.py").
+00002af0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00002b00: 2c20 5f20 3d20 7265 6164 5f64 6174 6128  , _ = read_data(
+00002b10: 2273 696d 706c 655f 6361 7365 7322 2c20  "simple_cases", 
+00002b20: 2265 7870 7265 7373 696f 6e2e 6469 6666  "expression.diff
+00002b30: 2229 0a20 2020 2020 2020 2074 6d70 5f66  ").        tmp_f
+00002b40: 696c 6520 3d20 5061 7468 2862 6c61 636b  ile = Path(black
+00002b50: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
+00002b60: 7572 6365 2929 0a20 2020 2020 2020 2074  urce)).        t
+00002b70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00002b80: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
+00002b90: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
+00002ba0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00002bb0: 6c61 636b 2e6d 6169 6e2c 0a20 2020 2020  lack.main,.     
+00002bc0: 2020 2020 2020 2020 2020 205b 222d 2d64             ["--d
+00002bd0: 6966 6622 2c20 222d 2d63 6f6c 6f72 222c  iff", "--color",
+00002be0: 2073 7472 2874 6d70 5f66 696c 6529 2c20   str(tmp_file), 
+00002bf0: 6622 2d2d 636f 6e66 6967 3d7b 454d 5054  f"--config={EMPT
+00002c00: 595f 434f 4e46 4947 7d22 5d2c 0a20 2020  Y_CONFIG}"],.   
+00002c10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00002c20: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+00002c30: 2020 2020 2020 2020 6f73 2e75 6e6c 696e          os.unlin
+00002c40: 6b28 746d 705f 6669 6c65 290a 2020 2020  k(tmp_file).    
+00002c50: 2020 2020 6163 7475 616c 203d 2072 6573      actual = res
+00002c60: 756c 742e 6f75 7470 7574 0a20 2020 2020  ult.output.     
+00002c70: 2020 2023 2057 6520 6368 6563 6b20 7468     # We check th
+00002c80: 6520 636f 6e74 656e 7473 206f 6620 7468  e contents of th
+00002c90: 6520 6469 6666 2069 6e20 6074 6573 745f  e diff in `test_
+00002ca0: 6578 7072 6573 7369 6f6e 5f64 6966 6660  expression_diff`
+00002cb0: 2e20 416c 6c0a 2020 2020 2020 2020 2320  . All.        # 
+00002cc0: 7765 206e 6565 6420 746f 2063 6865 636b  we need to check
+00002cd0: 2068 6572 6520 6973 2074 6861 7420 636f   here is that co
+00002ce0: 6c6f 7220 636f 6465 7320 6578 6973 7420  lor codes exist 
+00002cf0: 696e 2074 6865 2072 6573 756c 742e 0a20  in the result.. 
+00002d00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002d10: 7274 496e 2822 5c30 3333 5b31 6d22 2c20  rtIn("\033[1m", 
+00002d20: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00002d30: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
+00002d40: 3033 335b 3336 6d22 2c20 6163 7475 616c  033[36m", actual
+00002d50: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002d60: 7373 6572 7449 6e28 225c 3033 335b 3332  ssertIn("\033[32
+00002d70: 6d22 2c20 6163 7475 616c 290a 2020 2020  m", actual).    
+00002d80: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00002d90: 6e28 225c 3033 335b 3331 6d22 2c20 6163  n("\033[31m", ac
+00002da0: 7475 616c 290a 2020 2020 2020 2020 7365  tual).        se
+00002db0: 6c66 2e61 7373 6572 7449 6e28 225c 3033  lf.assertIn("\03
+00002dc0: 335b 306d 222c 2061 6374 7561 6c29 0a0a  3[0m", actual)..
+00002dd0: 2020 2020 6465 6620 7465 7374 5f64 6574      def test_det
+00002de0: 6563 745f 706f 735f 6f6e 6c79 5f61 7267  ect_pos_only_arg
+00002df0: 756d 656e 7473 2873 656c 6629 202d 3e20  uments(self) -> 
+00002e00: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+00002e10: 7572 6365 2c20 5f20 3d20 7265 6164 5f64  urce, _ = read_d
+00002e20: 6174 6128 2270 795f 3338 222c 2022 7065  ata("py_38", "pe
+00002e30: 705f 3537 3022 290a 2020 2020 2020 2020  p_570").        
+00002e40: 726f 6f74 203d 2062 6c61 636b 2e6c 6962  root = black.lib
+00002e50: 3274 6f33 5f70 6172 7365 2873 6f75 7263  2to3_parse(sourc
+00002e60: 6529 0a20 2020 2020 2020 2066 6561 7475  e).        featu
+00002e70: 7265 7320 3d20 626c 6163 6b2e 6765 745f  res = black.get_
+00002e80: 6665 6174 7572 6573 5f75 7365 6428 726f  features_used(ro
+00002e90: 6f74 290a 2020 2020 2020 2020 7365 6c66  ot).        self
+00002ea0: 2e61 7373 6572 7449 6e28 626c 6163 6b2e  .assertIn(black.
+00002eb0: 4665 6174 7572 652e 504f 535f 4f4e 4c59  Feature.POS_ONLY
+00002ec0: 5f41 5247 554d 454e 5453 2c20 6665 6174  _ARGUMENTS, feat
+00002ed0: 7572 6573 290a 2020 2020 2020 2020 7665  ures).        ve
+00002ee0: 7273 696f 6e73 203d 2062 6c61 636b 2e64  rsions = black.d
+00002ef0: 6574 6563 745f 7461 7267 6574 5f76 6572  etect_target_ver
+00002f00: 7369 6f6e 7328 726f 6f74 290a 2020 2020  sions(root).    
+00002f10: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00002f20: 6e28 626c 6163 6b2e 5461 7267 6574 5665  n(black.TargetVe
+00002f30: 7273 696f 6e2e 5059 3338 2c20 7665 7273  rsion.PY38, vers
+00002f40: 696f 6e73 290a 0a20 2020 2064 6566 2074  ions)..    def t
+00002f50: 6573 745f 6465 7465 6374 5f64 6562 7567  est_detect_debug
+00002f60: 5f66 5f73 7472 696e 6773 2873 656c 6629  _f_strings(self)
+00002f70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00002f80: 2020 726f 6f74 203d 2062 6c61 636b 2e6c    root = black.l
+00002f90: 6962 3274 6f33 5f70 6172 7365 2822 2222  ib2to3_parse("""
+00002fa0: 6622 7b78 3d7d 2220 2222 2229 0a20 2020  f"{x=}" """).   
+00002fb0: 2020 2020 2066 6561 7475 7265 7320 3d20       features = 
+00002fc0: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00002fd0: 6573 5f75 7365 6428 726f 6f74 290a 2020  es_used(root).  
+00002fe0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00002ff0: 7449 6e28 626c 6163 6b2e 4665 6174 7572  tIn(black.Featur
+00003000: 652e 4445 4255 475f 465f 5354 5249 4e47  e.DEBUG_F_STRING
+00003010: 532c 2066 6561 7475 7265 7329 0a20 2020  S, features).   
+00003020: 2020 2020 2076 6572 7369 6f6e 7320 3d20       versions = 
+00003030: 626c 6163 6b2e 6465 7465 6374 5f74 6172  black.detect_tar
+00003040: 6765 745f 7665 7273 696f 6e73 2872 6f6f  get_versions(roo
+00003050: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+00003060: 6173 7365 7274 496e 2862 6c61 636b 2e54  assertIn(black.T
+00003070: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00003080: 382c 2076 6572 7369 6f6e 7329 0a0a 2020  8, versions)..  
+00003090: 2020 2020 2020 726f 6f74 203d 2062 6c61        root = bla
+000030a0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+000030b0: 280a 2020 2020 2020 2020 2020 2020 2222  (.            ""
+000030c0: 2266 227b 787d 225c 6e66 277b 223d 227d  "f"{x}"\nf'{"="}
+000030d0: 275c 6e66 277b 2878 3a3d 3529 7d27 5c6e  '\nf'{(x:=5)}'\n
+000030e0: 6627 7b66 2861 3d22 333d 2229 7d27 5c6e  f'{f(a="3=")}'\n
+000030f0: 6627 7b78 3a3d 3130 7d27 5c6e 2222 220a  f'{x:=10}'\n""".
+00003100: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003110: 2020 6665 6174 7572 6573 203d 2062 6c61    features = bla
+00003120: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
+00003130: 7573 6564 2872 6f6f 7429 0a20 2020 2020  used(root).     
+00003140: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+00003150: 7449 6e28 626c 6163 6b2e 4665 6174 7572  tIn(black.Featur
+00003160: 652e 4445 4255 475f 465f 5354 5249 4e47  e.DEBUG_F_STRING
+00003170: 532c 2066 6561 7475 7265 7329 0a0a 2020  S, features)..  
+00003180: 2020 2020 2020 2320 5765 2064 6f6e 2774        # We don't
+00003190: 2079 6574 2073 7570 706f 7274 2066 6561   yet support fea
+000031a0: 7475 7265 2076 6572 7369 6f6e 2064 6574  ture version det
+000031b0: 6563 7469 6f6e 2069 6e20 6e65 7374 6564  ection in nested
+000031c0: 2066 2d73 7472 696e 6773 0a20 2020 2020   f-strings.     
+000031d0: 2020 2072 6f6f 7420 3d20 626c 6163 6b2e     root = black.
+000031e0: 6c69 6232 746f 335f 7061 7273 6528 0a20  lib2to3_parse(. 
+000031f0: 2020 2020 2020 2020 2020 2022 2222 6622             """f"
+00003200: 6865 6172 6420 6120 7275 6d6f 7572 2074  heard a rumour t
+00003210: 6861 7420 7b20 6627 7b31 2b31 3d7d 2720  hat { f'{1+1=}' 
+00003220: 7d20 2e2e 2e20 7365 656d 7320 6c69 6b65  } ... seems like
+00003230: 2069 7420 636f 756c 6420 6265 2074 7275   it could be tru
+00003240: 6522 2022 2222 0a20 2020 2020 2020 2029  e" """.        )
+00003250: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+00003260: 7320 3d20 626c 6163 6b2e 6765 745f 6665  s = black.get_fe
+00003270: 6174 7572 6573 5f75 7365 6428 726f 6f74  atures_used(root
+00003280: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00003290: 7373 6572 744e 6f74 496e 2862 6c61 636b  ssertNotIn(black
+000032a0: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
+000032b0: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
+000032c0: 6573 290a 0a20 2020 2040 7061 7463 6828  es)..    @patch(
+000032d0: 2262 6c61 636b 2e64 756d 705f 746f 5f66  "black.dump_to_f
+000032e0: 696c 6522 2c20 6475 6d70 5f74 6f5f 7374  ile", dump_to_st
+000032f0: 6465 7272 290a 2020 2020 6465 6620 7465  derr).    def te
+00003300: 7374 5f73 7472 696e 675f 7175 6f74 6573  st_string_quotes
+00003310: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00003320: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+00003330: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
+00003340: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+00003350: 6f75 7322 2c20 2273 7472 696e 675f 7175  ous", "string_qu
+00003360: 6f74 6573 2229 0a20 2020 2020 2020 206d  otes").        m
+00003370: 6f64 6520 3d20 626c 6163 6b2e 4d6f 6465  ode = black.Mode
+00003380: 2870 7265 7669 6577 3d54 7275 6529 0a20  (preview=True). 
+00003390: 2020 2020 2020 2061 7373 6572 745f 666f         assert_fo
+000033a0: 726d 6174 2873 6f75 7263 652c 2065 7870  rmat(source, exp
+000033b0: 6563 7465 642c 206d 6f64 6529 0a20 2020  ected, mode).   
+000033c0: 2020 2020 206d 6f64 6520 3d20 7265 706c       mode = repl
+000033d0: 6163 6528 6d6f 6465 2c20 7374 7269 6e67  ace(mode, string
+000033e0: 5f6e 6f72 6d61 6c69 7a61 7469 6f6e 3d46  _normalization=F
+000033f0: 616c 7365 290a 2020 2020 2020 2020 6e6f  alse).        no
+00003400: 745f 6e6f 726d 616c 697a 6564 203d 2066  t_normalized = f
+00003410: 7328 736f 7572 6365 2c20 6d6f 6465 3d6d  s(source, mode=m
+00003420: 6f64 6529 0a20 2020 2020 2020 2073 656c  ode).        sel
+00003430: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
+00003440: 7561 6c28 736f 7572 6365 2e72 6570 6c61  ual(source.repla
+00003450: 6365 2822 5c5c 5c6e 222c 2022 2229 2c20  ce("\\\n", ""), 
+00003460: 6e6f 745f 6e6f 726d 616c 697a 6564 290a  not_normalized).
+00003470: 2020 2020 2020 2020 626c 6163 6b2e 6173          black.as
+00003480: 7365 7274 5f65 7175 6976 616c 656e 7428  sert_equivalent(
+00003490: 736f 7572 6365 2c20 6e6f 745f 6e6f 726d  source, not_norm
+000034a0: 616c 697a 6564 290a 2020 2020 2020 2020  alized).        
+000034b0: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
+000034c0: 626c 6528 736f 7572 6365 2c20 6e6f 745f  ble(source, not_
+000034d0: 6e6f 726d 616c 697a 6564 2c20 6d6f 6465  normalized, mode
+000034e0: 3d6d 6f64 6529 0a0a 2020 2020 6465 6620  =mode)..    def 
+000034f0: 7465 7374 5f73 6b69 705f 736f 7572 6365  test_skip_source
+00003500: 5f66 6972 7374 5f6c 696e 6528 7365 6c66  _first_line(self
+00003510: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00003520: 2020 2073 6f75 7263 652c 205f 203d 2072     source, _ = r
+00003530: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+00003540: 6c61 6e65 6f75 7322 2c20 2269 6e76 616c  laneous", "inval
+00003550: 6964 5f68 6561 6465 7222 290a 2020 2020  id_header").    
+00003560: 2020 2020 746d 705f 6669 6c65 203d 2050      tmp_file = P
+00003570: 6174 6828 626c 6163 6b2e 6475 6d70 5f74  ath(black.dump_t
+00003580: 6f5f 6669 6c65 2873 6f75 7263 6529 290a  o_file(source)).
+00003590: 2020 2020 2020 2020 2320 4675 6c6c 2073          # Full s
+000035a0: 6f75 7263 6520 7368 6f75 6c64 2066 6169  ource should fai
+000035b0: 6c20 2869 6e76 616c 6964 2073 796e 7461  l (invalid synta
+000035c0: 7820 6174 2068 6561 6465 7229 0a20 2020  x at header).   
+000035d0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+000035e0: 426c 6163 6b28 5b73 7472 2874 6d70 5f66  Black([str(tmp_f
+000035f0: 696c 6529 2c20 222d 2d64 6966 6622 2c20  ile), "--diff", 
+00003600: 222d 2d63 6865 636b 225d 2c20 6578 6974  "--check"], exit
+00003610: 5f63 6f64 653d 3132 3329 0a20 2020 2020  _code=123).     
+00003620: 2020 2023 2053 6f2c 2073 6b69 7070 696e     # So, skippin
+00003630: 6720 7468 6520 6669 7273 7420 6c69 6e65  g the first line
+00003640: 2073 686f 756c 6420 776f 726b 0a20 2020   should work.   
+00003650: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
+00003660: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
+00003670: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+00003680: 626c 6163 6b2e 6d61 696e 2c20 5b73 7472  black.main, [str
+00003690: 2874 6d70 5f66 696c 6529 2c20 222d 7822  (tmp_file), "-x"
+000036a0: 2c20 6622 2d2d 636f 6e66 6967 3d7b 454d  , f"--config={EM
+000036b0: 5054 595f 434f 4e46 4947 7d22 5d0a 2020  PTY_CONFIG}"].  
+000036c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000036d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000036e0: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
+000036f0: 652c 2030 290a 2020 2020 2020 2020 6163  e, 0).        ac
+00003700: 7475 616c 203d 2074 6d70 5f66 696c 652e  tual = tmp_file.
+00003710: 7265 6164 5f74 6578 7428 656e 636f 6469  read_text(encodi
+00003720: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
+00003730: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00003740: 6f72 6d61 7445 7175 616c 2873 6f75 7263  ormatEqual(sourc
+00003750: 652c 2061 6374 7561 6c29 0a0a 2020 2020  e, actual)..    
+00003760: 6465 6620 7465 7374 5f73 6b69 705f 736f  def test_skip_so
+00003770: 7572 6365 5f66 6972 7374 5f6c 696e 655f  urce_first_line_
+00003780: 7768 656e 5f6d 6978 696e 675f 6e65 776c  when_mixing_newl
+00003790: 696e 6573 2873 656c 6629 202d 3e20 4e6f  ines(self) -> No
+000037a0: 6e65 3a0a 2020 2020 2020 2020 636f 6465  ne:.        code
+000037b0: 5f6d 6978 696e 675f 6e65 776c 696e 6573  _mixing_newlines
+000037c0: 203d 2062 2248 6561 6465 7220 7769 6c6c   = b"Header will
+000037d0: 2062 6520 736b 6970 7065 645c 725c 6e69   be skipped\r\ni
+000037e0: 203d 205b 312c 322c 335d 5c6e 6a20 3d20   = [1,2,3]\nj = 
+000037f0: 5b31 2c32 2c33 5d5c 6e22 0a20 2020 2020  [1,2,3]\n".     
+00003800: 2020 2065 7870 6563 7465 6420 3d20 6222     expected = b"
+00003810: 4865 6164 6572 2077 696c 6c20 6265 2073  Header will be s
+00003820: 6b69 7070 6564 5c72 5c6e 6920 3d20 5b31  kipped\r\ni = [1
+00003830: 2c20 322c 2033 5d5c 6e6a 203d 205b 312c  , 2, 3]\nj = [1,
+00003840: 2032 2c20 335d 5c6e 220a 2020 2020 2020   2, 3]\n".      
+00003850: 2020 7769 7468 2054 656d 706f 7261 7279    with Temporary
+00003860: 4469 7265 6374 6f72 7928 2920 6173 2077  Directory() as w
+00003870: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+00003880: 2020 2020 2020 7465 7374 5f66 696c 6520        test_file 
+00003890: 3d20 5061 7468 2877 6f72 6b73 7061 6365  = Path(workspace
+000038a0: 2920 2f20 2273 6b69 705f 6865 6164 6572  ) / "skip_header
+000038b0: 2e70 7922 0a20 2020 2020 2020 2020 2020  .py".           
+000038c0: 2074 6573 745f 6669 6c65 2e77 7269 7465   test_file.write
+000038d0: 5f62 7974 6573 2863 6f64 655f 6d69 7869  _bytes(code_mixi
+000038e0: 6e67 5f6e 6577 6c69 6e65 7329 0a20 2020  ng_newlines).   
+000038f0: 2020 2020 2020 2020 206d 6f64 6520 3d20           mode = 
+00003900: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
+00003910: 4d4f 4445 2c20 736b 6970 5f73 6f75 7263  MODE, skip_sourc
+00003920: 655f 6669 7273 745f 6c69 6e65 3d54 7275  e_first_line=Tru
+00003930: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
+00003940: 6628 7465 7374 5f66 696c 652c 206d 6f64  f(test_file, mod
+00003950: 653d 6d6f 6465 2c20 7772 6974 655f 6261  e=mode, write_ba
+00003960: 636b 3d62 6c61 636b 2e57 7269 7465 4261  ck=black.WriteBa
+00003970: 636b 2e59 4553 290a 2020 2020 2020 2020  ck.YES).        
+00003980: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00003990: 7175 616c 2874 6573 745f 6669 6c65 2e72  qual(test_file.r
+000039a0: 6561 645f 6279 7465 7328 292c 2065 7870  ead_bytes(), exp
+000039b0: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+000039c0: 7465 7374 5f73 6b69 705f 6d61 6769 635f  test_skip_magic_
+000039d0: 7472 6169 6c69 6e67 5f63 6f6d 6d61 2873  trailing_comma(s
+000039e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+000039f0: 2020 2020 2020 736f 7572 6365 2c20 5f20        source, _ 
+00003a00: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
+00003a10: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
+00003a20: 7265 7373 696f 6e22 290a 2020 2020 2020  ression").      
+00003a30: 2020 6578 7065 6374 6564 2c20 5f20 3d20    expected, _ = 
+00003a40: 7265 6164 5f64 6174 6128 0a20 2020 2020  read_data(.     
+00003a50: 2020 2020 2020 2022 6d69 7363 656c 6c61         "miscella
+00003a60: 6e65 6f75 7322 2c20 2265 7870 7265 7373  neous", "express
+00003a70: 696f 6e5f 736b 6970 5f6d 6167 6963 5f74  ion_skip_magic_t
+00003a80: 7261 696c 696e 675f 636f 6d6d 612e 6469  railing_comma.di
+00003a90: 6666 220a 2020 2020 2020 2020 290a 2020  ff".        ).  
+00003aa0: 2020 2020 2020 746d 705f 6669 6c65 203d        tmp_file =
+00003ab0: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
+00003ac0: 5f74 6f5f 6669 6c65 2873 6f75 7263 6529  _to_file(source)
+00003ad0: 290a 2020 2020 2020 2020 6469 6666 5f68  ).        diff_h
+00003ae0: 6561 6465 7220 3d20 7265 2e63 6f6d 7069  eader = re.compi
+00003af0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00003b00: 7266 227b 7265 2e65 7363 6170 6528 7374  rf"{re.escape(st
+00003b10: 7228 746d 705f 6669 6c65 2929 7d5c 745c  r(tmp_file))}\t\
+00003b20: 645c 645c 645c 642d 5c64 5c64 2d5c 645c  d\d\d\d-\d\d-\d\
+00003b30: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
+00003b40: 7222 5c64 5c64 3a5c 645c 643a 5c64 5c64  r"\d\d:\d\d:\d\d
+00003b50: 5c2e 5c64 5c64 5c64 5c64 5c64 5c64 5c2b  \.\d\d\d\d\d\d\+
+00003b60: 5c64 5c64 3a5c 645c 6422 0a20 2020 2020  \d\d:\d\d".     
+00003b70: 2020 2029 0a20 2020 2020 2020 2074 7279     ).        try
+00003b80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00003b90: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
+00003ba0: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
+00003bb0: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
+00003bc0: 636b 2e6d 6169 6e2c 205b 222d 4322 2c20  ck.main, ["-C", 
+00003bd0: 222d 2d64 6966 6622 2c20 7374 7228 746d  "--diff", str(tm
+00003be0: 705f 6669 6c65 292c 2066 222d 2d63 6f6e  p_file), f"--con
+00003bf0: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
+00003c00: 477d 225d 0a20 2020 2020 2020 2020 2020  G}"].           
+00003c10: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+00003c20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00003c30: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
+00003c40: 2c20 3029 0a20 2020 2020 2020 2066 696e  , 0).        fin
+00003c50: 616c 6c79 3a0a 2020 2020 2020 2020 2020  ally:.          
+00003c60: 2020 6f73 2e75 6e6c 696e 6b28 746d 705f    os.unlink(tmp_
+00003c70: 6669 6c65 290a 2020 2020 2020 2020 6163  file).        ac
+00003c80: 7475 616c 203d 2072 6573 756c 742e 6f75  tual = result.ou
+00003c90: 7470 7574 0a20 2020 2020 2020 2061 6374  tput.        act
+00003ca0: 7561 6c20 3d20 6469 6666 5f68 6561 6465  ual = diff_heade
+00003cb0: 722e 7375 6228 4445 5445 524d 494e 4953  r.sub(DETERMINIS
+00003cc0: 5449 435f 4845 4144 4552 2c20 6163 7475  TIC_HEADER, actu
+00003cd0: 616c 290a 2020 2020 2020 2020 6163 7475  al).        actu
+00003ce0: 616c 203d 2061 6374 7561 6c2e 7273 7472  al = actual.rstr
+00003cf0: 6970 2829 202b 2022 5c6e 2220 2023 2074  ip() + "\n"  # t
+00003d00: 6865 2064 6966 6620 6f75 7470 7574 2068  he diff output h
+00003d10: 6173 2061 2074 7261 696c 696e 6720 7370  as a trailing sp
+00003d20: 6163 650a 2020 2020 2020 2020 6966 2065  ace.        if e
+00003d30: 7870 6563 7465 6420 213d 2061 6374 7561  xpected != actua
+00003d40: 6c3a 0a20 2020 2020 2020 2020 2020 2064  l:.            d
+00003d50: 756d 7020 3d20 626c 6163 6b2e 6475 6d70  ump = black.dump
+00003d60: 5f74 6f5f 6669 6c65 2861 6374 7561 6c29  _to_file(actual)
+00003d70: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+00003d80: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00003d90: 2020 2020 2022 4578 7065 6374 6564 2064       "Expected d
+00003da0: 6966 6620 6973 6e27 7420 6571 7561 6c20  iff isn't equal 
+00003db0: 746f 2074 6865 2061 6374 7561 6c2e 2049  to the actual. I
+00003dc0: 6620 796f 7520 6d61 6465 2063 6861 6e67  f you made chang
+00003dd0: 6573 2074 6f22 0a20 2020 2020 2020 2020  es to".         
+00003de0: 2020 2020 2020 2022 2065 7870 7265 7373         " express
+00003df0: 696f 6e2e 7079 2061 6e64 2074 6869 7320  ion.py and this 
+00003e00: 6973 2061 6e20 616e 7469 6369 7061 7465  is an anticipate
+00003e10: 6420 6469 6666 6572 656e 6365 2c20 6f76  d difference, ov
+00003e20: 6572 7772 6974 6522 0a20 2020 2020 2020  erwrite".       
+00003e30: 2020 2020 2020 2020 2022 2074 6573 7473           " tests
+00003e40: 2f64 6174 612f 6d69 7363 656c 6c61 6e65  /data/miscellane
+00003e50: 6f75 732f 6578 7072 6573 7369 6f6e 5f73  ous/expression_s
+00003e60: 6b69 705f 6d61 6769 635f 7472 6169 6c69  kip_magic_traili
+00003e70: 6e67 5f63 6f6d 6d61 2e64 6966 6622 0a20  ng_comma.diff". 
+00003e80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00003e90: 2220 7769 7468 207b 6475 6d70 7d22 0a20  " with {dump}". 
+00003ea0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00003eb0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00003ec0: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
+00003ed0: 6564 2c20 6163 7475 616c 2c20 6d73 6729  ed, actual, msg)
+00003ee0: 0a0a 2020 2020 4070 6174 6368 2822 626c  ..    @patch("bl
+00003ef0: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
+00003f00: 222c 2064 756d 705f 746f 5f73 7464 6572  ", dump_to_stder
+00003f10: 7229 0a20 2020 2064 6566 2074 6573 745f  r).    def test_
+00003f20: 6173 796e 635f 6173 5f69 6465 6e74 6966  async_as_identif
+00003f30: 6965 7228 7365 6c66 2920 2d3e 204e 6f6e  ier(self) -> Non
+00003f40: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
+00003f50: 655f 7061 7468 203d 2067 6574 5f63 6173  e_path = get_cas
+00003f60: 655f 7061 7468 2822 6d69 7363 656c 6c61  e_path("miscella
+00003f70: 6e65 6f75 7322 2c20 2261 7379 6e63 5f61  neous", "async_a
+00003f80: 735f 6964 656e 7469 6669 6572 2229 0a20  s_identifier"). 
+00003f90: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+00003fa0: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+00003fb0: 6174 615f 6672 6f6d 5f66 696c 6528 736f  ata_from_file(so
+00003fc0: 7572 6365 5f70 6174 6829 0a20 2020 2020  urce_path).     
+00003fd0: 2020 2061 6374 7561 6c20 3d20 6673 2873     actual = fs(s
+00003fe0: 6f75 7263 6529 0a20 2020 2020 2020 2073  ource).        s
+00003ff0: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+00004000: 4571 7561 6c28 6578 7065 6374 6564 2c20  Equal(expected, 
+00004010: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00004020: 6d61 6a6f 722c 206d 696e 6f72 203d 2073  major, minor = s
+00004030: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
+00004040: 3a32 5d0a 2020 2020 2020 2020 6966 206d  :2].        if m
+00004050: 616a 6f72 203c 2033 206f 7220 286d 616a  ajor < 3 or (maj
+00004060: 6f72 203c 3d20 3320 616e 6420 6d69 6e6f  or <= 3 and mino
+00004070: 7220 3c20 3729 3a0a 2020 2020 2020 2020  r < 7):.        
+00004080: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
+00004090: 5f65 7175 6976 616c 656e 7428 736f 7572  _equivalent(sour
+000040a0: 6365 2c20 6163 7475 616c 290a 2020 2020  ce, actual).    
+000040b0: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
+000040c0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
+000040d0: 6163 7475 616c 2c20 4445 4641 554c 545f  actual, DEFAULT_
+000040e0: 4d4f 4445 290a 2020 2020 2020 2020 2320  MODE).        # 
+000040f0: 656e 7375 7265 2062 6c61 636b 2063 616e  ensure black can
+00004100: 2070 6172 7365 2074 6869 7320 7768 656e   parse this when
+00004110: 2074 6865 2074 6172 6765 7420 6973 2033   the target is 3
+00004120: 2e36 0a20 2020 2020 2020 2073 656c 662e  .6.        self.
+00004130: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
+00004140: 2873 6f75 7263 655f 7061 7468 292c 2022  (source_path), "
+00004150: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
+00004160: 222c 2022 7079 3336 225d 290a 2020 2020  ", "py36"]).    
+00004170: 2020 2020 2320 6275 7420 6e6f 7420 6f6e      # but not on
+00004180: 2033 2e37 2c20 6265 6361 7573 6520 6173   3.7, because as
+00004190: 796e 632f 6177 6169 7420 6973 206e 6f20  ync/await is no 
+000041a0: 6c6f 6e67 6572 2061 6e20 6964 656e 7469  longer an identi
+000041b0: 6669 6572 0a20 2020 2020 2020 2073 656c  fier.        sel
+000041c0: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+000041d0: 7472 2873 6f75 7263 655f 7061 7468 292c  tr(source_path),
+000041e0: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
+000041f0: 6f6e 222c 2022 7079 3337 225d 2c20 6578  on", "py37"], ex
+00004200: 6974 5f63 6f64 653d 3132 3329 0a0a 2020  it_code=123)..  
+00004210: 2020 4070 6174 6368 2822 626c 6163 6b2e    @patch("black.
+00004220: 6475 6d70 5f74 6f5f 6669 6c65 222c 2064  dump_to_file", d
+00004230: 756d 705f 746f 5f73 7464 6572 7229 0a20  ump_to_stderr). 
+00004240: 2020 2064 6566 2074 6573 745f 7079 7468     def test_pyth
+00004250: 6f6e 3337 2873 656c 6629 202d 3e20 4e6f  on37(self) -> No
+00004260: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
+00004270: 6365 5f70 6174 6820 3d20 6765 745f 6361  ce_path = get_ca
+00004280: 7365 5f70 6174 6828 2270 795f 3337 222c  se_path("py_37",
+00004290: 2022 7079 7468 6f6e 3337 2229 0a20 2020   "python37").   
+000042a0: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
+000042b0: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
+000042c0: 615f 6672 6f6d 5f66 696c 6528 736f 7572  a_from_file(sour
+000042d0: 6365 5f70 6174 6829 0a20 2020 2020 2020  ce_path).       
+000042e0: 2061 6374 7561 6c20 3d20 6673 2873 6f75   actual = fs(sou
+000042f0: 7263 6529 0a20 2020 2020 2020 2073 656c  rce).        sel
+00004300: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
+00004310: 7561 6c28 6578 7065 6374 6564 2c20 6163  ual(expected, ac
+00004320: 7475 616c 290a 2020 2020 2020 2020 6d61  tual).        ma
+00004330: 6a6f 722c 206d 696e 6f72 203d 2073 7973  jor, minor = sys
+00004340: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 3a32  .version_info[:2
+00004350: 5d0a 2020 2020 2020 2020 6966 206d 616a  ].        if maj
+00004360: 6f72 203e 2033 206f 7220 286d 616a 6f72  or > 3 or (major
+00004370: 203d 3d20 3320 616e 6420 6d69 6e6f 7220   == 3 and minor 
+00004380: 3e3d 2037 293a 0a20 2020 2020 2020 2020  >= 7):.         
+00004390: 2020 2062 6c61 636b 2e61 7373 6572 745f     black.assert_
+000043a0: 6571 7569 7661 6c65 6e74 2873 6f75 7263  equivalent(sourc
+000043b0: 652c 2061 6374 7561 6c29 0a20 2020 2020  e, actual).     
+000043c0: 2020 2062 6c61 636b 2e61 7373 6572 745f     black.assert_
+000043d0: 7374 6162 6c65 2873 6f75 7263 652c 2061  stable(source, a
+000043e0: 6374 7561 6c2c 2044 4546 4155 4c54 5f4d  ctual, DEFAULT_M
+000043f0: 4f44 4529 0a20 2020 2020 2020 2023 2065  ODE).        # e
+00004400: 6e73 7572 6520 626c 6163 6b20 6361 6e20  nsure black can 
+00004410: 7061 7273 6520 7468 6973 2077 6865 6e20  parse this when 
+00004420: 7468 6520 7461 7267 6574 2069 7320 332e  the target is 3.
+00004430: 370a 2020 2020 2020 2020 7365 6c66 2e69  7.        self.i
+00004440: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+00004450: 736f 7572 6365 5f70 6174 6829 2c20 222d  source_path), "-
+00004460: 2d74 6172 6765 742d 7665 7273 696f 6e22  -target-version"
+00004470: 2c20 2270 7933 3722 5d29 0a20 2020 2020  , "py37"]).     
+00004480: 2020 2023 2062 7574 206e 6f74 206f 6e20     # but not on 
+00004490: 332e 362c 2062 6563 6175 7365 2077 6520  3.6, because we 
+000044a0: 7573 6520 6173 796e 6320 6173 2061 2072  use async as a r
+000044b0: 6573 6572 7665 6420 6b65 7977 6f72 640a  eserved keyword.
+000044c0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+000044d0: 6f6b 6542 6c61 636b 285b 7374 7228 736f  okeBlack([str(so
+000044e0: 7572 6365 5f70 6174 6829 2c20 222d 2d74  urce_path), "--t
+000044f0: 6172 6765 742d 7665 7273 696f 6e22 2c20  arget-version", 
+00004500: 2270 7933 3622 5d2c 2065 7869 745f 636f  "py36"], exit_co
+00004510: 6465 3d31 3233 290a 0a20 2020 2064 6566  de=123)..    def
+00004520: 2074 6573 745f 7461 625f 636f 6d6d 656e   test_tab_commen
+00004530: 745f 696e 6465 6e74 6174 696f 6e28 7365  t_indentation(se
+00004540: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00004550: 2020 2020 2063 6f6e 7465 6e74 735f 7461       contents_ta
+00004560: 6220 3d20 2269 6620 313a 5c6e 5c74 6966  b = "if 1:\n\tif
+00004570: 2032 3a5c 6e5c 745c 7470 6173 735c 6e5c   2:\n\t\tpass\n\
+00004580: 7423 2063 6f6d 6d65 6e74 5c6e 5c74 7061  t# comment\n\tpa
+00004590: 7373 5c6e 220a 2020 2020 2020 2020 636f  ss\n".        co
+000045a0: 6e74 656e 7473 5f73 7063 203d 2022 6966  ntents_spc = "if
+000045b0: 2031 3a5c 6e20 2020 2069 6620 323a 5c6e   1:\n    if 2:\n
+000045c0: 2020 2020 2020 2020 7061 7373 5c6e 2020          pass\n  
+000045d0: 2020 2320 636f 6d6d 656e 745c 6e20 2020    # comment\n   
+000045e0: 2070 6173 735c 6e22 0a20 2020 2020 2020   pass\n".       
+000045f0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+00004600: 6174 4571 7561 6c28 636f 6e74 656e 7473  atEqual(contents
+00004610: 5f73 7063 2c20 6673 2863 6f6e 7465 6e74  _spc, fs(content
+00004620: 735f 7370 6329 290a 2020 2020 2020 2020  s_spc)).        
+00004630: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
+00004640: 7445 7175 616c 2863 6f6e 7465 6e74 735f  tEqual(contents_
+00004650: 7370 632c 2066 7328 636f 6e74 656e 7473  spc, fs(contents
+00004660: 5f74 6162 2929 0a0a 2020 2020 2020 2020  _tab))..        
+00004670: 636f 6e74 656e 7473 5f74 6162 203d 2022  contents_tab = "
+00004680: 6966 2031 3a5c 6e5c 7469 6620 323a 5c6e  if 1:\n\tif 2:\n
+00004690: 5c74 5c74 7061 7373 5c6e 5c74 5c74 2320  \t\tpass\n\t\t# 
+000046a0: 636f 6d6d 656e 745c 6e5c 7470 6173 735c  comment\n\tpass\
+000046b0: 6e22 0a20 2020 2020 2020 2063 6f6e 7465  n".        conte
+000046c0: 6e74 735f 7370 6320 3d20 2269 6620 313a  nts_spc = "if 1:
+000046d0: 5c6e 2020 2020 6966 2032 3a5c 6e20 2020  \n    if 2:\n   
+000046e0: 2020 2020 2070 6173 735c 6e20 2020 2020       pass\n     
+000046f0: 2020 2023 2063 6f6d 6d65 6e74 5c6e 2020     # comment\n  
+00004700: 2020 7061 7373 5c6e 220a 2020 2020 2020    pass\n".      
+00004710: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
+00004720: 6d61 7445 7175 616c 2863 6f6e 7465 6e74  matEqual(content
+00004730: 735f 7370 632c 2066 7328 636f 6e74 656e  s_spc, fs(conten
+00004740: 7473 5f73 7063 2929 0a20 2020 2020 2020  ts_spc)).       
+00004750: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+00004760: 6174 4571 7561 6c28 636f 6e74 656e 7473  atEqual(contents
+00004770: 5f73 7063 2c20 6673 2863 6f6e 7465 6e74  _spc, fs(content
+00004780: 735f 7461 6229 290a 0a20 2020 2020 2020  s_tab))..       
+00004790: 2023 206d 6978 6564 2074 6162 7320 616e   # mixed tabs an
+000047a0: 6420 7370 6163 6573 2028 7661 6c69 6420  d spaces (valid 
+000047b0: 5079 7468 6f6e 2032 2063 6f64 6529 0a20  Python 2 code). 
+000047c0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
+000047d0: 7461 6220 3d20 2269 6620 313a 5c6e 2020  tab = "if 1:\n  
+000047e0: 2020 2020 2020 6966 2032 3a5c 6e5c 745c        if 2:\n\t\
+000047f0: 7470 6173 735c 6e5c 7423 2063 6f6d 6d65  tpass\n\t# comme
+00004800: 6e74 5c6e 2020 2020 2020 2020 7061 7373  nt\n        pass
+00004810: 5c6e 220a 2020 2020 2020 2020 636f 6e74  \n".        cont
+00004820: 656e 7473 5f73 7063 203d 2022 6966 2031  ents_spc = "if 1
+00004830: 3a5c 6e20 2020 2069 6620 323a 5c6e 2020  :\n    if 2:\n  
+00004840: 2020 2020 2020 7061 7373 5c6e 2020 2020        pass\n    
+00004850: 2320 636f 6d6d 656e 745c 6e20 2020 2070  # comment\n    p
+00004860: 6173 735c 6e22 0a20 2020 2020 2020 2073  ass\n".        s
+00004870: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+00004880: 4571 7561 6c28 636f 6e74 656e 7473 5f73  Equal(contents_s
+00004890: 7063 2c20 6673 2863 6f6e 7465 6e74 735f  pc, fs(contents_
+000048a0: 7370 6329 290a 2020 2020 2020 2020 7365  spc)).        se
+000048b0: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
+000048c0: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
+000048d0: 632c 2066 7328 636f 6e74 656e 7473 5f74  c, fs(contents_t
+000048e0: 6162 2929 0a0a 2020 2020 2020 2020 636f  ab))..        co
+000048f0: 6e74 656e 7473 5f74 6162 203d 2022 6966  ntents_tab = "if
+00004900: 2031 3a5c 6e20 2020 2020 2020 2069 6620   1:\n        if 
+00004910: 323a 5c6e 5c74 5c74 7061 7373 5c6e 5c74  2:\n\t\tpass\n\t
+00004920: 5c74 2320 636f 6d6d 656e 745c 6e20 2020  \t# comment\n   
+00004930: 2020 2020 2070 6173 735c 6e22 0a20 2020       pass\n".   
+00004940: 2020 2020 2063 6f6e 7465 6e74 735f 7370       contents_sp
+00004950: 6320 3d20 2269 6620 313a 5c6e 2020 2020  c = "if 1:\n    
+00004960: 6966 2032 3a5c 6e20 2020 2020 2020 2070  if 2:\n        p
+00004970: 6173 735c 6e20 2020 2020 2020 2023 2063  ass\n        # c
+00004980: 6f6d 6d65 6e74 5c6e 2020 2020 7061 7373  omment\n    pass
+00004990: 5c6e 220a 2020 2020 2020 2020 7365 6c66  \n".        self
+000049a0: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
+000049b0: 616c 2863 6f6e 7465 6e74 735f 7370 632c  al(contents_spc,
+000049c0: 2066 7328 636f 6e74 656e 7473 5f73 7063   fs(contents_spc
+000049d0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+000049e0: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
+000049f0: 6c28 636f 6e74 656e 7473 5f73 7063 2c20  l(contents_spc, 
+00004a00: 6673 2863 6f6e 7465 6e74 735f 7461 6229  fs(contents_tab)
+00004a10: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00004a20: 6661 6c73 655f 706f 7369 7469 7665 5f73  false_positive_s
+00004a30: 796d 6c69 6e6b 5f6f 7574 7075 745f 6973  ymlink_output_is
+00004a40: 7375 655f 3333 3834 2873 656c 6629 202d  sue_3384(self) -
+00004a50: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00004a60: 2320 456d 756c 6174 6520 7468 6520 6265  # Emulate the be
+00004a70: 6861 7669 6f72 2077 6865 6e20 7573 696e  havior when usin
+00004a80: 6720 7468 6520 434c 4920 2860 626c 6163  g the CLI (`blac
+00004a90: 6b20 2e2f 6368 696c 6420 202d 2d76 6572  k ./child  --ver
+00004aa0: 626f 7365 6029 2c20 7768 6963 680a 2020  bose`), which.  
+00004ab0: 2020 2020 2020 2320 696e 766f 6c76 6573        # involves
+00004ac0: 2070 6174 6368 696e 6720 736f 6d65 2060   patching some `
+00004ad0: 7061 7468 6c69 622e 5061 7468 6020 6d65  pathlib.Path` me
+00004ae0: 7468 6f64 732e 2049 6e20 7061 7274 6963  thods. In partic
+00004af0: 756c 6172 2c20 6069 735f 6469 7260 2069  ular, `is_dir` i
+00004b00: 730a 2020 2020 2020 2020 2320 7061 7463  s.        # patc
+00004b10: 6865 6420 6f6e 6c79 206f 6e20 6974 7320  hed only on its 
+00004b20: 6669 7273 7420 6361 6c6c 3a20 7768 656e  first call: when
+00004b30: 2063 6865 636b 696e 6720 6966 2022 2e2f   checking if "./
+00004b40: 6368 696c 6422 2069 7320 6120 6469 7265  child" is a dire
+00004b50: 6374 6f72 7920 6974 0a20 2020 2020 2020  ctory it.       
+00004b60: 2023 2073 686f 756c 6420 7265 7475 726e   # should return
+00004b70: 2054 7275 652e 2054 6865 2022 2e2f 6368   True. The "./ch
+00004b80: 696c 6422 2066 6f6c 6465 7220 6578 6973  ild" folder exis
+00004b90: 7473 2072 656c 6174 6976 6520 746f 2074  ts relative to t
+00004ba0: 6865 2063 7764 2077 6865 6e0a 2020 2020  he cwd when.    
+00004bb0: 2020 2020 2320 7275 6e6e 696e 6720 6672      # running fr
+00004bc0: 6f6d 2043 4c49 2c20 6275 7420 6661 696c  om CLI, but fail
+00004bd0: 7320 7768 656e 2072 756e 6e69 6e67 2074  s when running t
+00004be0: 6865 2074 6573 7473 2062 6563 6175 7365  he tests because
+00004bf0: 2063 7764 2069 7320 6469 6666 6572 656e   cwd is differen
+00004c00: 740a 2020 2020 2020 2020 7072 6f6a 6563  t.        projec
+00004c10: 745f 726f 6f74 203d 2050 6174 6828 5448  t_root = Path(TH
+00004c20: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
+00004c30: 2f20 226e 6573 7465 645f 6769 7469 676e  / "nested_gitign
+00004c40: 6f72 655f 7465 7374 7322 290a 2020 2020  ore_tests").    
+00004c50: 2020 2020 776f 726b 696e 675f 6469 7265      working_dire
+00004c60: 6374 6f72 7920 3d20 7072 6f6a 6563 745f  ctory = project_
+00004c70: 726f 6f74 202f 2022 726f 6f74 220a 2020  root / "root".  
+00004c80: 2020 2020 2020 7461 7267 6574 5f61 6273        target_abs
+00004c90: 7061 7468 203d 2077 6f72 6b69 6e67 5f64  path = working_d
+00004ca0: 6972 6563 746f 7279 202f 2022 6368 696c  irectory / "chil
+00004cb0: 6422 0a20 2020 2020 2020 2074 6172 6765  d".        targe
+00004cc0: 745f 636f 6e74 656e 7473 203d 2028 0a20  t_contents = (. 
+00004cd0: 2020 2020 2020 2020 2020 2073 7263 2e72             src.r
+00004ce0: 656c 6174 6976 655f 746f 2877 6f72 6b69  elative_to(worki
+00004cf0: 6e67 5f64 6972 6563 746f 7279 2920 666f  ng_directory) fo
+00004d00: 7220 7372 6320 696e 2074 6172 6765 745f  r src in target_
+00004d10: 6162 7370 6174 682e 6974 6572 6469 7228  abspath.iterdir(
+00004d20: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00004d30: 2020 2020 2064 6566 206d 6f63 6b5f 6e5f       def mock_n_
+00004d40: 6361 6c6c 7328 7265 7370 6f6e 7365 733a  calls(responses:
+00004d50: 204c 6973 745b 626f 6f6c 5d29 202d 3e20   List[bool]) -> 
+00004d60: 4361 6c6c 6162 6c65 5b5b 5d2c 2062 6f6f  Callable[[], boo
+00004d70: 6c5d 3a0a 2020 2020 2020 2020 2020 2020  l]:.            
+00004d80: 6465 6620 5f6d 6f63 6b65 645f 6361 6c6c  def _mocked_call
+00004d90: 7328 2920 2d3e 2062 6f6f 6c3a 0a20 2020  s() -> bool:.   
+00004da0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004db0: 7265 7370 6f6e 7365 733a 0a20 2020 2020  responses:.     
+00004dc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004dd0: 6574 7572 6e20 7265 7370 6f6e 7365 732e  eturn responses.
+00004de0: 706f 7028 3029 0a20 2020 2020 2020 2020  pop(0).         
+00004df0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00004e00: 6c73 650a 0a20 2020 2020 2020 2020 2020  lse..           
+00004e10: 2072 6574 7572 6e20 5f6d 6f63 6b65 645f   return _mocked_
+00004e20: 6361 6c6c 730a 0a20 2020 2020 2020 2077  calls..        w
+00004e30: 6974 6820 7061 7463 6828 2270 6174 686c  ith patch("pathl
+00004e40: 6962 2e50 6174 682e 6974 6572 6469 7222  ib.Path.iterdir"
+00004e50: 2c20 7265 7475 726e 5f76 616c 7565 3d74  , return_value=t
+00004e60: 6172 6765 745f 636f 6e74 656e 7473 292c  arget_contents),
+00004e70: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
+00004e80: 2020 2020 2270 6174 686c 6962 2e50 6174      "pathlib.Pat
+00004e90: 682e 6377 6422 2c20 7265 7475 726e 5f76  h.cwd", return_v
+00004ea0: 616c 7565 3d77 6f72 6b69 6e67 5f64 6972  alue=working_dir
+00004eb0: 6563 746f 7279 0a20 2020 2020 2020 2029  ectory.        )
+00004ec0: 2c20 7061 7463 6828 2270 6174 686c 6962  , patch("pathlib
+00004ed0: 2e50 6174 682e 6973 5f64 6972 222c 2073  .Path.is_dir", s
+00004ee0: 6964 655f 6566 6665 6374 3d6d 6f63 6b5f  ide_effect=mock_
+00004ef0: 6e5f 6361 6c6c 7328 5b54 7275 655d 2929  n_calls([True]))
+00004f00: 3a0a 2020 2020 2020 2020 2020 2020 6374  :.            ct
+00004f10: 7820 3d20 4661 6b65 436f 6e74 6578 7428  x = FakeContext(
+00004f20: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00004f30: 4e6f 7465 2074 6861 7420 7468 6520 726f  Note that the ro
+00004f40: 6f74 2066 6f6c 6465 7220 2870 726f 6a65  ot folder (proje
+00004f50: 6374 5f72 6f6f 7429 2069 736e 2774 2074  ct_root) isn't t
+00004f60: 6865 2066 6f6c 6465 720a 2020 2020 2020  he folder.      
+00004f70: 2020 2020 2020 2320 6e61 6d65 6420 2272        # named "r
+00004f80: 6f6f 7422 2028 616b 6120 776f 726b 696e  oot" (aka workin
+00004f90: 675f 6469 7265 6374 6f72 7929 0a20 2020  g_directory).   
+00004fa0: 2020 2020 2020 2020 2063 7478 2e6f 626a           ctx.obj
+00004fb0: 5b22 726f 6f74 225d 203d 2070 726f 6a65  ["root"] = proje
+00004fc0: 6374 5f72 6f6f 740a 2020 2020 2020 2020  ct_root.        
+00004fd0: 2020 2020 7265 706f 7274 203d 204d 6167      report = Mag
+00004fe0: 6963 4d6f 636b 2876 6572 626f 7365 3d54  icMock(verbose=T
+00004ff0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00005000: 2062 6c61 636b 2e67 6574 5f73 6f75 7263   black.get_sourc
+00005010: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00005020: 2020 2020 6374 783d 6374 782c 0a20 2020      ctx=ctx,.   
+00005030: 2020 2020 2020 2020 2020 2020 2073 7263               src
+00005040: 3d28 222e 2f63 6869 6c64 222c 292c 0a20  =("./child",),. 
+00005050: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00005060: 7569 6574 3d46 616c 7365 2c0a 2020 2020  uiet=False,.    
+00005070: 2020 2020 2020 2020 2020 2020 7665 7262              verb
+00005080: 6f73 653d 5472 7565 2c0a 2020 2020 2020  ose=True,.      
+00005090: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+000050a0: 653d 4445 4641 554c 545f 494e 434c 5544  e=DEFAULT_INCLUD
+000050b0: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
+000050c0: 2020 2065 7863 6c75 6465 3d4e 6f6e 652c     exclude=None,
+000050d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000050e0: 2072 6570 6f72 743d 7265 706f 7274 2c0a   report=report,.
+000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005100: 6578 7465 6e64 5f65 7863 6c75 6465 3d4e  extend_exclude=N
+00005110: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00005120: 2020 2020 2066 6f72 6365 5f65 7863 6c75       force_exclu
+00005130: 6465 3d4e 6f6e 652c 0a20 2020 2020 2020  de=None,.       
+00005140: 2020 2020 2020 2020 2073 7464 696e 5f66           stdin_f
+00005150: 696c 656e 616d 653d 4e6f 6e65 2c0a 2020  ilename=None,.  
+00005160: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005170: 2020 2020 6173 7365 7274 206e 6f74 2061      assert not a
+00005180: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
+00005190: 6d6f 636b 5f61 7267 735b 315d 2e73 7461  mock_args[1].sta
+000051a0: 7274 7377 6974 6828 2269 7320 6120 7379  rtswith("is a sy
+000051b0: 6d62 6f6c 6963 206c 696e 6b20 7468 6174  mbolic link that
+000051c0: 2070 6f69 6e74 7320 6f75 7473 6964 6522   points outside"
+000051d0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000051e0: 7220 5f2c 206d 6f63 6b5f 6172 6773 2c20  r _, mock_args, 
+000051f0: 5f20 696e 2072 6570 6f72 742e 7061 7468  _ in report.path
+00005200: 5f69 676e 6f72 6564 2e6d 6f63 6b5f 6361  _ignored.mock_ca
+00005210: 6c6c 730a 2020 2020 2020 2020 292c 2022  lls.        ), "
+00005220: 4120 7379 6d62 6f6c 6963 206c 696e 6b20  A symbolic link 
+00005230: 7761 7320 7265 706f 7274 6564 2e22 0a20  was reported.". 
+00005240: 2020 2020 2020 2072 6570 6f72 742e 7061         report.pa
+00005250: 7468 5f69 676e 6f72 6564 2e61 7373 6572  th_ignored.asser
+00005260: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
+00005270: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
+00005280: 5061 7468 2822 726f 6f74 222c 2022 6368  Path("root", "ch
+00005290: 696c 6422 2c20 2262 2e70 7922 292c 2022  ild", "b.py"), "
+000052a0: 6d61 7463 6865 7320 6120 2e67 6974 6967  matches a .gitig
+000052b0: 6e6f 7265 2066 696c 6520 636f 6e74 656e  nore file conten
+000052c0: 7422 0a20 2020 2020 2020 2029 0a0a 2020  t".        )..  
+000052d0: 2020 6465 6620 7465 7374 5f72 6570 6f72    def test_repor
+000052e0: 745f 7665 7262 6f73 6528 7365 6c66 2920  t_verbose(self) 
+000052f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00005300: 2072 6570 6f72 7420 3d20 5265 706f 7274   report = Report
+00005310: 2876 6572 626f 7365 3d54 7275 6529 0a20  (verbose=True). 
+00005320: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
+00005330: 203d 205b 5d0a 2020 2020 2020 2020 6572   = [].        er
+00005340: 725f 6c69 6e65 7320 3d20 5b5d 0a0a 2020  r_lines = []..  
+00005350: 2020 2020 2020 6465 6620 6f75 7428 6d73        def out(ms
+00005360: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
+00005370: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
+00005380: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+00005390: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
+000053a0: 290a 0a20 2020 2020 2020 2064 6566 2065  )..        def e
+000053b0: 7272 286d 7367 3a20 7374 722c 202a 2a6b  rr(msg: str, **k
+000053c0: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
+000053d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000053e0: 2065 7272 5f6c 696e 6573 2e61 7070 656e   err_lines.appen
+000053f0: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
+00005400: 7769 7468 2070 6174 6368 2822 626c 6163  with patch("blac
+00005410: 6b2e 6f75 7470 7574 2e5f 6f75 7422 2c20  k.output._out", 
+00005420: 6f75 7429 2c20 7061 7463 6828 2262 6c61  out), patch("bla
+00005430: 636b 2e6f 7574 7075 742e 5f65 7272 222c  ck.output._err",
+00005440: 2065 7272 293a 0a20 2020 2020 2020 2020   err):.         
+00005450: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00005460: 6174 6828 2266 3122 292c 2062 6c61 636b  ath("f1"), black
+00005470: 2e43 6861 6e67 6564 2e4e 4f29 0a20 2020  .Changed.NO).   
+00005480: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005490: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+000054a0: 745f 6c69 6e65 7329 2c20 3129 0a20 2020  t_lines), 1).   
+000054b0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000054c0: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+000054d0: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
+000054e0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000054f0: 7365 7274 4571 7561 6c28 6f75 745f 6c69  sertEqual(out_li
+00005500: 6e65 735b 2d31 5d2c 2022 6631 2061 6c72  nes[-1], "f1 alr
+00005510: 6561 6479 2077 656c 6c20 666f 726d 6174  eady well format
+00005520: 7465 642c 2067 6f6f 6420 6a6f 622e 2229  ted, good job.")
+00005530: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005540: 662e 6173 7365 7274 4571 7561 6c28 756e  f.assertEqual(un
+00005550: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+00005560: 2929 2c20 2231 2066 696c 6520 6c65 6674  )), "1 file left
+00005570: 2075 6e63 6861 6e67 6564 2e22 290a 2020   unchanged.").  
+00005580: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005590: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+000055a0: 742e 7265 7475 726e 5f63 6f64 652c 2030  t.return_code, 0
+000055b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000055c0: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+000055d0: 6632 2229 2c20 626c 6163 6b2e 4368 616e  f2"), black.Chan
+000055e0: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
+000055f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005600: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00005610: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00005620: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005630: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00005640: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00005650: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005660: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
+00005670: 2d31 5d2c 2022 7265 666f 726d 6174 7465  -1], "reformatte
+00005680: 6420 6632 2229 0a20 2020 2020 2020 2020  d f2").         
 00005690: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000056a0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-000056b0: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
-000056c0: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
-000056d0: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
-000056e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000056f0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00005700: 6574 7572 6e5f 636f 6465 2c20 3129 0a20  eturn_code, 1). 
-00005710: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00005720: 742e 6368 6563 6b20 3d20 4661 6c73 650a  t.check = False.
-00005730: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00005740: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
-00005750: 6531 2229 2c20 2262 6f6f 6d22 290a 2020  e1"), "boom").  
-00005760: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00005770: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
-00005780: 7574 5f6c 696e 6573 292c 2033 290a 2020  ut_lines), 3).  
-00005790: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000057a0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
-000057b0: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
-000057c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000057d0: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
-000057e0: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
-000057f0: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
-00005800: 6531 3a20 626f 6f6d 2229 0a20 2020 2020  e1: boom").     
-00005810: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005820: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00005830: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-00005840: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
-00005850: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00005860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005870: 2020 2020 2022 3120 6669 6c65 2072 6566       "1 file ref
-00005880: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
-00005890: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
-000058a0: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
-000058b0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-000058c0: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
-000058d0: 6174 2e22 0a20 2020 2020 2020 2020 2020  at.".           
-000058e0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-000058f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00005900: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005910: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-00005920: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
-00005930: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-00005940: 6f6e 6528 5061 7468 2822 6633 2229 2c20  one(Path("f3"), 
-00005950: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
-00005960: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
-00005970: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005980: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-00005990: 3429 0a20 2020 2020 2020 2020 2020 2073  4).            s
-000059a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000059b0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-000059c0: 3129 0a20 2020 2020 2020 2020 2020 2073  1).            s
-000059d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000059e0: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
-000059f0: 7265 666f 726d 6174 7465 6420 6633 2229  reformatted f3")
-00005a00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005a10: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00005a20: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00005a30: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00005a40: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-00005a50: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-00005a60: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00005a70: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00005a80: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00005a90: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
-00005aa0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+000056a0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+000056b0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+000056c0: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
+000056d0: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
+000056e0: 3120 6669 6c65 206c 6566 7420 756e 6368  1 file left unch
+000056f0: 616e 6765 642e 220a 2020 2020 2020 2020  anged.".        
+00005700: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00005710: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00005720: 7468 2822 6633 2229 2c20 626c 6163 6b2e  th("f3"), black.
+00005730: 4368 616e 6765 642e 4341 4348 4544 290a  Changed.CACHED).
+00005740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005750: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00005760: 286f 7574 5f6c 696e 6573 292c 2033 290a  (out_lines), 3).
+00005770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005780: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00005790: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
+000057a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000057b0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+000057c0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+000057d0: 745f 6c69 6e65 735b 2d31 5d2c 2022 6633  t_lines[-1], "f3
+000057e0: 2077 6173 6e27 7420 6d6f 6469 6669 6564   wasn't modified
+000057f0: 206f 6e20 6469 736b 2073 696e 6365 206c   on disk since l
+00005800: 6173 7420 7275 6e2e 220a 2020 2020 2020  ast run.".      
+00005810: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00005820: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005830: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00005840: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
+00005850: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
+00005860: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
+00005870: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00005880: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
+00005890: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000058a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000058b0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+000058c0: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
+000058d0: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
+000058e0: 6865 636b 203d 2054 7275 650a 2020 2020  heck = True.    
+000058f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005900: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+00005910: 7265 7475 726e 5f63 6f64 652c 2031 290a  return_code, 1).
+00005920: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00005930: 7274 2e63 6865 636b 203d 2046 616c 7365  rt.check = False
+00005940: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00005950: 6f72 742e 6661 696c 6564 2850 6174 6828  ort.failed(Path(
+00005960: 2265 3122 292c 2022 626f 6f6d 2229 0a20  "e1"), "boom"). 
+00005970: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005980: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005990: 6f75 745f 6c69 6e65 7329 2c20 3329 0a20  out_lines), 3). 
+000059a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000059b0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000059c0: 6572 725f 6c69 6e65 7329 2c20 3129 0a20  err_lines), 1). 
+000059d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000059e0: 6173 7365 7274 4571 7561 6c28 6572 725f  assertEqual(err_
+000059f0: 6c69 6e65 735b 2d31 5d2c 2022 6572 726f  lines[-1], "erro
+00005a00: 723a 2063 616e 6e6f 7420 666f 726d 6174  r: cannot format
+00005a10: 2065 313a 2062 6f6f 6d22 290a 2020 2020   e1: boom").    
+00005a20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005a30: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00005a40: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00005a50: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00005a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a70: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
+00005a80: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
+00005a90: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
+00005aa0: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
 00005ab0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00005ac0: 2072 6566 6f72 6d61 742e 220a 2020 2020   reformat.".    
-00005ad0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00005ae0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005af0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00005b00: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00005b10: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-00005b20: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00005b30: 6570 6f72 742e 6661 696c 6564 2850 6174  eport.failed(Pat
-00005b40: 6828 2265 3222 292c 2022 626f 6f6d 2229  h("e2"), "boom")
-00005b50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005b60: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005b70: 6e28 6f75 745f 6c69 6e65 7329 2c20 3429  n(out_lines), 4)
-00005b80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005b90: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005ba0: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
-00005bb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005bc0: 662e 6173 7365 7274 4571 7561 6c28 6572  f.assertEqual(er
-00005bd0: 725f 6c69 6e65 735b 2d31 5d2c 2022 6572  r_lines[-1], "er
-00005be0: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
-00005bf0: 6174 2065 323a 2062 6f6f 6d22 290a 2020  at e2: boom").  
-00005c00: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00005c10: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00005c20: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00005c30: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00005c40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005c50: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00005c60: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
-00005c70: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
-00005c80: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
-00005c90: 6e67 6564 2c20 3220 6669 6c65 7320 6661  nged, 2 files fa
-00005ca0: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
-00005cb0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-00005cc0: 6566 6f72 6d61 742e 220a 2020 2020 2020  eformat.".      
-00005cd0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00005ce0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00005cf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005d00: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00005d10: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
-00005d20: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00005d30: 6f72 742e 7061 7468 5f69 676e 6f72 6564  ort.path_ignored
-00005d40: 2850 6174 6828 2277 6174 2229 2c20 226e  (Path("wat"), "n
-00005d50: 6f20 6d61 7463 6822 290a 2020 2020 2020  o match").      
-00005d60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005d70: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00005d80: 696e 6573 292c 2035 290a 2020 2020 2020  ines), 5).      
-00005d90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005da0: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00005db0: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
-00005dc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005dd0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
-00005de0: 5b2d 315d 2c20 2277 6174 2069 676e 6f72  [-1], "wat ignor
-00005df0: 6564 3a20 6e6f 206d 6174 6368 2229 0a20  ed: no match"). 
-00005e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005e10: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00005e20: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00005e30: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00005e40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00005e50: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
-00005e60: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-00005e70: 7320 7265 666f 726d 6174 7465 642c 2032  s reformatted, 2
-00005e80: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
-00005e90: 616e 6765 642c 2032 2066 696c 6573 2066  anged, 2 files f
-00005ea0: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
-00005eb0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00005ec0: 7265 666f 726d 6174 2e22 0a20 2020 2020  reformat.".     
-00005ed0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00005ee0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00005ef0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005f00: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
-00005f10: 7265 7475 726e 5f63 6f64 652c 2031 3233  return_code, 123
-00005f20: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00005f30: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-00005f40: 6634 2229 2c20 626c 6163 6b2e 4368 616e  f4"), black.Chan
-00005f50: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
-00005f60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005f70: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005f80: 6573 292c 2036 290a 2020 2020 2020 2020  es), 6).        
-00005f90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005fa0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00005fb0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00005fc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005fd0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
-00005fe0: 315d 2c20 2266 3420 616c 7265 6164 7920  1], "f4 already 
-00005ff0: 7765 6c6c 2066 6f72 6d61 7474 6564 2c20  well formatted, 
-00006000: 676f 6f64 206a 6f62 2e22 290a 2020 2020  good job.").    
-00006010: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006020: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00006030: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00006040: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006060: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006070: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
-00006080: 6566 6f72 6d61 7474 6564 2c20 3320 6669  eformatted, 3 fi
-00006090: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
-000060a0: 6564 2c20 3220 6669 6c65 7320 6661 696c  ed, 2 files fail
-000060b0: 6564 2074 6f22 0a20 2020 2020 2020 2020  ed to".         
-000060c0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-000060d0: 6f72 6d61 742e 220a 2020 2020 2020 2020  ormat.".        
-000060e0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-000060f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006100: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006110: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00006120: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00006130: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006140: 742e 6368 6563 6b20 3d20 5472 7565 0a20  t.check = True. 
-00006150: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006160: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00006170: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00006180: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00006190: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000061a0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
-000061b0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-000061c0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
-000061d0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
-000061e0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
-000061f0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
-00006200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006210: 2220 6669 6c65 7320 776f 756c 6420 6661  " files would fa
-00006220: 696c 2074 6f20 7265 666f 726d 6174 2e22  il to reformat."
-00006230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006240: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00006250: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006260: 706f 7274 2e63 6865 636b 203d 2046 616c  port.check = Fal
-00006270: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
-00006280: 6570 6f72 742e 6469 6666 203d 2054 7275  eport.diff = Tru
-00006290: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-000062a0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000062b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062c0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-000062d0: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-000062e0: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-000062f0: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00006300: 696c 6573 2077 6f75 6c64 2062 6520 7265  iles would be re
-00006310: 666f 726d 6174 7465 642c 2033 2066 696c  formatted, 3 fil
-00006320: 6573 2077 6f75 6c64 2062 6520 6c65 6674  es would be left
-00006330: 2075 6e63 6861 6e67 6564 2c20 3222 0a20   unchanged, 2". 
-00006340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006350: 2020 2022 2066 696c 6573 2077 6f75 6c64     " files would
-00006360: 2066 6169 6c20 746f 2072 6566 6f72 6d61   fail to reforma
-00006370: 742e 220a 2020 2020 2020 2020 2020 2020  t.".            
-00006380: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00006390: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-000063a0: 7374 5f72 6570 6f72 745f 7175 6965 7428  st_report_quiet(
-000063b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000063c0: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
-000063d0: 5265 706f 7274 2871 7569 6574 3d54 7275  Report(quiet=Tru
-000063e0: 6529 0a20 2020 2020 2020 206f 7574 5f6c  e).        out_l
-000063f0: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
-00006400: 2020 6572 725f 6c69 6e65 7320 3d20 5b5d    err_lines = []
-00006410: 0a0a 2020 2020 2020 2020 6465 6620 6f75  ..        def ou
-00006420: 7428 6d73 673a 2073 7472 2c20 2a2a 6b77  t(msg: str, **kw
-00006430: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-00006440: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006450: 6f75 745f 6c69 6e65 732e 6170 7065 6e64  out_lines.append
-00006460: 286d 7367 290a 0a20 2020 2020 2020 2064  (msg)..        d
-00006470: 6566 2065 7272 286d 7367 3a20 7374 722c  ef err(msg: str,
-00006480: 202a 2a6b 7761 7267 733a 2041 6e79 2920   **kwargs: Any) 
-00006490: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000064a0: 2020 2020 2065 7272 5f6c 696e 6573 2e61       err_lines.a
-000064b0: 7070 656e 6428 6d73 6729 0a0a 2020 2020  ppend(msg)..    
-000064c0: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
-000064d0: 626c 6163 6b2e 6f75 7470 7574 2e5f 6f75  black.output._ou
-000064e0: 7422 2c20 6f75 7429 2c20 7061 7463 6828  t", out), patch(
-000064f0: 2262 6c61 636b 2e6f 7574 7075 742e 5f65  "black.output._e
-00006500: 7272 222c 2065 7272 293a 0a20 2020 2020  rr", err):.     
-00006510: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-00006520: 6e65 2850 6174 6828 2266 3122 292c 2062  ne(Path("f1"), b
-00006530: 6c61 636b 2e43 6861 6e67 6564 2e4e 4f29  lack.Changed.NO)
-00006540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006550: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00006560: 6e28 6f75 745f 6c69 6e65 7329 2c20 3029  n(out_lines), 0)
-00006570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006580: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00006590: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
-000065a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000065b0: 662e 6173 7365 7274 4571 7561 6c28 756e  f.assertEqual(un
-000065c0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-000065d0: 2929 2c20 2231 2066 696c 6520 6c65 6674  )), "1 file left
-000065e0: 2075 6e63 6861 6e67 6564 2e22 290a 2020   unchanged.").  
-000065f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006600: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-00006610: 742e 7265 7475 726e 5f63 6f64 652c 2030  t.return_code, 0
-00006620: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006630: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-00006640: 6632 2229 2c20 626c 6163 6b2e 4368 616e  f2"), black.Chan
-00006650: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
-00006660: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006670: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00006680: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00006690: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000066a0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-000066b0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-000066c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000066d0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-000066e0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-000066f0: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
-00006700: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
-00006710: 2c20 3120 6669 6c65 206c 6566 7420 756e  , 1 file left un
-00006720: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
-00006730: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006740: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
-00006750: 5061 7468 2822 6633 2229 2c20 626c 6163  Path("f3"), blac
-00006760: 6b2e 4368 616e 6765 642e 4341 4348 4544  k.Changed.CACHED
-00006770: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006780: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00006790: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
-000067a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000067b0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-000067c0: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
-000067d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000067e0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000067f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006800: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00006810: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
-00006820: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-00006830: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00006840: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-00006850: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006860: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00006870: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00006880: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
-00006890: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-000068a0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000068b0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000068c0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-000068d0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
-000068e0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
-000068f0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
-00006900: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
-00006910: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
-00006920: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
-00006930: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006940: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00006950: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00006960: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006970: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00006980: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00006990: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000069a0: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
-000069b0: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
-000069c0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
-000069d0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-000069e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000069f0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006a00: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00006a10: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00006a20: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a40: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
-00006a50: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
-00006a60: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
-00006a70: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
-00006a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a90: 2020 2022 2072 6566 6f72 6d61 742e 220a     " reformat.".
-00006aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ab0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
-00006ac0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006ad0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00006ae0: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
-00006af0: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
-00006b00: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
-00006b10: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
-00006b20: 2e43 6861 6e67 6564 2e59 4553 290a 2020  .Changed.YES).  
-00006b30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006b40: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
-00006b50: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
-00006b60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006b70: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
-00006b80: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
-00006b90: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006ba0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00006bb0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00006bc0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00006bd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006be0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00006bf0: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
-00006c00: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
-00006c10: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
-00006c20: 6e67 6564 2c20 3120 6669 6c65 2066 6169  nged, 1 file fai
-00006c30: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
-00006c40: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00006c50: 666f 726d 6174 2e22 0a20 2020 2020 2020  format.".       
-00006c60: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00006c70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006c80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006c90: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00006ca0: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00006cb0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00006cc0: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
-00006cd0: 6532 2229 2c20 2262 6f6f 6d22 290a 2020  e2"), "boom").  
-00006ce0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006cf0: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
-00006d00: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
-00006d10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006d20: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
-00006d30: 7272 5f6c 696e 6573 292c 2032 290a 2020  rr_lines), 2).  
-00006d40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006d50: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
-00006d60: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
-00006d70: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
-00006d80: 6532 3a20 626f 6f6d 2229 0a20 2020 2020  e2: boom").     
-00006d90: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006da0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00006db0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-00006dc0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00006de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006df0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-00006e00: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-00006e10: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00006e20: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
-00006e30: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00006e40: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
-00006e50: 726d 6174 2e22 0a20 2020 2020 2020 2020  rmat.".         
-00006e60: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00006e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006e80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006e90: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00006ea0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-00006eb0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00006ec0: 2e70 6174 685f 6967 6e6f 7265 6428 5061  .path_ignored(Pa
-00006ed0: 7468 2822 7761 7422 292c 2022 6e6f 206d  th("wat"), "no m
-00006ee0: 6174 6368 2229 0a20 2020 2020 2020 2020  atch").         
-00006ef0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006f00: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-00006f10: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-00006f20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006f30: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00006f40: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
-00006f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006f60: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00006f70: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00006f80: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00006f90: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
-00006fc0: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
-00006fd0: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
-00006fe0: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
-00006ff0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00007000: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00007010: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00007020: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00007030: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007040: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007050: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00007060: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
-00007070: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-00007080: 6528 5061 7468 2822 6634 2229 2c20 626c  e(Path("f4"), bl
-00007090: 6163 6b2e 4368 616e 6765 642e 4e4f 290a  ack.Changed.NO).
-000070a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000070b0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000070c0: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
-000070d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000070e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000070f0: 2865 7272 5f6c 696e 6573 292c 2032 290a  (err_lines), 2).
-00007100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007110: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00007120: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00007130: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-00007140: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00007150: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-00007160: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00007170: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
-00007180: 3320 6669 6c65 7320 6c65 6674 2075 6e63  3 files left unc
-00007190: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
-000071a0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-000071b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000071c0: 2072 6566 6f72 6d61 742e 220a 2020 2020   reformat.".    
-000071d0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-000071e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000071f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00007200: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00007210: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-00007220: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00007230: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
-00007240: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
-00007250: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007270: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00007280: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00007290: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-000072a0: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-000072b0: 6669 6c65 7320 776f 756c 6420 6265 2072  files would be r
-000072c0: 6566 6f72 6d61 7474 6564 2c20 3320 6669  eformatted, 3 fi
-000072d0: 6c65 7320 776f 756c 6420 6265 206c 6566  les would be lef
-000072e0: 7420 756e 6368 616e 6765 642c 2032 220a  t unchanged, 2".
-000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007300: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-00007310: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-00007320: 6174 2e22 0a20 2020 2020 2020 2020 2020  at.".           
-00007330: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00007340: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00007350: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-00007360: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00007370: 2020 2072 6570 6f72 742e 6469 6666 203d     report.diff =
-00007380: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00007390: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000073a0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-000073b0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-000073c0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-000073d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-000073e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073f0: 2232 2066 696c 6573 2077 6f75 6c64 2062  "2 files would b
-00007400: 6520 7265 666f 726d 6174 7465 642c 2033  e reformatted, 3
-00007410: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
-00007420: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-00007430: 3222 0a20 2020 2020 2020 2020 2020 2020  2".             
-00007440: 2020 2020 2020 2022 2066 696c 6573 2077         " files w
-00007450: 6f75 6c64 2066 6169 6c20 746f 2072 6566  ould fail to ref
-00007460: 6f72 6d61 742e 220a 2020 2020 2020 2020  ormat.".        
-00007470: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00007480: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00007490: 6620 7465 7374 5f72 6570 6f72 745f 6e6f  f test_report_no
-000074a0: 726d 616c 2873 656c 6629 202d 3e20 4e6f  rmal(self) -> No
-000074b0: 6e65 3a0a 2020 2020 2020 2020 7265 706f  ne:.        repo
-000074c0: 7274 203d 2062 6c61 636b 2e52 6570 6f72  rt = black.Repor
-000074d0: 7428 290a 2020 2020 2020 2020 6f75 745f  t().        out_
-000074e0: 6c69 6e65 7320 3d20 5b5d 0a20 2020 2020  lines = [].     
-000074f0: 2020 2065 7272 5f6c 696e 6573 203d 205b     err_lines = [
-00007500: 5d0a 0a20 2020 2020 2020 2064 6566 206f  ]..        def o
-00007510: 7574 286d 7367 3a20 7374 722c 202a 2a6b  ut(msg: str, **k
-00007520: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
-00007530: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00007540: 206f 7574 5f6c 696e 6573 2e61 7070 656e   out_lines.appen
-00007550: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
-00007560: 6465 6620 6572 7228 6d73 673a 2073 7472  def err(msg: str
-00007570: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-00007580: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00007590: 2020 2020 2020 6572 725f 6c69 6e65 732e        err_lines.
-000075a0: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
-000075b0: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
-000075c0: 2262 6c61 636b 2e6f 7574 7075 742e 5f6f  "black.output._o
-000075d0: 7574 222c 206f 7574 292c 2070 6174 6368  ut", out), patch
-000075e0: 2822 626c 6163 6b2e 6f75 7470 7574 2e5f  ("black.output._
-000075f0: 6572 7222 2c20 6572 7229 3a0a 2020 2020  err", err):.    
-00007600: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-00007610: 6f6e 6528 5061 7468 2822 6631 2229 2c20  one(Path("f1"), 
-00007620: 626c 6163 6b2e 4368 616e 6765 642e 4e4f  black.Changed.NO
-00007630: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007640: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00007650: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
-00007660: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007670: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00007680: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
-00007690: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000076a0: 6c66 2e61 7373 6572 7445 7175 616c 2875  lf.assertEqual(u
-000076b0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-000076c0: 7429 292c 2022 3120 6669 6c65 206c 6566  t)), "1 file lef
-000076d0: 7420 756e 6368 616e 6765 642e 2229 0a20  t unchanged."). 
-000076e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000076f0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-00007700: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-00007710: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
-00007720: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
-00007730: 2266 3222 292c 2062 6c61 636b 2e43 6861  "f2"), black.Cha
-00007740: 6e67 6564 2e59 4553 290a 2020 2020 2020  nged.YES).      
-00007750: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007760: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00007770: 696e 6573 292c 2031 290a 2020 2020 2020  ines), 1).      
-00007780: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007790: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-000077a0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
-000077b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000077c0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
-000077d0: 5b2d 315d 2c20 2272 6566 6f72 6d61 7474  [-1], "reformatt
-000077e0: 6564 2066 3222 290a 2020 2020 2020 2020  ed f2").        
-000077f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007800: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00007810: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00007820: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
-00007830: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
-00007840: 2031 2066 696c 6520 6c65 6674 2075 6e63   1 file left unc
-00007850: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
-00007860: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00007870: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
-00007880: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
-00007890: 2e43 6861 6e67 6564 2e43 4143 4845 4429  .Changed.CACHED)
-000078a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000078b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000078c0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3129  n(out_lines), 1)
-000078d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000078e0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000078f0: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
-00007900: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007910: 662e 6173 7365 7274 4571 7561 6c28 6f75  f.assertEqual(ou
-00007920: 745f 6c69 6e65 735b 2d31 5d2c 2022 7265  t_lines[-1], "re
-00007930: 666f 726d 6174 7465 6420 6632 2229 0a20  formatted f2"). 
-00007940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007950: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00007960: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00007970: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00007980: 292c 2022 3120 6669 6c65 2072 6566 6f72  ), "1 file refor
-00007990: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
-000079a0: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
-000079b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000079c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000079d0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-000079e0: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-000079f0: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
-00007a00: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
-00007a10: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
-00007a20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007a30: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
-00007a40: 6465 2c20 3129 0a20 2020 2020 2020 2020  de, 1).         
-00007a50: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
-00007a60: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00007a70: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
-00007a80: 6428 5061 7468 2822 6531 2229 2c20 2262  d(Path("e1"), "b
-00007a90: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-00007aa0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007ab0: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00007ac0: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
-00007ad0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007ae0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00007af0: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
-00007b00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007b10: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
-00007b20: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
-00007b30: 2066 6f72 6d61 7420 6531 3a20 626f 6f6d   format e1: boom
-00007b40: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00007b50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007b70: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00007b80: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00007b90: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-00007ba0: 2020 2020 2020 2020 2020 2020 2022 3120               "1 
-00007bb0: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
-00007bc0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00007bd0: 6e63 6861 6e67 6564 2c20 3120 6669 6c65  nchanged, 1 file
-00007be0: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c00: 2220 7265 666f 726d 6174 2e22 0a20 2020  " reformat.".   
-00007c10: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00007c20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00007c30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007c40: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-00007c50: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
-00007c60: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
-00007c70: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-00007c80: 2822 6633 2229 2c20 626c 6163 6b2e 4368  ("f3"), black.Ch
-00007c90: 616e 6765 642e 5945 5329 0a20 2020 2020  anged.YES).     
-00007ca0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007cb0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00007cc0: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00007cd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007ce0: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00007cf0: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-00007d00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007d10: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
-00007d20: 735b 2d31 5d2c 2022 7265 666f 726d 6174  s[-1], "reformat
-00007d30: 7465 6420 6633 2229 0a20 2020 2020 2020  ted f3").       
-00007d40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007d50: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00007d60: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00007d70: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00007d80: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00007d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007da0: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
-00007db0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
-00007dc0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00007dd0: 2031 2066 696c 6520 6661 696c 6564 2074   1 file failed t
-00007de0: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
-00007df0: 2020 2020 2020 2022 2072 6566 6f72 6d61         " reforma
-00007e00: 742e 220a 2020 2020 2020 2020 2020 2020  t.".            
-00007e10: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00007e20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00007e30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007e40: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-00007e50: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
-00007e60: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
-00007e70: 696c 6564 2850 6174 6828 2265 3222 292c  iled(Path("e2"),
-00007e80: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
-00007e90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007ea0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00007eb0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00007ec0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007ed0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00007ee0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00007ef0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007f00: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
-00007f10: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
-00007f20: 6e6f 7420 666f 726d 6174 2065 323a 2062  not format e2: b
-00007f30: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-00007f40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007f50: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00007f60: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00007f70: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00007f80: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fa0: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
-00007fb0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
-00007fc0: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
-00007fd0: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
-00007fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007ff0: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
-00008000: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00008010: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-00008020: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00008030: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008040: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
-00008050: 6465 2c20 3132 3329 0a20 2020 2020 2020  de, 123).       
-00008060: 2020 2020 2072 6570 6f72 742e 7061 7468       report.path
-00008070: 5f69 676e 6f72 6564 2850 6174 6828 2277  _ignored(Path("w
-00008080: 6174 2229 2c20 226e 6f20 6d61 7463 6822  at"), "no match"
-00008090: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000080a0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-000080b0: 656e 286f 7574 5f6c 696e 6573 292c 2032  en(out_lines), 2
-000080c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000080d0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-000080e0: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
-000080f0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00008100: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00008110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008120: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00008130: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-00008140: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-00008150: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00008160: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00008170: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00008180: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
-00008190: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
-000081a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081b0: 2022 2072 6566 6f72 6d61 742e 220a 2020   " reformat.".  
-000081c0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-000081d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000081e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000081f0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-00008200: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-00008210: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
-00008220: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
-00008230: 6828 2266 3422 292c 2062 6c61 636b 2e43  h("f4"), black.C
-00008240: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
-00008250: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008260: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00008270: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00008280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008290: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-000082a0: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-000082b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000082c0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-000082d0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-000082e0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
-000082f0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00008300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008310: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-00008320: 666f 726d 6174 7465 642c 2033 2066 696c  formatted, 3 fil
-00008330: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00008340: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
-00008350: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00008360: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
-00008370: 726d 6174 2e22 0a20 2020 2020 2020 2020  rmat.".         
-00008380: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00008390: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000083a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000083b0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-000083c0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-000083d0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000083e0: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
-000083f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00008400: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00008410: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00008420: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00008430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008440: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00008450: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
-00008460: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
-00008470: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
-00008480: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
-00008490: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
-000084a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000084b0: 2066 696c 6573 2077 6f75 6c64 2066 6169   files would fai
-000084c0: 6c20 746f 2072 6566 6f72 6d61 742e 220a  l to reformat.".
-000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084e0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
-000084f0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00008500: 6f72 742e 6368 6563 6b20 3d20 4661 6c73  ort.check = Fals
-00008510: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-00008520: 706f 7274 2e64 6966 6620 3d20 5472 7565  port.diff = True
-00008530: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008540: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00008550: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00008560: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00008570: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-00008580: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-00008590: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-000085a0: 6c65 7320 776f 756c 6420 6265 2072 6566  les would be ref
-000085b0: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
-000085c0: 7320 776f 756c 6420 6265 206c 6566 7420  s would be left 
-000085d0: 756e 6368 616e 6765 642c 2032 220a 2020  unchanged, 2".  
-000085e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085f0: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
-00008600: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
-00008610: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00008620: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00008630: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-00008640: 745f 6c69 6232 746f 335f 7061 7273 6528  t_lib2to3_parse(
-00008650: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00008660: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00008670: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
-00008680: 6163 6b2e 496e 7661 6c69 6449 6e70 7574  ack.InvalidInput
-00008690: 293a 0a20 2020 2020 2020 2020 2020 2062  ):.            b
-000086a0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-000086b0: 7365 2822 696e 7661 6c69 6420 7379 6e74  se("invalid synt
-000086c0: 6178 2229 0a0a 2020 2020 2020 2020 7374  ax")..        st
-000086d0: 7261 6464 6c69 6e67 203d 2022 7820 2b20  raddling = "x + 
-000086e0: 7922 0a20 2020 2020 2020 2062 6c61 636b  y".        black
-000086f0: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
-00008700: 7472 6164 646c 696e 6729 0a20 2020 2020  traddling).     
-00008710: 2020 2062 6c61 636b 2e6c 6962 3274 6f33     black.lib2to3
-00008720: 5f70 6172 7365 2873 7472 6164 646c 696e  _parse(straddlin
-00008730: 672c 207b 5461 7267 6574 5665 7273 696f  g, {TargetVersio
-00008740: 6e2e 5059 3336 7d29 0a0a 2020 2020 2020  n.PY36})..      
-00008750: 2020 7079 325f 6f6e 6c79 203d 2022 7072    py2_only = "pr
-00008760: 696e 7420 7822 0a20 2020 2020 2020 2077  int x".        w
-00008770: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-00008780: 6169 7365 7328 626c 6163 6b2e 496e 7661  aises(black.Inva
-00008790: 6c69 6449 6e70 7574 293a 0a20 2020 2020  lidInput):.     
-000087a0: 2020 2020 2020 2062 6c61 636b 2e6c 6962         black.lib
-000087b0: 3274 6f33 5f70 6172 7365 2870 7932 5f6f  2to3_parse(py2_o
-000087c0: 6e6c 792c 207b 5461 7267 6574 5665 7273  nly, {TargetVers
-000087d0: 696f 6e2e 5059 3336 7d29 0a0a 2020 2020  ion.PY36})..    
-000087e0: 2020 2020 7079 335f 6f6e 6c79 203d 2022      py3_only = "
-000087f0: 6578 6563 2878 2c20 656e 643d 7929 220a  exec(x, end=y)".
-00008800: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
-00008810: 6232 746f 335f 7061 7273 6528 7079 335f  b2to3_parse(py3_
-00008820: 6f6e 6c79 290a 2020 2020 2020 2020 626c  only).        bl
-00008830: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00008840: 6528 7079 335f 6f6e 6c79 2c20 7b54 6172  e(py3_only, {Tar
-00008850: 6765 7456 6572 7369 6f6e 2e50 5933 367d  getVersion.PY36}
-00008860: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00008870: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00008880: 645f 6465 636f 7261 746f 7228 7365 6c66  d_decorator(self
-00008890: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000088a0: 2020 2023 2054 6573 7420 7468 6520 6665     # Test the fe
-000088b0: 6174 7572 6520 6465 7465 6374 696f 6e20  ature detection 
-000088c0: 6f66 206e 6577 2064 6563 6f72 6174 6f72  of new decorator
-000088d0: 2073 796e 7461 780a 2020 2020 2020 2020   syntax.        
-000088e0: 2320 7369 6e63 6520 7468 6973 206d 616b  # since this mak
-000088f0: 6573 2073 6f6d 6520 7465 7374 2063 6173  es some test cas
-00008900: 6573 206f 6620 7465 7374 5f67 6574 5f66  es of test_get_f
-00008910: 6561 7475 7265 735f 7573 6564 2829 0a20  eatures_used(). 
-00008920: 2020 2020 2020 2023 2066 6169 6c73 2069         # fails i
-00008930: 6620 6974 2066 6169 6c73 2c20 7468 6973  f it fails, this
-00008940: 2069 7320 7465 7374 6564 2066 6972 7374   is tested first
-00008950: 2073 6f20 7468 6174 2061 2075 7365 6675   so that a usefu
-00008960: 6c20 6361 7365 0a20 2020 2020 2020 2023  l case.        #
-00008970: 2069 7320 6964 656e 7469 6669 6564 0a20   is identified. 
-00008980: 2020 2020 2020 2073 696d 706c 6573 2c20         simples, 
-00008990: 7265 6c61 7865 6420 3d20 7265 6164 5f64  relaxed = read_d
-000089a0: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
-000089b0: 7573 222c 2022 6465 636f 7261 746f 7273  us", "decorators
-000089c0: 2229 0a20 2020 2020 2020 2023 2073 6b69  ").        # ski
-000089d0: 7020 6578 706c 616e 6174 696f 6e20 636f  p explanation co
-000089e0: 6d6d 656e 7473 2061 7420 7468 6520 746f  mments at the to
-000089f0: 7020 6f66 2074 6865 2066 696c 650a 2020  p of the file.  
-00008a00: 2020 2020 2020 666f 7220 7369 6d70 6c65        for simple
-00008a10: 5f74 6573 7420 696e 2073 696d 706c 6573  _test in simples
-00008a20: 2e73 706c 6974 2822 2323 2229 5b31 3a5d  .split("##")[1:]
-00008a30: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
-00008a40: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-00008a50: 6f33 5f70 6172 7365 2873 696d 706c 655f  o3_parse(simple_
-00008a60: 7465 7374 290a 2020 2020 2020 2020 2020  test).          
-00008a70: 2020 6465 636f 7261 746f 7220 3d20 7374    decorator = st
-00008a80: 7228 6e6f 6465 2e63 6869 6c64 7265 6e5b  r(node.children[
-00008a90: 305d 2e63 6869 6c64 7265 6e5b 305d 292e  0].children[0]).
-00008aa0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-00008ab0: 2020 2020 7365 6c66 2e61 7373 6572 744e      self.assertN
-00008ac0: 6f74 496e 280a 2020 2020 2020 2020 2020  otIn(.          
-00008ad0: 2020 2020 2020 4665 6174 7572 652e 5245        Feature.RE
-00008ae0: 4c41 5845 445f 4445 434f 5241 544f 5253  LAXED_DECORATORS
-00008af0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008b00: 2020 626c 6163 6b2e 6765 745f 6665 6174    black.get_feat
-00008b10: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00008b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b30: 206d 7367 3d28 0a20 2020 2020 2020 2020   msg=(.         
-00008b40: 2020 2020 2020 2020 2020 2066 2264 6563             f"dec
-00008b50: 6f72 6174 6f72 2027 7b64 6563 6f72 6174  orator '{decorat
-00008b60: 6f72 7d27 2066 6f6c 6c6f 7773 2070 7974  or}' follows pyt
-00008b70: 686f 6e3c 3d33 2e38 2073 796e 7461 7822  hon<=3.8 syntax"
-00008b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b90: 2020 2020 2022 6275 7420 6973 2064 6574       "but is det
-00008ba0: 6563 7465 6420 6173 2033 2e39 2b22 0a20  ected as 3.9+". 
+00005ac0: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00005ad0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00005ae0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005af0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00005b00: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
+00005b10: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00005b20: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+00005b30: 3322 292c 2062 6c61 636b 2e43 6861 6e67  3"), black.Chang
+00005b40: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
+00005b50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005b60: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00005b70: 6573 292c 2034 290a 2020 2020 2020 2020  es), 4).        
+00005b80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005b90: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00005ba0: 6573 292c 2031 290a 2020 2020 2020 2020  es), 1).        
+00005bb0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005bc0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00005bd0: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
+00005be0: 2066 3322 290a 2020 2020 2020 2020 2020   f3").          
+00005bf0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005c00: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00005c10: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00005c20: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00005c30: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00005c40: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00005c50: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00005c60: 6861 6e67 6564 2c20 3120 6669 6c65 2066  hanged, 1 file f
+00005c70: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
+00005c80: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
+00005c90: 726d 6174 2e22 2c0a 2020 2020 2020 2020  rmat.",.        
+00005ca0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00005cb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005cc0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+00005cd0: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
+00005ce0: 2020 2020 2020 2020 7265 706f 7274 2e66          report.f
+00005cf0: 6169 6c65 6428 5061 7468 2822 6532 2229  ailed(Path("e2")
+00005d00: 2c20 2262 6f6f 6d22 290a 2020 2020 2020  , "boom").      
+00005d10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005d20: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00005d30: 696e 6573 292c 2034 290a 2020 2020 2020  ines), 4).      
+00005d40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005d50: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00005d60: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
+00005d70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005d80: 7445 7175 616c 2865 7272 5f6c 696e 6573  tEqual(err_lines
+00005d90: 5b2d 315d 2c20 2265 7272 6f72 3a20 6361  [-1], "error: ca
+00005da0: 6e6e 6f74 2066 6f72 6d61 7420 6532 3a20  nnot format e2: 
+00005db0: 626f 6f6d 2229 0a20 2020 2020 2020 2020  boom").         
+00005dc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005dd0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00005de0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00005df0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00005e00: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00005e10: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00005e20: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00005e30: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
+00005e40: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+00005e50: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+00005e60: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+00005e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00005e80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005e90: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00005ea0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00005eb0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00005ec0: 2e70 6174 685f 6967 6e6f 7265 6428 5061  .path_ignored(Pa
+00005ed0: 7468 2822 7761 7422 292c 2022 6e6f 206d  th("wat"), "no m
+00005ee0: 6174 6368 2229 0a20 2020 2020 2020 2020  atch").         
+00005ef0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005f00: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00005f10: 7329 2c20 3529 0a20 2020 2020 2020 2020  s), 5).         
+00005f20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005f30: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00005f40: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+00005f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005f60: 7561 6c28 6f75 745f 6c69 6e65 735b 2d31  ual(out_lines[-1
+00005f70: 5d2c 2022 7761 7420 6967 6e6f 7265 643a  ], "wat ignored:
+00005f80: 206e 6f20 6d61 7463 6822 290a 2020 2020   no match").    
+00005f90: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005fa0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00005fb0: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00005fc0: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fe0: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
+00005ff0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
+00006000: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
+00006010: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
+00006020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006030: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
+00006040: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00006050: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006060: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00006070: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00006080: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00006090: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
+000060a0: 2266 3422 292c 2062 6c61 636b 2e43 6861  "f4"), black.Cha
+000060b0: 6e67 6564 2e4e 4f29 0a20 2020 2020 2020  nged.NO).       
+000060c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000060d0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+000060e0: 6e65 7329 2c20 3629 0a20 2020 2020 2020  nes), 6).       
+000060f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006100: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00006110: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00006120: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006130: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
+00006140: 2d31 5d2c 2022 6634 2061 6c72 6561 6479  -1], "f4 already
+00006150: 2077 656c 6c20 666f 726d 6174 7465 642c   well formatted,
+00006160: 2067 6f6f 6420 6a6f 622e 2229 0a20 2020   good job.").   
+00006170: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006180: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00006190: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+000061a0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+000061b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000061c0: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
+000061d0: 6174 7465 642c 2033 2066 696c 6573 206c  atted, 3 files l
+000061e0: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+000061f0: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
+00006200: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006210: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+00006220: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00006230: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006240: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00006250: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+00006260: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+00006270: 7265 706f 7274 2e63 6865 636b 203d 2054  report.check = T
+00006280: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00006290: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000062a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000062b0: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+000062c0: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+000062d0: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+000062e0: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
+000062f0: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
+00006300: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
+00006310: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
+00006320: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
+00006330: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
+00006340: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00006350: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00006360: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+00006370: 6563 6b20 3d20 4661 6c73 650a 2020 2020  eck = False.    
+00006380: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+00006390: 6966 6620 3d20 5472 7565 0a20 2020 2020  iff = True.     
+000063a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000063b0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000063c0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+000063d0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+000063e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000063f0: 3220 6669 6c65 7320 776f 756c 6420 6265  2 files would be
+00006400: 2072 6566 6f72 6d61 7474 6564 2c20 3320   reformatted, 3 
+00006410: 6669 6c65 7320 776f 756c 6420 6265 206c  files would be l
+00006420: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+00006430: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006440: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
+00006450: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
+00006460: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00006470: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00006480: 7265 706f 7274 5f71 7569 6574 2873 656c  report_quiet(sel
+00006490: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000064a0: 2020 2020 7265 706f 7274 203d 2052 6570      report = Rep
+000064b0: 6f72 7428 7175 6965 743d 5472 7565 290a  ort(quiet=True).
+000064c0: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
+000064d0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
+000064e0: 7272 5f6c 696e 6573 203d 205b 5d0a 0a20  rr_lines = [].. 
+000064f0: 2020 2020 2020 2064 6566 206f 7574 286d         def out(m
+00006500: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
+00006510: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
+00006520: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00006530: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
+00006540: 6729 0a0a 2020 2020 2020 2020 6465 6620  g)..        def 
+00006550: 6572 7228 6d73 673a 2073 7472 2c20 2a2a  err(msg: str, **
+00006560: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
+00006570: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006580: 2020 6572 725f 6c69 6e65 732e 6170 7065    err_lines.appe
+00006590: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
+000065a0: 2077 6974 6820 7061 7463 6828 2262 6c61   with patch("bla
+000065b0: 636b 2e6f 7574 7075 742e 5f6f 7574 222c  ck.output._out",
+000065c0: 206f 7574 292c 2070 6174 6368 2822 626c   out), patch("bl
+000065d0: 6163 6b2e 6f75 7470 7574 2e5f 6572 7222  ack.output._err"
+000065e0: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
+000065f0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00006600: 5061 7468 2822 6631 2229 2c20 626c 6163  Path("f1"), blac
+00006610: 6b2e 4368 616e 6765 642e 4e4f 290a 2020  k.Changed.NO).  
+00006620: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006630: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00006640: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+00006650: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006660: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00006670: 7272 5f6c 696e 6573 292c 2030 290a 2020  rr_lines), 0).  
+00006680: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006690: 7373 6572 7445 7175 616c 2875 6e73 7479  ssertEqual(unsty
+000066a0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+000066b0: 2022 3120 6669 6c65 206c 6566 7420 756e   "1 file left un
+000066c0: 6368 616e 6765 642e 2229 0a20 2020 2020  changed.").     
+000066d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000066e0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+000066f0: 6574 7572 6e5f 636f 6465 2c20 3029 0a20  eturn_code, 0). 
+00006700: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00006710: 742e 646f 6e65 2850 6174 6828 2266 3222  t.done(Path("f2"
+00006720: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
+00006730: 2e59 4553 290a 2020 2020 2020 2020 2020  .YES).          
+00006740: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006750: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00006760: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
+00006770: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006780: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00006790: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
+000067a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000067b0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+000067c0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+000067d0: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
+000067e0: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
+000067f0: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+00006800: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
+00006810: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00006820: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+00006830: 6828 2266 3322 292c 2062 6c61 636b 2e43  h("f3"), black.C
+00006840: 6861 6e67 6564 2e43 4143 4845 4429 0a20  hanged.CACHED). 
+00006850: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006860: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006870: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
+00006880: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006890: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000068a0: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
+000068b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000068c0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+000068d0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+000068e0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+000068f0: 292c 2022 3120 6669 6c65 2072 6566 6f72  ), "1 file refor
+00006900: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00006910: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+00006920: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00006930: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006940: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00006950: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00006960: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
+00006970: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00006980: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00006990: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000069a0: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
+000069b0: 6465 2c20 3129 0a20 2020 2020 2020 2020  de, 1).         
+000069c0: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
+000069d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000069e0: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
+000069f0: 6428 5061 7468 2822 6531 2229 2c20 2262  d(Path("e1"), "b
+00006a00: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+00006a10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006a20: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00006a30: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
+00006a40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006a50: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00006a60: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
+00006a70: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006a80: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
+00006a90: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
+00006aa0: 2066 6f72 6d61 7420 6531 3a20 626f 6f6d   format e1: boom
+00006ab0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00006ac0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ae0: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00006af0: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00006b00: 2020 2020 2020 2022 3120 6669 6c65 2072         "1 file r
+00006b10: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
+00006b20: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
+00006b30: 6564 2c20 3120 6669 6c65 2066 6169 6c65  ed, 1 file faile
+00006b40: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00006b50: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00006b60: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00006b70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006b80: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00006b90: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00006ba0: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
+00006bb0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00006bc0: 5061 7468 2822 6633 2229 2c20 626c 6163  Path("f3"), blac
+00006bd0: 6b2e 4368 616e 6765 642e 5945 5329 0a20  k.Changed.YES). 
+00006be0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006bf0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006c00: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
+00006c10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006c20: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006c30: 6572 725f 6c69 6e65 7329 2c20 3129 0a20  err_lines), 1). 
+00006c40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006c50: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006c60: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006c70: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006c80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006c90: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00006ca0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00006cb0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00006cc0: 2031 2066 696c 6520 6661 696c 6564 2074   1 file failed t
+00006cd0: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
+00006ce0: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
+00006cf0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00006d00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006d10: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00006d20: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00006d30: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+00006d40: 2072 6570 6f72 742e 6661 696c 6564 2850   report.failed(P
+00006d50: 6174 6828 2265 3222 292c 2022 626f 6f6d  ath("e2"), "boom
+00006d60: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00006d70: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006d80: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00006d90: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00006da0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006db0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00006dc0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+00006dd0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006de0: 6572 725f 6c69 6e65 735b 2d31 5d2c 2022  err_lines[-1], "
+00006df0: 6572 726f 723a 2063 616e 6e6f 7420 666f  error: cannot fo
+00006e00: 726d 6174 2065 323a 2062 6f6f 6d22 290a  rmat e2: boom").
+00006e10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006e20: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00006e30: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00006e40: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+00006e50: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00006e60: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
+00006e70: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+00006e80: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+00006e90: 2c20 3220 6669 6c65 7320 6661 696c 6564  , 2 files failed
+00006ea0: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
+00006eb0: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
+00006ec0: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00006ed0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006ee0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00006ef0: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00006f00: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
+00006f10: 2020 2072 6570 6f72 742e 7061 7468 5f69     report.path_i
+00006f20: 676e 6f72 6564 2850 6174 6828 2277 6174  gnored(Path("wat
+00006f30: 2229 2c20 226e 6f20 6d61 7463 6822 290a  "), "no match").
+00006f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006f50: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00006f60: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
+00006f70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006f80: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00006f90: 2865 7272 5f6c 696e 6573 292c 2032 290a  (err_lines), 2).
+00006fa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006fb0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00006fc0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00006fd0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+00006fe0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00006ff0: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
+00007000: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+00007010: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+00007020: 2c20 3220 6669 6c65 7320 6661 696c 6564  , 2 files failed
+00007030: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
+00007040: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
+00007050: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00007060: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007070: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00007080: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00007090: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
+000070a0: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+000070b0: 6174 6828 2266 3422 292c 2062 6c61 636b  ath("f4"), black
+000070c0: 2e43 6861 6e67 6564 2e4e 4f29 0a20 2020  .Changed.NO).   
+000070d0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000070e0: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+000070f0: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
+00007100: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007110: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+00007120: 725f 6c69 6e65 7329 2c20 3229 0a20 2020  r_lines), 2).   
+00007130: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007140: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00007150: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00007160: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00007170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007180: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
+00007190: 6174 7465 642c 2033 2066 696c 6573 206c  atted, 3 files l
+000071a0: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+000071b0: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
+000071c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000071d0: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+000071e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000071f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007200: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00007210: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+00007220: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+00007230: 7265 706f 7274 2e63 6865 636b 203d 2054  report.check = T
+00007240: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00007250: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007260: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00007270: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+00007280: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+00007290: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+000072a0: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
+000072b0: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
+000072c0: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
+000072d0: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
+000072e0: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
+000072f0: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
+00007300: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00007310: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00007320: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+00007330: 6563 6b20 3d20 4661 6c73 650a 2020 2020  eck = False.    
+00007340: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+00007350: 6966 6620 3d20 5472 7565 0a20 2020 2020  iff = True.     
+00007360: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007370: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00007380: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00007390: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+000073a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000073b0: 3220 6669 6c65 7320 776f 756c 6420 6265  2 files would be
+000073c0: 2072 6566 6f72 6d61 7474 6564 2c20 3320   reformatted, 3 
+000073d0: 6669 6c65 7320 776f 756c 6420 6265 206c  files would be l
+000073e0: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+000073f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00007400: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
+00007410: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
+00007420: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00007430: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00007440: 7265 706f 7274 5f6e 6f72 6d61 6c28 7365  report_normal(se
+00007450: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00007460: 2020 2020 2072 6570 6f72 7420 3d20 626c       report = bl
+00007470: 6163 6b2e 5265 706f 7274 2829 0a20 2020  ack.Report().   
+00007480: 2020 2020 206f 7574 5f6c 696e 6573 203d       out_lines =
+00007490: 205b 5d0a 2020 2020 2020 2020 6572 725f   [].        err_
+000074a0: 6c69 6e65 7320 3d20 5b5d 0a0a 2020 2020  lines = []..    
+000074b0: 2020 2020 6465 6620 6f75 7428 6d73 673a      def out(msg:
+000074c0: 2073 7472 2c20 2a2a 6b77 6172 6773 3a20   str, **kwargs: 
+000074d0: 416e 7929 202d 3e20 4e6f 6e65 3a0a 2020  Any) -> None:.  
+000074e0: 2020 2020 2020 2020 2020 6f75 745f 6c69            out_li
+000074f0: 6e65 732e 6170 7065 6e64 286d 7367 290a  nes.append(msg).
+00007500: 0a20 2020 2020 2020 2064 6566 2065 7272  .        def err
+00007510: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
+00007520: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
+00007530: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+00007540: 7272 5f6c 696e 6573 2e61 7070 656e 6428  rr_lines.append(
+00007550: 6d73 6729 0a0a 2020 2020 2020 2020 7769  msg)..        wi
+00007560: 7468 2070 6174 6368 2822 626c 6163 6b2e  th patch("black.
+00007570: 6f75 7470 7574 2e5f 6f75 7422 2c20 6f75  output._out", ou
+00007580: 7429 2c20 7061 7463 6828 2262 6c61 636b  t), patch("black
+00007590: 2e6f 7574 7075 742e 5f65 7272 222c 2065  .output._err", e
+000075a0: 7272 293a 0a20 2020 2020 2020 2020 2020  rr):.           
+000075b0: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+000075c0: 6828 2266 3122 292c 2062 6c61 636b 2e43  h("f1"), black.C
+000075d0: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
+000075e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000075f0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
+00007600: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
+00007610: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007620: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
+00007630: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
+00007640: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007650: 7274 4571 7561 6c28 756e 7374 796c 6528  rtEqual(unstyle(
+00007660: 7374 7228 7265 706f 7274 2929 2c20 2231  str(report)), "1
+00007670: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+00007680: 6e67 6564 2e22 290a 2020 2020 2020 2020  nged.").        
+00007690: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000076a0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+000076b0: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
+000076c0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+000076d0: 6f6e 6528 5061 7468 2822 6632 2229 2c20  one(Path("f2"), 
+000076e0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
+000076f0: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
+00007700: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007710: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00007720: 3129 0a20 2020 2020 2020 2020 2020 2073  1).            s
+00007730: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007740: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00007750: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00007760: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007770: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
+00007780: 7265 666f 726d 6174 7465 6420 6632 2229  reformatted f2")
+00007790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000077a0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+000077b0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000077c0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+000077d0: 7429 292c 2022 3120 6669 6c65 2072 6566  t)), "1 file ref
+000077e0: 6f72 6d61 7474 6564 2c20 3120 6669 6c65  ormatted, 1 file
+000077f0: 206c 6566 7420 756e 6368 616e 6765 642e   left unchanged.
+00007800: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00007810: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00007820: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
+00007830: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
+00007840: 642e 4341 4348 4544 290a 2020 2020 2020  d.CACHED).      
+00007850: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007860: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00007870: 696e 6573 292c 2031 290a 2020 2020 2020  ines), 1).      
+00007880: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007890: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+000078a0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+000078b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000078c0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
+000078d0: 5b2d 315d 2c20 2272 6566 6f72 6d61 7474  [-1], "reformatt
+000078e0: 6564 2066 3222 290a 2020 2020 2020 2020  ed f2").        
+000078f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007900: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00007910: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
+00007920: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
+00007930: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
+00007940: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00007950: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
+00007960: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007970: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007980: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00007990: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
+000079a0: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
+000079b0: 6865 636b 203d 2054 7275 650a 2020 2020  heck = True.    
+000079c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000079d0: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+000079e0: 7265 7475 726e 5f63 6f64 652c 2031 290a  return_code, 1).
+000079f0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00007a00: 7274 2e63 6865 636b 203d 2046 616c 7365  rt.check = False
+00007a10: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00007a20: 6f72 742e 6661 696c 6564 2850 6174 6828  ort.failed(Path(
+00007a30: 2265 3122 292c 2022 626f 6f6d 2229 0a20  "e1"), "boom"). 
+00007a40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007a50: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00007a60: 6f75 745f 6c69 6e65 7329 2c20 3129 0a20  out_lines), 1). 
+00007a70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007a80: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00007a90: 6572 725f 6c69 6e65 7329 2c20 3129 0a20  err_lines), 1). 
+00007aa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007ab0: 6173 7365 7274 4571 7561 6c28 6572 725f  assertEqual(err_
+00007ac0: 6c69 6e65 735b 2d31 5d2c 2022 6572 726f  lines[-1], "erro
+00007ad0: 723a 2063 616e 6e6f 7420 666f 726d 6174  r: cannot format
+00007ae0: 2065 313a 2062 6f6f 6d22 290a 2020 2020   e1: boom").    
+00007af0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00007b00: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00007b10: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00007b20: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b40: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
+00007b50: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
+00007b60: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
+00007b70: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
+00007b80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00007b90: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00007ba0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00007bb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007bc0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00007bd0: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
+00007be0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00007bf0: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+00007c00: 3322 292c 2062 6c61 636b 2e43 6861 6e67  3"), black.Chang
+00007c10: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
+00007c20: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007c30: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00007c40: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
+00007c50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007c60: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00007c70: 6573 292c 2031 290a 2020 2020 2020 2020  es), 1).        
+00007c80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007c90: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00007ca0: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
+00007cb0: 2066 3322 290a 2020 2020 2020 2020 2020   f3").          
+00007cc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007cd0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00007ce0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00007cf0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00007d00: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00007d10: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00007d20: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00007d30: 6861 6e67 6564 2c20 3120 6669 6c65 2066  hanged, 1 file f
+00007d40: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
+00007d50: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
+00007d60: 726d 6174 2e22 2c0a 2020 2020 2020 2020  rmat.",.        
+00007d70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00007d80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007d90: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+00007da0: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
+00007db0: 2020 2020 2020 2020 7265 706f 7274 2e66          report.f
+00007dc0: 6169 6c65 6428 5061 7468 2822 6532 2229  ailed(Path("e2")
+00007dd0: 2c20 2262 6f6f 6d22 290a 2020 2020 2020  , "boom").      
+00007de0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007df0: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00007e00: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
+00007e10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007e20: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00007e30: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
+00007e40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007e50: 7445 7175 616c 2865 7272 5f6c 696e 6573  tEqual(err_lines
+00007e60: 5b2d 315d 2c20 2265 7272 6f72 3a20 6361  [-1], "error: ca
+00007e70: 6e6e 6f74 2066 6f72 6d61 7420 6532 3a20  nnot format e2: 
+00007e80: 626f 6f6d 2229 0a20 2020 2020 2020 2020  boom").         
+00007e90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007ea0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00007eb0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00007ec0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00007ed0: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00007ee0: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00007ef0: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00007f00: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
+00007f10: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+00007f20: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+00007f30: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+00007f40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007f50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007f60: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00007f70: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00007f80: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00007f90: 2e70 6174 685f 6967 6e6f 7265 6428 5061  .path_ignored(Pa
+00007fa0: 7468 2822 7761 7422 292c 2022 6e6f 206d  th("wat"), "no m
+00007fb0: 6174 6368 2229 0a20 2020 2020 2020 2020  atch").         
+00007fc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007fd0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00007fe0: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+00007ff0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00008000: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00008010: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+00008020: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00008030: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00008040: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00008050: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00008060: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00008070: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00008080: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00008090: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
+000080a0: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+000080b0: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+000080c0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+000080d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000080e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000080f0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00008100: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00008110: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00008120: 2e64 6f6e 6528 5061 7468 2822 6634 2229  .done(Path("f4")
+00008130: 2c20 626c 6163 6b2e 4368 616e 6765 642e  , black.Changed.
+00008140: 4e4f 290a 2020 2020 2020 2020 2020 2020  NO).            
+00008150: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008160: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
+00008170: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00008180: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008190: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
+000081a0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+000081b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000081c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000081d0: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+000081e0: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+000081f0: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00008200: 2072 6566 6f72 6d61 7474 6564 2c20 3320   reformatted, 3 
+00008210: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
+00008220: 6e67 6564 2c20 3220 6669 6c65 7320 6661  nged, 2 files fa
+00008230: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00008240: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00008250: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00008260: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00008270: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008280: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+00008290: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+000082a0: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+000082b0: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
+000082c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000082d0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000082e0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+000082f0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00008300: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00008310: 3220 6669 6c65 7320 776f 756c 6420 6265  2 files would be
+00008320: 2072 6566 6f72 6d61 7474 6564 2c20 3320   reformatted, 3 
+00008330: 6669 6c65 7320 776f 756c 6420 6265 206c  files would be l
+00008340: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+00008350: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00008360: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
+00008370: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
+00008380: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00008390: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000083a0: 706f 7274 2e63 6865 636b 203d 2046 616c  port.check = Fal
+000083b0: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
+000083c0: 6570 6f72 742e 6469 6666 203d 2054 7275  eport.diff = Tru
+000083d0: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+000083e0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+000083f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008400: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00008410: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
+00008420: 2020 2020 2020 2232 2066 696c 6573 2077        "2 files w
+00008430: 6f75 6c64 2062 6520 7265 666f 726d 6174  ould be reformat
+00008440: 7465 642c 2033 2066 696c 6573 2077 6f75  ted, 3 files wou
+00008450: 6c64 2062 6520 6c65 6674 2075 6e63 6861  ld be left uncha
+00008460: 6e67 6564 2c20 3222 0a20 2020 2020 2020  nged, 2".       
+00008470: 2020 2020 2020 2020 2022 2066 696c 6573           " files
+00008480: 2077 6f75 6c64 2066 6169 6c20 746f 2072   would fail to r
+00008490: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
+000084a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000084b0: 6620 7465 7374 5f6c 6962 3274 6f33 5f70  f test_lib2to3_p
+000084c0: 6172 7365 2873 656c 6629 202d 3e20 4e6f  arse(self) -> No
+000084d0: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+000084e0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+000084f0: 6573 2862 6c61 636b 2e49 6e76 616c 6964  es(black.Invalid
+00008500: 496e 7075 7429 3a0a 2020 2020 2020 2020  Input):.        
+00008510: 2020 2020 626c 6163 6b2e 6c69 6232 746f      black.lib2to
+00008520: 335f 7061 7273 6528 2269 6e76 616c 6964  3_parse("invalid
+00008530: 2073 796e 7461 7822 290a 0a20 2020 2020   syntax")..     
+00008540: 2020 2073 7472 6164 646c 696e 6720 3d20     straddling = 
+00008550: 2278 202b 2079 220a 2020 2020 2020 2020  "x + y".        
+00008560: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00008570: 7273 6528 7374 7261 6464 6c69 6e67 290a  rse(straddling).
+00008580: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
+00008590: 6232 746f 335f 7061 7273 6528 7374 7261  b2to3_parse(stra
+000085a0: 6464 6c69 6e67 2c20 7b54 6172 6765 7456  ddling, {TargetV
+000085b0: 6572 7369 6f6e 2e50 5933 367d 290a 0a20  ersion.PY36}).. 
+000085c0: 2020 2020 2020 2070 7932 5f6f 6e6c 7920         py2_only 
+000085d0: 3d20 2270 7269 6e74 2078 220a 2020 2020  = "print x".    
+000085e0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+000085f0: 7365 7274 5261 6973 6573 2862 6c61 636b  sertRaises(black
+00008600: 2e49 6e76 616c 6964 496e 7075 7429 3a0a  .InvalidInput):.
+00008610: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00008620: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+00008630: 7079 325f 6f6e 6c79 2c20 7b54 6172 6765  py2_only, {Targe
+00008640: 7456 6572 7369 6f6e 2e50 5933 367d 290a  tVersion.PY36}).
+00008650: 0a20 2020 2020 2020 2070 7933 5f6f 6e6c  .        py3_onl
+00008660: 7920 3d20 2265 7865 6328 782c 2065 6e64  y = "exec(x, end
+00008670: 3d79 2922 0a20 2020 2020 2020 2062 6c61  =y)".        bla
+00008680: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00008690: 2870 7933 5f6f 6e6c 7929 0a20 2020 2020  (py3_only).     
+000086a0: 2020 2062 6c61 636b 2e6c 6962 3274 6f33     black.lib2to3
+000086b0: 5f70 6172 7365 2870 7933 5f6f 6e6c 792c  _parse(py3_only,
+000086c0: 207b 5461 7267 6574 5665 7273 696f 6e2e   {TargetVersion.
+000086d0: 5059 3336 7d29 0a0a 2020 2020 6465 6620  PY36})..    def 
+000086e0: 7465 7374 5f67 6574 5f66 6561 7475 7265  test_get_feature
+000086f0: 735f 7573 6564 5f64 6563 6f72 6174 6f72  s_used_decorator
+00008700: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00008710: 2020 2020 2020 2020 2320 5465 7374 2074          # Test t
+00008720: 6865 2066 6561 7475 7265 2064 6574 6563  he feature detec
+00008730: 7469 6f6e 206f 6620 6e65 7720 6465 636f  tion of new deco
+00008740: 7261 746f 7220 7379 6e74 6178 0a20 2020  rator syntax.   
+00008750: 2020 2020 2023 2073 696e 6365 2074 6869       # since thi
+00008760: 7320 6d61 6b65 7320 736f 6d65 2074 6573  s makes some tes
+00008770: 7420 6361 7365 7320 6f66 2074 6573 745f  t cases of test_
+00008780: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00008790: 6428 290a 2020 2020 2020 2020 2320 6661  d().        # fa
+000087a0: 696c 7320 6966 2069 7420 6661 696c 732c  ils if it fails,
+000087b0: 2074 6869 7320 6973 2074 6573 7465 6420   this is tested 
+000087c0: 6669 7273 7420 736f 2074 6861 7420 6120  first so that a 
+000087d0: 7573 6566 756c 2063 6173 650a 2020 2020  useful case.    
+000087e0: 2020 2020 2320 6973 2069 6465 6e74 6966      # is identif
+000087f0: 6965 640a 2020 2020 2020 2020 7369 6d70  ied.        simp
+00008800: 6c65 732c 2072 656c 6178 6564 203d 2072  les, relaxed = r
+00008810: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+00008820: 6c61 6e65 6f75 7322 2c20 2264 6563 6f72  laneous", "decor
+00008830: 6174 6f72 7322 290a 2020 2020 2020 2020  ators").        
+00008840: 2320 736b 6970 2065 7870 6c61 6e61 7469  # skip explanati
+00008850: 6f6e 2063 6f6d 6d65 6e74 7320 6174 2074  on comments at t
+00008860: 6865 2074 6f70 206f 6620 7468 6520 6669  he top of the fi
+00008870: 6c65 0a20 2020 2020 2020 2066 6f72 2073  le.        for s
+00008880: 696d 706c 655f 7465 7374 2069 6e20 7369  imple_test in si
+00008890: 6d70 6c65 732e 7370 6c69 7428 2223 2322  mples.split("##"
+000088a0: 295b 313a 5d3a 0a20 2020 2020 2020 2020  )[1:]:.         
+000088b0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
+000088c0: 6c69 6232 746f 335f 7061 7273 6528 7369  lib2to3_parse(si
+000088d0: 6d70 6c65 5f74 6573 7429 0a20 2020 2020  mple_test).     
+000088e0: 2020 2020 2020 2064 6563 6f72 6174 6f72         decorator
+000088f0: 203d 2073 7472 286e 6f64 652e 6368 696c   = str(node.chil
+00008900: 6472 656e 5b30 5d2e 6368 696c 6472 656e  dren[0].children
+00008910: 5b30 5d29 2e73 7472 6970 2829 0a20 2020  [0]).strip().   
+00008920: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00008930: 7365 7274 4e6f 7449 6e28 0a20 2020 2020  sertNotIn(.     
+00008940: 2020 2020 2020 2020 2020 2046 6561 7475             Featu
+00008950: 7265 2e52 454c 4158 4544 5f44 4543 4f52  re.RELAXED_DECOR
+00008960: 4154 4f52 532c 0a20 2020 2020 2020 2020  ATORS,.         
+00008970: 2020 2020 2020 2062 6c61 636b 2e67 6574         black.get
+00008980: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00008990: 6f64 6529 2c0a 2020 2020 2020 2020 2020  ode),.          
+000089a0: 2020 2020 2020 6d73 673d 280a 2020 2020        msg=(.    
+000089b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089c0: 6622 6465 636f 7261 746f 7220 277b 6465  f"decorator '{de
+000089d0: 636f 7261 746f 727d 2720 666f 6c6c 6f77  corator}' follow
+000089e0: 7320 7079 7468 6f6e 3c3d 332e 3820 7379  s python<=3.8 sy
+000089f0: 6e74 6178 220a 2020 2020 2020 2020 2020  ntax".          
+00008a00: 2020 2020 2020 2020 2020 2262 7574 2069            "but i
+00008a10: 7320 6465 7465 6374 6564 2061 7320 332e  s detected as 3.
+00008a20: 392b 220a 2020 2020 2020 2020 2020 2020  9+".            
+00008a30: 2020 2020 2020 2020 2320 6622 5468 6520          # f"The 
+00008a40: 6675 6c6c 206e 6f64 6520 6973 5c6e 7b6e  full node is\n{n
+00008a50: 6f64 6521 727d 220a 2020 2020 2020 2020  ode!r}".        
+00008a60: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00008a70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00008a80: 2023 2073 6b69 7020 7468 6520 2723 206f   # skip the '# o
+00008a90: 7574 7075 7427 2063 6f6d 6d65 6e74 2061  utput' comment a
+00008aa0: 7420 7468 6520 746f 7020 6f66 2074 6865  t the top of the
+00008ab0: 206f 7574 7075 7420 7061 7274 0a20 2020   output part.   
+00008ac0: 2020 2020 2066 6f72 2072 656c 6178 6564       for relaxed
+00008ad0: 5f74 6573 7420 696e 2072 656c 6178 6564  _test in relaxed
+00008ae0: 2e73 706c 6974 2822 2323 2229 5b31 3a5d  .split("##")[1:]
+00008af0: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
+00008b00: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00008b10: 6f33 5f70 6172 7365 2872 656c 6178 6564  o3_parse(relaxed
+00008b20: 5f74 6573 7429 0a20 2020 2020 2020 2020  _test).         
+00008b30: 2020 2064 6563 6f72 6174 6f72 203d 2073     decorator = s
+00008b40: 7472 286e 6f64 652e 6368 696c 6472 656e  tr(node.children
+00008b50: 5b30 5d2e 6368 696c 6472 656e 5b30 5d29  [0].children[0])
+00008b60: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00008b70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008b80: 496e 280a 2020 2020 2020 2020 2020 2020  In(.            
+00008b90: 2020 2020 4665 6174 7572 652e 5245 4c41      Feature.RELA
+00008ba0: 5845 445f 4445 434f 5241 544f 5253 2c0a  XED_DECORATORS,.
 00008bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bc0: 2020 2023 2066 2254 6865 2066 756c 6c20     # f"The full 
-00008bd0: 6e6f 6465 2069 735c 6e7b 6e6f 6465 2172  node is\n{node!r
-00008be0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-00008bf0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00008c00: 2020 290a 2020 2020 2020 2020 2320 736b    ).        # sk
-00008c10: 6970 2074 6865 2027 2320 6f75 7470 7574  ip the '# output
-00008c20: 2720 636f 6d6d 656e 7420 6174 2074 6865  ' comment at the
-00008c30: 2074 6f70 206f 6620 7468 6520 6f75 7470   top of the outp
-00008c40: 7574 2070 6172 740a 2020 2020 2020 2020  ut part.        
-00008c50: 666f 7220 7265 6c61 7865 645f 7465 7374  for relaxed_test
-00008c60: 2069 6e20 7265 6c61 7865 642e 7370 6c69   in relaxed.spli
-00008c70: 7428 2223 2322 295b 313a 5d3a 0a20 2020  t("##")[1:]:.   
-00008c80: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
-00008c90: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00008ca0: 7273 6528 7265 6c61 7865 645f 7465 7374  rse(relaxed_test
-00008cb0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008cc0: 636f 7261 746f 7220 3d20 7374 7228 6e6f  corator = str(no
-00008cd0: 6465 2e63 6869 6c64 7265 6e5b 305d 2e63  de.children[0].c
-00008ce0: 6869 6c64 7265 6e5b 305d 292e 7374 7269  hildren[0]).stri
-00008cf0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00008d00: 7365 6c66 2e61 7373 6572 7449 6e28 0a20  self.assertIn(. 
-00008d10: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-00008d20: 6561 7475 7265 2e52 454c 4158 4544 5f44  eature.RELAXED_D
-00008d30: 4543 4f52 4154 4f52 532c 0a20 2020 2020  ECORATORS,.     
-00008d40: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00008d50: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-00008d60: 6564 286e 6f64 6529 2c0a 2020 2020 2020  ed(node),.      
-00008d70: 2020 2020 2020 2020 2020 6d73 673d 280a            msg=(.
-00008d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d90: 2020 2020 6622 6465 636f 7261 746f 7220      f"decorator 
-00008da0: 277b 6465 636f 7261 746f 727d 2720 7573  '{decorator}' us
-00008db0: 6573 2070 7974 686f 6e33 2e39 2b20 7379  es python3.9+ sy
-00008dc0: 6e74 6178 220a 2020 2020 2020 2020 2020  ntax".          
-00008dd0: 2020 2020 2020 2020 2020 2262 7574 2069            "but i
-00008de0: 7320 6465 7465 6374 6564 2061 7320 7079  s detected as py
-00008df0: 7468 6f6e 3c3d 332e 3822 0a20 2020 2020  thon<=3.8".     
-00008e00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00008e10: 2066 2254 6865 2066 756c 6c20 6e6f 6465   f"The full node
-00008e20: 2069 735c 6e7b 6e6f 6465 2172 7d22 0a20   is\n{node!r}". 
-00008e30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008e40: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00008e50: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
-00008e60: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00008e70: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00008e80: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00008e90: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00008ea0: 6528 2264 6566 2066 282a 2c20 6172 6729  e("def f(*, arg)
-00008eb0: 3a20 2e2e 2e5c 6e22 290a 2020 2020 2020  : ...\n").      
-00008ec0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008ed0: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00008ee0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00008ef0: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
-00008f00: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00008f10: 6232 746f 335f 7061 7273 6528 2264 6566  b2to3_parse("def
-00008f20: 2066 282a 2c20 6172 672c 293a 202e 2e2e   f(*, arg,): ...
-00008f30: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
-00008f40: 662e 6173 7365 7274 4571 7561 6c28 626c  f.assertEqual(bl
-00008f50: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
-00008f60: 5f75 7365 6428 6e6f 6465 292c 207b 4665  _used(node), {Fe
-00008f70: 6174 7572 652e 5452 4149 4c49 4e47 5f43  ature.TRAILING_C
-00008f80: 4f4d 4d41 5f49 4e5f 4445 467d 290a 2020  OMMA_IN_DEF}).  
-00008f90: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
-00008fa0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-00008fb0: 2822 6628 2a61 7267 2c29 5c6e 2229 0a20  ("f(*arg,)\n"). 
-00008fc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008fd0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00008fe0: 2020 2020 2062 6c61 636b 2e67 6574 5f66       black.get_f
-00008ff0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-00009000: 6529 2c20 7b46 6561 7475 7265 2e54 5241  e), {Feature.TRA
-00009010: 494c 494e 475f 434f 4d4d 415f 494e 5f43  ILING_COMMA_IN_C
-00009020: 414c 4c7d 0a20 2020 2020 2020 2029 0a20  ALL}.        ). 
-00009030: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00009040: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00009050: 6528 2264 6566 2066 282a 2c20 6172 6729  e("def f(*, arg)
-00009060: 3a20 6627 7374 7269 6e67 275c 6e22 290a  : f'string'\n").
-00009070: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009080: 6572 7445 7175 616c 2862 6c61 636b 2e67  ertEqual(black.g
-00009090: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-000090a0: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
-000090b0: 2e46 5f53 5452 494e 4753 7d29 0a20 2020  .F_STRINGS}).   
-000090c0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-000090d0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-000090e0: 2231 3233 5f34 3536 5c6e 2229 0a20 2020  "123_456\n").   
-000090f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00009100: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
-00009110: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-00009120: 6465 292c 207b 4665 6174 7572 652e 4e55  de), {Feature.NU
-00009130: 4d45 5249 435f 554e 4445 5253 434f 5245  MERIC_UNDERSCORE
-00009140: 537d 290a 2020 2020 2020 2020 6e6f 6465  S}).        node
-00009150: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-00009160: 5f70 6172 7365 2822 3132 3334 3536 5c6e  _parse("123456\n
-00009170: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00009180: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
-00009190: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-000091a0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
-000091b0: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
-000091c0: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
-000091d0: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
-000091e0: 6173 6573 222c 2022 6675 6e63 7469 6f6e  ases", "function
-000091f0: 2229 0a20 2020 2020 2020 206e 6f64 6520  ").        node 
-00009200: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00009210: 7061 7273 6528 736f 7572 6365 290a 2020  parse(source).  
-00009220: 2020 2020 2020 6578 7065 6374 6564 5f66        expected_f
-00009230: 6561 7475 7265 7320 3d20 7b0a 2020 2020  eatures = {.    
-00009240: 2020 2020 2020 2020 4665 6174 7572 652e          Feature.
-00009250: 5452 4149 4c49 4e47 5f43 4f4d 4d41 5f49  TRAILING_COMMA_I
-00009260: 4e5f 4341 4c4c 2c0a 2020 2020 2020 2020  N_CALL,.        
-00009270: 2020 2020 4665 6174 7572 652e 5452 4149      Feature.TRAI
-00009280: 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f 4445  LING_COMMA_IN_DE
-00009290: 462c 0a20 2020 2020 2020 2020 2020 2046  F,.            F
-000092a0: 6561 7475 7265 2e46 5f53 5452 494e 4753  eature.F_STRINGS
-000092b0: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-000092c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000092d0: 7175 616c 2862 6c61 636b 2e67 6574 5f66  qual(black.get_f
-000092e0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-000092f0: 6529 2c20 6578 7065 6374 6564 5f66 6561  e), expected_fea
-00009300: 7475 7265 7329 0a20 2020 2020 2020 206e  tures).        n
-00009310: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00009320: 746f 335f 7061 7273 6528 6578 7065 6374  to3_parse(expect
-00009330: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
-00009340: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-00009350: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00009360: 7573 6564 286e 6f64 6529 2c20 6578 7065  used(node), expe
-00009370: 6374 6564 5f66 6561 7475 7265 7329 0a20  cted_features). 
-00009380: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
-00009390: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
-000093a0: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
-000093b0: 7322 2c20 2265 7870 7265 7373 696f 6e22  s", "expression"
-000093c0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-000093d0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-000093e0: 6172 7365 2873 6f75 7263 6529 0a20 2020  arse(source).   
-000093f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00009400: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
-00009410: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-00009420: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
-00009430: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
-00009440: 2e6c 6962 3274 6f33 5f70 6172 7365 2865  .lib2to3_parse(e
-00009450: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
-00009460: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00009470: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
-00009480: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00009490: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
-000094a0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-000094b0: 3274 6f33 5f70 6172 7365 2822 6c61 6d62  2to3_parse("lamb
-000094c0: 6461 2061 2c20 2f2c 2062 3a20 2e2e 2e22  da a, /, b: ..."
-000094d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000094e0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
-000094f0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-00009500: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
-00009510: 7265 2e50 4f53 5f4f 4e4c 595f 4152 4755  re.POS_ONLY_ARGU
-00009520: 4d45 4e54 537d 290a 2020 2020 2020 2020  MENTS}).        
-00009530: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-00009540: 3274 6f33 5f70 6172 7365 2822 6465 6620  2to3_parse("def 
-00009550: 666e 2861 2c20 2f2c 2062 293a 202e 2e2e  fn(a, /, b): ...
-00009560: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00009570: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
-00009580: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-00009590: 7365 6428 6e6f 6465 292c 207b 4665 6174  sed(node), {Feat
-000095a0: 7572 652e 504f 535f 4f4e 4c59 5f41 5247  ure.POS_ONLY_ARG
-000095b0: 554d 454e 5453 7d29 0a20 2020 2020 2020  UMENTS}).       
-000095c0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-000095d0: 6232 746f 335f 7061 7273 6528 2264 6566  b2to3_parse("def
-000095e0: 2066 6e28 293a 2079 6965 6c64 2061 2c20   fn(): yield a, 
-000095f0: 6222 290a 2020 2020 2020 2020 7365 6c66  b").        self
+00008bc0: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00008bd0: 6573 5f75 7365 6428 6e6f 6465 292c 0a20  es_used(node),. 
+00008be0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00008bf0: 7367 3d28 0a20 2020 2020 2020 2020 2020  sg=(.           
+00008c00: 2020 2020 2020 2020 2066 2264 6563 6f72           f"decor
+00008c10: 6174 6f72 2027 7b64 6563 6f72 6174 6f72  ator '{decorator
+00008c20: 7d27 2075 7365 7320 7079 7468 6f6e 332e  }' uses python3.
+00008c30: 392b 2073 796e 7461 7822 0a20 2020 2020  9+ syntax".     
+00008c40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00008c50: 6275 7420 6973 2064 6574 6563 7465 6420  but is detected 
+00008c60: 6173 2070 7974 686f 6e3c 3d33 2e38 220a  as python<=3.8".
+00008c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c80: 2020 2020 2320 6622 5468 6520 6675 6c6c      # f"The full
+00008c90: 206e 6f64 6520 6973 5c6e 7b6e 6f64 6521   node is\n{node!
+00008ca0: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
+00008cb0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00008cc0: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+00008cd0: 7374 5f67 6574 5f66 6561 7475 7265 735f  st_get_features_
+00008ce0: 7573 6564 2873 656c 6629 202d 3e20 4e6f  used(self) -> No
+00008cf0: 6e65 3a0a 2020 2020 2020 2020 6e6f 6465  ne:.        node
+00008d00: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+00008d10: 5f70 6172 7365 2822 6465 6620 6628 2a2c  _parse("def f(*,
+00008d20: 2061 7267 293a 202e 2e2e 5c6e 2229 0a20   arg): ...\n"). 
+00008d30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008d40: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
+00008d50: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00008d60: 6e6f 6465 292c 2073 6574 2829 290a 2020  node), set()).  
+00008d70: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+00008d80: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00008d90: 2822 6465 6620 6628 2a2c 2061 7267 2c29  ("def f(*, arg,)
+00008da0: 3a20 2e2e 2e5c 6e22 290a 2020 2020 2020  : ...\n").      
+00008db0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00008dc0: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
+00008dd0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+00008de0: 2c20 7b46 6561 7475 7265 2e54 5241 494c  , {Feature.TRAIL
+00008df0: 494e 475f 434f 4d4d 415f 494e 5f44 4546  ING_COMMA_IN_DEF
+00008e00: 7d29 0a20 2020 2020 2020 206e 6f64 6520  }).        node 
+00008e10: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00008e20: 7061 7273 6528 2266 282a 6172 672c 295c  parse("f(*arg,)\
+00008e30: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
+00008e40: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00008e50: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00008e60: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00008e70: 6428 6e6f 6465 292c 207b 4665 6174 7572  d(node), {Featur
+00008e80: 652e 5452 4149 4c49 4e47 5f43 4f4d 4d41  e.TRAILING_COMMA
+00008e90: 5f49 4e5f 4341 4c4c 7d0a 2020 2020 2020  _IN_CALL}.      
+00008ea0: 2020 290a 2020 2020 2020 2020 6e6f 6465    ).        node
+00008eb0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+00008ec0: 5f70 6172 7365 2822 6465 6620 6628 2a2c  _parse("def f(*,
+00008ed0: 2061 7267 293a 2066 2773 7472 696e 6727   arg): f'string'
+00008ee0: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
+00008ef0: 662e 6173 7365 7274 4571 7561 6c28 626c  f.assertEqual(bl
+00008f00: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
+00008f10: 5f75 7365 6428 6e6f 6465 292c 207b 4665  _used(node), {Fe
+00008f20: 6174 7572 652e 465f 5354 5249 4e47 537d  ature.F_STRINGS}
+00008f30: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+00008f40: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+00008f50: 6172 7365 2822 3132 335f 3435 365c 6e22  arse("123_456\n"
+00008f60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00008f70: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00008f80: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00008f90: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00008fa0: 7265 2e4e 554d 4552 4943 5f55 4e44 4552  re.NUMERIC_UNDER
+00008fb0: 5343 4f52 4553 7d29 0a20 2020 2020 2020  SCORES}).       
+00008fc0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+00008fd0: 6232 746f 335f 7061 7273 6528 2231 3233  b2to3_parse("123
+00008fe0: 3435 365c 6e22 290a 2020 2020 2020 2020  456\n").        
+00008ff0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00009000: 2862 6c61 636b 2e67 6574 5f66 6561 7475  (black.get_featu
+00009010: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
+00009020: 7365 7428 2929 0a20 2020 2020 2020 2073  set()).        s
+00009030: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+00009040: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
+00009050: 706c 655f 6361 7365 7322 2c20 2266 756e  ple_cases", "fun
+00009060: 6374 696f 6e22 290a 2020 2020 2020 2020  ction").        
+00009070: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+00009080: 3274 6f33 5f70 6172 7365 2873 6f75 7263  2to3_parse(sourc
+00009090: 6529 0a20 2020 2020 2020 2065 7870 6563  e).        expec
+000090a0: 7465 645f 6665 6174 7572 6573 203d 207b  ted_features = {
+000090b0: 0a20 2020 2020 2020 2020 2020 2046 6561  .            Fea
+000090c0: 7475 7265 2e54 5241 494c 494e 475f 434f  ture.TRAILING_CO
+000090d0: 4d4d 415f 494e 5f43 414c 4c2c 0a20 2020  MMA_IN_CALL,.   
+000090e0: 2020 2020 2020 2020 2046 6561 7475 7265           Feature
+000090f0: 2e54 5241 494c 494e 475f 434f 4d4d 415f  .TRAILING_COMMA_
+00009100: 494e 5f44 4546 2c0a 2020 2020 2020 2020  IN_DEF,.        
+00009110: 2020 2020 4665 6174 7572 652e 465f 5354      Feature.F_ST
+00009120: 5249 4e47 532c 0a20 2020 2020 2020 207d  RINGS,.        }
+00009130: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009140: 7365 7274 4571 7561 6c28 626c 6163 6b2e  sertEqual(black.
+00009150: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00009160: 6428 6e6f 6465 292c 2065 7870 6563 7465  d(node), expecte
+00009170: 645f 6665 6174 7572 6573 290a 2020 2020  d_features).    
+00009180: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
+00009190: 2e6c 6962 3274 6f33 5f70 6172 7365 2865  .lib2to3_parse(e
+000091a0: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
+000091b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000091c0: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
+000091d0: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
+000091e0: 2065 7870 6563 7465 645f 6665 6174 7572   expected_featur
+000091f0: 6573 290a 2020 2020 2020 2020 736f 7572  es).        sour
+00009200: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
+00009210: 6561 645f 6461 7461 2822 7369 6d70 6c65  ead_data("simple
+00009220: 5f63 6173 6573 222c 2022 6578 7072 6573  _cases", "expres
+00009230: 7369 6f6e 2229 0a20 2020 2020 2020 206e  sion").        n
+00009240: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+00009250: 746f 335f 7061 7273 6528 736f 7572 6365  to3_parse(source
+00009260: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009270: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00009280: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009290: 6564 286e 6f64 6529 2c20 7365 7428 2929  ed(node), set())
+000092a0: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+000092b0: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+000092c0: 7273 6528 6578 7065 6374 6564 290a 2020  rse(expected).  
+000092d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000092e0: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
+000092f0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009300: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009310: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+00009320: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+00009330: 226c 616d 6264 6120 612c 202f 2c20 623a  "lambda a, /, b:
+00009340: 202e 2e2e 2229 0a20 2020 2020 2020 2073   ...").        s
+00009350: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00009360: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00009370: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00009380: 4665 6174 7572 652e 504f 535f 4f4e 4c59  Feature.POS_ONLY
+00009390: 5f41 5247 554d 454e 5453 7d29 0a20 2020  _ARGUMENTS}).   
+000093a0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+000093b0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+000093c0: 2264 6566 2066 6e28 612c 202f 2c20 6229  "def fn(a, /, b)
+000093d0: 3a20 2e2e 2e22 290a 2020 2020 2020 2020  : ...").        
+000093e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000093f0: 2862 6c61 636b 2e67 6574 5f66 6561 7475  (black.get_featu
+00009400: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
+00009410: 7b46 6561 7475 7265 2e50 4f53 5f4f 4e4c  {Feature.POS_ONL
+00009420: 595f 4152 4755 4d45 4e54 537d 290a 2020  Y_ARGUMENTS}).  
+00009430: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+00009440: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00009450: 2822 6465 6620 666e 2829 3a20 7969 656c  ("def fn(): yiel
+00009460: 6420 612c 2062 2229 0a20 2020 2020 2020  d a, b").       
+00009470: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009480: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
+00009490: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
+000094a0: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
+000094b0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+000094c0: 3274 6f33 5f70 6172 7365 2822 6465 6620  2to3_parse("def 
+000094d0: 666e 2829 3a20 7265 7475 726e 2061 2c20  fn(): return a, 
+000094e0: 6222 290a 2020 2020 2020 2020 7365 6c66  b").        self
+000094f0: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
+00009500: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
+00009510: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
+00009520: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
+00009530: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00009540: 7061 7273 6528 2264 6566 2066 6e28 293a  parse("def fn():
+00009550: 2079 6965 6c64 202a 622c 2063 2229 0a20   yield *b, c"). 
+00009560: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009570: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
+00009580: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00009590: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
+000095a0: 554e 5041 434b 494e 475f 4f4e 5f46 4c4f  UNPACKING_ON_FLO
+000095b0: 577d 290a 2020 2020 2020 2020 6e6f 6465  W}).        node
+000095c0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+000095d0: 5f70 6172 7365 2822 6465 6620 666e 2829  _parse("def fn()
+000095e0: 3a20 7265 7475 726e 2061 2c20 2a62 2c20  : return a, *b, 
+000095f0: 6322 290a 2020 2020 2020 2020 7365 6c66  c").        self
 00009600: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
 00009610: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00009620: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
-00009630: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-00009640: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00009650: 7061 7273 6528 2264 6566 2066 6e28 293a  parse("def fn():
-00009660: 2072 6574 7572 6e20 612c 2062 2229 0a20   return a, b"). 
-00009670: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009680: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
-00009690: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-000096a0: 6e6f 6465 292c 2073 6574 2829 290a 2020  node), set()).  
-000096b0: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
-000096c0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-000096d0: 2822 6465 6620 666e 2829 3a20 7969 656c  ("def fn(): yiel
-000096e0: 6420 2a62 2c20 6322 290a 2020 2020 2020  d *b, c").      
-000096f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009700: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00009710: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00009720: 2c20 7b46 6561 7475 7265 2e55 4e50 4143  , {Feature.UNPAC
-00009730: 4b49 4e47 5f4f 4e5f 464c 4f57 7d29 0a20  KING_ON_FLOW}). 
-00009740: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00009750: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00009760: 6528 2264 6566 2066 6e28 293a 2072 6574  e("def fn(): ret
-00009770: 7572 6e20 612c 202a 622c 2063 2229 0a20  urn a, *b, c"). 
-00009780: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009790: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
-000097a0: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-000097b0: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
-000097c0: 554e 5041 434b 494e 475f 4f4e 5f46 4c4f  UNPACKING_ON_FLO
-000097d0: 577d 290a 2020 2020 2020 2020 6e6f 6465  W}).        node
-000097e0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-000097f0: 5f70 6172 7365 2822 7820 3d20 612c 202a  _parse("x = a, *
-00009800: 622c 2063 2229 0a20 2020 2020 2020 2073  b, c").        s
-00009810: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009820: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
-00009830: 6573 5f75 7365 6428 6e6f 6465 292c 2073  es_used(node), s
-00009840: 6574 2829 290a 2020 2020 2020 2020 6e6f  et()).        no
-00009850: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-00009860: 6f33 5f70 6172 7365 2822 783a 2041 6e79  o3_parse("x: Any
-00009870: 203d 2072 6567 756c 6172 2229 0a20 2020   = regular").   
-00009880: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00009890: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
-000098a0: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-000098b0: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
-000098c0: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
-000098d0: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
-000098e0: 783a 2041 6e79 203d 2028 7265 6775 6c61  x: Any = (regula
-000098f0: 722c 2072 6567 756c 6172 2922 290a 2020  r, regular)").  
-00009900: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009910: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
-00009920: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
-00009930: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
-00009940: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-00009950: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-00009960: 2278 3a20 416e 7920 3d20 436f 6d70 6c65  "x: Any = Comple
-00009970: 7828 5479 7065 2831 2929 5b73 6f6d 6574  x(Type(1))[somet
-00009980: 6869 6e67 5d22 290a 2020 2020 2020 2020  hing]").        
-00009990: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000099a0: 2862 6c61 636b 2e67 6574 5f66 6561 7475  (black.get_featu
-000099b0: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
-000099c0: 7365 7428 2929 0a20 2020 2020 2020 206e  set()).        n
-000099d0: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-000099e0: 746f 335f 7061 7273 6528 2278 3a20 5475  to3_parse("x: Tu
-000099f0: 706c 655b 696e 742c 202e 2e2e 5d20 3d20  ple[int, ...] = 
-00009a00: 612c 2062 2c20 6322 290a 2020 2020 2020  a, b, c").      
-00009a10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009a20: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00009a30: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
-00009a40: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
-00009a50: 4665 6174 7572 652e 414e 4e5f 4153 5349  Feature.ANN_ASSI
-00009a60: 474e 5f45 5854 454e 4445 445f 5248 537d  GN_EXTENDED_RHS}
-00009a70: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00009a80: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00009a90: 6c69 6232 746f 335f 7061 7273 6528 2274  lib2to3_parse("t
-00009aa0: 7279 3a20 7061 7373 5c6e 6578 6365 7074  ry: pass\nexcept
-00009ab0: 2053 6f6d 6574 6869 6e67 3a20 7061 7373   Something: pass
-00009ac0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00009ad0: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
-00009ae0: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-00009af0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
-00009b00: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-00009b10: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-00009b20: 6172 7365 2822 7472 793a 2070 6173 735c  arse("try: pass\
-00009b30: 6e65 7863 6570 7420 282a 536f 6d65 7468  nexcept (*Someth
-00009b40: 696e 672c 293a 2070 6173 7322 290a 2020  ing,): pass").  
-00009b50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009b60: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
-00009b70: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
-00009b80: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
-00009b90: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-00009ba0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-00009bb0: 2274 7279 3a20 7061 7373 5c6e 6578 6365  "try: pass\nexce
-00009bc0: 7074 202a 4772 6f75 703a 2070 6173 7322  pt *Group: pass"
-00009bd0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009be0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
-00009bf0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-00009c00: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
-00009c10: 7265 2e45 5843 4550 545f 5354 4152 7d29  re.EXCEPT_STAR})
-00009c20: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00009c30: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00009c40: 7273 6528 2261 5b2a 625d 2229 0a20 2020  rse("a[*b]").   
-00009c50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00009c60: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
-00009c70: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-00009c80: 6465 292c 207b 4665 6174 7572 652e 5641  de), {Feature.VA
-00009c90: 5249 4144 4943 5f47 454e 4552 4943 537d  RIADIC_GENERICS}
-00009ca0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-00009cb0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-00009cc0: 6172 7365 2822 615b 782c 202a 7928 292c  arse("a[x, *y(),
-00009cd0: 207a 5d20 3d20 7422 290a 2020 2020 2020   z] = t").      
-00009ce0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009cf0: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00009d00: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00009d10: 2c20 7b46 6561 7475 7265 2e56 4152 4941  , {Feature.VARIA
-00009d20: 4449 435f 4745 4e45 5249 4353 7d29 0a20  DIC_GENERICS}). 
-00009d30: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00009d40: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00009d50: 6528 2264 6566 2066 6e28 2a61 7267 733a  e("def fn(*args:
-00009d60: 202a 5429 3a20 7061 7373 2229 0a20 2020   *T): pass").   
-00009d70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00009d80: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
-00009d90: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-00009da0: 6465 292c 207b 4665 6174 7572 652e 5641  de), {Feature.VA
-00009db0: 5249 4144 4943 5f47 454e 4552 4943 537d  RIADIC_GENERICS}
-00009dc0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00009dd0: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00009de0: 645f 666f 725f 6675 7475 7265 5f66 6c61  d_for_future_fla
-00009df0: 6773 2873 656c 6629 202d 3e20 4e6f 6e65  gs(self) -> None
-00009e00: 3a0a 2020 2020 2020 2020 666f 7220 7372  :.        for sr
-00009e10: 632c 2066 6561 7475 7265 7320 696e 205b  c, features in [
-00009e20: 0a20 2020 2020 2020 2020 2020 2028 2266  .            ("f
-00009e30: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
-00009e40: 6d70 6f72 7420 616e 6e6f 7461 7469 6f6e  mport annotation
-00009e50: 7322 2c20 7b46 6561 7475 7265 2e46 5554  s", {Feature.FUT
-00009e60: 5552 455f 414e 4e4f 5441 5449 4f4e 537d  URE_ANNOTATIONS}
-00009e70: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-00009e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e90: 2022 6672 6f6d 205f 5f66 7574 7572 655f   "from __future_
-00009ea0: 5f20 696d 706f 7274 2028 6f74 6865 722c  _ import (other,
-00009eb0: 2061 6e6e 6f74 6174 696f 6e73 2922 2c0a   annotations)",.
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ed0: 7b46 6561 7475 7265 2e46 5554 5552 455f  {Feature.FUTURE_
-00009ee0: 414e 4e4f 5441 5449 4f4e 537d 2c0a 2020  ANNOTATIONS},.  
-00009ef0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00009f00: 2020 2020 2020 2020 2028 2261 203d 2031           ("a = 1
-00009f10: 202b 2032 5c6e 6672 6f6d 2073 6f6d 6574   + 2\nfrom somet
-00009f20: 6869 6e67 2069 6d70 6f72 7420 616e 6e6f  hing import anno
-00009f30: 7461 7469 6f6e 7322 2c20 7365 7428 2929  tations", set())
-00009f40: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-00009f50: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009f60: 696d 706f 7274 2078 2c20 7922 2c20 7365  import x, y", se
-00009f70: 7428 2929 2c0a 2020 2020 2020 2020 5d3a  t()),.        ]:
-00009f80: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00009f90: 6820 7365 6c66 2e73 7562 5465 7374 2873  h self.subTest(s
-00009fa0: 7263 3d73 7263 2c20 6665 6174 7572 6573  rc=src, features
-00009fb0: 3d66 6561 7475 7265 7329 3a0a 2020 2020  =features):.    
-00009fc0: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-00009fd0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-00009fe0: 5f70 6172 7365 2873 7263 290a 2020 2020  _parse(src).    
-00009ff0: 2020 2020 2020 2020 2020 2020 6675 7475              futu
-0000a000: 7265 5f69 6d70 6f72 7473 203d 2062 6c61  re_imports = bla
-0000a010: 636b 2e67 6574 5f66 7574 7572 655f 696d  ck.get_future_im
-0000a020: 706f 7274 7328 6e6f 6465 290a 2020 2020  ports(node).    
-0000a030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000a040: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 2020 626c 6163 6b2e 6765 745f 6665 6174    black.get_feat
-0000a070: 7572 6573 5f75 7365 6428 6e6f 6465 2c20  ures_used(node, 
-0000a080: 6675 7475 7265 5f69 6d70 6f72 7473 3d66  future_imports=f
-0000a090: 7574 7572 655f 696d 706f 7274 7329 2c0a  uture_imports),.
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 2020 2020 6665 6174 7572 6573 2c0a 2020      features,.  
-0000a0c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000a0d0: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
-0000a0e0: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-0000a0f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000a100: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-0000a110: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-0000a120: 7365 2822 5c6e 2229 0a20 2020 2020 2020  se("\n").       
-0000a130: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000a140: 6c28 7365 7428 292c 2062 6c61 636b 2e67  l(set(), black.g
-0000a150: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-0000a160: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-0000a170: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-0000a180: 6232 746f 335f 7061 7273 6528 2266 726f  b2to3_parse("fro
-0000a190: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-0000a1a0: 6f72 7420 626c 6163 6b5c 6e22 290a 2020  ort black\n").  
-0000a1b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a1c0: 7445 7175 616c 287b 2262 6c61 636b 227d  tEqual({"black"}
-0000a1d0: 2c20 626c 6163 6b2e 6765 745f 6675 7475  , black.get_futu
-0000a1e0: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
-0000a1f0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-0000a200: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-0000a210: 6172 7365 2822 6672 6f6d 205f 5f66 7574  arse("from __fut
-0000a220: 7572 655f 5f20 696d 706f 7274 206d 756c  ure__ import mul
-0000a230: 7469 706c 652c 2069 6d70 6f72 7473 5c6e  tiple, imports\n
-0000a240: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0000a250: 6173 7365 7274 4571 7561 6c28 7b22 6d75  assertEqual({"mu
-0000a260: 6c74 6970 6c65 222c 2022 696d 706f 7274  ltiple", "import
-0000a270: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
-0000a280: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
-0000a290: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
-0000a2a0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-0000a2b0: 335f 7061 7273 6528 2266 726f 6d20 5f5f  3_parse("from __
-0000a2c0: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-0000a2d0: 2870 6172 656e 7468 6573 697a 6564 2c20  (parenthesized, 
-0000a2e0: 696d 706f 7274 7329 5c6e 2229 0a20 2020  imports)\n").   
-0000a2f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a300: 4571 7561 6c28 7b22 7061 7265 6e74 6865  Equal({"parenthe
-0000a310: 7369 7a65 6422 2c20 2269 6d70 6f72 7473  sized", "imports
-0000a320: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
-0000a330: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
-0000a340: 6529 290a 2020 2020 2020 2020 6e6f 6465  e)).        node
-0000a350: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-0000a360: 5f70 6172 7365 280a 2020 2020 2020 2020  _parse(.        
-0000a370: 2020 2020 2266 726f 6d20 5f5f 6675 7475      "from __futu
-0000a380: 7265 5f5f 2069 6d70 6f72 7420 6d75 6c74  re__ import mult
-0000a390: 6970 6c65 5c6e 6672 6f6d 205f 5f66 7574  iple\nfrom __fut
-0000a3a0: 7572 655f 5f20 696d 706f 7274 2069 6d70  ure__ import imp
-0000a3b0: 6f72 7473 5c6e 220a 2020 2020 2020 2020  orts\n".        
-0000a3c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000a3d0: 7373 6572 7445 7175 616c 287b 226d 756c  ssertEqual({"mul
-0000a3e0: 7469 706c 6522 2c20 2269 6d70 6f72 7473  tiple", "imports
-0000a3f0: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
-0000a400: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
-0000a410: 6529 290a 2020 2020 2020 2020 6e6f 6465  e)).        node
-0000a420: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-0000a430: 5f70 6172 7365 2822 2320 636f 6d6d 656e  _parse("# commen
-0000a440: 745c 6e66 726f 6d20 5f5f 6675 7475 7265  t\nfrom __future
-0000a450: 5f5f 2069 6d70 6f72 7420 626c 6163 6b5c  __ import black\
-0000a460: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
-0000a470: 2e61 7373 6572 7445 7175 616c 287b 2262  .assertEqual({"b
-0000a480: 6c61 636b 227d 2c20 626c 6163 6b2e 6765  lack"}, black.ge
-0000a490: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-0000a4a0: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
-0000a4b0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-0000a4c0: 3274 6f33 5f70 6172 7365 2827 2222 2264  2to3_parse('"""d
-0000a4d0: 6f63 7374 7269 6e67 2222 225c 6e66 726f  ocstring"""\nfro
-0000a4e0: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-0000a4f0: 6f72 7420 626c 6163 6b5c 6e27 290a 2020  ort black\n').  
-0000a500: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a510: 7445 7175 616c 287b 2262 6c61 636b 227d  tEqual({"black"}
-0000a520: 2c20 626c 6163 6b2e 6765 745f 6675 7475  , black.get_futu
-0000a530: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
-0000a540: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-0000a550: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-0000a560: 6172 7365 2822 736f 6d65 286f 7468 6572  arse("some(other
-0000a570: 2c20 636f 6465 295c 6e66 726f 6d20 5f5f  , code)\nfrom __
-0000a580: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-0000a590: 626c 6163 6b5c 6e22 290a 2020 2020 2020  black\n").      
-0000a5a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000a5b0: 616c 2873 6574 2829 2c20 626c 6163 6b2e  al(set(), black.
-0000a5c0: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
-0000a5d0: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
-0000a5e0: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
-0000a5f0: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
-0000a600: 6f6d 2073 6f6d 652e 6d6f 6475 6c65 2069  om some.module i
-0000a610: 6d70 6f72 7420 626c 6163 6b5c 6e22 290a  mport black\n").
-0000a620: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000a630: 6572 7445 7175 616c 2873 6574 2829 2c20  ertEqual(set(), 
-0000a640: 626c 6163 6b2e 6765 745f 6675 7475 7265  black.get_future
-0000a650: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
-0000a660: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-0000a670: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-0000a680: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
-0000a690: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
-0000a6a0: 2069 6d70 6f72 7420 756e 6963 6f64 655f   import unicode_
-0000a6b0: 6c69 7465 7261 6c73 2061 7320 5f75 6e69  literals as _uni
-0000a6c0: 636f 6465 5f6c 6974 6572 616c 7322 0a20  code_literals". 
-0000a6d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000a6e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000a6f0: 6c28 7b22 756e 6963 6f64 655f 6c69 7465  l({"unicode_lite
-0000a700: 7261 6c73 227d 2c20 626c 6163 6b2e 6765  rals"}, black.ge
-0000a710: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-0000a720: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
-0000a730: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-0000a740: 3274 6f33 5f70 6172 7365 280a 2020 2020  2to3_parse(.    
-0000a750: 2020 2020 2020 2020 2266 726f 6d20 5f5f          "from __
-0000a760: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-0000a770: 756e 6963 6f64 655f 6c69 7465 7261 6c73  unicode_literals
-0000a780: 2061 7320 5f6c 6f6c 2c20 7072 696e 7422   as _lol, print"
-0000a790: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0000a7a0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a7b0: 7561 6c28 7b22 756e 6963 6f64 655f 6c69  ual({"unicode_li
-0000a7c0: 7465 7261 6c73 222c 2022 7072 696e 7422  terals", "print"
-0000a7d0: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
-0000a7e0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
-0000a7f0: 2929 0a0a 2020 2020 4070 7974 6573 742e  ))..    @pytest.
-0000a800: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
-0000a810: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
-0000a820: 2064 6566 2074 6573 745f 6465 6275 675f   def test_debug_
-0000a830: 7669 7369 746f 7228 7365 6c66 2920 2d3e  visitor(self) ->
-0000a840: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-0000a850: 6f75 7263 652c 205f 203d 2072 6561 645f  ource, _ = read_
-0000a860: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-0000a870: 6f75 7322 2c20 2264 6562 7567 5f76 6973  ous", "debug_vis
-0000a880: 6974 6f72 2229 0a20 2020 2020 2020 2065  itor").        e
-0000a890: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
-0000a8a0: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-0000a8b0: 6e65 6f75 7322 2c20 2264 6562 7567 5f76  neous", "debug_v
-0000a8c0: 6973 6974 6f72 2e6f 7574 2229 0a20 2020  isitor.out").   
-0000a8d0: 2020 2020 206f 7574 5f6c 696e 6573 203d       out_lines =
-0000a8e0: 205b 5d0a 2020 2020 2020 2020 6572 725f   [].        err_
-0000a8f0: 6c69 6e65 7320 3d20 5b5d 0a0a 2020 2020  lines = []..    
-0000a900: 2020 2020 6465 6620 6f75 7428 6d73 673a      def out(msg:
-0000a910: 2073 7472 2c20 2a2a 6b77 6172 6773 3a20   str, **kwargs: 
-0000a920: 416e 7929 202d 3e20 4e6f 6e65 3a0a 2020  Any) -> None:.  
-0000a930: 2020 2020 2020 2020 2020 6f75 745f 6c69            out_li
-0000a940: 6e65 732e 6170 7065 6e64 286d 7367 290a  nes.append(msg).
-0000a950: 0a20 2020 2020 2020 2064 6566 2065 7272  .        def err
-0000a960: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
-0000a970: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
-0000a980: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
-0000a990: 7272 5f6c 696e 6573 2e61 7070 656e 6428  rr_lines.append(
-0000a9a0: 6d73 6729 0a0a 2020 2020 2020 2020 7769  msg)..        wi
-0000a9b0: 7468 2070 6174 6368 2822 626c 6163 6b2e  th patch("black.
-0000a9c0: 6465 6275 672e 6f75 7422 2c20 6f75 7429  debug.out", out)
-0000a9d0: 3a0a 2020 2020 2020 2020 2020 2020 4465  :.            De
-0000a9e0: 6275 6756 6973 6974 6f72 2e73 686f 7728  bugVisitor.show(
-0000a9f0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-0000aa00: 6163 7475 616c 203d 2022 5c6e 222e 6a6f  actual = "\n".jo
-0000aa10: 696e 286f 7574 5f6c 696e 6573 2920 2b20  in(out_lines) + 
-0000aa20: 225c 6e22 0a20 2020 2020 2020 206c 6f67  "\n".        log
-0000aa30: 5f6e 616d 6520 3d20 2222 0a20 2020 2020  _name = "".     
-0000aa40: 2020 2069 6620 6578 7065 6374 6564 2021     if expected !
-0000aa50: 3d20 6163 7475 616c 3a0a 2020 2020 2020  = actual:.      
-0000aa60: 2020 2020 2020 6c6f 675f 6e61 6d65 203d        log_name =
-0000aa70: 2062 6c61 636b 2e64 756d 705f 746f 5f66   black.dump_to_f
-0000aa80: 696c 6528 2a6f 7574 5f6c 696e 6573 290a  ile(*out_lines).
-0000aa90: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000aaa0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-0000aab0: 2020 2020 2020 6578 7065 6374 6564 2c0a        expected,.
-0000aac0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-0000aad0: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
-0000aae0: 6622 4153 5420 7072 696e 7420 6f75 7420  f"AST print out 
-0000aaf0: 6973 2064 6966 6665 7265 6e74 2e20 4163  is different. Ac
-0000ab00: 7475 616c 2076 6572 7369 6f6e 2064 756d  tual version dum
-0000ab10: 7065 6420 746f 207b 6c6f 675f 6e61 6d65  ped to {log_name
-0000ab20: 7d22 2c0a 2020 2020 2020 2020 290a 0a20  }",.        ).. 
-0000ab30: 2020 2064 6566 2074 6573 745f 666f 726d     def test_form
-0000ab40: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
-0000ab50: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000ab60: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-0000ab70: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-0000ab80: 2020 2020 656d 7074 7920 3d20 2222 0a20      empty = "". 
-0000ab90: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000aba0: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
-0000abb0: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
-0000abc0: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
-0000abd0: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
-0000abe0: 6c65 5f63 6f6e 7465 6e74 7328 656d 7074  le_contents(empt
-0000abf0: 792c 206d 6f64 653d 6d6f 6465 2c20 6661  y, mode=mode, fa
-0000ac00: 7374 3d46 616c 7365 290a 2020 2020 2020  st=False).      
-0000ac10: 2020 6a75 7374 5f6e 6c20 3d20 225c 6e22    just_nl = "\n"
-0000ac20: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-0000ac30: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-0000ac40: 626c 6163 6b2e 4e6f 7468 696e 6743 6861  black.NothingCha
-0000ac50: 6e67 6564 293a 0a20 2020 2020 2020 2020  nged):.         
-0000ac60: 2020 2062 6c61 636b 2e66 6f72 6d61 745f     black.format_
-0000ac70: 6669 6c65 5f63 6f6e 7465 6e74 7328 6a75  file_contents(ju
-0000ac80: 7374 5f6e 6c2c 206d 6f64 653d 6d6f 6465  st_nl, mode=mode
-0000ac90: 2c20 6661 7374 3d46 616c 7365 290a 2020  , fast=False).  
-0000aca0: 2020 2020 2020 7361 6d65 203d 2022 6a20        same = "j 
-0000acb0: 3d20 5b31 2c20 322c 2033 5d5c 6e22 0a20  = [1, 2, 3]\n". 
-0000acc0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000acd0: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
-0000ace0: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
-0000acf0: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
-0000ad00: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
-0000ad10: 6c65 5f63 6f6e 7465 6e74 7328 7361 6d65  le_contents(same
-0000ad20: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
-0000ad30: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-0000ad40: 2064 6966 6665 7265 6e74 203d 2022 6a20   different = "j 
-0000ad50: 3d20 5b31 2c32 2c33 5d22 0a20 2020 2020  = [1,2,3]".     
-0000ad60: 2020 2065 7870 6563 7465 6420 3d20 7361     expected = sa
-0000ad70: 6d65 0a20 2020 2020 2020 2061 6374 7561  me.        actua
-0000ad80: 6c20 3d20 626c 6163 6b2e 666f 726d 6174  l = black.format
-0000ad90: 5f66 696c 655f 636f 6e74 656e 7473 2864  _file_contents(d
-0000ada0: 6966 6665 7265 6e74 2c20 6d6f 6465 3d6d  ifferent, mode=m
-0000adb0: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
-0000adc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000add0: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
-0000ade0: 6564 2c20 6163 7475 616c 290a 2020 2020  ed, actual).    
-0000adf0: 2020 2020 696e 7661 6c69 6420 3d20 2272      invalid = "r
-0000ae00: 6574 7572 6e20 6966 2079 6f75 2063 616e  eturn if you can
-0000ae10: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
-0000ae20: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000ae30: 2862 6c61 636b 2e49 6e76 616c 6964 496e  (black.InvalidIn
-0000ae40: 7075 7429 2061 7320 653a 0a20 2020 2020  put) as e:.     
-0000ae50: 2020 2020 2020 2062 6c61 636b 2e66 6f72         black.for
-0000ae60: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0000ae70: 7328 696e 7661 6c69 642c 206d 6f64 653d  s(invalid, mode=
-0000ae80: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
-0000ae90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000aea0: 7373 6572 7445 7175 616c 2873 7472 2865  ssertEqual(str(e
-0000aeb0: 2e65 7863 6570 7469 6f6e 292c 2022 4361  .exception), "Ca
-0000aec0: 6e6e 6f74 2070 6172 7365 3a20 313a 373a  nnot parse: 1:7:
-0000aed0: 2072 6574 7572 6e20 6966 2079 6f75 2063   return if you c
-0000aee0: 616e 2229 0a0a 2020 2020 2020 2020 6d6f  an")..        mo
-0000aef0: 6465 203d 2062 6c61 636b 2e4d 6f64 6528  de = black.Mode(
-0000af00: 7072 6576 6965 773d 5472 7565 290a 2020  preview=True).  
-0000af10: 2020 2020 2020 6a75 7374 5f63 726c 6620        just_crlf 
-0000af20: 3d20 225c 725c 6e22 0a20 2020 2020 2020  = "\r\n".       
-0000af30: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-0000af40: 7452 6169 7365 7328 626c 6163 6b2e 4e6f  tRaises(black.No
-0000af50: 7468 696e 6743 6861 6e67 6564 293a 0a20  thingChanged):. 
-0000af60: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000af70: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
-0000af80: 7465 6e74 7328 6a75 7374 5f63 726c 662c  tents(just_crlf,
-0000af90: 206d 6f64 653d 6d6f 6465 2c20 6661 7374   mode=mode, fast
-0000afa0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0000afb0: 6a75 7374 5f77 6869 7465 7370 6163 655f  just_whitespace_
-0000afc0: 6e6c 203d 2022 5c6e 5c74 5c6e 205c 6e5c  nl = "\n\t\n \n\
-0000afd0: 7420 5c6e 205c 745c 6e5c 6e22 0a20 2020  t \n \t\n\n".   
-0000afe0: 2020 2020 2061 6374 7561 6c20 3d20 626c       actual = bl
-0000aff0: 6163 6b2e 666f 726d 6174 5f66 696c 655f  ack.format_file_
-0000b000: 636f 6e74 656e 7473 286a 7573 745f 7768  contents(just_wh
-0000b010: 6974 6573 7061 6365 5f6e 6c2c 206d 6f64  itespace_nl, mod
-0000b020: 653d 6d6f 6465 2c20 6661 7374 3d46 616c  e=mode, fast=Fal
-0000b030: 7365 290a 2020 2020 2020 2020 7365 6c66  se).        self
-0000b040: 2e61 7373 6572 7445 7175 616c 2822 5c6e  .assertEqual("\n
-0000b050: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
-0000b060: 2020 206a 7573 745f 7768 6974 6573 7061     just_whitespa
-0000b070: 6365 5f63 726c 6620 3d20 225c 725c 6e5c  ce_crlf = "\r\n\
-0000b080: 745c 725c 6e20 5c72 5c6e 5c74 205c 725c  t\r\n \r\n\t \r\
-0000b090: 6e20 5c74 5c72 5c6e 5c72 5c6e 220a 2020  n \t\r\n\r\n".  
-0000b0a0: 2020 2020 2020 6163 7475 616c 203d 2062        actual = b
-0000b0b0: 6c61 636b 2e66 6f72 6d61 745f 6669 6c65  lack.format_file
-0000b0c0: 5f63 6f6e 7465 6e74 7328 6a75 7374 5f77  _contents(just_w
-0000b0d0: 6869 7465 7370 6163 655f 6372 6c66 2c20  hitespace_crlf, 
-0000b0e0: 6d6f 6465 3d6d 6f64 652c 2066 6173 743d  mode=mode, fast=
-0000b0f0: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
-0000b100: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000b110: 225c 725c 6e22 2c20 6163 7475 616c 290a  "\r\n", actual).
-0000b120: 0a20 2020 2064 6566 2074 6573 745f 656e  .    def test_en
-0000b130: 646d 6172 6b65 7228 7365 6c66 2920 2d3e  dmarker(self) ->
-0000b140: 204e 6f6e 653a 0a20 2020 2020 2020 206e   None:.        n
-0000b150: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-0000b160: 5f70 6172 7365 2822 5c6e 2229 0a20 2020  _parse("\n").   
-0000b170: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000b180: 4571 7561 6c28 6e2e 7479 7065 2c20 626c  Equal(n.type, bl
-0000b190: 6163 6b2e 7379 6d73 2e66 696c 655f 696e  ack.syms.file_in
-0000b1a0: 7075 7429 0a20 2020 2020 2020 2073 656c  put).        sel
-0000b1b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-0000b1c0: 6e28 6e2e 6368 696c 6472 656e 292c 2031  n(n.children), 1
-0000b1d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000b1e0: 7373 6572 7445 7175 616c 286e 2e63 6869  ssertEqual(n.chi
-0000b1f0: 6c64 7265 6e5b 305d 2e74 7970 652c 2062  ldren[0].type, b
-0000b200: 6c61 636b 2e74 6f6b 656e 2e45 4e44 4d41  lack.token.ENDMA
-0000b210: 524b 4552 290a 0a20 2020 2040 7079 7465  RKER)..    @pyte
-0000b220: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-0000b230: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-0000b240: 2020 2020 4075 6e69 7474 6573 742e 736b      @unittest.sk
-0000b250: 6970 4966 286f 732e 656e 7669 726f 6e2e  ipIf(os.environ.
-0000b260: 6765 7428 2253 4b49 505f 4153 545f 5052  get("SKIP_AST_PR
-0000b270: 494e 5422 292c 2022 7573 6572 2073 6574  INT"), "user set
-0000b280: 2053 4b49 505f 4153 545f 5052 494e 5422   SKIP_AST_PRINT"
-0000b290: 290a 2020 2020 6465 6620 7465 7374 5f61  ).    def test_a
-0000b2a0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-0000b2b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000b2c0: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
-0000b2d0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
-0000b2e0: 7272 5f6c 696e 6573 203d 205b 5d0a 0a20  rr_lines = [].. 
-0000b2f0: 2020 2020 2020 2064 6566 206f 7574 286d         def out(m
-0000b300: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
-0000b310: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
-0000b320: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000b330: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
-0000b340: 6729 0a0a 2020 2020 2020 2020 6465 6620  g)..        def 
-0000b350: 6572 7228 6d73 673a 2073 7472 2c20 2a2a  err(msg: str, **
-0000b360: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
-0000b370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000b380: 2020 6572 725f 6c69 6e65 732e 6170 7065    err_lines.appe
-0000b390: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
-0000b3a0: 2077 6974 6820 7061 7463 6828 2262 6c61   with patch("bla
-0000b3b0: 636b 2e6f 7574 7075 742e 5f6f 7574 222c  ck.output._out",
-0000b3c0: 206f 7574 292c 2070 6174 6368 2822 626c   out), patch("bl
-0000b3d0: 6163 6b2e 6f75 7470 7574 2e5f 6572 7222  ack.output._err"
-0000b3e0: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
-0000b3f0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0000b400: 7365 7274 5261 6973 6573 2841 7373 6572  sertRaises(Asser
-0000b410: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
-0000b420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b430: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-0000b440: 616c 2822 6a20 3d20 5b31 2c20 322c 2033  al("j = [1, 2, 3
-0000b450: 5d22 2c20 226a 203d 205b 312c 2032 2c20  ]", "j = [1, 2, 
-0000b460: 332c 5d22 290a 0a20 2020 2020 2020 206f  3,]")..        o
-0000b470: 7574 5f73 7472 203d 2022 222e 6a6f 696e  ut_str = "".join
-0000b480: 286f 7574 5f6c 696e 6573 290a 2020 2020  (out_lines).    
-0000b490: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000b4a0: 6e28 2245 7870 6563 7465 6420 7472 6565  n("Expected tree
-0000b4b0: 3a22 2c20 6f75 745f 7374 7229 0a20 2020  :", out_str).   
-0000b4c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000b4d0: 496e 2822 4163 7475 616c 2074 7265 653a  In("Actual tree:
-0000b4e0: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
-0000b4f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b500: 7175 616c 2822 222e 6a6f 696e 2865 7272  qual("".join(err
-0000b510: 5f6c 696e 6573 292c 2022 2229 0a0a 2020  _lines), "")..  
-0000b520: 2020 4065 7665 6e74 5f6c 6f6f 7028 290a    @event_loop().
-0000b530: 2020 2020 4070 6174 6368 2822 636f 6e63      @patch("conc
-0000b540: 7572 7265 6e74 2e66 7574 7572 6573 2e50  urrent.futures.P
-0000b550: 726f 6365 7373 506f 6f6c 4578 6563 7574  rocessPoolExecut
-0000b560: 6f72 222c 204d 6167 6963 4d6f 636b 2873  or", MagicMock(s
-0000b570: 6964 655f 6566 6665 6374 3d4f 5345 7272  ide_effect=OSErr
-0000b580: 6f72 2929 0a20 2020 2064 6566 2074 6573  or)).    def tes
-0000b590: 745f 776f 726b 735f 696e 5f6d 6f6e 6f5f  t_works_in_mono_
-0000b5a0: 7072 6f63 6573 735f 6f6e 6c79 5f65 6e76  process_only_env
-0000b5b0: 6972 6f6e 6d65 6e74 2873 656c 6629 202d  ironment(self) -
-0000b5c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b5d0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000b5e0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-0000b5f0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-0000b600: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
-0000b610: 2020 2020 2020 2877 6f72 6b73 7061 6365        (workspace
-0000b620: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
-0000b630: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
-0000b640: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
-0000b650: 6365 202f 2022 7477 6f2e 7079 2229 2e72  ce / "two.py").r
-0000b660: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
-0000b670: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
-0000b680: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-0000b690: 5f74 6578 7428 2770 7269 6e74 2822 6865  _text('print("he
-0000b6a0: 6c6c 6f22 295c 6e27 290a 2020 2020 2020  llo")\n').      
-0000b6b0: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000b6c0: 6542 6c61 636b 285b 7374 7228 776f 726b  eBlack([str(work
-0000b6d0: 7370 6163 6529 5d29 0a0a 2020 2020 4065  space)])..    @e
-0000b6e0: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
-0000b6f0: 6465 6620 7465 7374 5f63 6865 636b 5f64  def test_check_d
-0000b700: 6966 665f 7573 655f 746f 6765 7468 6572  iff_use_together
-0000b710: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000b720: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-0000b730: 6865 5f64 6972 2829 3a0a 2020 2020 2020  he_dir():.      
-0000b740: 2020 2020 2020 2320 4669 6c65 7320 7768        # Files wh
-0000b750: 6963 6820 7769 6c6c 2062 6520 7265 666f  ich will be refo
-0000b760: 726d 6174 7465 642e 0a20 2020 2020 2020  rmatted..       
-0000b770: 2020 2020 2073 7263 3120 3d20 6765 745f       src1 = get_
-0000b780: 6361 7365 5f70 6174 6828 226d 6973 6365  case_path("misce
-0000b790: 6c6c 616e 656f 7573 222c 2022 7374 7269  llaneous", "stri
-0000b7a0: 6e67 5f71 756f 7465 7322 290a 2020 2020  ng_quotes").    
-0000b7b0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b7c0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
-0000b7d0: 6331 292c 2022 2d2d 6469 6666 222c 2022  c1), "--diff", "
-0000b7e0: 2d2d 6368 6563 6b22 5d2c 2065 7869 745f  --check"], exit_
-0000b7f0: 636f 6465 3d31 290a 2020 2020 2020 2020  code=1).        
-0000b800: 2020 2020 2320 4669 6c65 7320 7768 6963      # Files whic
-0000b810: 6820 7769 6c6c 206e 6f74 2062 6520 7265  h will not be re
-0000b820: 666f 726d 6174 7465 642e 0a20 2020 2020  formatted..     
-0000b830: 2020 2020 2020 2073 7263 3220 3d20 6765         src2 = ge
-0000b840: 745f 6361 7365 5f70 6174 6828 2273 696d  t_case_path("sim
-0000b850: 706c 655f 6361 7365 7322 2c20 2263 6f6d  ple_cases", "com
-0000b860: 706f 7369 7469 6f6e 2229 0a20 2020 2020  position").     
-0000b870: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-0000b880: 6b65 426c 6163 6b28 5b73 7472 2873 7263  keBlack([str(src
-0000b890: 3229 2c20 222d 2d64 6966 6622 2c20 222d  2), "--diff", "-
-0000b8a0: 2d63 6865 636b 225d 290a 2020 2020 2020  -check"]).      
-0000b8b0: 2020 2020 2020 2320 4d75 6c74 6920 6669        # Multi fi
-0000b8c0: 6c65 2063 6f6d 6d61 6e64 2e0a 2020 2020  le command..    
-0000b8d0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b8e0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
-0000b8f0: 6331 292c 2073 7472 2873 7263 3229 2c20  c1), str(src2), 
-0000b900: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
-0000b910: 636b 225d 2c20 6578 6974 5f63 6f64 653d  ck"], exit_code=
-0000b920: 3129 0a0a 2020 2020 6465 6620 7465 7374  1)..    def test
-0000b930: 5f6e 6f5f 7372 635f 6661 696c 7328 7365  _no_src_fails(se
-0000b940: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000b950: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-0000b960: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
-0000b970: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000b980: 6163 6b28 5b5d 2c20 6578 6974 5f63 6f64  ack([], exit_cod
-0000b990: 653d 3129 0a0a 2020 2020 6465 6620 7465  e=1)..    def te
-0000b9a0: 7374 5f73 7263 5f61 6e64 5f63 6f64 655f  st_src_and_code_
-0000b9b0: 6661 696c 7328 7365 6c66 2920 2d3e 204e  fails(self) -> N
-0000b9c0: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
-0000b9d0: 6820 6361 6368 655f 6469 7228 293a 0a20  h cache_dir():. 
-0000b9e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b9f0: 696e 766f 6b65 426c 6163 6b28 5b22 2e22  invokeBlack(["."
-0000ba00: 2c20 222d 6322 2c20 2230 225d 2c20 6578  , "-c", "0"], ex
-0000ba10: 6974 5f63 6f64 653d 3129 0a0a 2020 2020  it_code=1)..    
-0000ba20: 6465 6620 7465 7374 5f62 726f 6b65 6e5f  def test_broken_
-0000ba30: 7379 6d6c 696e 6b28 7365 6c66 2920 2d3e  symlink(self) ->
-0000ba40: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
-0000ba50: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
-0000ba60: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000ba70: 2020 2020 2020 2020 2020 7379 6d6c 696e            symlin
-0000ba80: 6b20 3d20 776f 726b 7370 6163 6520 2f20  k = workspace / 
-0000ba90: 2262 726f 6b65 6e5f 6c69 6e6b 2e70 7922  "broken_link.py"
-0000baa0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0000bab0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000bac0: 2020 7379 6d6c 696e 6b2e 7379 6d6c 696e    symlink.symlin
-0000bad0: 6b5f 746f 2822 6e6f 6e65 7869 7374 656e  k_to("nonexisten
-0000bae0: 742e 7079 2229 0a20 2020 2020 2020 2020  t.py").         
-0000baf0: 2020 2065 7863 6570 7420 284f 5345 7272     except (OSErr
-0000bb00: 6f72 2c20 4e6f 7449 6d70 6c65 6d65 6e74  or, NotImplement
-0000bb10: 6564 4572 726f 7229 2061 7320 653a 0a20  edError) as e:. 
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bb30: 656c 662e 736b 6970 5465 7374 2866 2243  elf.skipTest(f"C
-0000bb40: 616e 2774 2063 7265 6174 6520 7379 6d6c  an't create syml
-0000bb50: 696e 6b73 3a20 7b65 7d22 290a 2020 2020  inks: {e}").    
-0000bb60: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000bb70: 6f6b 6542 6c61 636b 285b 7374 7228 776f  okeBlack([str(wo
-0000bb80: 726b 7370 6163 652e 7265 736f 6c76 6528  rkspace.resolve(
-0000bb90: 2929 5d29 0a0a 2020 2020 6465 6620 7465  ))])..    def te
-0000bba0: 7374 5f73 696e 676c 655f 6669 6c65 5f66  st_single_file_f
-0000bbb0: 6f72 6365 5f70 7969 2873 656c 6629 202d  orce_pyi(self) -
-0000bbc0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000bbd0: 7079 695f 6d6f 6465 203d 2072 6570 6c61  pyi_mode = repla
-0000bbe0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-0000bbf0: 2069 735f 7079 693d 5472 7565 290a 2020   is_pyi=True).  
-0000bc00: 2020 2020 2020 636f 6e74 656e 7473 2c20        contents, 
-0000bc10: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-0000bc20: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-0000bc30: 6f75 7322 2c20 2266 6f72 6365 5f70 7969  ous", "force_pyi
-0000bc40: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
-0000bc50: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
-0000bc60: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-0000bc70: 2020 2020 2020 7061 7468 203d 2028 776f        path = (wo
-0000bc80: 726b 7370 6163 6520 2f20 2266 696c 652e  rkspace / "file.
-0000bc90: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
-0000bca0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000bcb0: 6f70 656e 2870 6174 682c 2022 7722 2920  open(path, "w") 
-0000bcc0: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
-0000bcd0: 2020 2020 2020 2066 682e 7772 6974 6528         fh.write(
-0000bce0: 636f 6e74 656e 7473 290a 2020 2020 2020  contents).      
-0000bcf0: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000bd00: 6542 6c61 636b 285b 7374 7228 7061 7468  eBlack([str(path
-0000bd10: 292c 2022 2d2d 7079 6922 5d29 0a20 2020  ), "--pyi"]).   
-0000bd20: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000bd30: 656e 2870 6174 682c 2022 7222 2920 6173  en(path, "r") as
-0000bd40: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
-0000bd50: 2020 2020 2061 6374 7561 6c20 3d20 6668       actual = fh
-0000bd60: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-0000bd70: 2020 2020 2320 7665 7269 6679 2063 6163      # verify cac
-0000bd80: 6865 2077 6974 6820 2d2d 7079 6920 6973  he with --pyi is
-0000bd90: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
-0000bda0: 2020 2020 2020 7079 695f 6361 6368 6520        pyi_cache 
-0000bdb0: 3d20 626c 6163 6b2e 7265 6164 5f63 6163  = black.read_cac
-0000bdc0: 6865 2870 7969 5f6d 6f64 6529 0a20 2020  he(pyi_mode).   
-0000bdd0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000bde0: 7365 7274 496e 2873 7472 2870 6174 6829  sertIn(str(path)
-0000bdf0: 2c20 7079 695f 6361 6368 6529 0a20 2020  , pyi_cache).   
-0000be00: 2020 2020 2020 2020 206e 6f72 6d61 6c5f           normal_
-0000be10: 6361 6368 6520 3d20 626c 6163 6b2e 7265  cache = black.re
-0000be20: 6164 5f63 6163 6865 2844 4546 4155 4c54  ad_cache(DEFAULT
-0000be30: 5f4d 4f44 4529 0a20 2020 2020 2020 2020  _MODE).         
-0000be40: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
-0000be50: 7449 6e28 7374 7228 7061 7468 292c 206e  tIn(str(path), n
-0000be60: 6f72 6d61 6c5f 6361 6368 6529 0a20 2020  ormal_cache).   
-0000be70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000be80: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
-0000be90: 6374 6564 2c20 6163 7475 616c 290a 2020  cted, actual).  
-0000bea0: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
-0000beb0: 7274 5f65 7175 6976 616c 656e 7428 636f  rt_equivalent(co
-0000bec0: 6e74 656e 7473 2c20 6163 7475 616c 290a  ntents, actual).
-0000bed0: 2020 2020 2020 2020 626c 6163 6b2e 6173          black.as
-0000bee0: 7365 7274 5f73 7461 626c 6528 636f 6e74  sert_stable(cont
-0000bef0: 656e 7473 2c20 6163 7475 616c 2c20 7079  ents, actual, py
-0000bf00: 695f 6d6f 6465 290a 0a20 2020 2040 6576  i_mode)..    @ev
-0000bf10: 656e 745f 6c6f 6f70 2829 0a20 2020 2064  ent_loop().    d
-0000bf20: 6566 2074 6573 745f 6d75 6c74 695f 6669  ef test_multi_fi
-0000bf30: 6c65 5f66 6f72 6365 5f70 7969 2873 656c  le_force_pyi(sel
-0000bf40: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000bf50: 2020 2020 7265 675f 6d6f 6465 203d 2044      reg_mode = D
-0000bf60: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-0000bf70: 2020 2020 7079 695f 6d6f 6465 203d 2072      pyi_mode = r
-0000bf80: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
-0000bf90: 4f44 452c 2069 735f 7079 693d 5472 7565  ODE, is_pyi=True
-0000bfa0: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
-0000bfb0: 7473 2c20 6578 7065 6374 6564 203d 2072  ts, expected = r
-0000bfc0: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
-0000bfd0: 6c61 6e65 6f75 7322 2c20 2266 6f72 6365  laneous", "force
-0000bfe0: 5f70 7969 2229 0a20 2020 2020 2020 2077  _pyi").        w
-0000bff0: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
-0000c000: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000c010: 2020 2020 2020 2020 2020 7061 7468 7320            paths 
-0000c020: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-0000c030: 2020 2020 2877 6f72 6b73 7061 6365 202f      (workspace /
-0000c040: 2022 6669 6c65 312e 7079 2229 2e72 6573   "file1.py").res
-0000c050: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
-0000c060: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
-0000c070: 6365 202f 2022 6669 6c65 322e 7079 2229  ce / "file2.py")
-0000c080: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
-0000c090: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-0000c0a0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
-0000c0b0: 6e20 7061 7468 733a 0a20 2020 2020 2020  n paths:.       
-0000c0c0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000c0d0: 656e 2870 6174 682c 2022 7722 2920 6173  en(path, "w") as
-0000c0e0: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
-0000c0f0: 2020 2020 2020 2020 2066 682e 7772 6974           fh.writ
-0000c100: 6528 636f 6e74 656e 7473 290a 2020 2020  e(contents).    
-0000c110: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000c120: 6f6b 6542 6c61 636b 285b 7374 7228 7029  okeBlack([str(p)
-0000c130: 2066 6f72 2070 2069 6e20 7061 7468 735d   for p in paths]
-0000c140: 202b 205b 222d 2d70 7969 225d 290a 2020   + ["--pyi"]).  
-0000c150: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000c160: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
-0000c170: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0000c180: 6820 6f70 656e 2870 6174 682c 2022 7222  h open(path, "r"
-0000c190: 2920 6173 2066 683a 0a20 2020 2020 2020  ) as fh:.       
-0000c1a0: 2020 2020 2020 2020 2020 2020 2061 6374               act
-0000c1b0: 7561 6c20 3d20 6668 2e72 6561 6428 290a  ual = fh.read().
-0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000c1e0: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
-0000c1f0: 6429 0a20 2020 2020 2020 2020 2020 2023  d).            #
-0000c200: 2076 6572 6966 7920 6361 6368 6520 7769   verify cache wi
-0000c210: 7468 202d 2d70 7969 2069 7320 7365 7061  th --pyi is sepa
-0000c220: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
-0000c230: 2070 7969 5f63 6163 6865 203d 2062 6c61   pyi_cache = bla
-0000c240: 636b 2e72 6561 645f 6361 6368 6528 7079  ck.read_cache(py
-0000c250: 695f 6d6f 6465 290a 2020 2020 2020 2020  i_mode).        
-0000c260: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
-0000c270: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
-0000c280: 6368 6528 7265 675f 6d6f 6465 290a 2020  che(reg_mode).  
-0000c290: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000c2a0: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
-0000c2b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c2c0: 662e 6173 7365 7274 496e 2873 7472 2870  f.assertIn(str(p
-0000c2d0: 6174 6829 2c20 7079 695f 6361 6368 6529  ath), pyi_cache)
-0000c2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c2f0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
-0000c300: 6e28 7374 7228 7061 7468 292c 206e 6f72  n(str(path), nor
-0000c310: 6d61 6c5f 6361 6368 6529 0a0a 2020 2020  mal_cache)..    
-0000c320: 6465 6620 7465 7374 5f70 6970 655f 666f  def test_pipe_fo
-0000c330: 7263 655f 7079 6928 7365 6c66 2920 2d3e  rce_pyi(self) ->
-0000c340: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-0000c350: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
-0000c360: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-0000c370: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
-0000c380: 7263 655f 7079 6922 290a 2020 2020 2020  rce_pyi").      
-0000c390: 2020 7265 7375 6c74 203d 2043 6c69 5275    result = CliRu
-0000c3a0: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
-0000c3b0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000c3c0: 2e6d 6169 6e2c 205b 222d 222c 2022 2d71  .main, ["-", "-q
-0000c3d0: 222c 2022 2d2d 7079 6922 5d2c 2069 6e70  ", "--pyi"], inp
-0000c3e0: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
-0000c3f0: 652e 656e 636f 6465 2822 7574 6638 2229  e.encode("utf8")
-0000c400: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
-0000c410: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000c420: 7175 616c 2872 6573 756c 742e 6578 6974  qual(result.exit
-0000c430: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
-0000c440: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
-0000c450: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
-0000c460: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-0000c470: 6174 4571 7561 6c28 6163 7475 616c 2c20  atEqual(actual, 
-0000c480: 6578 7065 6374 6564 290a 0a20 2020 2064  expected)..    d
-0000c490: 6566 2074 6573 745f 7369 6e67 6c65 5f66  ef test_single_f
-0000c4a0: 696c 655f 666f 7263 655f 7079 3336 2873  ile_force_py36(s
-0000c4b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000c4c0: 2020 2020 2020 7265 675f 6d6f 6465 203d        reg_mode =
-0000c4d0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-0000c4e0: 2020 2020 2020 7079 3336 5f6d 6f64 6520        py36_mode 
-0000c4f0: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
-0000c500: 545f 4d4f 4445 2c20 7461 7267 6574 5f76  T_MODE, target_v
-0000c510: 6572 7369 6f6e 733d 5059 3336 5f56 4552  ersions=PY36_VER
-0000c520: 5349 4f4e 5329 0a20 2020 2020 2020 2073  SIONS).        s
-0000c530: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
-0000c540: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-0000c550: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
-0000c560: 7263 655f 7079 3336 2229 0a20 2020 2020  rce_py36").     
-0000c570: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-0000c580: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-0000c590: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0000c5a0: 7468 203d 2028 776f 726b 7370 6163 6520  th = (workspace 
-0000c5b0: 2f20 2266 696c 652e 7079 2229 2e72 6573  / "file.py").res
-0000c5c0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-0000c5d0: 2020 2077 6974 6820 6f70 656e 2870 6174     with open(pat
-0000c5e0: 682c 2022 7722 2920 6173 2066 683a 0a20  h, "w") as fh:. 
-0000c5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000c600: 682e 7772 6974 6528 736f 7572 6365 290a  h.write(source).
-0000c610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c620: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-0000c630: 7228 7061 7468 292c 202a 5059 3336 5f41  r(path), *PY36_A
-0000c640: 5247 535d 290a 2020 2020 2020 2020 2020  RGS]).          
-0000c650: 2020 7769 7468 206f 7065 6e28 7061 7468    with open(path
-0000c660: 2c20 2272 2229 2061 7320 6668 3a0a 2020  , "r") as fh:.  
-0000c670: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000c680: 7475 616c 203d 2066 682e 7265 6164 2829  tual = fh.read()
-0000c690: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
-0000c6a0: 6572 6966 7920 6361 6368 6520 7769 7468  erify cache with
-0000c6b0: 202d 2d74 6172 6765 742d 7665 7273 696f   --target-versio
-0000c6c0: 6e20 6973 2073 6570 6172 6174 650a 2020  n is separate.  
-0000c6d0: 2020 2020 2020 2020 2020 7079 3336 5f63            py36_c
-0000c6e0: 6163 6865 203d 2062 6c61 636b 2e72 6561  ache = black.rea
-0000c6f0: 645f 6361 6368 6528 7079 3336 5f6d 6f64  d_cache(py36_mod
-0000c700: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-0000c710: 656c 662e 6173 7365 7274 496e 2873 7472  elf.assertIn(str
-0000c720: 2870 6174 6829 2c20 7079 3336 5f63 6163  (path), py36_cac
-0000c730: 6865 290a 2020 2020 2020 2020 2020 2020  he).            
-0000c740: 6e6f 726d 616c 5f63 6163 6865 203d 2062  normal_cache = b
-0000c750: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
-0000c760: 7265 675f 6d6f 6465 290a 2020 2020 2020  reg_mode).      
-0000c770: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000c780: 744e 6f74 496e 2873 7472 2870 6174 6829  tNotIn(str(path)
-0000c790: 2c20 6e6f 726d 616c 5f63 6163 6865 290a  , normal_cache).
-0000c7a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c7b0: 6572 7445 7175 616c 2861 6374 7561 6c2c  ertEqual(actual,
-0000c7c0: 2065 7870 6563 7465 6429 0a0a 2020 2020   expected)..    
-0000c7d0: 4065 7665 6e74 5f6c 6f6f 7028 290a 2020  @event_loop().  
-0000c7e0: 2020 6465 6620 7465 7374 5f6d 756c 7469    def test_multi
-0000c7f0: 5f66 696c 655f 666f 7263 655f 7079 3336  _file_force_py36
-0000c800: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000c810: 2020 2020 2020 2020 7265 675f 6d6f 6465          reg_mode
-0000c820: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
-0000c830: 2020 2020 2020 2020 7079 3336 5f6d 6f64          py36_mod
-0000c840: 6520 3d20 7265 706c 6163 6528 4445 4641  e = replace(DEFA
-0000c850: 554c 545f 4d4f 4445 2c20 7461 7267 6574  ULT_MODE, target
-0000c860: 5f76 6572 7369 6f6e 733d 5059 3336 5f56  _versions=PY36_V
-0000c870: 4552 5349 4f4e 5329 0a20 2020 2020 2020  ERSIONS).       
-0000c880: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
-0000c890: 6420 3d20 7265 6164 5f64 6174 6128 226d  d = read_data("m
-0000c8a0: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
-0000c8b0: 666f 7263 655f 7079 3336 2229 0a20 2020  force_py36").   
-0000c8c0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-0000c8d0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-0000c8e0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-0000c8f0: 7061 7468 7320 3d20 5b0a 2020 2020 2020  paths = [.      
-0000c900: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
-0000c910: 7061 6365 202f 2022 6669 6c65 312e 7079  pace / "file1.py
-0000c920: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2877                (w
-0000c940: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
-0000c950: 322e 7079 2229 2e72 6573 6f6c 7665 2829  2.py").resolve()
-0000c960: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
-0000c970: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000c980: 7061 7468 2069 6e20 7061 7468 733a 0a20  path in paths:. 
-0000c990: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000c9a0: 6974 6820 6f70 656e 2870 6174 682c 2022  ith open(path, "
-0000c9b0: 7722 2920 6173 2066 683a 0a20 2020 2020  w") as fh:.     
-0000c9c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000c9d0: 682e 7772 6974 6528 736f 7572 6365 290a  h.write(source).
-0000c9e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c9f0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-0000ca00: 7228 7029 2066 6f72 2070 2069 6e20 7061  r(p) for p in pa
-0000ca10: 7468 735d 202b 2050 5933 365f 4152 4753  ths] + PY36_ARGS
-0000ca20: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0000ca30: 7220 7061 7468 2069 6e20 7061 7468 733a  r path in paths:
-0000ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ca50: 2077 6974 6820 6f70 656e 2870 6174 682c   with open(path,
-0000ca60: 2022 7222 2920 6173 2066 683a 0a20 2020   "r") as fh:.   
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca80: 2061 6374 7561 6c20 3d20 6668 2e72 6561   actual = fh.rea
-0000ca90: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
-0000caa0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000cab0: 7175 616c 2861 6374 7561 6c2c 2065 7870  qual(actual, exp
-0000cac0: 6563 7465 6429 0a20 2020 2020 2020 2020  ected).         
-0000cad0: 2020 2023 2076 6572 6966 7920 6361 6368     # verify cach
-0000cae0: 6520 7769 7468 202d 2d74 6172 6765 742d  e with --target-
-0000caf0: 7665 7273 696f 6e20 6973 2073 6570 6172  version is separ
-0000cb00: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-0000cb10: 7079 695f 6361 6368 6520 3d20 626c 6163  pyi_cache = blac
-0000cb20: 6b2e 7265 6164 5f63 6163 6865 2870 7933  k.read_cache(py3
-0000cb30: 365f 6d6f 6465 290a 2020 2020 2020 2020  6_mode).        
-0000cb40: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
-0000cb50: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
-0000cb60: 6368 6528 7265 675f 6d6f 6465 290a 2020  che(reg_mode).  
-0000cb70: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000cb80: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
-0000cb90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000cba0: 662e 6173 7365 7274 496e 2873 7472 2870  f.assertIn(str(p
-0000cbb0: 6174 6829 2c20 7079 695f 6361 6368 6529  ath), pyi_cache)
-0000cbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cbd0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
-0000cbe0: 6e28 7374 7228 7061 7468 292c 206e 6f72  n(str(path), nor
-0000cbf0: 6d61 6c5f 6361 6368 6529 0a0a 2020 2020  mal_cache)..    
-0000cc00: 6465 6620 7465 7374 5f70 6970 655f 666f  def test_pipe_fo
-0000cc10: 7263 655f 7079 3336 2873 656c 6629 202d  rce_py36(self) -
-0000cc20: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000cc30: 736f 7572 6365 2c20 6578 7065 6374 6564  source, expected
-0000cc40: 203d 2072 6561 645f 6461 7461 2822 6d69   = read_data("mi
-0000cc50: 7363 656c 6c61 6e65 6f75 7322 2c20 2266  scellaneous", "f
-0000cc60: 6f72 6365 5f70 7933 3622 290a 2020 2020  orce_py36").    
-0000cc70: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
-0000cc80: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-0000cc90: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000cca0: 636b 2e6d 6169 6e2c 0a20 2020 2020 2020  ck.main,.       
-0000ccb0: 2020 2020 205b 222d 222c 2022 2d71 222c       ["-", "-q",
-0000ccc0: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
-0000ccd0: 6f6e 3d70 7933 3622 5d2c 0a20 2020 2020  on=py36"],.     
-0000cce0: 2020 2020 2020 2069 6e70 7574 3d42 7974         input=Byt
-0000ccf0: 6573 494f 2873 6f75 7263 652e 656e 636f  esIO(source.enco
-0000cd00: 6465 2822 7574 6638 2229 292c 0a20 2020  de("utf8")),.   
-0000cd10: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0000cd20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000cd30: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
-0000cd40: 2c20 3029 0a20 2020 2020 2020 2061 6374  , 0).        act
-0000cd50: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
-0000cd60: 7075 740a 2020 2020 2020 2020 7365 6c66  put.        self
-0000cd70: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-0000cd80: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
-0000cd90: 7465 6429 0a0a 2020 2020 4070 7974 6573  ted)..    @pytes
-0000cda0: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
-0000cdb0: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
-0000cdc0: 2020 2064 6566 2074 6573 745f 7265 666f     def test_refo
-0000cdd0: 726d 6174 5f6f 6e65 5f77 6974 685f 7374  rmat_one_with_st
-0000cde0: 6469 6e28 7365 6c66 2920 2d3e 204e 6f6e  din(self) -> Non
-0000cdf0: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
-0000ce00: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
-0000ce10: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
-0000ce20: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
-0000ce30: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
-0000ce40: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
-0000ce50: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
-0000ce60: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
-0000ce70: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
-0000ce80: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
-0000ce90: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
-0000cea0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-0000ceb0: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
-0000cec0: 7468 2822 2d22 290a 2020 2020 2020 2020  th("-").        
-0000ced0: 2020 2020 626c 6163 6b2e 7265 666f 726d      black.reform
-0000cee0: 6174 5f6f 6e65 280a 2020 2020 2020 2020  at_one(.        
-0000cef0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0000cf10: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
-0000cf20: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
-0000cf30: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-0000cf40: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
-0000cf50: 2020 2020 2020 2020 206d 6f64 653d 4445           mode=DE
-0000cf60: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
-0000cf70: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-0000cf80: 7274 3d72 6570 6f72 742c 0a20 2020 2020  rt=report,.     
-0000cf90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cfa0: 2020 2020 2066 7374 732e 6173 7365 7274       fsts.assert
-0000cfb0: 5f63 616c 6c65 645f 6f6e 6365 2829 0a20  _called_once(). 
-0000cfc0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000cfd0: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000cfe0: 6c6c 6564 5f77 6974 6828 7061 7468 2c20  lled_with(path, 
-0000cff0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
-0000d000: 5329 0a0a 2020 2020 4070 7974 6573 742e  S)..    @pytest.
-0000d010: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
-0000d020: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
-0000d030: 2064 6566 2074 6573 745f 7265 666f 726d   def test_reform
-0000d040: 6174 5f6f 6e65 5f77 6974 685f 7374 6469  at_one_with_stdi
-0000d050: 6e5f 6669 6c65 6e61 6d65 2873 656c 6629  n_filename(self)
-0000d060: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000d070: 2020 7769 7468 2070 6174 6368 280a 2020    with patch(.  
-0000d080: 2020 2020 2020 2020 2020 2262 6c61 636b            "black
-0000d090: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
-0000d0a0: 5f73 7464 6f75 7422 2c0a 2020 2020 2020  _stdout",.      
-0000d0b0: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
-0000d0c0: 7565 3d6c 616d 6264 6120 2a61 7267 732c  ue=lambda *args,
-0000d0d0: 202a 2a6b 7761 7267 733a 2062 6c61 636b   **kwargs: black
-0000d0e0: 2e43 6861 6e67 6564 2e59 4553 2c0a 2020  .Changed.YES,.  
-0000d0f0: 2020 2020 2020 2920 6173 2066 7374 733a        ) as fsts:
-0000d100: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-0000d110: 6f72 7420 3d20 4d61 6769 634d 6f63 6b28  ort = MagicMock(
-0000d120: 290a 2020 2020 2020 2020 2020 2020 7020  ).            p 
-0000d130: 3d20 2266 6f6f 2e70 7922 0a20 2020 2020  = "foo.py".     
-0000d140: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
-0000d150: 7468 2866 225f 5f42 4c41 434b 5f53 5444  th(f"__BLACK_STD
-0000d160: 494e 5f46 494c 454e 414d 455f 5f7b 707d  IN_FILENAME__{p}
-0000d170: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-0000d180: 7870 6563 7465 6420 3d20 5061 7468 2870  xpected = Path(p
-0000d190: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
-0000d1a0: 6163 6b2e 7265 666f 726d 6174 5f6f 6e65  ack.reformat_one
-0000d1b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d1c0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
-0000d1d0: 2020 2020 2020 2020 6661 7374 3d54 7275          fast=Tru
-0000d1e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000d1f0: 2020 2077 7269 7465 5f62 6163 6b3d 626c     write_back=bl
-0000d200: 6163 6b2e 5772 6974 6542 6163 6b2e 5945  ack.WriteBack.YE
-0000d210: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
-0000d220: 2020 206d 6f64 653d 4445 4641 554c 545f     mode=DEFAULT_
-0000d230: 4d4f 4445 2c0a 2020 2020 2020 2020 2020  MODE,.          
-0000d240: 2020 2020 2020 7265 706f 7274 3d72 6570        report=rep
-0000d250: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-0000d260: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
-0000d270: 7374 732e 6173 7365 7274 5f63 616c 6c65  sts.assert_calle
-0000d280: 645f 6f6e 6365 5f77 6974 6828 0a20 2020  d_once_with(.   
-0000d290: 2020 2020 2020 2020 2020 2020 2066 6173               fas
-0000d2a0: 743d 5472 7565 2c20 7772 6974 655f 6261  t=True, write_ba
-0000d2b0: 636b 3d62 6c61 636b 2e57 7269 7465 4261  ck=black.WriteBa
-0000d2c0: 636b 2e59 4553 2c20 6d6f 6465 3d44 4546  ck.YES, mode=DEF
-0000d2d0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-0000d2e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d2f0: 2020 2020 2320 5f5f 424c 4143 4b5f 5354      # __BLACK_ST
-0000d300: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 2073  DIN_FILENAME__ s
-0000d310: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
-0000d320: 7374 7269 7070 6564 0a20 2020 2020 2020  stripped.       
-0000d330: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-0000d340: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
-0000d350: 6974 6828 6578 7065 6374 6564 2c20 626c  ith(expected, bl
-0000d360: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
-0000d370: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-0000d380: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-0000d390: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
-0000d3a0: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
-0000d3b0: 5f6f 6e65 5f77 6974 685f 7374 6469 6e5f  _one_with_stdin_
-0000d3c0: 6669 6c65 6e61 6d65 5f70 7969 2873 656c  filename_pyi(sel
-0000d3d0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000d3e0: 2020 2020 7769 7468 2070 6174 6368 280a      with patch(.
-0000d3f0: 2020 2020 2020 2020 2020 2020 2262 6c61              "bla
-0000d400: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
-0000d410: 746f 5f73 7464 6f75 7422 2c0a 2020 2020  to_stdout",.    
-0000d420: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
-0000d430: 616c 7565 3d6c 616d 6264 6120 2a61 7267  alue=lambda *arg
-0000d440: 732c 202a 2a6b 7761 7267 733a 2062 6c61  s, **kwargs: bla
-0000d450: 636b 2e43 6861 6e67 6564 2e59 4553 2c0a  ck.Changed.YES,.
-0000d460: 2020 2020 2020 2020 2920 6173 2066 7374          ) as fst
-0000d470: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0000d480: 6570 6f72 7420 3d20 4d61 6769 634d 6f63  eport = MagicMoc
-0000d490: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-0000d4a0: 7020 3d20 2266 6f6f 2e70 7969 220a 2020  p = "foo.pyi".  
-0000d4b0: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0000d4c0: 2050 6174 6828 6622 5f5f 424c 4143 4b5f   Path(f"__BLACK_
-0000d4d0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
-0000d4e0: 7b70 7d22 290a 2020 2020 2020 2020 2020  {p}").          
-0000d4f0: 2020 6578 7065 6374 6564 203d 2050 6174    expected = Pat
-0000d500: 6828 7029 0a20 2020 2020 2020 2020 2020  h(p).           
-0000d510: 2062 6c61 636b 2e72 6566 6f72 6d61 745f   black.reformat_
-0000d520: 6f6e 6528 0a20 2020 2020 2020 2020 2020  one(.           
-0000d530: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-0000d540: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
-0000d550: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0000d560: 2020 2020 2020 7772 6974 655f 6261 636b        write_back
-0000d570: 3d62 6c61 636b 2e57 7269 7465 4261 636b  =black.WriteBack
-0000d580: 2e59 4553 2c0a 2020 2020 2020 2020 2020  .YES,.          
-0000d590: 2020 2020 2020 6d6f 6465 3d44 4546 4155        mode=DEFAU
-0000d5a0: 4c54 5f4d 4f44 452c 0a20 2020 2020 2020  LT_MODE,.       
-0000d5b0: 2020 2020 2020 2020 2072 6570 6f72 743d           report=
-0000d5c0: 7265 706f 7274 2c0a 2020 2020 2020 2020  report,.        
-0000d5d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000d5e0: 2020 6673 7473 2e61 7373 6572 745f 6361    fsts.assert_ca
-0000d5f0: 6c6c 6564 5f6f 6e63 655f 7769 7468 280a  lled_once_with(.
-0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d610: 6661 7374 3d54 7275 652c 0a20 2020 2020  fast=True,.     
-0000d620: 2020 2020 2020 2020 2020 2077 7269 7465             write
-0000d630: 5f62 6163 6b3d 626c 6163 6b2e 5772 6974  _back=black.Writ
-0000d640: 6542 6163 6b2e 5945 532c 0a20 2020 2020  eBack.YES,.     
-0000d650: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
-0000d660: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
-0000d670: 4d4f 4445 2c20 6973 5f70 7969 3d54 7275  MODE, is_pyi=Tru
-0000d680: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-0000d690: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000d6a0: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
-0000d6b0: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
-0000d6c0: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
-0000d6d0: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
-0000d6e0: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
-0000d6f0: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
-0000d700: 7065 6374 6564 2c20 626c 6163 6b2e 4368  pected, black.Ch
-0000d710: 616e 6765 642e 5945 5329 0a0a 2020 2020  anged.YES)..    
-0000d720: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
-0000d730: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
-0000d740: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
-0000d750: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
-0000d760: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
-0000d770: 6d65 5f69 7079 6e62 2873 656c 6629 202d  me_ipynb(self) -
-0000d780: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d790: 7769 7468 2070 6174 6368 280a 2020 2020  with patch(.    
-0000d7a0: 2020 2020 2020 2020 2262 6c61 636b 2e66          "black.f
-0000d7b0: 6f72 6d61 745f 7374 6469 6e5f 746f 5f73  ormat_stdin_to_s
-0000d7c0: 7464 6f75 7422 2c0a 2020 2020 2020 2020  tdout",.        
-0000d7d0: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
-0000d7e0: 3d6c 616d 6264 6120 2a61 7267 732c 202a  =lambda *args, *
-0000d7f0: 2a6b 7761 7267 733a 2062 6c61 636b 2e43  *kwargs: black.C
-0000d800: 6861 6e67 6564 2e59 4553 2c0a 2020 2020  hanged.YES,.    
-0000d810: 2020 2020 2920 6173 2066 7374 733a 0a20      ) as fsts:. 
-0000d820: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000d830: 7420 3d20 4d61 6769 634d 6f63 6b28 290a  t = MagicMock().
-0000d840: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-0000d850: 2266 6f6f 2e69 7079 6e62 220a 2020 2020  "foo.ipynb".    
-0000d860: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
-0000d870: 6174 6828 6622 5f5f 424c 4143 4b5f 5354  ath(f"__BLACK_ST
-0000d880: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 7b70  DIN_FILENAME__{p
-0000d890: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000d8a0: 6578 7065 6374 6564 203d 2050 6174 6828  expected = Path(
-0000d8b0: 7029 0a20 2020 2020 2020 2020 2020 2062  p).            b
-0000d8c0: 6c61 636b 2e72 6566 6f72 6d61 745f 6f6e  lack.reformat_on
-0000d8d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000d8e0: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
-0000d8f0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
-0000d900: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000d910: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
-0000d920: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
-0000d930: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
-0000d940: 2020 2020 6d6f 6465 3d44 4546 4155 4c54      mode=DEFAULT
-0000d950: 5f4d 4f44 452c 0a20 2020 2020 2020 2020  _MODE,.         
-0000d960: 2020 2020 2020 2072 6570 6f72 743d 7265         report=re
-0000d970: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
-0000d980: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000d990: 6673 7473 2e61 7373 6572 745f 6361 6c6c  fsts.assert_call
-0000d9a0: 6564 5f6f 6e63 655f 7769 7468 280a 2020  ed_once_with(.  
-0000d9b0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0000d9c0: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
-0000d9d0: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
-0000d9e0: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-0000d9f0: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
-0000da00: 2020 2020 2020 2020 206d 6f64 653d 7265           mode=re
-0000da10: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
-0000da20: 4445 2c20 6973 5f69 7079 6e62 3d54 7275  DE, is_ipynb=Tru
-0000da30: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-0000da40: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000da50: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
-0000da60: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
-0000da70: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
-0000da80: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
-0000da90: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
-0000daa0: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
-0000dab0: 7065 6374 6564 2c20 626c 6163 6b2e 4368  pected, black.Ch
-0000dac0: 616e 6765 642e 5945 5329 0a0a 2020 2020  anged.YES)..    
-0000dad0: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
-0000dae0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
-0000daf0: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
-0000db00: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
-0000db10: 6974 685f 7374 6469 6e5f 616e 645f 6578  ith_stdin_and_ex
-0000db20: 6973 7469 6e67 5f70 6174 6828 7365 6c66  isting_path(self
-0000db30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000db40: 2020 2077 6974 6820 7061 7463 6828 0a20     with patch(. 
-0000db50: 2020 2020 2020 2020 2020 2022 626c 6163             "blac
-0000db60: 6b2e 666f 726d 6174 5f73 7464 696e 5f74  k.format_stdin_t
-0000db70: 6f5f 7374 646f 7574 222c 0a20 2020 2020  o_stdout",.     
-0000db80: 2020 2020 2020 2072 6574 7572 6e5f 7661         return_va
-0000db90: 6c75 653d 6c61 6d62 6461 202a 6172 6773  lue=lambda *args
-0000dba0: 2c20 2a2a 6b77 6172 6773 3a20 626c 6163  , **kwargs: blac
-0000dbb0: 6b2e 4368 616e 6765 642e 5945 532c 0a20  k.Changed.YES,. 
-0000dbc0: 2020 2020 2020 2029 2061 7320 6673 7473         ) as fsts
-0000dbd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000dbe0: 706f 7274 203d 204d 6167 6963 4d6f 636b  port = MagicMock
-0000dbf0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-0000dc00: 2045 7665 6e20 7769 7468 2061 6e20 6578   Even with an ex
-0000dc10: 6973 7469 6e67 2066 696c 652c 2073 696e  isting file, sin
-0000dc20: 6365 2077 6520 6172 6520 666f 7263 696e  ce we are forcin
-0000dc30: 6720 7374 6469 6e2c 2062 6c61 636b 0a20  g stdin, black. 
-0000dc40: 2020 2020 2020 2020 2020 2023 2073 686f             # sho
-0000dc50: 756c 6420 6f75 7470 7574 2074 6f20 7374  uld output to st
-0000dc60: 646f 7574 2061 6e64 206e 6f74 206d 6f64  dout and not mod
-0000dc70: 6966 7920 7468 6520 6669 6c65 2069 6e70  ify the file inp
-0000dc80: 6c61 6365 0a20 2020 2020 2020 2020 2020  lace.           
-0000dc90: 2070 203d 2054 4849 535f 4449 5220 2f20   p = THIS_DIR / 
-0000dca0: 2264 6174 6122 202f 2022 7369 6d70 6c65  "data" / "simple
-0000dcb0: 5f63 6173 6573 2220 2f20 2263 6f6c 6c65  _cases" / "colle
-0000dcc0: 6374 696f 6e73 2e70 7922 0a20 2020 2020  ctions.py".     
-0000dcd0: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
-0000dce0: 7265 2069 735f 6669 6c65 2061 6374 7561  re is_file actua
-0000dcf0: 6c6c 7920 7265 7475 726e 7320 5472 7565  lly returns True
-0000dd00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000dd10: 662e 6173 7365 7274 5472 7565 2870 2e69  f.assertTrue(p.i
-0000dd20: 735f 6669 6c65 2829 290a 2020 2020 2020  s_file()).      
-0000dd30: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-0000dd40: 6828 6622 5f5f 424c 4143 4b5f 5354 4449  h(f"__BLACK_STDI
-0000dd50: 4e5f 4649 4c45 4e41 4d45 5f5f 7b70 7d22  N_FILENAME__{p}"
-0000dd60: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0000dd70: 7065 6374 6564 203d 2050 6174 6828 7029  pected = Path(p)
-0000dd80: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000dd90: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
-0000dda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ddb0: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
-0000ddc0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
-0000ddd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dde0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
-0000ddf0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
-0000de00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000de10: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
-0000de20: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
-0000de30: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
-0000de40: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0000de50: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
-0000de60: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
-0000de70: 5f6f 6e63 6528 290a 2020 2020 2020 2020  _once().        
-0000de80: 2020 2020 2320 5f5f 424c 4143 4b5f 5354      # __BLACK_ST
-0000de90: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 2073  DIN_FILENAME__ s
-0000dea0: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
-0000deb0: 7374 7269 7070 6564 0a20 2020 2020 2020  stripped.       
-0000dec0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-0000ded0: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
-0000dee0: 6974 6828 6578 7065 6374 6564 2c20 626c  ith(expected, bl
-0000def0: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
-0000df00: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
-0000df10: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
-0000df20: 5f73 7464 696e 5f65 6d70 7479 2873 656c  _stdin_empty(sel
-0000df30: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000df40: 2020 2020 6361 7365 7320 3d20 5b0a 2020      cases = [.  
-0000df50: 2020 2020 2020 2020 2020 2822 222c 2022            ("", "
-0000df60: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-0000df70: 2822 5c6e 222c 2022 5c6e 2229 2c0a 2020  ("\n", "\n"),.  
-0000df80: 2020 2020 2020 2020 2020 2822 5c72 5c6e            ("\r\n
-0000df90: 222c 2022 5c72 5c6e 2229 2c0a 2020 2020  ", "\r\n"),.    
-0000dfa0: 2020 2020 2020 2020 2822 205c 7422 2c20          (" \t", 
-0000dfb0: 2222 292c 0a20 2020 2020 2020 2020 2020  ""),.           
-0000dfc0: 2028 2220 5c74 5c6e 5c74 2022 2c20 225c   (" \t\n\t ", "\
-0000dfd0: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
-0000dfe0: 2028 2220 5c74 5c72 5c6e 5c74 2022 2c20   (" \t\r\n\t ", 
-0000dff0: 225c 725c 6e22 292c 0a20 2020 2020 2020  "\r\n"),.       
-0000e000: 205d 0a0a 2020 2020 2020 2020 6465 6620   ]..        def 
-0000e010: 5f6e 6577 5f77 7261 7070 6572 280a 2020  _new_wrapper(.  
-0000e020: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000e030: 3a20 696f 2e53 7472 696e 6749 4f2c 2069  : io.StringIO, i
-0000e040: 6f5f 5465 7874 494f 5772 6170 7065 723a  o_TextIOWrapper:
-0000e050: 2054 7970 655b 696f 2e54 6578 7449 4f57   Type[io.TextIOW
-0000e060: 7261 7070 6572 5d0a 2020 2020 2020 2020  rapper].        
-0000e070: 2920 2d3e 2043 616c 6c61 626c 655b 5b41  ) -> Callable[[A
-0000e080: 6e79 2c20 416e 795d 2c20 696f 2e54 6578  ny, Any], io.Tex
-0000e090: 7449 4f57 7261 7070 6572 5d3a 0a20 2020  tIOWrapper]:.   
-0000e0a0: 2020 2020 2020 2020 2064 6566 2067 6574           def get
-0000e0b0: 5f6f 7574 7075 7428 2a61 7267 733a 2041  _output(*args: A
-0000e0c0: 6e79 2c20 2a2a 6b77 6172 6773 3a20 416e  ny, **kwargs: An
-0000e0d0: 7929 202d 3e20 696f 2e54 6578 7449 4f57  y) -> io.TextIOW
-0000e0e0: 7261 7070 6572 3a0a 2020 2020 2020 2020  rapper:.        
-0000e0f0: 2020 2020 2020 2020 6966 2061 7267 7320          if args 
-0000e100: 3d3d 2028 7379 732e 7374 646f 7574 2e62  == (sys.stdout.b
-0000e110: 7566 6665 722c 293a 0a20 2020 2020 2020  uffer,):.       
-0000e120: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000e130: 7427 7320 6066 6f72 6d61 745f 7374 6469  t's `format_stdi
-0000e140: 6e5f 746f 5f73 7464 6f75 7428 2960 2063  n_to_stdout()` c
-0000e150: 616c 6c69 6e67 2060 696f 2e54 6578 7449  alling `io.TextI
-0000e160: 4f57 7261 7070 6572 2829 602c 0a20 2020  OWrapper()`,.   
-0000e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e180: 2023 2072 6574 7572 6e20 6f75 7220 6d6f   # return our mo
-0000e190: 636b 206f 626a 6563 742e 0a20 2020 2020  ck object..     
-0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e1b0: 6574 7572 6e20 6f75 7470 7574 0a20 2020  eturn output.   
-0000e1c0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000e1d0: 7427 7320 736f 6d65 7468 696e 6720 656c  t's something el
-0000e1e0: 7365 2028 692e 652e 2060 6465 636f 6465  se (i.e. `decode
-0000e1f0: 5f62 7974 6573 2829 6029 2063 616c 6c69  _bytes()`) calli
-0000e200: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0000e210: 2020 2023 2060 696f 2e54 6578 7449 4f57     # `io.TextIOW
-0000e220: 7261 7070 6572 2829 602c 2070 6173 7320  rapper()`, pass 
-0000e230: 7468 726f 7567 6820 746f 2074 6865 206f  through to the o
-0000e240: 7269 6769 6e61 6c20 696d 706c 656d 656e  riginal implemen
-0000e250: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
-0000e260: 2020 2020 2020 2020 2320 5365 6520 6469          # See di
-0000e270: 7363 7573 7369 6f6e 2069 6e20 6874 7470  scussion in http
-0000e280: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
-0000e290: 7366 2f62 6c61 636b 2f70 756c 6c2f 3234  sf/black/pull/24
-0000e2a0: 3839 0a20 2020 2020 2020 2020 2020 2020  89.             
-0000e2b0: 2020 2072 6574 7572 6e20 696f 5f54 6578     return io_Tex
-0000e2c0: 7449 4f57 7261 7070 6572 282a 6172 6773  tIOWrapper(*args
-0000e2d0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-0000e2e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e2f0: 6765 745f 6f75 7470 7574 0a0a 2020 2020  get_output..    
-0000e300: 2020 2020 6d6f 6465 203d 2062 6c61 636b      mode = black
-0000e310: 2e4d 6f64 6528 7072 6576 6965 773d 5472  .Mode(preview=Tr
-0000e320: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
-0000e330: 636f 6e74 656e 742c 2065 7870 6563 7465  content, expecte
-0000e340: 6420 696e 2063 6173 6573 3a0a 2020 2020  d in cases:.    
-0000e350: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-0000e360: 2069 6f2e 5374 7269 6e67 494f 2829 0a20   io.StringIO(). 
-0000e370: 2020 2020 2020 2020 2020 2069 6f5f 5465             io_Te
-0000e380: 7874 494f 5772 6170 7065 7220 3d20 696f  xtIOWrapper = io
-0000e390: 2e54 6578 7449 4f57 7261 7070 6572 0a0a  .TextIOWrapper..
-0000e3a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000e3b0: 2070 6174 6368 2822 696f 2e54 6578 7449   patch("io.TextI
-0000e3c0: 4f57 7261 7070 6572 222c 205f 6e65 775f  OWrapper", _new_
-0000e3d0: 7772 6170 7065 7228 6f75 7470 7574 2c20  wrapper(output, 
-0000e3e0: 696f 5f54 6578 7449 4f57 7261 7070 6572  io_TextIOWrapper
-0000e3f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000e400: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000e410: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
-0000e420: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
-0000e430: 746f 5f73 7464 6f75 7428 0a20 2020 2020  to_stdout(.     
-0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e450: 2020 2066 6173 743d 5472 7565 2c0a 2020     fast=True,.  
-0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e470: 2020 2020 2020 636f 6e74 656e 743d 636f        content=co
-0000e480: 6e74 656e 742c 0a20 2020 2020 2020 2020  ntent,.         
-0000e490: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000e4a0: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
-0000e4b0: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
-0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4d0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-0000e4e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e4f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e500: 2020 2020 2020 2020 6578 6365 7074 2069          except i
-0000e510: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-0000e520: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
-0000e530: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0000e540: 2020 2320 5374 7269 6e67 494f 2064 6f65    # StringIO doe
-0000e550: 7320 6e6f 7420 7375 7070 6f72 7420 6465  s not support de
-0000e560: 7461 6368 0a20 2020 2020 2020 2020 2020  tach.           
-0000e570: 2020 2020 2061 7373 6572 7420 6f75 7470       assert outp
-0000e580: 7574 2e67 6574 7661 6c75 6528 2920 3d3d  ut.getvalue() ==
-0000e590: 2065 7870 6563 7465 640a 0a20 2020 2020   expected..     
-0000e5a0: 2020 2023 2041 6e20 656d 7074 7920 7374     # An empty st
-0000e5b0: 7269 6e67 2069 7320 7468 6520 6f6e 6c79  ring is the only
-0000e5c0: 2074 6573 7420 6361 7365 2066 6f72 2060   test case for `
-0000e5d0: 7072 6576 6965 773d 4661 6c73 6560 0a20  preview=False`. 
-0000e5e0: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
-0000e5f0: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
-0000e600: 2020 2020 2020 696f 5f54 6578 7449 4f57        io_TextIOW
-0000e610: 7261 7070 6572 203d 2069 6f2e 5465 7874  rapper = io.Text
-0000e620: 494f 5772 6170 7065 720a 2020 2020 2020  IOWrapper.      
-0000e630: 2020 7769 7468 2070 6174 6368 2822 696f    with patch("io
-0000e640: 2e54 6578 7449 4f57 7261 7070 6572 222c  .TextIOWrapper",
-0000e650: 205f 6e65 775f 7772 6170 7065 7228 6f75   _new_wrapper(ou
-0000e660: 7470 7574 2c20 696f 5f54 6578 7449 4f57  tput, io_TextIOW
-0000e670: 7261 7070 6572 2929 3a0a 2020 2020 2020  rapper)):.      
-0000e680: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e690: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000e6a0: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
-0000e6b0: 5f73 7464 6f75 7428 0a20 2020 2020 2020  _stdout(.       
-0000e6c0: 2020 2020 2020 2020 2020 2020 2066 6173               fas
-0000e6d0: 743d 5472 7565 2c0a 2020 2020 2020 2020  t=True,.        
-0000e6e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000e6f0: 656e 743d 2222 2c0a 2020 2020 2020 2020  ent="",.        
-0000e700: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-0000e710: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
-0000e720: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-0000e750: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-0000e760: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000e770: 2065 7863 6570 7420 696f 2e55 6e73 7570   except io.Unsup
-0000e780: 706f 7274 6564 4f70 6572 6174 696f 6e3a  portedOperation:
-0000e790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e7a0: 2070 6173 7320 2023 2053 7472 696e 6749   pass  # StringI
-0000e7b0: 4f20 646f 6573 206e 6f74 2073 7570 706f  O does not suppo
-0000e7c0: 7274 2064 6574 6163 680a 2020 2020 2020  rt detach.      
-0000e7d0: 2020 2020 2020 6173 7365 7274 206f 7574        assert out
-0000e7e0: 7075 742e 6765 7476 616c 7565 2829 203d  put.getvalue() =
-0000e7f0: 3d20 2222 0a0a 2020 2020 6465 6620 7465  = ""..    def te
-0000e800: 7374 5f69 6e76 616c 6964 5f63 6c69 5f72  st_invalid_cli_r
-0000e810: 6567 6578 2873 656c 6629 202d 3e20 4e6f  egex(self) -> No
-0000e820: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
-0000e830: 6f70 7469 6f6e 2069 6e20 5b22 2d2d 696e  option in ["--in
-0000e840: 636c 7564 6522 2c20 222d 2d65 7863 6c75  clude", "--exclu
-0000e850: 6465 222c 2022 2d2d 6578 7465 6e64 2d65  de", "--extend-e
-0000e860: 7863 6c75 6465 222c 2022 2d2d 666f 7263  xclude", "--forc
-0000e870: 652d 6578 636c 7564 6522 5d3a 0a20 2020  e-exclude"]:.   
-0000e880: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-0000e890: 766f 6b65 426c 6163 6b28 5b22 2d22 2c20  vokeBlack(["-", 
-0000e8a0: 6f70 7469 6f6e 2c20 222a 2a28 2928 2121  option, "**()(!!
-0000e8b0: 2a29 225d 2c20 6578 6974 5f63 6f64 653d  *)"], exit_code=
-0000e8c0: 3229 0a0a 2020 2020 6465 6620 7465 7374  2)..    def test
-0000e8d0: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
-0000e8e0: 6e5f 6d61 7463 6865 735f 7665 7273 696f  n_matches_versio
-0000e8f0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-0000e900: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0000e910: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
-0000e920: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
-0000e930: 7265 642d 7665 7273 696f 6e22 2c20 626c  red-version", bl
-0000e940: 6163 6b2e 5f5f 7665 7273 696f 6e5f 5f2c  ack.__version__,
-0000e950: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
-0000e960: 2020 2020 2020 2020 2065 7869 745f 636f           exit_co
-0000e970: 6465 3d30 2c0a 2020 2020 2020 2020 2020  de=0,.          
-0000e980: 2020 6967 6e6f 7265 5f63 6f6e 6669 673d    ignore_config=
-0000e990: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
-0000e9a0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-0000e9b0: 7175 6972 6564 5f76 6572 7369 6f6e 5f6d  quired_version_m
-0000e9c0: 6174 6368 6573 5f70 6172 7469 616c 5f76  atches_partial_v
-0000e9d0: 6572 7369 6f6e 2873 656c 6629 202d 3e20  ersion(self) -> 
-0000e9e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
-0000e9f0: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
-0000ea00: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000ea10: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000ea20: 222c 2062 6c61 636b 2e5f 5f76 6572 7369  ", black.__versi
-0000ea30: 6f6e 5f5f 2e73 706c 6974 2822 2e22 295b  on__.split(".")[
-0000ea40: 305d 2c20 222d 6322 2c20 2230 225d 2c0a  0], "-c", "0"],.
-0000ea50: 2020 2020 2020 2020 2020 2020 6578 6974              exit
-0000ea60: 5f63 6f64 653d 302c 0a20 2020 2020 2020  _code=0,.       
-0000ea70: 2020 2020 2069 676e 6f72 655f 636f 6e66       ignore_conf
-0000ea80: 6967 3d54 7275 652c 0a20 2020 2020 2020  ig=True,.       
-0000ea90: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0000eaa0: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
-0000eab0: 6e5f 646f 6573 5f6e 6f74 5f6d 6174 6368  n_does_not_match
-0000eac0: 5f6f 6e5f 6d69 6e6f 725f 7665 7273 696f  _on_minor_versio
-0000ead0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-0000eae0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0000eaf0: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
-0000eb00: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
-0000eb10: 7265 642d 7665 7273 696f 6e22 2c20 626c  red-version", bl
-0000eb20: 6163 6b2e 5f5f 7665 7273 696f 6e5f 5f2e  ack.__version__.
-0000eb30: 7370 6c69 7428 222e 2229 5b30 5d20 2b20  split(".")[0] + 
-0000eb40: 222e 3939 3922 2c20 222d 6322 2c20 2230  ".999", "-c", "0
-0000eb50: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0000eb60: 6578 6974 5f63 6f64 653d 312c 0a20 2020  exit_code=1,.   
-0000eb70: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-0000eb80: 636f 6e66 6967 3d54 7275 652c 0a20 2020  config=True,.   
-0000eb90: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-0000eba0: 7465 7374 5f72 6571 7569 7265 645f 7665  test_required_ve
-0000ebb0: 7273 696f 6e5f 646f 6573 5f6e 6f74 5f6d  rsion_does_not_m
-0000ebc0: 6174 6368 5f76 6572 7369 6f6e 2873 656c  atch_version(sel
-0000ebd0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000ebe0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
-0000ebf0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
-0000ec00: 6528 0a20 2020 2020 2020 2020 2020 2062  e(.            b
-0000ec10: 6c61 636b 2e6d 6169 6e2c 0a20 2020 2020  lack.main,.     
-0000ec20: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
-0000ec30: 7265 642d 7665 7273 696f 6e22 2c20 2232  red-version", "2
-0000ec40: 302e 3939 6222 2c20 222d 6322 2c20 2230  0.99b", "-c", "0
-0000ec50: 225d 2c0a 2020 2020 2020 2020 290a 2020  "],.        ).  
-0000ec60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000ec70: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
-0000ec80: 6974 5f63 6f64 652c 2031 290a 2020 2020  it_code, 1).    
-0000ec90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000eca0: 6e28 2272 6571 7569 7265 6420 7665 7273  n("required vers
-0000ecb0: 696f 6e22 2c20 7265 7375 6c74 2e73 7464  ion", result.std
-0000ecc0: 6572 7229 0a0a 2020 2020 6465 6620 7465  err)..    def te
-0000ecd0: 7374 5f70 7265 7365 7276 6573 5f6c 696e  st_preserves_lin
-0000ece0: 655f 656e 6469 6e67 7328 7365 6c66 2920  e_endings(self) 
-0000ecf0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000ed00: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
-0000ed10: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
-0000ed20: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-0000ed30: 2020 2020 2074 6573 745f 6669 6c65 203d       test_file =
-0000ed40: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
-0000ed50: 202f 2022 7465 7374 2e70 7922 0a20 2020   / "test.py".   
-0000ed60: 2020 2020 2020 2020 2066 6f72 206e 6c20           for nl 
-0000ed70: 696e 205b 225c 6e22 2c20 225c 725c 6e22  in ["\n", "\r\n"
-0000ed80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0000ed90: 2020 2063 6f6e 7465 6e74 7320 3d20 6e6c     contents = nl
-0000eda0: 2e6a 6f69 6e28 5b22 6465 6620 6628 2020  .join(["def f(  
-0000edb0: 293a 222c 2022 2020 2020 7061 7373 225d  ):", "    pass"]
-0000edc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000edd0: 2020 7465 7374 5f66 696c 652e 7772 6974    test_file.writ
-0000ede0: 655f 6279 7465 7328 636f 6e74 656e 7473  e_bytes(contents
-0000edf0: 2e65 6e63 6f64 6528 2929 0a20 2020 2020  .encode()).     
-0000ee00: 2020 2020 2020 2020 2020 2066 6628 7465             ff(te
-0000ee10: 7374 5f66 696c 652c 2077 7269 7465 5f62  st_file, write_b
-0000ee20: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-0000ee30: 6163 6b2e 5945 5329 0a20 2020 2020 2020  ack.YES).       
-0000ee40: 2020 2020 2020 2020 2075 7064 6174 6564           updated
-0000ee50: 5f63 6f6e 7465 6e74 733a 2062 7974 6573  _contents: bytes
-0000ee60: 203d 2074 6573 745f 6669 6c65 2e72 6561   = test_file.rea
-0000ee70: 645f 6279 7465 7328 290a 2020 2020 2020  d_bytes().      
-0000ee80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000ee90: 7373 6572 7449 6e28 6e6c 2e65 6e63 6f64  ssertIn(nl.encod
-0000eea0: 6528 292c 2075 7064 6174 6564 5f63 6f6e  e(), updated_con
-0000eeb0: 7465 6e74 7329 0a20 2020 2020 2020 2020  tents).         
-0000eec0: 2020 2020 2020 2069 6620 6e6c 203d 3d20         if nl == 
-0000eed0: 225c 6e22 3a0a 2020 2020 2020 2020 2020  "\n":.          
-0000eee0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000eef0: 7373 6572 744e 6f74 496e 2862 225c 725c  ssertNotIn(b"\r\
-0000ef00: 6e22 2c20 7570 6461 7465 645f 636f 6e74  n", updated_cont
-0000ef10: 656e 7473 290a 0a20 2020 2064 6566 2074  ents)..    def t
-0000ef20: 6573 745f 7072 6573 6572 7665 735f 6c69  est_preserves_li
-0000ef30: 6e65 5f65 6e64 696e 6773 5f76 6961 5f73  ne_endings_via_s
-0000ef40: 7464 696e 2873 656c 6629 202d 3e20 4e6f  tdin(self) -> No
-0000ef50: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
-0000ef60: 6e6c 2069 6e20 5b22 5c6e 222c 2022 5c72  nl in ["\n", "\r
-0000ef70: 5c6e 225d 3a0a 2020 2020 2020 2020 2020  \n"]:.          
-0000ef80: 2020 636f 6e74 656e 7473 203d 206e 6c2e    contents = nl.
-0000ef90: 6a6f 696e 285b 2264 6566 2066 2820 2029  join(["def f(  )
-0000efa0: 3a22 2c20 2220 2020 2070 6173 7322 5d29  :", "    pass"])
-0000efb0: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
-0000efc0: 6e65 7220 3d20 426c 6163 6b52 756e 6e65  ner = BlackRunne
-0000efd0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-0000efe0: 7265 7375 6c74 203d 2072 756e 6e65 722e  result = runner.
-0000eff0: 696e 766f 6b65 280a 2020 2020 2020 2020  invoke(.        
-0000f000: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
-0000f010: 696e 2c20 5b22 2d22 2c20 222d 2d66 6173  in, ["-", "--fas
-0000f020: 7422 5d2c 2069 6e70 7574 3d42 7974 6573  t"], input=Bytes
-0000f030: 494f 2863 6f6e 7465 6e74 732e 656e 636f  IO(contents.enco
-0000f040: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
-0000f050: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000f060: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000f070: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
-0000f080: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
-0000f090: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-0000f0a0: 2072 6573 756c 742e 7374 646f 7574 5f62   result.stdout_b
-0000f0b0: 7974 6573 0a20 2020 2020 2020 2020 2020  ytes.           
-0000f0c0: 2073 656c 662e 6173 7365 7274 496e 286e   self.assertIn(n
-0000f0d0: 6c2e 656e 636f 6465 2822 7574 6638 2229  l.encode("utf8")
-0000f0e0: 2c20 6f75 7470 7574 290a 2020 2020 2020  , output).      
-0000f0f0: 2020 2020 2020 6966 206e 6c20 3d3d 2022        if nl == "
-0000f100: 5c6e 223a 0a20 2020 2020 2020 2020 2020  \n":.           
-0000f110: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000f120: 4e6f 7449 6e28 6222 5c72 5c6e 222c 206f  NotIn(b"\r\n", o
-0000f130: 7574 7075 7429 0a0a 2020 2020 6465 6620  utput)..    def 
-0000f140: 7465 7374 5f6e 6f72 6d61 6c69 7a65 5f6c  test_normalize_l
-0000f150: 696e 655f 656e 6469 6e67 7328 7365 6c66  ine_endings(self
-0000f160: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000f170: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
-0000f180: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
-0000f190: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-0000f1a0: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
-0000f1b0: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
-0000f1c0: 6529 202f 2022 7465 7374 2e70 7922 0a20  e) / "test.py". 
-0000f1d0: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0000f1e0: 6174 612c 2065 7870 6563 7465 6420 696e  ata, expected in
-0000f1f0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000f200: 2020 2028 6222 635c 725c 6e63 5c6e 2022     (b"c\r\nc\n "
-0000f210: 2c20 6222 635c 725c 6e63 5c72 5c6e 2229  , b"c\r\nc\r\n")
-0000f220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f230: 2020 2862 226c 5c6e 6c5c 725c 6e20 222c    (b"l\nl\r\n ",
-0000f240: 2062 226c 5c6e 6c5c 6e22 292c 0a20 2020   b"l\nl\n"),.   
-0000f250: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-0000f260: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000f270: 5f66 696c 652e 7772 6974 655f 6279 7465  _file.write_byte
-0000f280: 7328 6461 7461 290a 2020 2020 2020 2020  s(data).        
-0000f290: 2020 2020 2020 2020 6666 2874 6573 745f          ff(test_
-0000f2a0: 6669 6c65 2c20 7772 6974 655f 6261 636b  file, write_back
-0000f2b0: 3d62 6c61 636b 2e57 7269 7465 4261 636b  =black.WriteBack
-0000f2c0: 2e59 4553 290a 2020 2020 2020 2020 2020  .YES).          
-0000f2d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000f2e0: 7445 7175 616c 2874 6573 745f 6669 6c65  tEqual(test_file
-0000f2f0: 2e72 6561 645f 6279 7465 7328 292c 2065  .read_bytes(), e
-0000f300: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
-0000f310: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
-0000f320: 7569 7661 6c65 6e74 5f64 6966 6665 7265  uivalent_differe
-0000f330: 6e74 5f61 7374 7328 7365 6c66 2920 2d3e  nt_asts(self) ->
-0000f340: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
-0000f350: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0000f360: 6169 7365 7328 4173 7365 7274 696f 6e45  aises(AssertionE
-0000f370: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0000f380: 2020 2062 6c61 636b 2e61 7373 6572 745f     black.assert_
-0000f390: 6571 7569 7661 6c65 6e74 2822 7b7d 222c  equivalent("{}",
-0000f3a0: 2022 4e6f 6e65 2229 0a0a 2020 2020 6465   "None")..    de
-0000f3b0: 6620 7465 7374 5f73 6868 685f 636c 6963  f test_shhh_clic
-0000f3c0: 6b28 7365 6c66 2920 2d3e 204e 6f6e 653a  k(self) -> None:
-0000f3d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000f3e0: 2020 2020 2020 2020 2020 6672 6f6d 2063            from c
-0000f3f0: 6c69 636b 2069 6d70 6f72 7420 5f75 6e69  lick import _uni
-0000f400: 636f 6465 6675 6e20 2023 2074 7970 653a  codefun  # type:
-0000f410: 2069 676e 6f72 650a 2020 2020 2020 2020   ignore.        
-0000f420: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-0000f430: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-0000f440: 7365 6c66 2e73 6b69 7054 6573 7428 2249  self.skipTest("I
-0000f450: 6e63 6f6d 7061 7469 626c 6520 436c 6963  ncompatible Clic
-0000f460: 6b20 7665 7273 696f 6e22 290a 0a20 2020  k version")..   
-0000f470: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
-0000f480: 7474 7228 5f75 6e69 636f 6465 6675 6e2c  ttr(_unicodefun,
-0000f490: 2022 5f76 6572 6966 795f 7079 7468 6f6e   "_verify_python
-0000f4a0: 5f65 6e76 2229 3a0a 2020 2020 2020 2020  _env"):.        
-0000f4b0: 2020 2020 7365 6c66 2e73 6b69 7054 6573      self.skipTes
-0000f4c0: 7428 2249 6e63 6f6d 7061 7469 626c 6520  t("Incompatible 
-0000f4d0: 436c 6963 6b20 7665 7273 696f 6e22 290a  Click version").
-0000f4e0: 0a20 2020 2020 2020 2023 2046 6972 7374  .        # First
-0000f4f0: 2c20 6c65 7427 7320 7365 6520 6966 2043  , let's see if C
-0000f500: 6c69 636b 2069 7320 6372 6173 6869 6e67  lick is crashing
-0000f510: 2077 6974 6820 6120 7072 6566 6572 7265   with a preferre
-0000f520: 6420 4153 4349 4920 6368 6172 7365 742e  d ASCII charset.
-0000f530: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
-0000f540: 7463 6828 226c 6f63 616c 652e 6765 7470  tch("locale.getp
-0000f550: 7265 6665 7272 6564 656e 636f 6469 6e67  referredencoding
-0000f560: 2229 2061 7320 6770 653a 0a20 2020 2020  ") as gpe:.     
-0000f570: 2020 2020 2020 2067 7065 2e72 6574 7572         gpe.retur
-0000f580: 6e5f 7661 6c75 6520 3d20 2241 5343 4949  n_value = "ASCII
-0000f590: 220a 2020 2020 2020 2020 2020 2020 7769  ".            wi
-0000f5a0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-0000f5b0: 6973 6573 2852 756e 7469 6d65 4572 726f  ises(RuntimeErro
-0000f5c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0000f5d0: 2020 2020 5f75 6e69 636f 6465 6675 6e2e      _unicodefun.
-0000f5e0: 5f76 6572 6966 795f 7079 7468 6f6e 5f65  _verify_python_e
-0000f5f0: 6e76 2829 0a20 2020 2020 2020 2023 204e  nv().        # N
-0000f600: 6f77 2c20 6c65 7427 7320 7369 6c65 6e63  ow, let's silenc
-0000f610: 6520 436c 6963 6b2e 2e2e 0a20 2020 2020  e Click....     
-0000f620: 2020 2062 6c61 636b 2e70 6174 6368 5f63     black.patch_c
-0000f630: 6c69 636b 2829 0a20 2020 2020 2020 2023  lick().        #
-0000f640: 202e 2e2e 616e 6420 636f 6e66 6972 6d20   ...and confirm 
-0000f650: 6974 2773 2073 696c 656e 742e 0a20 2020  it's silent..   
-0000f660: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
-0000f670: 226c 6f63 616c 652e 6765 7470 7265 6665  "locale.getprefe
-0000f680: 7272 6564 656e 636f 6469 6e67 2229 2061  rredencoding") a
-0000f690: 7320 6770 653a 0a20 2020 2020 2020 2020  s gpe:.         
-0000f6a0: 2020 2067 7065 2e72 6574 7572 6e5f 7661     gpe.return_va
-0000f6b0: 6c75 6520 3d20 2241 5343 4949 220a 2020  lue = "ASCII".  
-0000f6c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0000f6d0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000f6e0: 756e 6963 6f64 6566 756e 2e5f 7665 7269  unicodefun._veri
-0000f6f0: 6679 5f70 7974 686f 6e5f 656e 7628 290a  fy_python_env().
-0000f700: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000f710: 7074 2052 756e 7469 6d65 4572 726f 7220  pt RuntimeError 
-0000f720: 6173 2072 653a 0a20 2020 2020 2020 2020  as re:.         
-0000f730: 2020 2020 2020 2073 656c 662e 6661 696c         self.fail
-0000f740: 2866 2260 7061 7463 685f 636c 6963 6b28  (f"`patch_click(
-0000f750: 2960 2066 6169 6c65 642c 2065 7863 6570  )` failed, excep
-0000f760: 7469 6f6e 2073 7469 6c6c 2072 6169 7365  tion still raise
-0000f770: 643a 207b 7265 7d22 290a 0a20 2020 2064  d: {re}")..    d
-0000f780: 6566 2074 6573 745f 726f 6f74 5f6c 6f67  ef test_root_log
-0000f790: 6765 725f 6e6f 745f 7573 6564 5f64 6972  ger_not_used_dir
-0000f7a0: 6563 746c 7928 7365 6c66 2920 2d3e 204e  ectly(self) -> N
-0000f7b0: 6f6e 653a 0a20 2020 2020 2020 2064 6566  one:.        def
-0000f7c0: 2066 6169 6c28 2a61 7267 733a 2041 6e79   fail(*args: Any
-0000f7d0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-0000f7e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000f7f0: 2020 2020 2020 7365 6c66 2e66 6169 6c28        self.fail(
-0000f800: 2252 6563 6f72 6420 6372 6561 7465 6420  "Record created 
-0000f810: 7769 7468 2072 6f6f 7420 6c6f 6767 6572  with root logger
-0000f820: 2229 0a0a 2020 2020 2020 2020 7769 7468  ")..        with
-0000f830: 2070 6174 6368 2e6d 756c 7469 706c 6528   patch.multiple(
-0000f840: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000f850: 6769 6e67 2e72 6f6f 742c 0a20 2020 2020  ging.root,.     
-0000f860: 2020 2020 2020 2064 6562 7567 3d66 6169         debug=fai
-0000f870: 6c2c 0a20 2020 2020 2020 2020 2020 2069  l,.            i
-0000f880: 6e66 6f3d 6661 696c 2c0a 2020 2020 2020  nfo=fail,.      
-0000f890: 2020 2020 2020 7761 726e 696e 673d 6661        warning=fa
-0000f8a0: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
-0000f8b0: 6572 726f 723d 6661 696c 2c0a 2020 2020  error=fail,.    
-0000f8c0: 2020 2020 2020 2020 6372 6974 6963 616c          critical
-0000f8d0: 3d66 6169 6c2c 0a20 2020 2020 2020 2020  =fail,.         
-0000f8e0: 2020 206c 6f67 3d66 6169 6c2c 0a20 2020     log=fail,.   
-0000f8f0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0000f900: 2020 2020 6666 2854 4849 535f 4449 5220      ff(THIS_DIR 
-0000f910: 2f20 2275 7469 6c2e 7079 2229 0a0a 2020  / "util.py")..  
-0000f920: 2020 6465 6620 7465 7374 5f69 6e76 616c    def test_inval
-0000f930: 6964 5f63 6f6e 6669 675f 7265 7475 726e  id_config_return
-0000f940: 5f63 6f64 6528 7365 6c66 2920 2d3e 204e  _code(self) -> N
-0000f950: 6f6e 653a 0a20 2020 2020 2020 2074 6d70  one:.        tmp
-0000f960: 5f66 696c 6520 3d20 5061 7468 2862 6c61  _file = Path(bla
-0000f970: 636b 2e64 756d 705f 746f 5f66 696c 6528  ck.dump_to_file(
-0000f980: 2929 0a20 2020 2020 2020 2074 7279 3a0a  )).        try:.
-0000f990: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
-0000f9a0: 636f 6e66 6967 203d 2050 6174 6828 626c  config = Path(bl
-0000f9b0: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
-0000f9c0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-0000f9d0: 746d 705f 636f 6e66 6967 2e75 6e6c 696e  tmp_config.unlin
-0000f9e0: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-0000f9f0: 6172 6773 203d 205b 222d 2d63 6f6e 6669  args = ["--confi
-0000fa00: 6722 2c20 7374 7228 746d 705f 636f 6e66  g", str(tmp_conf
-0000fa10: 6967 292c 2073 7472 2874 6d70 5f66 696c  ig), str(tmp_fil
-0000fa20: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
-0000fa30: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000fa40: 2861 7267 732c 2065 7869 745f 636f 6465  (args, exit_code
-0000fa50: 3d32 2c20 6967 6e6f 7265 5f63 6f6e 6669  =2, ignore_confi
-0000fa60: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
-0000fa70: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-0000fa80: 2020 2020 2020 746d 705f 6669 6c65 2e75        tmp_file.u
-0000fa90: 6e6c 696e 6b28 290a 0a20 2020 2064 6566  nlink()..    def
-0000faa0: 2074 6573 745f 7061 7273 655f 7079 7072   test_parse_pypr
-0000fab0: 6f6a 6563 745f 746f 6d6c 2873 656c 6629  oject_toml(self)
-0000fac0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000fad0: 2020 7465 7374 5f74 6f6d 6c5f 6669 6c65    test_toml_file
-0000fae0: 203d 2054 4849 535f 4449 5220 2f20 2274   = THIS_DIR / "t
-0000faf0: 6573 742e 746f 6d6c 220a 2020 2020 2020  est.toml".      
-0000fb00: 2020 636f 6e66 6967 203d 2062 6c61 636b    config = black
-0000fb10: 2e70 6172 7365 5f70 7970 726f 6a65 6374  .parse_pyproject
-0000fb20: 5f74 6f6d 6c28 7374 7228 7465 7374 5f74  _toml(str(test_t
-0000fb30: 6f6d 6c5f 6669 6c65 2929 0a20 2020 2020  oml_file)).     
-0000fb40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000fb50: 7561 6c28 636f 6e66 6967 5b22 7665 7262  ual(config["verb
-0000fb60: 6f73 6522 5d2c 2031 290a 2020 2020 2020  ose"], 1).      
-0000fb70: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000fb80: 616c 2863 6f6e 6669 675b 2263 6865 636b  al(config["check
-0000fb90: 225d 2c20 226e 6f22 290a 2020 2020 2020  "], "no").      
-0000fba0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000fbb0: 616c 2863 6f6e 6669 675b 2264 6966 6622  al(config["diff"
-0000fbc0: 5d2c 2022 7922 290a 2020 2020 2020 2020  ], "y").        
-0000fbd0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000fbe0: 2863 6f6e 6669 675b 2263 6f6c 6f72 225d  (config["color"]
-0000fbf0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-0000fc00: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000fc10: 2863 6f6e 6669 675b 226c 696e 655f 6c65  (config["line_le
-0000fc20: 6e67 7468 225d 2c20 3739 290a 2020 2020  ngth"], 79).    
-0000fc30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000fc40: 7175 616c 2863 6f6e 6669 675b 2274 6172  qual(config["tar
-0000fc50: 6765 745f 7665 7273 696f 6e22 5d2c 205b  get_version"], [
-0000fc60: 2270 7933 3622 2c20 2270 7933 3722 2c20  "py36", "py37", 
-0000fc70: 2270 7933 3822 5d29 0a20 2020 2020 2020  "py38"]).       
-0000fc80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000fc90: 6c28 636f 6e66 6967 5b22 7079 7468 6f6e  l(config["python
-0000fca0: 5f63 656c 6c5f 6d61 6769 6373 225d 2c20  _cell_magics"], 
-0000fcb0: 5b22 6375 7374 6f6d 3122 2c20 2263 7573  ["custom1", "cus
-0000fcc0: 746f 6d32 225d 290a 2020 2020 2020 2020  tom2"]).        
-0000fcd0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000fce0: 2863 6f6e 6669 675b 2265 7863 6c75 6465  (config["exclude
-0000fcf0: 225d 2c20 7222 5c2e 7079 693f 2422 290a  "], r"\.pyi?$").
-0000fd00: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000fd10: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000fd20: 2269 6e63 6c75 6465 225d 2c20 7222 5c2e  "include"], r"\.
-0000fd30: 7079 3f24 2229 0a0a 2020 2020 6465 6620  py?$")..    def 
-0000fd40: 7465 7374 5f70 6172 7365 5f70 7970 726f  test_parse_pypro
-0000fd50: 6a65 6374 5f74 6f6d 6c5f 7072 6f6a 6563  ject_toml_projec
-0000fd60: 745f 6d65 7461 6461 7461 2873 656c 6629  t_metadata(self)
-0000fd70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000fd80: 2020 666f 7220 7465 7374 5f74 6f6d 6c2c    for test_toml,
-0000fd90: 2065 7870 6563 7465 6420 696e 205b 0a20   expected in [. 
-0000fda0: 2020 2020 2020 2020 2020 2028 226f 6e6c             ("onl
-0000fdb0: 795f 626c 6163 6b5f 7079 7072 6f6a 6563  y_black_pyprojec
-0000fdc0: 742e 746f 6d6c 222c 205b 2270 7933 3130  t.toml", ["py310
-0000fdd0: 225d 292c 0a20 2020 2020 2020 2020 2020  "]),.           
-0000fde0: 2028 226f 6e6c 795f 6d65 7461 6461 7461   ("only_metadata
-0000fdf0: 5f70 7970 726f 6a65 6374 2e74 6f6d 6c22  _pyproject.toml"
-0000fe00: 2c20 5b22 7079 3337 222c 2022 7079 3338  , ["py37", "py38
-0000fe10: 222c 2022 7079 3339 222c 2022 7079 3331  ", "py39", "py31
-0000fe20: 3022 5d29 2c0a 2020 2020 2020 2020 2020  0"]),.          
-0000fe30: 2020 2822 6e65 6974 6865 725f 7079 7072    ("neither_pypr
-0000fe40: 6f6a 6563 742e 746f 6d6c 222c 204e 6f6e  oject.toml", Non
-0000fe50: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-0000fe60: 2822 626f 7468 5f70 7970 726f 6a65 6374  ("both_pyproject
-0000fe70: 2e74 6f6d 6c22 2c20 5b22 7079 3331 3022  .toml", ["py310"
-0000fe80: 5d29 2c0a 2020 2020 2020 2020 5d3a 0a20  ]),.        ]:. 
-0000fe90: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-0000fea0: 746f 6d6c 5f66 696c 6520 3d20 5448 4953  toml_file = THIS
-0000feb0: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
-0000fec0: 2270 726f 6a65 6374 5f6d 6574 6164 6174  "project_metadat
-0000fed0: 6122 202f 2074 6573 745f 746f 6d6c 0a20  a" / test_toml. 
-0000fee0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0000fef0: 6720 3d20 626c 6163 6b2e 7061 7273 655f  g = black.parse_
-0000ff00: 7079 7072 6f6a 6563 745f 746f 6d6c 2873  pyproject_toml(s
-0000ff10: 7472 2874 6573 745f 746f 6d6c 5f66 696c  tr(test_toml_fil
-0000ff20: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0000ff30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ff40: 2863 6f6e 6669 672e 6765 7428 2274 6172  (config.get("tar
-0000ff50: 6765 745f 7665 7273 696f 6e22 292c 2065  get_version"), e
-0000ff60: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
-0000ff70: 6620 7465 7374 5f69 6e66 6572 5f74 6172  f test_infer_tar
-0000ff80: 6765 745f 7665 7273 696f 6e28 7365 6c66  get_version(self
-0000ff90: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000ffa0: 2020 2066 6f72 2076 6572 7369 6f6e 2c20     for version, 
-0000ffb0: 6578 7065 6374 6564 2069 6e20 5b0a 2020  expected in [.  
-0000ffc0: 2020 2020 2020 2020 2020 2822 332e 3622            ("3.6"
-0000ffd0: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
-0000ffe0: 2e50 5933 365d 292c 0a20 2020 2020 2020  .PY36]),.       
-0000fff0: 2020 2020 2028 2233 2e31 312e 3072 6331       ("3.11.0rc1
-00010000: 222c 205b 5461 7267 6574 5665 7273 696f  ", [TargetVersio
-00010010: 6e2e 5059 3331 315d 292c 0a20 2020 2020  n.PY311]),.     
-00010020: 2020 2020 2020 2028 223e 3d33 2e31 3022         (">=3.10"
-00010030: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
-00010040: 2e50 5933 3130 2c20 5461 7267 6574 5665  .PY310, TargetVe
-00010050: 7273 696f 6e2e 5059 3331 315d 292c 0a20  rsion.PY311]),. 
-00010060: 2020 2020 2020 2020 2020 2028 223e 3d33             (">=3
-00010070: 2e31 302e 3622 2c20 5b54 6172 6765 7456  .10.6", [TargetV
-00010080: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
-00010090: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
-000100a0: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
-000100b0: 2028 223c 332e 3622 2c20 5b54 6172 6765   ("<3.6", [Targe
-000100c0: 7456 6572 7369 6f6e 2e50 5933 332c 2054  tVersion.PY33, T
-000100d0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-000100e0: 342c 2054 6172 6765 7456 6572 7369 6f6e  4, TargetVersion
-000100f0: 2e50 5933 355d 292c 0a20 2020 2020 2020  .PY35]),.       
-00010100: 2020 2020 2028 223e 332e 372c 3c33 2e31       (">3.7,<3.1
-00010110: 3022 2c20 5b54 6172 6765 7456 6572 7369  0", [TargetVersi
-00010120: 6f6e 2e50 5933 382c 2054 6172 6765 7456  on.PY38, TargetV
-00010130: 6572 7369 6f6e 2e50 5933 395d 292c 0a20  ersion.PY39]),. 
-00010140: 2020 2020 2020 2020 2020 2028 223e 332e             (">3.
-00010150: 372c 213d 332e 382c 213d 332e 3922 2c20  7,!=3.8,!=3.9", 
-00010160: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
-00010170: 5933 3130 2c20 5461 7267 6574 5665 7273  Y310, TargetVers
-00010180: 696f 6e2e 5059 3331 315d 292c 0a20 2020  ion.PY311]),.   
-00010190: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-000101a0: 2020 2020 2020 2020 2020 2022 3e20 332e             "> 3.
-000101b0: 392e 342c 2021 3d20 332e 3130 2e33 222c  9.4, != 3.10.3",
-000101c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000101d0: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
-000101e0: 5059 3339 2c20 5461 7267 6574 5665 7273  PY39, TargetVers
-000101f0: 696f 6e2e 5059 3331 302c 2054 6172 6765  ion.PY310, Targe
-00010200: 7456 6572 7369 6f6e 2e50 5933 3131 5d2c  tVersion.PY311],
-00010210: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00010220: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-00010230: 2020 2020 2020 2020 2020 2020 2020 2221                "!
-00010240: 3d33 2e33 2c21 3d33 2e34 222c 0a20 2020  =3.3,!=3.4",.   
-00010250: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
-00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010270: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
-00010280: 2e50 5933 352c 0a20 2020 2020 2020 2020  .PY35,.         
-00010290: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
-000102a0: 7456 6572 7369 6f6e 2e50 5933 362c 0a20  tVersion.PY36,. 
-000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102c0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
-000102d0: 2e50 5933 372c 0a20 2020 2020 2020 2020  .PY37,.         
-000102e0: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
-000102f0: 7456 6572 7369 6f6e 2e50 5933 382c 0a20  tVersion.PY38,. 
-00010300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010310: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
-00010320: 2e50 5933 392c 0a20 2020 2020 2020 2020  .PY39,.         
-00010330: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
-00010340: 7456 6572 7369 6f6e 2e50 5933 3130 2c0a  tVersion.PY310,.
-00010350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010360: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
-00010370: 6e2e 5059 3331 312c 0a20 2020 2020 2020  n.PY311,.       
-00010380: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
-00010390: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-000103a0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-000103b0: 2020 2020 2020 2020 2022 3d3d 332e 2a22           "==3.*"
-000103c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000103d0: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
-000103e0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-000103f0: 7273 696f 6e2e 5059 3333 2c0a 2020 2020  rsion.PY33,.    
-00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010410: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-00010420: 3334 2c0a 2020 2020 2020 2020 2020 2020  34,.            
-00010430: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-00010440: 7273 696f 6e2e 5059 3335 2c0a 2020 2020  rsion.PY35,.    
-00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010460: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-00010470: 3336 2c0a 2020 2020 2020 2020 2020 2020  36,.            
-00010480: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-00010490: 7273 696f 6e2e 5059 3337 2c0a 2020 2020  rsion.PY37,.    
-000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104b0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-000104c0: 3338 2c0a 2020 2020 2020 2020 2020 2020  38,.            
-000104d0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-000104e0: 7273 696f 6e2e 5059 3339 2c0a 2020 2020  rsion.PY39,.    
-000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010500: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-00010510: 3331 302c 0a20 2020 2020 2020 2020 2020  310,.           
-00010520: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
-00010530: 6572 7369 6f6e 2e50 5933 3131 2c0a 2020  ersion.PY311,.  
-00010540: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
-00010550: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00010560: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
-00010570: 332e 382e 2a22 2c20 5b54 6172 6765 7456  3.8.*", [TargetV
-00010580: 6572 7369 6f6e 2e50 5933 385d 292c 0a20  ersion.PY38]),. 
-00010590: 2020 2020 2020 2020 2020 2028 4e6f 6e65             (None
-000105a0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-000105b0: 2020 2020 2028 2222 2c20 4e6f 6e65 292c       ("", None),
-000105c0: 0a20 2020 2020 2020 2020 2020 2028 2269  .            ("i
-000105d0: 6e76 616c 6964 222c 204e 6f6e 6529 2c0a  nvalid", None),.
-000105e0: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
-000105f0: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
-00010600: 0a20 2020 2020 2020 2020 2020 2028 223e  .            (">
-00010610: 332e 392c 213d 696e 7661 6c69 6422 2c20  3.9,!=invalid", 
-00010620: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
-00010630: 2020 2028 2233 222c 204e 6f6e 6529 2c0a     ("3", None),.
-00010640: 2020 2020 2020 2020 2020 2020 2822 332e              ("3.
-00010650: 3222 2c20 4e6f 6e65 292c 0a20 2020 2020  2", None),.     
-00010660: 2020 2020 2020 2028 2232 2e37 2e31 3822         ("2.7.18"
-00010670: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-00010680: 2020 2020 2028 223d 3d32 2e37 222c 204e       ("==2.7", N
-00010690: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
-000106a0: 2020 2822 3e33 2e31 302c 3c33 2e31 3122    (">3.10,<3.11"
-000106b0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-000106c0: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
-000106d0: 7465 7374 5f74 6f6d 6c20 3d20 7b22 7072  test_toml = {"pr
-000106e0: 6f6a 6563 7422 3a20 7b22 7265 7175 6972  oject": {"requir
-000106f0: 6573 2d70 7974 686f 6e22 3a20 7665 7273  es-python": vers
-00010700: 696f 6e7d 7d0a 2020 2020 2020 2020 2020  ion}}.          
-00010710: 2020 7265 7375 6c74 203d 2062 6c61 636b    result = black
-00010720: 2e66 696c 6573 2e69 6e66 6572 5f74 6172  .files.infer_tar
-00010730: 6765 745f 7665 7273 696f 6e28 7465 7374  get_version(test
-00010740: 5f74 6f6d 6c29 0a20 2020 2020 2020 2020  _toml).         
-00010750: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00010760: 7561 6c28 7265 7375 6c74 2c20 6578 7065  ual(result, expe
-00010770: 6374 6564 290a 0a20 2020 2064 6566 2074  cted)..    def t
-00010780: 6573 745f 7265 6164 5f70 7970 726f 6a65  est_read_pyproje
-00010790: 6374 5f74 6f6d 6c28 7365 6c66 2920 2d3e  ct_toml(self) ->
-000107a0: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
-000107b0: 6573 745f 746f 6d6c 5f66 696c 6520 3d20  est_toml_file = 
-000107c0: 5448 4953 5f44 4952 202f 2022 7465 7374  THIS_DIR / "test
-000107d0: 2e74 6f6d 6c22 0a20 2020 2020 2020 2066  .toml".        f
-000107e0: 616b 655f 6374 7820 3d20 4661 6b65 436f  ake_ctx = FakeCo
-000107f0: 6e74 6578 7428 290a 2020 2020 2020 2020  ntext().        
-00010800: 626c 6163 6b2e 7265 6164 5f70 7970 726f  black.read_pypro
-00010810: 6a65 6374 5f74 6f6d 6c28 6661 6b65 5f63  ject_toml(fake_c
-00010820: 7478 2c20 4661 6b65 5061 7261 6d65 7465  tx, FakeParamete
-00010830: 7228 292c 2073 7472 2874 6573 745f 746f  r(), str(test_to
-00010840: 6d6c 5f66 696c 6529 290a 2020 2020 2020  ml_file)).      
-00010850: 2020 636f 6e66 6967 203d 2066 616b 655f    config = fake_
-00010860: 6374 782e 6465 6661 756c 745f 6d61 700a  ctx.default_map.
-00010870: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00010880: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-00010890: 2276 6572 626f 7365 225d 2c20 2231 2229  "verbose"], "1")
-000108a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000108b0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-000108c0: 5b22 6368 6563 6b22 5d2c 2022 6e6f 2229  ["check"], "no")
-000108d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000108e0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-000108f0: 5b22 6469 6666 225d 2c20 2279 2229 0a20  ["diff"], "y"). 
-00010900: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00010910: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
-00010920: 636f 6c6f 7222 5d2c 2022 5472 7565 2229  color"], "True")
-00010930: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00010940: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-00010950: 5b22 6c69 6e65 5f6c 656e 6774 6822 5d2c  ["line_length"],
-00010960: 2022 3739 2229 0a20 2020 2020 2020 2073   "79").        s
-00010970: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00010980: 636f 6e66 6967 5b22 7461 7267 6574 5f76  config["target_v
-00010990: 6572 7369 6f6e 225d 2c20 5b22 7079 3336  ersion"], ["py36
-000109a0: 222c 2022 7079 3337 222c 2022 7079 3338  ", "py37", "py38
-000109b0: 225d 290a 2020 2020 2020 2020 7365 6c66  "]).        self
-000109c0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-000109d0: 6669 675b 2265 7863 6c75 6465 225d 2c20  fig["exclude"], 
-000109e0: 7222 5c2e 7079 693f 2422 290a 2020 2020  r"\.pyi?$").    
-000109f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00010a00: 7175 616c 2863 6f6e 6669 675b 2269 6e63  qual(config["inc
-00010a10: 6c75 6465 225d 2c20 7222 5c2e 7079 3f24  lude"], r"\.py?$
-00010a20: 2229 0a0a 2020 2020 4070 7974 6573 742e  ")..    @pytest.
-00010a30: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
-00010a40: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
-00010a50: 2064 6566 2074 6573 745f 6669 6e64 5f70   def test_find_p
-00010a60: 726f 6a65 6374 5f72 6f6f 7428 7365 6c66  roject_root(self
-00010a70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00010a80: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
-00010a90: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
-00010aa0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-00010ab0: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-00010ac0: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
-00010ad0: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
-00010ae0: 6972 203d 2072 6f6f 7420 2f20 2274 6573  ir = root / "tes
-00010af0: 7422 0a20 2020 2020 2020 2020 2020 2074  t".            t
-00010b00: 6573 745f 6469 722e 6d6b 6469 7228 290a  est_dir.mkdir().
-00010b10: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00010b20: 5f64 6972 203d 2072 6f6f 7420 2f20 2273  _dir = root / "s
-00010b30: 7263 220a 2020 2020 2020 2020 2020 2020  rc".            
-00010b40: 7372 635f 6469 722e 6d6b 6469 7228 290a  src_dir.mkdir().
-00010b50: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
-00010b60: 745f 7079 7072 6f6a 6563 7420 3d20 726f  t_pyproject = ro
-00010b70: 6f74 202f 2022 7079 7072 6f6a 6563 742e  ot / "pyproject.
-00010b80: 746f 6d6c 220a 2020 2020 2020 2020 2020  toml".          
-00010b90: 2020 726f 6f74 5f70 7970 726f 6a65 6374    root_pyproject
-00010ba0: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
-00010bb0: 2020 2020 2073 7263 5f70 7970 726f 6a65       src_pyproje
-00010bc0: 6374 203d 2073 7263 5f64 6972 202f 2022  ct = src_dir / "
-00010bd0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
-00010be0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00010bf0: 7079 7072 6f6a 6563 742e 746f 7563 6828  pyproject.touch(
-00010c00: 290a 2020 2020 2020 2020 2020 2020 7372  ).            sr
-00010c10: 635f 7079 7468 6f6e 203d 2073 7263 5f64  c_python = src_d
-00010c20: 6972 202f 2022 666f 6f2e 7079 220a 2020  ir / "foo.py".  
-00010c30: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
-00010c40: 7468 6f6e 2e74 6f75 6368 2829 0a0a 2020  thon.touch()..  
-00010c50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00010c60: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00010c70: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00010c80: 6b2e 6669 6e64 5f70 726f 6a65 6374 5f72  k.find_project_r
-00010c90: 6f6f 7428 2873 7263 5f64 6972 2c20 7465  oot((src_dir, te
-00010ca0: 7374 5f64 6972 2929 2c0a 2020 2020 2020  st_dir)),.      
-00010cb0: 2020 2020 2020 2020 2020 2872 6f6f 742e            (root.
-00010cc0: 7265 736f 6c76 6528 292c 2022 7079 7072  resolve(), "pypr
-00010cd0: 6f6a 6563 742e 746f 6d6c 2229 2c0a 2020  oject.toml"),.  
-00010ce0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00010cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00010d00: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00010d10: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-00010d20: 6669 6e64 5f70 726f 6a65 6374 5f72 6f6f  find_project_roo
-00010d30: 7428 2873 7263 5f64 6972 2c29 292c 0a20  t((src_dir,)),. 
-00010d40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00010d50: 7372 635f 6469 722e 7265 736f 6c76 6528  src_dir.resolve(
-00010d60: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
-00010d70: 6d6c 2229 2c0a 2020 2020 2020 2020 2020  ml"),.          
-00010d80: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00010d90: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00010da0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00010db0: 2020 626c 6163 6b2e 6669 6e64 5f70 726f    black.find_pro
-00010dc0: 6a65 6374 5f72 6f6f 7428 2873 7263 5f70  ject_root((src_p
-00010dd0: 7974 686f 6e2c 2929 2c0a 2020 2020 2020  ython,)),.      
-00010de0: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
-00010df0: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
-00010e00: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
-00010e10: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00010e20: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00010e30: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
-00010e40: 7928 7465 7374 5f64 6972 293a 0a20 2020  y(test_dir):.   
-00010e50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00010e60: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e80: 2020 2062 6c61 636b 2e66 696e 645f 7072     black.find_pr
-00010e90: 6f6a 6563 745f 726f 6f74 2828 222d 222c  oject_root(("-",
-00010ea0: 292c 2073 7464 696e 5f66 696c 656e 616d  ), stdin_filenam
-00010eb0: 653d 222e 2e2f 7372 632f 612e 7079 2229  e="../src/a.py")
-00010ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010ed0: 2020 2020 2020 2873 7263 5f64 6972 2e72        (src_dir.r
-00010ee0: 6573 6f6c 7665 2829 2c20 2270 7970 726f  esolve(), "pypro
-00010ef0: 6a65 6374 2e74 6f6d 6c22 292c 0a20 2020  ject.toml"),.   
-00010f00: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00010f10: 2020 2020 4070 6174 6368 280a 2020 2020      @patch(.    
-00010f20: 2020 2020 2262 6c61 636b 2e66 696c 6573      "black.files
-00010f30: 2e66 696e 645f 7573 6572 5f70 7970 726f  .find_user_pypro
-00010f40: 6a65 6374 5f74 6f6d 6c22 2c0a 2020 2020  ject_toml",.    
-00010f50: 290a 2020 2020 6465 6620 7465 7374 5f66  ).    def test_f
-00010f60: 696e 645f 7079 7072 6f6a 6563 745f 746f  ind_pyproject_to
-00010f70: 6d6c 2873 656c 662c 2066 696e 645f 7573  ml(self, find_us
-00010f80: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
-00010f90: 6c3a 204d 6167 6963 4d6f 636b 2920 2d3e  l: MagicMock) ->
-00010fa0: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
-00010fb0: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
-00010fc0: 6374 5f74 6f6d 6c2e 7369 6465 5f65 6666  ct_toml.side_eff
-00010fd0: 6563 7420 3d20 5275 6e74 696d 6545 7272  ect = RuntimeErr
-00010fe0: 6f72 2829 0a0a 2020 2020 2020 2020 7769  or()..        wi
-00010ff0: 7468 2072 6564 6972 6563 745f 7374 6465  th redirect_stde
-00011000: 7272 2869 6f2e 5374 7269 6e67 494f 2829  rr(io.StringIO()
-00011010: 2920 6173 2073 7464 6572 723a 0a20 2020  ) as stderr:.   
-00011020: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00011030: 3d20 626c 6163 6b2e 6669 6c65 732e 6669  = black.files.fi
-00011040: 6e64 5f70 7970 726f 6a65 6374 5f74 6f6d  nd_pyproject_tom
-00011050: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00011060: 2020 2070 6174 685f 7365 6172 6368 5f73     path_search_s
-00011070: 7461 7274 3d28 7374 7228 5061 7468 2e63  tart=(str(Path.c
-00011080: 7764 2829 2e72 6f6f 7429 2c29 0a20 2020  wd().root),).   
-00011090: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000110a0: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
-000110b0: 7420 6973 204e 6f6e 650a 2020 2020 2020  t is None.      
-000110c0: 2020 6572 7220 3d20 7374 6465 7272 2e67    err = stderr.g
-000110d0: 6574 7661 6c75 6528 290a 2020 2020 2020  etvalue().      
-000110e0: 2020 6173 7365 7274 2022 4967 6e6f 7269    assert "Ignori
-000110f0: 6e67 2075 7365 7220 636f 6e66 6967 7572  ng user configur
-00011100: 6174 696f 6e22 2069 6e20 6572 720a 0a20  ation" in err.. 
-00011110: 2020 2040 7061 7463 6828 0a20 2020 2020     @patch(.     
-00011120: 2020 2022 626c 6163 6b2e 6669 6c65 732e     "black.files.
-00011130: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
-00011140: 6563 745f 746f 6d6c 222c 0a20 2020 2020  ect_toml",.     
-00011150: 2020 2062 6c61 636b 2e66 696c 6573 2e66     black.files.f
-00011160: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
-00011170: 6374 5f74 6f6d 6c2e 5f5f 7772 6170 7065  ct_toml.__wrappe
-00011180: 645f 5f2c 0a20 2020 2029 0a20 2020 2064  d__,.    ).    d
-00011190: 6566 2074 6573 745f 6669 6e64 5f75 7365  ef test_find_use
-000111a0: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
-000111b0: 5f6c 696e 7578 2873 656c 6629 202d 3e20  _linux(self) -> 
-000111c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-000111d0: 2073 7973 7465 6d28 2920 3d3d 2022 5769   system() == "Wi
-000111e0: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-000111f0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011200: 2020 2020 2320 5465 7374 2069 6620 5844      # Test if XD
-00011210: 475f 434f 4e46 4947 5f48 4f4d 4520 6973  G_CONFIG_HOME is
-00011220: 2063 6865 636b 6564 0a20 2020 2020 2020   checked.       
-00011230: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
-00011240: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
-00011250: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-00011260: 2020 2020 2074 6d70 5f75 7365 725f 636f       tmp_user_co
-00011270: 6e66 6967 203d 2050 6174 6828 776f 726b  nfig = Path(work
-00011280: 7370 6163 6529 202f 2022 626c 6163 6b22  space) / "black"
-00011290: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-000112a0: 6820 7061 7463 682e 6469 6374 2822 6f73  h patch.dict("os
-000112b0: 2e65 6e76 6972 6f6e 222c 207b 2258 4447  .environ", {"XDG
-000112c0: 5f43 4f4e 4649 475f 484f 4d45 223a 2077  _CONFIG_HOME": w
-000112d0: 6f72 6b73 7061 6365 7d29 3a0a 2020 2020  orkspace}):.    
-000112e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000112f0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00011300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011310: 2020 626c 6163 6b2e 6669 6c65 732e 6669    black.files.fi
-00011320: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
-00011330: 745f 746f 6d6c 2829 2c20 746d 705f 7573  t_toml(), tmp_us
-00011340: 6572 5f63 6f6e 6669 672e 7265 736f 6c76  er_config.resolv
-00011350: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00011360: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-00011370: 2054 6573 7420 6661 6c6c 6261 636b 2066   Test fallback f
-00011380: 6f72 2058 4447 5f43 4f4e 4649 475f 484f  or XDG_CONFIG_HO
-00011390: 4d45 0a20 2020 2020 2020 2077 6974 6820  ME.        with 
-000113a0: 7061 7463 682e 6469 6374 2822 6f73 2e65  patch.dict("os.e
-000113b0: 6e76 6972 6f6e 2229 3a0a 2020 2020 2020  nviron"):.      
-000113c0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-000113d0: 2e70 6f70 2822 5844 475f 434f 4e46 4947  .pop("XDG_CONFIG
-000113e0: 5f48 4f4d 4522 2c20 4e6f 6e65 290a 2020  _HOME", None).  
-000113f0: 2020 2020 2020 2020 2020 6661 6c6c 6261            fallba
-00011400: 636b 5f75 7365 725f 636f 6e66 6967 203d  ck_user_config =
-00011410: 2050 6174 6828 227e 2f2e 636f 6e66 6967   Path("~/.config
-00011420: 2229 2e65 7870 616e 6475 7365 7228 2920  ").expanduser() 
-00011430: 2f20 2262 6c61 636b 220a 2020 2020 2020  / "black".      
-00011440: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00011450: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00011460: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
-00011470: 6c65 732e 6669 6e64 5f75 7365 725f 7079  les.find_user_py
-00011480: 7072 6f6a 6563 745f 746f 6d6c 2829 2c20  project_toml(), 
-00011490: 6661 6c6c 6261 636b 5f75 7365 725f 636f  fallback_user_co
-000114a0: 6e66 6967 2e72 6573 6f6c 7665 2829 0a20  nfig.resolve(). 
-000114b0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000114c0: 2020 6465 6620 7465 7374 5f66 696e 645f    def test_find_
-000114d0: 7573 6572 5f70 7970 726f 6a65 6374 5f74  user_pyproject_t
-000114e0: 6f6d 6c5f 7769 6e64 6f77 7328 7365 6c66  oml_windows(self
-000114f0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00011500: 2020 2069 6620 7379 7374 656d 2829 2021     if system() !
-00011510: 3d20 2257 696e 646f 7773 223a 0a20 2020  = "Windows":.   
-00011520: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00011530: 0a20 2020 2020 2020 2075 7365 725f 636f  .        user_co
-00011540: 6e66 6967 5f70 6174 6820 3d20 5061 7468  nfig_path = Path
-00011550: 2e68 6f6d 6528 2920 2f20 222e 626c 6163  .home() / ".blac
-00011560: 6b22 0a20 2020 2020 2020 2073 656c 662e  k".        self.
-00011570: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00011580: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
-00011590: 696c 6573 2e66 696e 645f 7573 6572 5f70  iles.find_user_p
-000115a0: 7970 726f 6a65 6374 5f74 6f6d 6c28 292c  yproject_toml(),
-000115b0: 2075 7365 725f 636f 6e66 6967 5f70 6174   user_config_pat
-000115c0: 682e 7265 736f 6c76 6528 290a 2020 2020  h.resolve().    
-000115d0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
-000115e0: 6573 745f 6270 6f5f 3333 3636 305f 776f  est_bpo_33660_wo
-000115f0: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
-00011600: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00011610: 6966 2073 7973 7465 6d28 2920 3d3d 2022  if system() == "
-00011620: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
-00011630: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00011640: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-00011650: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
-00011660: 6973 7375 6533 3336 3630 0a20 2020 2020  issue33660.     
-00011670: 2020 2072 6f6f 7420 3d20 5061 7468 2822     root = Path("
-00011680: 2f22 290a 2020 2020 2020 2020 7769 7468  /").        with
-00011690: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
-000116a0: 7928 726f 6f74 293a 0a20 2020 2020 2020  y(root):.       
-000116b0: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
-000116c0: 2822 776f 726b 7370 6163 6522 2920 2f20  ("workspace") / 
-000116d0: 2270 726f 6a65 6374 220a 2020 2020 2020  "project".      
-000116e0: 2020 2020 2020 7265 706f 7274 203d 2062        report = b
-000116f0: 6c61 636b 2e52 6570 6f72 7428 7665 7262  lack.Report(verb
-00011700: 6f73 653d 5472 7565 290a 2020 2020 2020  ose=True).      
-00011710: 2020 2020 2020 6e6f 726d 616c 697a 6564        normalized
-00011720: 5f70 6174 6820 3d20 626c 6163 6b2e 6e6f  _path = black.no
-00011730: 726d 616c 697a 655f 7061 7468 5f6d 6179  rmalize_path_may
-00011740: 6265 5f69 676e 6f72 6528 7061 7468 2c20  be_ignore(path, 
-00011750: 726f 6f74 2c20 7265 706f 7274 290a 2020  root, report).  
-00011760: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00011770: 7373 6572 7445 7175 616c 286e 6f72 6d61  ssertEqual(norma
-00011780: 6c69 7a65 645f 7061 7468 2c20 2277 6f72  lized_path, "wor
-00011790: 6b73 7061 6365 2f70 726f 6a65 6374 2229  kspace/project")
-000117a0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-000117b0: 6f72 6d61 6c69 7a65 5f70 6174 685f 6967  ormalize_path_ig
-000117c0: 6e6f 7265 5f77 696e 646f 7773 5f6a 756e  nore_windows_jun
-000117d0: 6374 696f 6e73 5f6f 7574 7369 6465 5f6f  ctions_outside_o
-000117e0: 665f 726f 6f74 2873 656c 6629 202d 3e20  f_root(self) -> 
-000117f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00011800: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
-00011810: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-00011820: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011830: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-00011840: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-00011850: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
-00011860: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
-00011870: 6174 6828 776f 726b 7370 6163 6529 0a20  ath(workspace). 
-00011880: 2020 2020 2020 2020 2020 206a 756e 6374             junct
-00011890: 696f 6e5f 6469 7220 3d20 726f 6f74 202f  ion_dir = root /
-000118a0: 2022 6a75 6e63 7469 6f6e 220a 2020 2020   "junction".    
-000118b0: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
-000118c0: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-000118d0: 6f66 5f72 6f6f 7420 3d20 726f 6f74 202f  of_root = root /
-000118e0: 2022 2e2e 220a 2020 2020 2020 2020 2020   "..".          
-000118f0: 2020 6f73 2e73 7973 7465 6d28 6622 6d6b    os.system(f"mk
-00011900: 6c69 6e6b 202f 4a20 7b6a 756e 6374 696f  link /J {junctio
-00011910: 6e5f 6469 727d 207b 6a75 6e63 7469 6f6e  n_dir} {junction
-00011920: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-00011930: 6f66 5f72 6f6f 747d 2229 0a0a 2020 2020  of_root}")..    
-00011940: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-00011950: 2062 6c61 636b 2e52 6570 6f72 7428 7665   black.Report(ve
-00011960: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
-00011970: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
-00011980: 6564 5f70 6174 6820 3d20 626c 6163 6b2e  ed_path = black.
-00011990: 6e6f 726d 616c 697a 655f 7061 7468 5f6d  normalize_path_m
-000119a0: 6179 6265 5f69 676e 6f72 6528 0a20 2020  aybe_ignore(.   
-000119b0: 2020 2020 2020 2020 2020 2020 206a 756e               jun
-000119c0: 6374 696f 6e5f 6469 722c 2072 6f6f 742c  ction_dir, root,
-000119d0: 2072 6570 6f72 740a 2020 2020 2020 2020   report.        
-000119e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000119f0: 2020 2320 4d61 6e75 616c 6c79 2064 656c    # Manually del
-00011a00: 6574 6520 666f 7220 5079 7468 6f6e 203c  ete for Python <
-00011a10: 2033 2e38 0a20 2020 2020 2020 2020 2020   3.8.           
-00011a20: 206f 732e 7379 7374 656d 2866 2272 6d64   os.system(f"rmd
-00011a30: 6972 207b 6a75 6e63 7469 6f6e 5f64 6972  ir {junction_dir
-00011a40: 7d22 290a 0a20 2020 2020 2020 2020 2020  }")..           
-00011a50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011a60: 6c28 6e6f 726d 616c 697a 6564 5f70 6174  l(normalized_pat
-00011a70: 682c 204e 6f6e 6529 0a0a 2020 2020 6465  h, None)..    de
-00011a80: 6620 7465 7374 5f6e 6577 6c69 6e65 5f63  f test_newline_c
-00011a90: 6f6d 6d65 6e74 5f69 6e74 6572 6163 7469  omment_interacti
-00011aa0: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
-00011ab0: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
-00011ac0: 203d 2022 636c 6173 7320 413a 5c5c 5c72   = "class A:\\\r
-00011ad0: 5c6e 2320 7479 7065 3a20 6967 6e6f 7265  \n# type: ignore
-00011ae0: 5c6e 2070 6173 735c 6e22 0a20 2020 2020  \n pass\n".     
-00011af0: 2020 206f 7574 7075 7420 3d20 626c 6163     output = blac
-00011b00: 6b2e 666f 726d 6174 5f73 7472 2873 6f75  k.format_str(sou
-00011b10: 7263 652c 206d 6f64 653d 4445 4641 554c  rce, mode=DEFAUL
-00011b20: 545f 4d4f 4445 290a 2020 2020 2020 2020  T_MODE).        
-00011b30: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
-00011b40: 626c 6528 736f 7572 6365 2c20 6f75 7470  ble(source, outp
-00011b50: 7574 2c20 6d6f 6465 3d44 4546 4155 4c54  ut, mode=DEFAULT
-00011b60: 5f4d 4f44 4529 0a0a 2020 2020 6465 6620  _MODE)..    def 
-00011b70: 7465 7374 5f62 706f 5f32 3134 325f 776f  test_bpo_2142_wo
-00011b80: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
-00011b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00011ba0: 2320 6874 7470 733a 2f2f 6275 6773 2e70  # https://bugs.p
-00011bb0: 7974 686f 6e2e 6f72 672f 6973 7375 6532  ython.org/issue2
-00011bc0: 3134 320a 0a20 2020 2020 2020 2073 6f75  142..        sou
-00011bd0: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
-00011be0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
-00011bf0: 7322 2c20 226d 6973 7369 6e67 5f66 696e  s", "missing_fin
-00011c00: 616c 5f6e 6577 6c69 6e65 2229 0a20 2020  al_newline").   
-00011c10: 2020 2020 2023 2072 6561 645f 6461 7461       # read_data
-00011c20: 2061 6464 7320 6120 7472 6169 6c69 6e67   adds a trailing
-00011c30: 206e 6577 6c69 6e65 0a20 2020 2020 2020   newline.       
-00011c40: 2073 6f75 7263 6520 3d20 736f 7572 6365   source = source
-00011c50: 2e72 7374 7269 7028 290a 2020 2020 2020  .rstrip().      
-00011c60: 2020 6578 7065 6374 6564 2c20 5f20 3d20    expected, _ = 
-00011c70: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
-00011c80: 6c6c 616e 656f 7573 222c 2022 6d69 7373  llaneous", "miss
-00011c90: 696e 675f 6669 6e61 6c5f 6e65 776c 696e  ing_final_newlin
-00011ca0: 652e 6469 6666 2229 0a20 2020 2020 2020  e.diff").       
-00011cb0: 2074 6d70 5f66 696c 6520 3d20 5061 7468   tmp_file = Path
-00011cc0: 2862 6c61 636b 2e64 756d 705f 746f 5f66  (black.dump_to_f
-00011cd0: 696c 6528 736f 7572 6365 2c20 656e 7375  ile(source, ensu
-00011ce0: 7265 5f66 696e 616c 5f6e 6577 6c69 6e65  re_final_newline
-00011cf0: 3d46 616c 7365 2929 0a20 2020 2020 2020  =False)).       
-00011d00: 2064 6966 665f 6865 6164 6572 203d 2072   diff_header = r
-00011d10: 652e 636f 6d70 696c 6528 0a20 2020 2020  e.compile(.     
-00011d20: 2020 2020 2020 2072 6622 7b72 652e 6573         rf"{re.es
-00011d30: 6361 7065 2873 7472 2874 6d70 5f66 696c  cape(str(tmp_fil
-00011d40: 6529 297d 5c74 5c64 5c64 5c64 5c64 2d5c  e))}\t\d\d\d\d-\
-00011d50: 645c 642d 5c64 5c64 2022 0a20 2020 2020  d\d-\d\d ".     
-00011d60: 2020 2020 2020 2072 225c 645c 643a 5c64         r"\d\d:\d
-00011d70: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
-00011d80: 645c 645c 6420 5c2b 5c64 5c64 5c64 5c64  d\d\d \+\d\d\d\d
-00011d90: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00011da0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00011db0: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
-00011dc0: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
-00011dd0: 6b65 2862 6c61 636b 2e6d 6169 6e2c 205b  ke(black.main, [
-00011de0: 222d 2d64 6966 6622 2c20 7374 7228 746d  "--diff", str(tm
-00011df0: 705f 6669 6c65 295d 290a 2020 2020 2020  p_file)]).      
-00011e00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00011e10: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
-00011e20: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
-00011e30: 2020 2020 6669 6e61 6c6c 793a 0a20 2020      finally:.   
-00011e40: 2020 2020 2020 2020 206f 732e 756e 6c69           os.unli
-00011e50: 6e6b 2874 6d70 5f66 696c 6529 0a20 2020  nk(tmp_file).   
-00011e60: 2020 2020 2061 6374 7561 6c20 3d20 7265       actual = re
-00011e70: 7375 6c74 2e6f 7574 7075 740a 2020 2020  sult.output.    
-00011e80: 2020 2020 6163 7475 616c 203d 2064 6966      actual = dif
-00011e90: 665f 6865 6164 6572 2e73 7562 2844 4554  f_header.sub(DET
-00011ea0: 4552 4d49 4e49 5354 4943 5f48 4541 4445  ERMINISTIC_HEADE
-00011eb0: 522c 2061 6374 7561 6c29 0a20 2020 2020  R, actual).     
-00011ec0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00011ed0: 7561 6c28 6163 7475 616c 2c20 6578 7065  ual(actual, expe
-00011ee0: 6374 6564 290a 0a20 2020 2040 7374 6174  cted)..    @stat
-00011ef0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00011f00: 2063 6f6d 7061 7265 5f72 6573 756c 7473   compare_results
-00011f10: 280a 2020 2020 2020 2020 7265 7375 6c74  (.        result
-00011f20: 3a20 636c 6963 6b2e 7465 7374 696e 672e  : click.testing.
-00011f30: 5265 7375 6c74 2c20 6578 7065 6374 6564  Result, expected
-00011f40: 5f76 616c 7565 3a20 7374 722c 2065 7870  _value: str, exp
-00011f50: 6563 7465 645f 6578 6974 5f63 6f64 653a  ected_exit_code:
-00011f60: 2069 6e74 0a20 2020 2029 202d 3e20 4e6f   int.    ) -> No
-00011f70: 6e65 3a0a 2020 2020 2020 2020 2222 2248  ne:.        """H
-00011f80: 656c 7065 7220 6d65 7468 6f64 2074 6f20  elper method to 
-00011f90: 7465 7374 2074 6865 2076 616c 7565 2061  test the value a
-00011fa0: 6e64 2065 7869 7420 636f 6465 206f 6620  nd exit code of 
-00011fb0: 6120 636c 6963 6b20 5265 7375 6c74 2e22  a click Result."
-00011fc0: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
-00011fd0: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
-00011fe0: 7265 7375 6c74 2e6f 7574 7075 7420 3d3d  result.output ==
-00011ff0: 2065 7870 6563 7465 645f 7661 6c75 650a   expected_value.
-00012000: 2020 2020 2020 2020 292c 2022 5468 6520          ), "The 
-00012010: 6f75 7470 7574 2064 6964 206e 6f74 206d  output did not m
-00012020: 6174 6368 2074 6865 2065 7870 6563 7465  atch the expecte
-00012030: 6420 7661 6c75 652e 220a 2020 2020 2020  d value.".      
-00012040: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
-00012050: 6578 6974 5f63 6f64 6520 3d3d 2065 7870  exit_code == exp
-00012060: 6563 7465 645f 6578 6974 5f63 6f64 652c  ected_exit_code,
-00012070: 2022 5468 6520 6578 6974 2063 6f64 6520   "The exit code 
-00012080: 6973 2069 6e63 6f72 7265 6374 2e22 0a0a  is incorrect."..
-00012090: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
-000120a0: 655f 6f70 7469 6f6e 2873 656c 6629 202d  e_option(self) -
-000120b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000120c0: 2222 2254 6573 7420 7468 6520 636f 6465  """Test the code
-000120d0: 206f 7074 696f 6e20 7769 7468 206e 6f20   option with no 
-000120e0: 6368 616e 6765 732e 2222 220a 2020 2020  changes.""".    
-000120f0: 2020 2020 636f 6465 203d 2027 7072 696e      code = 'prin
-00012100: 7428 2248 656c 6c6f 2077 6f72 6c64 2229  t("Hello world")
-00012110: 5c6e 270a 2020 2020 2020 2020 6172 6773  \n'.        args
-00012120: 203d 205b 222d 2d63 6f64 6522 2c20 636f   = ["--code", co
-00012130: 6465 5d0a 2020 2020 2020 2020 7265 7375  de].        resu
-00012140: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
-00012150: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
-00012160: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
-00012170: 2020 2073 656c 662e 636f 6d70 6172 655f     self.compare_
-00012180: 7265 7375 6c74 7328 7265 7375 6c74 2c20  results(result, 
-00012190: 636f 6465 2c20 3029 0a0a 2020 2020 6465  code, 0)..    de
-000121a0: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
-000121b0: 6f6e 5f63 6861 6e67 6564 2873 656c 6629  on_changed(self)
-000121c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000121d0: 2020 2222 2254 6573 7420 7468 6520 636f    """Test the co
-000121e0: 6465 206f 7074 696f 6e20 7768 656e 2063  de option when c
-000121f0: 6861 6e67 6573 2061 7265 2072 6571 7569  hanges are requi
-00012200: 7265 642e 2222 220a 2020 2020 2020 2020  red.""".        
-00012210: 636f 6465 203d 2022 7072 696e 7428 2768  code = "print('h
-00012220: 656c 6c6f 2077 6f72 6c64 2729 220a 2020  ello world')".  
-00012230: 2020 2020 2020 666f 726d 6174 7465 6420        formatted 
-00012240: 3d20 626c 6163 6b2e 666f 726d 6174 5f73  = black.format_s
-00012250: 7472 2863 6f64 652c 206d 6f64 653d 4445  tr(code, mode=DE
-00012260: 4641 554c 545f 4d4f 4445 290a 0a20 2020  FAULT_MODE)..   
-00012270: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
-00012280: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
-00012290: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
-000122a0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-000122b0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-000122c0: 7329 0a0a 2020 2020 2020 2020 7365 6c66  s)..        self
-000122d0: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
-000122e0: 2872 6573 756c 742c 2066 6f72 6d61 7474  (result, formatt
-000122f0: 6564 2c20 3029 0a0a 2020 2020 6465 6620  ed, 0)..    def 
-00012300: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
-00012310: 5f63 6865 636b 2873 656c 6629 202d 3e20  _check(self) -> 
-00012320: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00012330: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
-00012340: 7074 696f 6e20 7768 656e 2063 6865 636b  ption when check
-00012350: 2069 7320 7061 7373 6564 2e22 2222 0a20   is passed.""". 
-00012360: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
-00012370: 2d2d 6368 6563 6b22 2c20 222d 2d63 6f64  --check", "--cod
-00012380: 6522 2c20 2770 7269 6e74 2822 4865 6c6c  e", 'print("Hell
-00012390: 6f20 776f 726c 6422 295c 6e27 5d0a 2020  o world")\n'].  
-000123a0: 2020 2020 2020 7265 7375 6c74 203d 2043        result = C
-000123b0: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
-000123c0: 6528 626c 6163 6b2e 6d61 696e 2c20 6172  e(black.main, ar
-000123d0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-000123e0: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
-000123f0: 2872 6573 756c 742c 2022 222c 2030 290a  (result, "", 0).
-00012400: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
-00012410: 6465 5f6f 7074 696f 6e5f 6368 6563 6b5f  de_option_check_
-00012420: 6368 616e 6765 6428 7365 6c66 2920 2d3e  changed(self) ->
-00012430: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00012440: 2222 5465 7374 2074 6865 2063 6f64 6520  ""Test the code 
-00012450: 6f70 7469 6f6e 2077 6865 6e20 6368 616e  option when chan
-00012460: 6765 7320 6172 6520 7265 7175 6972 6564  ges are required
-00012470: 2c20 616e 6420 6368 6563 6b20 6973 2070  , and check is p
-00012480: 6173 7365 642e 2222 220a 2020 2020 2020  assed.""".      
-00012490: 2020 6172 6773 203d 205b 222d 2d63 6865    args = ["--che
-000124a0: 636b 222c 2022 2d2d 636f 6465 222c 2022  ck", "--code", "
-000124b0: 7072 696e 7428 2768 656c 6c6f 2077 6f72  print('hello wor
-000124c0: 6c64 2729 225d 0a20 2020 2020 2020 2072  ld')"].        r
-000124d0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-000124e0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-000124f0: 2e6d 6169 6e2c 2061 7267 7329 0a20 2020  .main, args).   
-00012500: 2020 2020 2073 656c 662e 636f 6d70 6172       self.compar
-00012510: 655f 7265 7375 6c74 7328 7265 7375 6c74  e_results(result
-00012520: 2c20 2222 2c20 3129 0a0a 2020 2020 6465  , "", 1)..    de
-00012530: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
-00012540: 6f6e 5f64 6966 6628 7365 6c66 2920 2d3e  on_diff(self) ->
-00012550: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00012560: 2222 5465 7374 2074 6865 2063 6f64 6520  ""Test the code 
-00012570: 6f70 7469 6f6e 2077 6865 6e20 6469 6666  option when diff
-00012580: 2069 7320 7061 7373 6564 2e22 2222 0a20   is passed.""". 
-00012590: 2020 2020 2020 2063 6f64 6520 3d20 2270         code = "p
-000125a0: 7269 6e74 2827 6865 6c6c 6f20 776f 726c  rint('hello worl
-000125b0: 6427 2922 0a20 2020 2020 2020 2066 6f72  d')".        for
-000125c0: 6d61 7474 6564 203d 2062 6c61 636b 2e66  matted = black.f
-000125d0: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
-000125e0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-000125f0: 4529 0a20 2020 2020 2020 2072 6573 756c  E).        resul
-00012600: 745f 6469 6666 203d 2064 6966 6628 636f  t_diff = diff(co
-00012610: 6465 2c20 666f 726d 6174 7465 642c 2022  de, formatted, "
-00012620: 5354 4449 4e22 2c20 2253 5444 4f55 5422  STDIN", "STDOUT"
-00012630: 290a 0a20 2020 2020 2020 2061 7267 7320  )..        args 
-00012640: 3d20 5b22 2d2d 6469 6666 222c 2022 2d2d  = ["--diff", "--
-00012650: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
-00012660: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
-00012670: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-00012680: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-00012690: 7329 0a0a 2020 2020 2020 2020 2320 5265  s)..        # Re
-000126a0: 6d6f 7665 2074 696d 6520 6672 6f6d 2064  move time from d
-000126b0: 6966 660a 2020 2020 2020 2020 6f75 7470  iff.        outp
-000126c0: 7574 203d 2044 4946 465f 5449 4d45 2e73  ut = DIFF_TIME.s
-000126d0: 7562 2822 222c 2072 6573 756c 742e 6f75  ub("", result.ou
-000126e0: 7470 7574 290a 0a20 2020 2020 2020 2061  tput)..        a
-000126f0: 7373 6572 7420 6f75 7470 7574 203d 3d20  ssert output == 
-00012700: 7265 7375 6c74 5f64 6966 662c 2022 5468  result_diff, "Th
-00012710: 6520 6f75 7470 7574 2064 6964 206e 6f74  e output did not
-00012720: 206d 6174 6368 2074 6865 2065 7870 6563   match the expec
-00012730: 7465 6420 7661 6c75 652e 220a 2020 2020  ted value.".    
-00012740: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
-00012750: 742e 6578 6974 5f63 6f64 6520 3d3d 2030  t.exit_code == 0
-00012760: 2c20 2254 6865 2065 7869 7420 636f 6465  , "The exit code
-00012770: 2069 7320 696e 636f 7272 6563 742e 220a   is incorrect.".
-00012780: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
-00012790: 6465 5f6f 7074 696f 6e5f 636f 6c6f 725f  de_option_color_
-000127a0: 6469 6666 2873 656c 6629 202d 3e20 4e6f  diff(self) -> No
-000127b0: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
-000127c0: 6573 7420 7468 6520 636f 6465 206f 7074  est the code opt
-000127d0: 696f 6e20 7768 656e 2063 6f6c 6f72 2061  ion when color a
-000127e0: 6e64 2064 6966 6620 6172 6520 7061 7373  nd diff are pass
-000127f0: 6564 2e22 2222 0a20 2020 2020 2020 2063  ed.""".        c
-00012800: 6f64 6520 3d20 2270 7269 6e74 2827 6865  ode = "print('he
-00012810: 6c6c 6f20 776f 726c 6427 2922 0a20 2020  llo world')".   
-00012820: 2020 2020 2066 6f72 6d61 7474 6564 203d       formatted =
-00012830: 2062 6c61 636b 2e66 6f72 6d61 745f 7374   black.format_st
-00012840: 7228 636f 6465 2c20 6d6f 6465 3d44 4546  r(code, mode=DEF
-00012850: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
-00012860: 2020 2020 7265 7375 6c74 5f64 6966 6620      result_diff 
-00012870: 3d20 6469 6666 2863 6f64 652c 2066 6f72  = diff(code, for
-00012880: 6d61 7474 6564 2c20 2253 5444 494e 222c  matted, "STDIN",
-00012890: 2022 5354 444f 5554 2229 0a20 2020 2020   "STDOUT").     
-000128a0: 2020 2072 6573 756c 745f 6469 6666 203d     result_diff =
-000128b0: 2063 6f6c 6f72 5f64 6966 6628 7265 7375   color_diff(resu
-000128c0: 6c74 5f64 6966 6629 0a0a 2020 2020 2020  lt_diff)..      
-000128d0: 2020 6172 6773 203d 205b 222d 2d64 6966    args = ["--dif
-000128e0: 6622 2c20 222d 2d63 6f6c 6f72 222c 2022  f", "--color", "
-000128f0: 2d2d 636f 6465 222c 2063 6f64 655d 0a20  --code", code]. 
-00012900: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00012910: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
-00012920: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
-00012930: 7267 7329 0a0a 2020 2020 2020 2020 2320  rgs)..        # 
-00012940: 5265 6d6f 7665 2074 696d 6520 6672 6f6d  Remove time from
-00012950: 2064 6966 660a 2020 2020 2020 2020 6f75   diff.        ou
-00012960: 7470 7574 203d 2044 4946 465f 5449 4d45  tput = DIFF_TIME
-00012970: 2e73 7562 2822 222c 2072 6573 756c 742e  .sub("", result.
-00012980: 6f75 7470 7574 290a 0a20 2020 2020 2020  output)..       
-00012990: 2061 7373 6572 7420 6f75 7470 7574 203d   assert output =
-000129a0: 3d20 7265 7375 6c74 5f64 6966 662c 2022  = result_diff, "
-000129b0: 5468 6520 6f75 7470 7574 2064 6964 206e  The output did n
-000129c0: 6f74 206d 6174 6368 2074 6865 2065 7870  ot match the exp
-000129d0: 6563 7465 6420 7661 6c75 652e 220a 2020  ected value.".  
-000129e0: 2020 2020 2020 6173 7365 7274 2072 6573        assert res
-000129f0: 756c 742e 6578 6974 5f63 6f64 6520 3d3d  ult.exit_code ==
-00012a00: 2030 2c20 2254 6865 2065 7869 7420 636f   0, "The exit co
-00012a10: 6465 2069 7320 696e 636f 7272 6563 742e  de is incorrect.
-00012a20: 220a 0a20 2020 2040 7079 7465 7374 2e6d  "..    @pytest.m
-00012a30: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-00012a40: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-00012a50: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
-00012a60: 7469 6f6e 5f73 6166 6528 7365 6c66 2920  tion_safe(self) 
-00012a70: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00012a80: 2022 2222 5465 7374 2074 6861 7420 7468   """Test that th
-00012a90: 6520 636f 6465 206f 7074 696f 6e20 7468  e code option th
-00012aa0: 726f 7773 2061 6e20 6572 726f 7220 7768  rows an error wh
-00012ab0: 656e 2074 6865 2073 616e 6974 7920 6368  en the sanity ch
-00012ac0: 6563 6b73 2066 6169 6c2e 2222 220a 2020  ecks fail.""".  
-00012ad0: 2020 2020 2020 2320 5061 7463 6820 626c        # Patch bl
-00012ae0: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
-00012af0: 616c 656e 7420 746f 2065 6e73 7572 6520  alent to ensure 
-00012b00: 7468 6520 7361 6e69 7479 2063 6865 636b  the sanity check
-00012b10: 7320 6661 696c 0a20 2020 2020 2020 2077  s fail.        w
-00012b20: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
-00012b30: 2862 6c61 636b 2c20 2261 7373 6572 745f  (black, "assert_
-00012b40: 6571 7569 7661 6c65 6e74 222c 2073 6964  equivalent", sid
-00012b50: 655f 6566 6665 6374 3d41 7373 6572 7469  e_effect=Asserti
-00012b60: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
-00012b70: 2020 2020 2020 636f 6465 203d 2027 7072        code = 'pr
-00012b80: 696e 7428 2248 656c 6c6f 2077 6f72 6c64  int("Hello world
-00012b90: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
-00012ba0: 6572 726f 725f 6d73 6720 3d20 6622 7b63  error_msg = f"{c
-00012bb0: 6f64 657d 5c6e 6572 726f 723a 2063 616e  ode}\nerror: can
-00012bc0: 6e6f 7420 666f 726d 6174 203c 7374 7269  not format <stri
-00012bd0: 6e67 3e3a 205c 6e22 0a0a 2020 2020 2020  ng>: \n"..      
-00012be0: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-00012bf0: 2d73 6166 6522 2c20 222d 2d63 6f64 6522  -safe", "--code"
-00012c00: 2c20 636f 6465 5d0a 2020 2020 2020 2020  , code].        
-00012c10: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
-00012c20: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-00012c30: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
-00012c40: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00012c50: 656c 662e 636f 6d70 6172 655f 7265 7375  elf.compare_resu
-00012c60: 6c74 7328 7265 7375 6c74 2c20 6572 726f  lts(result, erro
-00012c70: 725f 6d73 672c 2031 3233 290a 0a20 2020  r_msg, 123)..   
-00012c80: 2064 6566 2074 6573 745f 636f 6465 5f6f   def test_code_o
-00012c90: 7074 696f 6e5f 6661 7374 2873 656c 6629  ption_fast(self)
-00012ca0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00012cb0: 2020 2222 2254 6573 7420 7468 6174 2074    """Test that t
-00012cc0: 6865 2063 6f64 6520 6f70 7469 6f6e 2069  he code option i
-00012cd0: 676e 6f72 6573 2065 7272 6f72 7320 7768  gnores errors wh
-00012ce0: 656e 2074 6865 2073 616e 6974 7920 6368  en the sanity ch
-00012cf0: 6563 6b73 2066 6169 6c2e 2222 220a 2020  ecks fail.""".  
-00012d00: 2020 2020 2020 2320 5061 7463 6820 626c        # Patch bl
-00012d10: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
-00012d20: 616c 656e 7420 746f 2065 6e73 7572 6520  alent to ensure 
-00012d30: 7468 6520 7361 6e69 7479 2063 6865 636b  the sanity check
-00012d40: 7320 6661 696c 0a20 2020 2020 2020 2077  s fail.        w
-00012d50: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
-00012d60: 2862 6c61 636b 2c20 2261 7373 6572 745f  (black, "assert_
-00012d70: 6571 7569 7661 6c65 6e74 222c 2073 6964  equivalent", sid
-00012d80: 655f 6566 6665 6374 3d41 7373 6572 7469  e_effect=Asserti
-00012d90: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
-00012da0: 2020 2020 2020 636f 6465 203d 2027 7072        code = 'pr
-00012db0: 696e 7428 2248 656c 6c6f 2077 6f72 6c64  int("Hello world
-00012dc0: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
-00012dd0: 666f 726d 6174 7465 6420 3d20 626c 6163  formatted = blac
-00012de0: 6b2e 666f 726d 6174 5f73 7472 2863 6f64  k.format_str(cod
-00012df0: 652c 206d 6f64 653d 4445 4641 554c 545f  e, mode=DEFAULT_
-00012e00: 4d4f 4445 290a 0a20 2020 2020 2020 2020  MODE)..         
-00012e10: 2020 2061 7267 7320 3d20 5b22 2d2d 6661     args = ["--fa
-00012e20: 7374 222c 2022 2d2d 636f 6465 222c 2063  st", "--code", c
-00012e30: 6f64 655d 0a20 2020 2020 2020 2020 2020  ode].           
-00012e40: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
-00012e50: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
-00012e60: 636b 2e6d 6169 6e2c 2061 7267 7329 0a0a  ck.main, args)..
-00012e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012e80: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
-00012e90: 2872 6573 756c 742c 2066 6f72 6d61 7474  (result, formatt
-00012ea0: 6564 2c20 3029 0a0a 2020 2020 4070 7974  ed, 0)..    @pyt
-00012eb0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-00012ec0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-00012ed0: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
-00012ee0: 6465 5f6f 7074 696f 6e5f 636f 6e66 6967  de_option_config
-00012ef0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00012f00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012f10: 2020 2020 5465 7374 2074 6861 7420 7468      Test that th
-00012f20: 6520 636f 6465 206f 7074 696f 6e20 6669  e code option fi
-00012f30: 6e64 7320 7468 6520 7079 7072 6f6a 6563  nds the pyprojec
-00012f40: 742e 746f 6d6c 2069 6e20 7468 6520 6375  t.toml in the cu
-00012f50: 7272 656e 7420 6469 7265 6374 6f72 792e  rrent directory.
-00012f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00012f70: 2020 2020 2077 6974 6820 7061 7463 682e       with patch.
-00012f80: 6f62 6a65 6374 2862 6c61 636b 2c20 2270  object(black, "p
-00012f90: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
-00012fa0: 6f6d 6c22 2c20 7265 7475 726e 5f76 616c  oml", return_val
-00012fb0: 7565 3d7b 7d29 2061 7320 7061 7273 653a  ue={}) as parse:
-00012fc0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00012fd0: 7320 3d20 5b22 2d2d 636f 6465 222c 2022  s = ["--code", "
-00012fe0: 7072 696e 7422 5d0a 2020 2020 2020 2020  print"].        
-00012ff0: 2020 2020 2320 5468 6973 2069 7320 7468      # This is th
-00013000: 6520 6f6e 6c79 2064 6972 6563 746f 7279  e only directory
-00013010: 206b 6e6f 776e 2074 6f20 636f 6e74 6169   known to contai
-00013020: 6e20 6120 7079 7072 6f6a 6563 742e 746f  n a pyproject.to
-00013030: 6d6c 0a20 2020 2020 2020 2020 2020 2077  ml.            w
-00013040: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
-00013050: 746f 7279 2850 524f 4a45 4354 5f52 4f4f  tory(PROJECT_ROO
-00013060: 5429 3a0a 2020 2020 2020 2020 2020 2020  T):.            
-00013070: 2020 2020 436c 6952 756e 6e65 7228 292e      CliRunner().
-00013080: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-00013090: 6e2c 2061 7267 7329 0a20 2020 2020 2020  n, args).       
-000130a0: 2020 2020 2020 2020 2070 7970 726f 6a65           pyproje
-000130b0: 6374 5f70 6174 6820 3d20 5061 7468 2850  ct_path = Path(P
-000130c0: 6174 682e 6377 6428 292c 2022 7079 7072  ath.cwd(), "pypr
-000130d0: 6f6a 6563 742e 746f 6d6c 2229 2e72 6573  oject.toml").res
-000130e0: 6f6c 7665 2829 0a0a 2020 2020 2020 2020  olve()..        
-000130f0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
-00013100: 2020 2020 2020 2020 2020 2020 206c 656e               len
-00013110: 2870 6172 7365 2e6d 6f63 6b5f 6361 6c6c  (parse.mock_call
-00013120: 7329 203e 3d20 310a 2020 2020 2020 2020  s) >= 1.        
-00013130: 2020 2020 292c 2022 4578 7065 6374 6564      ), "Expected
-00013140: 2063 6f6e 6669 6720 7061 7273 6520 746f   config parse to
-00013150: 2062 6520 6361 6c6c 6564 2077 6974 6820   be called with 
-00013160: 7468 6520 6375 7272 656e 7420 6469 7265  the current dire
-00013170: 6374 6f72 792e 220a 0a20 2020 2020 2020  ctory."..       
-00013180: 2020 2020 205f 2c20 6361 6c6c 5f61 7267       _, call_arg
-00013190: 732c 205f 203d 2070 6172 7365 2e6d 6f63  s, _ = parse.moc
-000131a0: 6b5f 6361 6c6c 735b 305d 0a20 2020 2020  k_calls[0].     
-000131b0: 2020 2020 2020 2061 7373 6572 7420 280a         assert (.
-000131c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131d0: 6361 6c6c 5f61 7267 735b 305d 2e6c 6f77  call_args[0].low
-000131e0: 6572 2829 203d 3d20 7374 7228 7079 7072  er() == str(pypr
-000131f0: 6f6a 6563 745f 7061 7468 292e 6c6f 7765  oject_path).lowe
-00013200: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-00013210: 292c 2022 496e 636f 7272 6563 7420 636f  ), "Incorrect co
-00013220: 6e66 6967 206c 6f61 6465 642e 220a 0a20  nfig loaded.".. 
-00013230: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-00013240: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
-00013250: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
-00013260: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
-00013270: 5f70 6172 656e 745f 636f 6e66 6967 2873  _parent_config(s
-00013280: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00013290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000132a0: 2020 5465 7374 2074 6861 7420 7468 6520    Test that the 
-000132b0: 636f 6465 206f 7074 696f 6e20 6669 6e64  code option find
-000132c0: 7320 7468 6520 7079 7072 6f6a 6563 742e  s the pyproject.
-000132d0: 746f 6d6c 2069 6e20 7468 6520 7061 7265  toml in the pare
-000132e0: 6e74 2064 6972 6563 746f 7279 2e0a 2020  nt directory..  
-000132f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013300: 2020 7769 7468 2070 6174 6368 2e6f 626a    with patch.obj
-00013310: 6563 7428 626c 6163 6b2c 2022 7061 7273  ect(black, "pars
-00013320: 655f 7079 7072 6f6a 6563 745f 746f 6d6c  e_pyproject_toml
-00013330: 222c 2072 6574 7572 6e5f 7661 6c75 653d  ", return_value=
-00013340: 7b7d 2920 6173 2070 6172 7365 3a0a 2020  {}) as parse:.  
-00013350: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-00013360: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-00013370: 5448 4953 5f44 4952 293a 0a20 2020 2020  THIS_DIR):.     
-00013380: 2020 2020 2020 2020 2020 2061 7267 7320             args 
-00013390: 3d20 5b22 2d2d 636f 6465 222c 2022 7072  = ["--code", "pr
-000133a0: 696e 7422 5d0a 2020 2020 2020 2020 2020  int"].          
-000133b0: 2020 2020 2020 436c 6952 756e 6e65 7228        CliRunner(
-000133c0: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
-000133d0: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
-000133e0: 2020 2020 2020 2020 2020 2020 7079 7072              pypr
-000133f0: 6f6a 6563 745f 7061 7468 203d 2050 6174  oject_path = Pat
-00013400: 6828 5061 7468 2829 2e63 7764 2829 2e70  h(Path().cwd().p
-00013410: 6172 656e 742c 2022 7079 7072 6f6a 6563  arent, "pyprojec
-00013420: 742e 746f 6d6c 2229 2e72 6573 6f6c 7665  t.toml").resolve
-00013430: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00013440: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
-00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013460: 6c65 6e28 7061 7273 652e 6d6f 636b 5f63  len(parse.mock_c
-00013470: 616c 6c73 2920 3e3d 2031 0a20 2020 2020  alls) >= 1.     
-00013480: 2020 2020 2020 2020 2020 2029 2c20 2245             ), "E
-00013490: 7870 6563 7465 6420 636f 6e66 6967 2070  xpected config p
-000134a0: 6172 7365 2074 6f20 6265 2063 616c 6c65  arse to be calle
-000134b0: 6420 7769 7468 2074 6865 2063 7572 7265  d with the curre
-000134c0: 6e74 2064 6972 6563 746f 7279 2e22 0a0a  nt directory."..
-000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134e0: 5f2c 2063 616c 6c5f 6172 6773 2c20 5f20  _, call_args, _ 
-000134f0: 3d20 7061 7273 652e 6d6f 636b 5f63 616c  = parse.mock_cal
-00013500: 6c73 5b30 5d0a 2020 2020 2020 2020 2020  ls[0].          
-00013510: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
-00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013530: 2020 2063 616c 6c5f 6172 6773 5b30 5d2e     call_args[0].
-00013540: 6c6f 7765 7228 2920 3d3d 2073 7472 2870  lower() == str(p
-00013550: 7970 726f 6a65 6374 5f70 6174 6829 2e6c  yproject_path).l
-00013560: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
-00013570: 2020 2020 2020 2029 2c20 2249 6e63 6f72         ), "Incor
-00013580: 7265 6374 2063 6f6e 6669 6720 6c6f 6164  rect config load
-00013590: 6564 2e22 0a0a 2020 2020 6465 6620 7465  ed."..    def te
-000135a0: 7374 5f66 6f72 5f68 616e 646c 6564 5f75  st_for_handled_u
-000135b0: 6e65 7870 6563 7465 645f 656f 665f 6572  nexpected_eof_er
-000135c0: 726f 7228 7365 6c66 2920 2d3e 204e 6f6e  ror(self) -> Non
-000135d0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-000135e0: 2020 2020 2020 2054 6573 7420 7468 6174         Test that
-000135f0: 2061 6e20 756e 6578 7065 6374 6564 2045   an unexpected E
-00013600: 4f46 2053 796e 7461 7845 7272 6f72 2069  OF SyntaxError i
-00013610: 7320 6e69 6365 6c79 2070 7265 7365 6e74  s nicely present
-00013620: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-00013630: 2020 2020 2020 2020 7769 7468 2070 7974          with pyt
-00013640: 6573 742e 7261 6973 6573 2862 6c61 636b  est.raises(black
-00013650: 2e70 6172 7369 6e67 2e49 6e76 616c 6964  .parsing.Invalid
-00013660: 496e 7075 7429 2061 7320 6578 635f 696e  Input) as exc_in
-00013670: 666f 3a0a 2020 2020 2020 2020 2020 2020  fo:.            
-00013680: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00013690: 7273 6528 2270 7269 6e74 2822 2c20 7b7d  rse("print(", {}
-000136a0: 290a 0a20 2020 2020 2020 2065 7863 5f69  )..        exc_i
-000136b0: 6e66 6f2e 6d61 7463 6828 2243 616e 6e6f  nfo.match("Canno
-000136c0: 7420 7061 7273 653a 2032 3a30 3a20 454f  t parse: 2:0: EO
-000136d0: 4620 696e 206d 756c 7469 2d6c 696e 6520  F in multi-line 
-000136e0: 7374 6174 656d 656e 7422 290a 0a20 2020  statement")..   
-000136f0: 2064 6566 2074 6573 745f 6571 7569 7661   def test_equiva
-00013700: 6c65 6e63 795f 6173 745f 7061 7273 655f  lency_ast_parse_
-00013710: 6661 696c 7572 655f 696e 636c 7564 6573  failure_includes
-00013720: 5f65 7272 6f72 2873 656c 6629 202d 3e20  _error(self) -> 
-00013730: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-00013740: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
-00013750: 2841 7373 6572 7469 6f6e 4572 726f 7229  (AssertionError)
-00013760: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
-00013770: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00013780: 745f 6571 7569 7661 6c65 6e74 2822 61c2  t_equivalent("a.
-00013790: abc2 bb61 2020 3d20 3122 2c20 2261 c2ab  ...a  = 1", "a..
-000137a0: c2bb 6120 203d 2031 2229 0a0a 2020 2020  ..a  = 1")..    
-000137b0: 2020 2020 6572 722e 6d61 7463 6828 222d      err.match("-
-000137c0: 2d73 6166 6522 290a 2020 2020 2020 2020  -safe").        
-000137d0: 2320 556e 666f 7274 756e 6174 656c 7920  # Unfortunately 
-000137e0: 7468 6520 5379 6e74 6178 4572 726f 7220  the SyntaxError 
-000137f0: 6d65 7373 6167 6520 6861 7320 6368 616e  message has chan
-00013800: 6765 6420 696e 206e 6577 6572 2076 6572  ged in newer ver
-00013810: 7369 6f6e 7320 736f 2077 650a 2020 2020  sions so we.    
-00013820: 2020 2020 2320 6361 6e27 7420 6d61 7463      # can't matc
-00013830: 6820 6974 2064 6972 6563 746c 792e 0a20  h it directly.. 
-00013840: 2020 2020 2020 2065 7272 2e6d 6174 6368         err.match
-00013850: 2822 696e 7661 6c69 6420 6368 6172 6163  ("invalid charac
-00013860: 7465 7222 290a 2020 2020 2020 2020 6572  ter").        er
-00013870: 722e 6d61 7463 6828 7222 5c28 3c75 6e6b  r.match(r"\(<unk
-00013880: 6e6f 776e 3e2c 206c 696e 6520 315c 2922  nown>, line 1\)"
-00013890: 290a 0a0a 636c 6173 7320 5465 7374 4361  )...class TestCa
-000138a0: 6368 696e 673a 0a20 2020 2064 6566 2074  ching:.    def t
-000138b0: 6573 745f 6765 745f 6361 6368 655f 6469  est_get_cache_di
-000138c0: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-000138d0: 0a20 2020 2020 2020 2074 6d70 5f70 6174  .        tmp_pat
-000138e0: 683a 2050 6174 682c 0a20 2020 2020 2020  h: Path,.       
-000138f0: 206d 6f6e 6b65 7970 6174 6368 3a20 7079   monkeypatch: py
-00013900: 7465 7374 2e4d 6f6e 6b65 7950 6174 6368  test.MonkeyPatch
-00013910: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-00013920: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00013930: 6520 6d75 6c74 6970 6c65 2063 6163 6865  e multiple cache
-00013940: 2064 6972 6563 746f 7269 6573 0a20 2020   directories.   
-00013950: 2020 2020 2077 6f72 6b73 7061 6365 3120       workspace1 
-00013960: 3d20 746d 705f 7061 7468 202f 2022 7773  = tmp_path / "ws
-00013970: 3122 0a20 2020 2020 2020 2077 6f72 6b73  1".        works
-00013980: 7061 6365 312e 6d6b 6469 7228 290a 2020  pace1.mkdir().  
-00013990: 2020 2020 2020 776f 726b 7370 6163 6532        workspace2
-000139a0: 203d 2074 6d70 5f70 6174 6820 2f20 2277   = tmp_path / "w
-000139b0: 7332 220a 2020 2020 2020 2020 776f 726b  s2".        work
-000139c0: 7370 6163 6532 2e6d 6b64 6972 2829 0a0a  space2.mkdir()..
-000139d0: 2020 2020 2020 2020 2320 466f 7263 6520          # Force 
-000139e0: 7573 6572 5f63 6163 6865 5f64 6972 2074  user_cache_dir t
-000139f0: 6f20 7573 6520 7468 6520 7465 6d70 6f72  o use the tempor
-00013a00: 6172 7920 6469 7265 6374 6f72 7920 666f  ary directory fo
-00013a10: 7220 6561 7369 6572 2061 7373 6572 7469  r easier asserti
-00013a20: 6f6e 730a 2020 2020 2020 2020 7061 7463  ons.        patc
-00013a30: 685f 7573 6572 5f63 6163 6865 5f64 6972  h_user_cache_dir
-00013a40: 203d 2070 6174 6368 280a 2020 2020 2020   = patch(.      
-00013a50: 2020 2020 2020 7461 7267 6574 3d22 626c        target="bl
-00013a60: 6163 6b2e 6361 6368 652e 7573 6572 5f63  ack.cache.user_c
-00013a70: 6163 6865 5f64 6972 222c 0a20 2020 2020  ache_dir",.     
-00013a80: 2020 2020 2020 2061 7574 6f73 7065 633d         autospec=
-00013a90: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00013aa0: 2020 7265 7475 726e 5f76 616c 7565 3d73    return_value=s
-00013ab0: 7472 2877 6f72 6b73 7061 6365 3129 2c0a  tr(workspace1),.
-00013ac0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00013ad0: 2020 2023 2049 6620 424c 4143 4b5f 4341     # If BLACK_CA
-00013ae0: 4348 455f 4449 5220 6973 206e 6f74 2073  CHE_DIR is not s
-00013af0: 6574 2c20 7573 6520 7573 6572 5f63 6163  et, use user_cac
-00013b00: 6865 5f64 6972 0a20 2020 2020 2020 206d  he_dir.        m
-00013b10: 6f6e 6b65 7970 6174 6368 2e64 656c 656e  onkeypatch.delen
-00013b20: 7628 2242 4c41 434b 5f43 4143 4845 5f44  v("BLACK_CACHE_D
-00013b30: 4952 222c 2072 6169 7369 6e67 3d46 616c  IR", raising=Fal
-00013b40: 7365 290a 2020 2020 2020 2020 7769 7468  se).        with
-00013b50: 2070 6174 6368 5f75 7365 725f 6361 6368   patch_user_cach
-00013b60: 655f 6469 723a 0a20 2020 2020 2020 2020  e_dir:.         
-00013b70: 2020 2061 7373 6572 7420 6765 745f 6361     assert get_ca
-00013b80: 6368 655f 6469 7228 2920 3d3d 2077 6f72  che_dir() == wor
-00013b90: 6b73 7061 6365 310a 0a20 2020 2020 2020  kspace1..       
-00013ba0: 2023 2049 6620 6974 2069 7320 7365 742c   # If it is set,
-00013bb0: 2075 7365 2074 6865 2070 6174 6820 7072   use the path pr
-00013bc0: 6f76 6964 6564 2069 6e20 7468 6520 656e  ovided in the en
-00013bd0: 7620 7661 722e 0a20 2020 2020 2020 206d  v var..        m
-00013be0: 6f6e 6b65 7970 6174 6368 2e73 6574 656e  onkeypatch.seten
-00013bf0: 7628 2242 4c41 434b 5f43 4143 4845 5f44  v("BLACK_CACHE_D
-00013c00: 4952 222c 2073 7472 2877 6f72 6b73 7061  IR", str(workspa
-00013c10: 6365 3229 290a 2020 2020 2020 2020 6173  ce2)).        as
-00013c20: 7365 7274 2067 6574 5f63 6163 6865 5f64  sert get_cache_d
-00013c30: 6972 2829 203d 3d20 776f 726b 7370 6163  ir() == workspac
-00013c40: 6532 0a0a 2020 2020 6465 6620 7465 7374  e2..    def test
-00013c50: 5f63 6163 6865 5f62 726f 6b65 6e5f 6669  _cache_broken_fi
-00013c60: 6c65 2873 656c 6629 202d 3e20 4e6f 6e65  le(self) -> None
-00013c70: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00013c80: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00013c90: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00013ca0: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-00013cb0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-00013cc0: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
-00013cd0: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
-00013ce0: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-00013cf0: 6163 6865 5f66 696c 652e 7772 6974 655f  ache_file.write_
-00013d00: 7465 7874 2822 7468 6973 2069 7320 6e6f  text("this is no
-00013d10: 7420 6120 7069 636b 6c65 2229 0a20 2020  t a pickle").   
-00013d20: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00013d30: 626c 6163 6b2e 7265 6164 5f63 6163 6865  black.read_cache
-00013d40: 286d 6f64 6529 203d 3d20 7b7d 0a20 2020  (mode) == {}.   
-00013d50: 2020 2020 2020 2020 2073 7263 203d 2028           src = (
-00013d60: 776f 726b 7370 6163 6520 2f20 2274 6573  workspace / "tes
-00013d70: 742e 7079 2229 2e72 6573 6f6c 7665 2829  t.py").resolve()
-00013d80: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00013d90: 2e77 7269 7465 5f74 6578 7428 2270 7269  .write_text("pri
-00013da0: 6e74 2827 6865 6c6c 6f27 2922 290a 2020  nt('hello')").  
-00013db0: 2020 2020 2020 2020 2020 696e 766f 6b65            invoke
-00013dc0: 426c 6163 6b28 5b73 7472 2873 7263 295d  Black([str(src)]
-00013dd0: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
-00013de0: 6368 6520 3d20 626c 6163 6b2e 7265 6164  che = black.read
-00013df0: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
-00013e00: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00013e10: 7374 7228 7372 6329 2069 6e20 6361 6368  str(src) in cach
-00013e20: 650a 0a20 2020 2064 6566 2074 6573 745f  e..    def test_
-00013e30: 6361 6368 655f 7369 6e67 6c65 5f66 696c  cache_single_fil
-00013e40: 655f 616c 7265 6164 795f 6361 6368 6564  e_already_cached
-00013e50: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00013e60: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00013e70: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00013e80: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00013e90: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
-00013ea0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00013eb0: 7263 203d 2028 776f 726b 7370 6163 6520  rc = (workspace 
-00013ec0: 2f20 2274 6573 742e 7079 2229 2e72 6573  / "test.py").res
-00013ed0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-00013ee0: 2020 2073 7263 2e77 7269 7465 5f74 6578     src.write_tex
-00013ef0: 7428 2270 7269 6e74 2827 6865 6c6c 6f27  t("print('hello'
-00013f00: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
-00013f10: 626c 6163 6b2e 7772 6974 655f 6361 6368  black.write_cach
-00013f20: 6528 7b7d 2c20 5b73 7263 5d2c 206d 6f64  e({}, [src], mod
-00013f30: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-00013f40: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-00013f50: 7372 6329 5d29 0a20 2020 2020 2020 2020  src)]).         
-00013f60: 2020 2061 7373 6572 7420 7372 632e 7265     assert src.re
-00013f70: 6164 5f74 6578 7428 2920 3d3d 2022 7072  ad_text() == "pr
-00013f80: 696e 7428 2768 656c 6c6f 2729 220a 0a20  int('hello')".. 
-00013f90: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
-00013fa0: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
-00013fb0: 6368 655f 6d75 6c74 6970 6c65 5f66 696c  che_multiple_fil
-00013fc0: 6573 2873 656c 6629 202d 3e20 4e6f 6e65  es(self) -> None
-00013fd0: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00013fe0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00013ff0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00014000: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-00014010: 6163 652c 2070 6174 6368 280a 2020 2020  ace, patch(.    
-00014020: 2020 2020 2020 2020 2263 6f6e 6375 7272          "concurr
-00014030: 656e 742e 6675 7475 7265 732e 5072 6f63  ent.futures.Proc
-00014040: 6573 7350 6f6f 6c45 7865 6375 746f 7222  essPoolExecutor"
-00014050: 2c20 6e65 773d 5468 7265 6164 506f 6f6c  , new=ThreadPool
-00014060: 4578 6563 7574 6f72 0a20 2020 2020 2020  Executor.       
-00014070: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00014080: 6f6e 6520 3d20 2877 6f72 6b73 7061 6365  one = (workspace
-00014090: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
-000140a0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-000140b0: 2020 2077 6974 6820 6f6e 652e 6f70 656e     with one.open
-000140c0: 2822 7722 2920 6173 2066 6f62 6a3a 0a20  ("w") as fobj:. 
-000140d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000140e0: 6f62 6a2e 7772 6974 6528 2270 7269 6e74  obj.write("print
-000140f0: 2827 6865 6c6c 6f27 2922 290a 2020 2020  ('hello')").    
-00014100: 2020 2020 2020 2020 7477 6f20 3d20 2877          two = (w
-00014110: 6f72 6b73 7061 6365 202f 2022 7477 6f2e  orkspace / "two.
-00014120: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
-00014130: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00014140: 7477 6f2e 6f70 656e 2822 7722 2920 6173  two.open("w") as
-00014150: 2066 6f62 6a3a 0a20 2020 2020 2020 2020   fobj:.         
-00014160: 2020 2020 2020 2066 6f62 6a2e 7772 6974         fobj.writ
-00014170: 6528 2270 7269 6e74 2827 6865 6c6c 6f27  e("print('hello'
-00014180: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
-00014190: 626c 6163 6b2e 7772 6974 655f 6361 6368  black.write_cach
-000141a0: 6528 7b7d 2c20 5b6f 6e65 5d2c 206d 6f64  e({}, [one], mod
-000141b0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-000141c0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-000141d0: 776f 726b 7370 6163 6529 5d29 0a20 2020  workspace)]).   
-000141e0: 2020 2020 2020 2020 2077 6974 6820 6f6e           with on
-000141f0: 652e 6f70 656e 2822 7222 2920 6173 2066  e.open("r") as f
-00014200: 6f62 6a3a 0a20 2020 2020 2020 2020 2020  obj:.           
-00014210: 2020 2020 2061 7373 6572 7420 666f 626a       assert fobj
-00014220: 2e72 6561 6428 2920 3d3d 2022 7072 696e  .read() == "prin
-00014230: 7428 2768 656c 6c6f 2729 220a 2020 2020  t('hello')".    
-00014240: 2020 2020 2020 2020 7769 7468 2074 776f          with two
-00014250: 2e6f 7065 6e28 2272 2229 2061 7320 666f  .open("r") as fo
-00014260: 626a 3a0a 2020 2020 2020 2020 2020 2020  bj:.            
-00014270: 2020 2020 6173 7365 7274 2066 6f62 6a2e      assert fobj.
-00014280: 7265 6164 2829 203d 3d20 2770 7269 6e74  read() == 'print
-00014290: 2822 6865 6c6c 6f22 295c 6e27 0a20 2020  ("hello")\n'.   
-000142a0: 2020 2020 2020 2020 2063 6163 6865 203d           cache =
-000142b0: 2062 6c61 636b 2e72 6561 645f 6361 6368   black.read_cach
-000142c0: 6528 6d6f 6465 290a 2020 2020 2020 2020  e(mode).        
-000142d0: 2020 2020 6173 7365 7274 2073 7472 286f      assert str(o
-000142e0: 6e65 2920 696e 2063 6163 6865 0a20 2020  ne) in cache.   
-000142f0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00014300: 7374 7228 7477 6f29 2069 6e20 6361 6368  str(two) in cach
-00014310: 650a 0a20 2020 2040 7079 7465 7374 2e6d  e..    @pytest.m
-00014320: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
-00014330: 2263 6f6c 6f72 222c 205b 4661 6c73 652c  "color", [False,
-00014340: 2054 7275 655d 2c20 6964 733d 5b22 6e6f   True], ids=["no
-00014350: 2d63 6f6c 6f72 222c 2022 7769 7468 2d63  -color", "with-c
-00014360: 6f6c 6f72 225d 290a 2020 2020 6465 6620  olor"]).    def 
-00014370: 7465 7374 5f6e 6f5f 6361 6368 655f 7768  test_no_cache_wh
-00014380: 656e 5f77 7269 7465 6261 636b 5f64 6966  en_writeback_dif
-00014390: 6628 7365 6c66 2c20 636f 6c6f 723a 2062  f(self, color: b
-000143a0: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
-000143b0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
-000143c0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-000143d0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-000143e0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
-000143f0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00014400: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
-00014410: 2274 6573 742e 7079 2229 2e72 6573 6f6c  "test.py").resol
-00014420: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
-00014430: 2077 6974 6820 7372 632e 6f70 656e 2822   with src.open("
-00014440: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
-00014450: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
-00014460: 6a2e 7772 6974 6528 2270 7269 6e74 2827  j.write("print('
-00014470: 6865 6c6c 6f27 2922 290a 2020 2020 2020  hello')").      
-00014480: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-00014490: 2822 626c 6163 6b2e 7265 6164 5f63 6163  ("black.read_cac
-000144a0: 6865 2229 2061 7320 7265 6164 5f63 6163  he") as read_cac
-000144b0: 6865 2c20 7061 7463 6828 0a20 2020 2020  he, patch(.     
-000144c0: 2020 2020 2020 2020 2020 2022 626c 6163             "blac
-000144d0: 6b2e 7772 6974 655f 6361 6368 6522 0a20  k.write_cache". 
-000144e0: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
-000144f0: 7772 6974 655f 6361 6368 653a 0a20 2020  write_cache:.   
-00014500: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00014510: 203d 205b 7374 7228 7372 6329 2c20 222d   = [str(src), "-
-00014520: 2d64 6966 6622 5d0a 2020 2020 2020 2020  -diff"].        
-00014530: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
-00014540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014550: 2020 2020 2020 636d 642e 6170 7065 6e64        cmd.append
-00014560: 2822 2d2d 636f 6c6f 7222 290a 2020 2020  ("--color").    
-00014570: 2020 2020 2020 2020 2020 2020 696e 766f              invo
-00014580: 6b65 426c 6163 6b28 636d 6429 0a20 2020  keBlack(cmd).   
-00014590: 2020 2020 2020 2020 2020 2020 2063 6163               cac
-000145a0: 6865 5f66 696c 6520 3d20 6765 745f 6361  he_file = get_ca
-000145b0: 6368 655f 6669 6c65 286d 6f64 6529 0a20  che_file(mode). 
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000145d0: 7373 6572 7420 6361 6368 655f 6669 6c65  ssert cache_file
-000145e0: 2e65 7869 7374 7328 2920 6973 2046 616c  .exists() is Fal
-000145f0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00014600: 2020 2077 7269 7465 5f63 6163 6865 2e61     write_cache.a
-00014610: 7373 6572 745f 6e6f 745f 6361 6c6c 6564  ssert_not_called
-00014620: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00014630: 2020 2072 6561 645f 6361 6368 652e 6173     read_cache.as
-00014640: 7365 7274 5f6e 6f74 5f63 616c 6c65 6428  sert_not_called(
-00014650: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
-00014660: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
-00014670: 2263 6f6c 6f72 222c 205b 4661 6c73 652c  "color", [False,
-00014680: 2054 7275 655d 2c20 6964 733d 5b22 6e6f   True], ids=["no
-00014690: 2d63 6f6c 6f72 222c 2022 7769 7468 2d63  -color", "with-c
-000146a0: 6f6c 6f72 225d 290a 2020 2020 4065 7665  olor"]).    @eve
-000146b0: 6e74 5f6c 6f6f 7028 290a 2020 2020 6465  nt_loop().    de
-000146c0: 6620 7465 7374 5f6f 7574 7075 745f 6c6f  f test_output_lo
-000146d0: 636b 696e 675f 7768 656e 5f77 7269 7465  cking_when_write
-000146e0: 6261 636b 5f64 6966 6628 7365 6c66 2c20  back_diff(self, 
-000146f0: 636f 6c6f 723a 2062 6f6f 6c29 202d 3e20  color: bool) -> 
-00014700: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-00014710: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
-00014720: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-00014730: 2020 2020 2020 2020 2066 6f72 2074 6167           for tag
-00014740: 2069 6e20 7261 6e67 6528 302c 2034 293a   in range(0, 4):
-00014750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014760: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
-00014770: 6520 2f20 6622 7465 7374 7b74 6167 7d2e  e / f"test{tag}.
-00014780: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
-00014790: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000147a0: 6974 6820 7372 632e 6f70 656e 2822 7722  ith src.open("w"
-000147b0: 2920 6173 2066 6f62 6a3a 0a20 2020 2020  ) as fobj:.     
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000147d0: 6f62 6a2e 7772 6974 6528 2270 7269 6e74  obj.write("print
-000147e0: 2827 6865 6c6c 6f27 2922 290a 2020 2020  ('hello')").    
-000147f0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-00014800: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
-00014810: 2020 2020 2262 6c61 636b 2e63 6f6e 6375      "black.concu
-00014820: 7272 656e 6379 2e4d 616e 6167 6572 222c  rrency.Manager",
-00014830: 2077 7261 7073 3d6d 756c 7469 7072 6f63   wraps=multiproc
-00014840: 6573 7369 6e67 2e4d 616e 6167 6572 0a20  essing.Manager. 
-00014850: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
-00014860: 6d67 723a 0a20 2020 2020 2020 2020 2020  mgr:.           
-00014870: 2020 2020 2063 6d64 203d 205b 222d 2d64       cmd = ["--d
-00014880: 6966 6622 2c20 7374 7228 776f 726b 7370  iff", str(worksp
-00014890: 6163 6529 5d0a 2020 2020 2020 2020 2020  ace)].          
-000148a0: 2020 2020 2020 6966 2063 6f6c 6f72 3a0a        if color:.
-000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148c0: 2020 2020 636d 642e 6170 7065 6e64 2822      cmd.append("
-000148d0: 2d2d 636f 6c6f 7222 290a 2020 2020 2020  --color").      
-000148e0: 2020 2020 2020 2020 2020 696e 766f 6b65            invoke
-000148f0: 426c 6163 6b28 636d 642c 2065 7869 745f  Black(cmd, exit_
-00014900: 636f 6465 3d30 290a 2020 2020 2020 2020  code=0).        
-00014910: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
-00014920: 736e 2774 2071 7569 7465 2064 6f69 6e67  sn't quite doing
-00014930: 2077 6861 7420 7765 2077 616e 742c 2062   what we want, b
-00014940: 7574 2069 6620 6974 205f 6973 6e27 745f  ut if it _isn't_
-00014950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014960: 2023 2063 616c 6c65 6420 7468 656e 2077   # called then w
-00014970: 6520 6361 6e6e 6f74 2062 6520 7573 696e  e cannot be usin
-00014980: 6720 7468 6520 6c6f 636b 2069 7420 7072  g the lock it pr
-00014990: 6f76 6964 6573 0a20 2020 2020 2020 2020  ovides.         
-000149a0: 2020 2020 2020 206d 6772 2e61 7373 6572         mgr.asser
-000149b0: 745f 6361 6c6c 6564 2829 0a0a 2020 2020  t_called()..    
-000149c0: 6465 6620 7465 7374 5f6e 6f5f 6361 6368  def test_no_cach
-000149d0: 655f 7768 656e 5f73 7464 696e 2873 656c  e_when_stdin(sel
-000149e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000149f0: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
-00014a00: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
-00014a10: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-00014a20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00014a30: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
-00014a40: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-00014a50: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00014a60: 2e6d 6169 6e2c 205b 222d 225d 2c20 696e  .main, ["-"], in
-00014a70: 7075 743d 4279 7465 7349 4f28 6222 7072  put=BytesIO(b"pr
-00014a80: 696e 7428 2768 656c 6c6f 2729 2229 0a20  int('hello')"). 
-00014a90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00014aa0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00014ab0: 6e6f 7420 7265 7375 6c74 2e65 7869 745f  not result.exit_
-00014ac0: 636f 6465 0a20 2020 2020 2020 2020 2020  code.           
-00014ad0: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
-00014ae0: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
-00014af0: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
-00014b00: 7373 6572 7420 6e6f 7420 6361 6368 655f  ssert not cache_
-00014b10: 6669 6c65 2e65 7869 7374 7328 290a 0a20  file.exists().. 
-00014b20: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
-00014b30: 5f63 6163 6865 5f6e 6f5f 6361 6368 6566  _cache_no_cachef
-00014b40: 696c 6528 7365 6c66 2920 2d3e 204e 6f6e  ile(self) -> Non
-00014b50: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-00014b60: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-00014b70: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-00014b80: 655f 6469 7228 293a 0a20 2020 2020 2020  e_dir():.       
-00014b90: 2020 2020 2061 7373 6572 7420 626c 6163       assert blac
-00014ba0: 6b2e 7265 6164 5f63 6163 6865 286d 6f64  k.read_cache(mod
-00014bb0: 6529 203d 3d20 7b7d 0a0a 2020 2020 6465  e) == {}..    de
-00014bc0: 6620 7465 7374 5f77 7269 7465 5f63 6163  f test_write_cac
-00014bd0: 6865 5f72 6561 645f 6361 6368 6528 7365  he_read_cache(se
-00014be0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00014bf0: 2020 2020 206d 6f64 6520 3d20 4445 4641       mode = DEFA
-00014c00: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
-00014c10: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
-00014c20: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-00014c30: 2020 2020 2020 2020 2020 2020 7372 6320              src 
-00014c40: 3d20 2877 6f72 6b73 7061 6365 202f 2022  = (workspace / "
-00014c50: 7465 7374 2e70 7922 292e 7265 736f 6c76  test.py").resolv
-00014c60: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00014c70: 7372 632e 746f 7563 6828 290a 2020 2020  src.touch().    
-00014c80: 2020 2020 2020 2020 626c 6163 6b2e 7772          black.wr
-00014c90: 6974 655f 6361 6368 6528 7b7d 2c20 5b73  ite_cache({}, [s
-00014ca0: 7263 5d2c 206d 6f64 6529 0a20 2020 2020  rc], mode).     
-00014cb0: 2020 2020 2020 2063 6163 6865 203d 2062         cache = b
-00014cc0: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
-00014cd0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-00014ce0: 2020 6173 7365 7274 2073 7472 2873 7263    assert str(src
-00014cf0: 2920 696e 2063 6163 6865 0a20 2020 2020  ) in cache.     
-00014d00: 2020 2020 2020 2061 7373 6572 7420 6361         assert ca
-00014d10: 6368 655b 7374 7228 7372 6329 5d20 3d3d  che[str(src)] ==
-00014d20: 2062 6c61 636b 2e67 6574 5f63 6163 6865   black.get_cache
-00014d30: 5f69 6e66 6f28 7372 6329 0a0a 2020 2020  _info(src)..    
-00014d40: 6465 6620 7465 7374 5f66 696c 7465 725f  def test_filter_
-00014d50: 6361 6368 6564 2873 656c 6629 202d 3e20  cached(self) -> 
-00014d60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-00014d70: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-00014d80: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
-00014d90: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-00014da0: 2020 7061 7468 203d 2050 6174 6828 776f    path = Path(wo
-00014db0: 726b 7370 6163 6529 0a20 2020 2020 2020  rkspace).       
-00014dc0: 2020 2020 2075 6e63 6163 6865 6420 3d20       uncached = 
-00014dd0: 2870 6174 6820 2f20 2275 6e63 6163 6865  (path / "uncache
-00014de0: 6422 292e 7265 736f 6c76 6528 290a 2020  d").resolve().  
-00014df0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
-00014e00: 203d 2028 7061 7468 202f 2022 6361 6368   = (path / "cach
-00014e10: 6564 2229 2e72 6573 6f6c 7665 2829 0a20  ed").resolve(). 
-00014e20: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00014e30: 645f 6275 745f 6368 616e 6765 6420 3d20  d_but_changed = 
-00014e40: 2870 6174 6820 2f20 2263 6861 6e67 6564  (path / "changed
-00014e50: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
-00014e60: 2020 2020 2020 2020 2075 6e63 6163 6865           uncache
-00014e70: 642e 746f 7563 6828 290a 2020 2020 2020  d.touch().      
-00014e80: 2020 2020 2020 6361 6368 6564 2e74 6f75        cached.tou
-00014e90: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
-00014ea0: 2063 6163 6865 645f 6275 745f 6368 616e   cached_but_chan
-00014eb0: 6765 642e 746f 7563 6828 290a 2020 2020  ged.touch().    
-00014ec0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
-00014ed0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00014ee0: 2020 7374 7228 6361 6368 6564 293a 2062    str(cached): b
-00014ef0: 6c61 636b 2e67 6574 5f63 6163 6865 5f69  lack.get_cache_i
-00014f00: 6e66 6f28 6361 6368 6564 292c 0a20 2020  nfo(cached),.   
-00014f10: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00014f20: 2863 6163 6865 645f 6275 745f 6368 616e  (cached_but_chan
-00014f30: 6765 6429 3a20 2830 2e30 2c20 3029 2c0a  ged): (0.0, 0),.
-00014f40: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00014f50: 2020 2020 2020 2020 2020 746f 646f 2c20            todo, 
-00014f60: 646f 6e65 203d 2062 6c61 636b 2e63 6163  done = black.cac
-00014f70: 6865 2e66 696c 7465 725f 6361 6368 6564  he.filter_cached
-00014f80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014f90: 2020 6361 6368 652c 207b 756e 6361 6368    cache, {uncach
-00014fa0: 6564 2c20 6361 6368 6564 2c20 6361 6368  ed, cached, cach
-00014fb0: 6564 5f62 7574 5f63 6861 6e67 6564 7d0a  ed_but_changed}.
-00014fc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00014fd0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00014fe0: 2074 6f64 6f20 3d3d 207b 756e 6361 6368   todo == {uncach
-00014ff0: 6564 2c20 6361 6368 6564 5f62 7574 5f63  ed, cached_but_c
-00015000: 6861 6e67 6564 7d0a 2020 2020 2020 2020  hanged}.        
-00015010: 2020 2020 6173 7365 7274 2064 6f6e 6520      assert done 
-00015020: 3d3d 207b 6361 6368 6564 7d0a 0a20 2020  == {cached}..   
-00015030: 2064 6566 2074 6573 745f 7772 6974 655f   def test_write_
-00015040: 6361 6368 655f 6372 6561 7465 735f 6469  cache_creates_di
-00015050: 7265 6374 6f72 795f 6966 5f6e 6565 6465  rectory_if_neede
-00015060: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-00015070: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-00015080: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-00015090: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-000150a0: 6469 7228 6578 6973 7473 3d46 616c 7365  dir(exists=False
-000150b0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-000150c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000150d0: 7274 206e 6f74 2077 6f72 6b73 7061 6365  rt not workspace
-000150e0: 2e65 7869 7374 7328 290a 2020 2020 2020  .exists().      
-000150f0: 2020 2020 2020 626c 6163 6b2e 7772 6974        black.writ
-00015100: 655f 6361 6368 6528 7b7d 2c20 5b5d 2c20  e_cache({}, [], 
-00015110: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-00015120: 2020 6173 7365 7274 2077 6f72 6b73 7061    assert workspa
-00015130: 6365 2e65 7869 7374 7328 290a 0a20 2020  ce.exists()..   
-00015140: 2040 6576 656e 745f 6c6f 6f70 2829 0a20   @event_loop(). 
-00015150: 2020 2064 6566 2074 6573 745f 6661 696c     def test_fail
-00015160: 6564 5f66 6f72 6d61 7474 696e 675f 646f  ed_formatting_do
-00015170: 6573 5f6e 6f74 5f67 6574 5f63 6163 6865  es_not_get_cache
-00015180: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-00015190: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-000151a0: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-000151b0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-000151c0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-000151d0: 6365 2c20 7061 7463 6828 0a20 2020 2020  ce, patch(.     
-000151e0: 2020 2020 2020 2022 636f 6e63 7572 7265         "concurre
-000151f0: 6e74 2e66 7574 7572 6573 2e50 726f 6365  nt.futures.Proce
-00015200: 7373 506f 6f6c 4578 6563 7574 6f72 222c  ssPoolExecutor",
-00015210: 206e 6577 3d54 6872 6561 6450 6f6f 6c45   new=ThreadPoolE
-00015220: 7865 6375 746f 720a 2020 2020 2020 2020  xecutor.        
-00015230: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-00015240: 6169 6c69 6e67 203d 2028 776f 726b 7370  ailing = (worksp
-00015250: 6163 6520 2f20 2266 6169 6c69 6e67 2e70  ace / "failing.p
-00015260: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
-00015270: 2020 2020 2020 2020 2020 7769 7468 2066            with f
-00015280: 6169 6c69 6e67 2e6f 7065 6e28 2277 2229  ailing.open("w")
-00015290: 2061 7320 666f 626a 3a0a 2020 2020 2020   as fobj:.      
-000152a0: 2020 2020 2020 2020 2020 666f 626a 2e77            fobj.w
-000152b0: 7269 7465 2822 6e6f 7420 6163 7475 616c  rite("not actual
-000152c0: 6c79 2070 7974 686f 6e22 290a 2020 2020  ly python").    
-000152d0: 2020 2020 2020 2020 636c 6561 6e20 3d20          clean = 
-000152e0: 2877 6f72 6b73 7061 6365 202f 2022 636c  (workspace / "cl
-000152f0: 6561 6e2e 7079 2229 2e72 6573 6f6c 7665  ean.py").resolve
-00015300: 2829 0a20 2020 2020 2020 2020 2020 2077  ().            w
-00015310: 6974 6820 636c 6561 6e2e 6f70 656e 2822  ith clean.open("
-00015320: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
-00015330: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
-00015340: 6a2e 7772 6974 6528 2770 7269 6e74 2822  j.write('print("
-00015350: 6865 6c6c 6f22 295c 6e27 290a 2020 2020  hello")\n').    
-00015360: 2020 2020 2020 2020 696e 766f 6b65 426c          invokeBl
-00015370: 6163 6b28 5b73 7472 2877 6f72 6b73 7061  ack([str(workspa
-00015380: 6365 295d 2c20 6578 6974 5f63 6f64 653d  ce)], exit_code=
-00015390: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
-000153a0: 2063 6163 6865 203d 2062 6c61 636b 2e72   cache = black.r
-000153b0: 6561 645f 6361 6368 6528 6d6f 6465 290a  ead_cache(mode).
-000153c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000153d0: 7274 2073 7472 2866 6169 6c69 6e67 2920  rt str(failing) 
-000153e0: 6e6f 7420 696e 2063 6163 6865 0a20 2020  not in cache.   
-000153f0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00015400: 7374 7228 636c 6561 6e29 2069 6e20 6361  str(clean) in ca
-00015410: 6368 650a 0a20 2020 2064 6566 2074 6573  che..    def tes
-00015420: 745f 7772 6974 655f 6361 6368 655f 7772  t_write_cache_wr
-00015430: 6974 655f 6661 696c 2873 656c 6629 202d  ite_fail(self) -
-00015440: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00015450: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
-00015460: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
-00015470: 2063 6163 6865 5f64 6972 2829 2c20 7061   cache_dir(), pa
-00015480: 7463 682e 6f62 6a65 6374 2850 6174 682c  tch.object(Path,
-00015490: 2022 6f70 656e 2229 2061 7320 6d6f 636b   "open") as mock
-000154a0: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
-000154b0: 636b 2e73 6964 655f 6566 6665 6374 203d  ck.side_effect =
-000154c0: 204f 5345 7272 6f72 0a20 2020 2020 2020   OSError.       
-000154d0: 2020 2020 2062 6c61 636b 2e77 7269 7465       black.write
-000154e0: 5f63 6163 6865 287b 7d2c 205b 5d2c 206d  _cache({}, [], m
-000154f0: 6f64 6529 0a0a 2020 2020 6465 6620 7465  ode)..    def te
-00015500: 7374 5f72 6561 645f 6361 6368 655f 6c69  st_read_cache_li
-00015510: 6e65 5f6c 656e 6774 6873 2873 656c 6629  ne_lengths(self)
-00015520: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00015530: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
-00015540: 5f4d 4f44 450a 2020 2020 2020 2020 7368  _MODE.        sh
-00015550: 6f72 745f 6d6f 6465 203d 2072 6570 6c61  ort_mode = repla
-00015560: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-00015570: 206c 696e 655f 6c65 6e67 7468 3d31 290a   line_length=1).
-00015580: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-00015590: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
-000155a0: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-000155b0: 2020 2070 6174 6820 3d20 2877 6f72 6b73     path = (works
-000155c0: 7061 6365 202f 2022 6669 6c65 2e70 7922  pace / "file.py"
-000155d0: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-000155e0: 2020 2020 2020 2020 7061 7468 2e74 6f75          path.tou
-000155f0: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
-00015600: 2062 6c61 636b 2e77 7269 7465 5f63 6163   black.write_cac
-00015610: 6865 287b 7d2c 205b 7061 7468 5d2c 206d  he({}, [path], m
-00015620: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00015630: 206f 6e65 203d 2062 6c61 636b 2e72 6561   one = black.rea
-00015640: 645f 6361 6368 6528 6d6f 6465 290a 2020  d_cache(mode).  
-00015650: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00015660: 2073 7472 2870 6174 6829 2069 6e20 6f6e   str(path) in on
-00015670: 650a 2020 2020 2020 2020 2020 2020 7477  e.            tw
-00015680: 6f20 3d20 626c 6163 6b2e 7265 6164 5f63  o = black.read_c
-00015690: 6163 6865 2873 686f 7274 5f6d 6f64 6529  ache(short_mode)
-000156a0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000156b0: 6572 7420 7374 7228 7061 7468 2920 6e6f  ert str(path) no
-000156c0: 7420 696e 2074 776f 0a0a 0a64 6566 2061  t in two...def a
-000156d0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-000156e0: 736f 7572 6365 7328 0a20 2020 2073 7263  sources(.    src
-000156f0: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
-00015700: 5b73 7472 2c20 5061 7468 5d5d 2c0a 2020  [str, Path]],.  
-00015710: 2020 6578 7065 6374 6564 3a20 5365 7175    expected: Sequ
-00015720: 656e 6365 5b55 6e69 6f6e 5b73 7472 2c20  ence[Union[str, 
-00015730: 5061 7468 5d5d 2c0a 2020 2020 2a2c 0a20  Path]],.    *,. 
-00015740: 2020 2063 7478 3a20 4f70 7469 6f6e 616c     ctx: Optional
-00015750: 5b46 616b 6543 6f6e 7465 7874 5d20 3d20  [FakeContext] = 
-00015760: 4e6f 6e65 2c0a 2020 2020 6578 636c 7564  None,.    exclud
-00015770: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-00015780: 203d 204e 6f6e 652c 0a20 2020 2069 6e63   = None,.    inc
-00015790: 6c75 6465 3a20 4f70 7469 6f6e 616c 5b73  lude: Optional[s
-000157a0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-000157b0: 6578 7465 6e64 5f65 7863 6c75 6465 3a20  extend_exclude: 
-000157c0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-000157d0: 4e6f 6e65 2c0a 2020 2020 666f 7263 655f  None,.    force_
-000157e0: 6578 636c 7564 653a 204f 7074 696f 6e61  exclude: Optiona
-000157f0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-00015800: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
-00015810: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-00015820: 203d 204e 6f6e 652c 0a29 202d 3e20 4e6f   = None,.) -> No
-00015830: 6e65 3a0a 2020 2020 6773 5f73 7263 203d  ne:.    gs_src =
-00015840: 2074 7570 6c65 2873 7472 2850 6174 6828   tuple(str(Path(
-00015850: 7329 2920 666f 7220 7320 696e 2073 7263  s)) for s in src
-00015860: 290a 2020 2020 6773 5f65 7870 6563 7465  ).    gs_expecte
-00015870: 6420 3d20 5b50 6174 6828 7329 2066 6f72  d = [Path(s) for
-00015880: 2073 2069 6e20 6578 7065 6374 6564 5d0a   s in expected].
-00015890: 2020 2020 6773 5f65 7863 6c75 6465 203d      gs_exclude =
-000158a0: 204e 6f6e 6520 6966 2065 7863 6c75 6465   None if exclude
-000158b0: 2069 7320 4e6f 6e65 2065 6c73 6520 636f   is None else co
-000158c0: 6d70 696c 655f 7061 7474 6572 6e28 6578  mpile_pattern(ex
-000158d0: 636c 7564 6529 0a20 2020 2067 735f 696e  clude).    gs_in
-000158e0: 636c 7564 6520 3d20 4445 4641 554c 545f  clude = DEFAULT_
-000158f0: 494e 434c 5544 4520 6966 2069 6e63 6c75  INCLUDE if inclu
-00015900: 6465 2069 7320 4e6f 6e65 2065 6c73 6520  de is None else 
-00015910: 636f 6d70 696c 655f 7061 7474 6572 6e28  compile_pattern(
-00015920: 696e 636c 7564 6529 0a20 2020 2067 735f  include).    gs_
-00015930: 6578 7465 6e64 5f65 7863 6c75 6465 203d  extend_exclude =
-00015940: 2028 0a20 2020 2020 2020 204e 6f6e 6520   (.        None 
-00015950: 6966 2065 7874 656e 645f 6578 636c 7564  if extend_exclud
-00015960: 6520 6973 204e 6f6e 6520 656c 7365 2063  e is None else c
-00015970: 6f6d 7069 6c65 5f70 6174 7465 726e 2865  ompile_pattern(e
-00015980: 7874 656e 645f 6578 636c 7564 6529 0a20  xtend_exclude). 
-00015990: 2020 2029 0a20 2020 2067 735f 666f 7263     ).    gs_forc
-000159a0: 655f 6578 636c 7564 6520 3d20 4e6f 6e65  e_exclude = None
-000159b0: 2069 6620 666f 7263 655f 6578 636c 7564   if force_exclud
-000159c0: 6520 6973 204e 6f6e 6520 656c 7365 2063  e is None else c
-000159d0: 6f6d 7069 6c65 5f70 6174 7465 726e 2866  ompile_pattern(f
-000159e0: 6f72 6365 5f65 7863 6c75 6465 290a 2020  orce_exclude).  
-000159f0: 2020 636f 6c6c 6563 7465 6420 3d20 626c    collected = bl
-00015a00: 6163 6b2e 6765 745f 736f 7572 6365 7328  ack.get_sources(
-00015a10: 0a20 2020 2020 2020 2063 7478 3d63 7478  .        ctx=ctx
-00015a20: 206f 7220 4661 6b65 436f 6e74 6578 7428   or FakeContext(
-00015a30: 292c 0a20 2020 2020 2020 2073 7263 3d67  ),.        src=g
-00015a40: 735f 7372 632c 0a20 2020 2020 2020 2071  s_src,.        q
-00015a50: 7569 6574 3d46 616c 7365 2c0a 2020 2020  uiet=False,.    
-00015a60: 2020 2020 7665 7262 6f73 653d 4661 6c73      verbose=Fals
-00015a70: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
-00015a80: 6465 3d67 735f 696e 636c 7564 652c 0a20  de=gs_include,. 
-00015a90: 2020 2020 2020 2065 7863 6c75 6465 3d67         exclude=g
-00015aa0: 735f 6578 636c 7564 652c 0a20 2020 2020  s_exclude,.     
-00015ab0: 2020 2065 7874 656e 645f 6578 636c 7564     extend_exclud
-00015ac0: 653d 6773 5f65 7874 656e 645f 6578 636c  e=gs_extend_excl
-00015ad0: 7564 652c 0a20 2020 2020 2020 2066 6f72  ude,.        for
-00015ae0: 6365 5f65 7863 6c75 6465 3d67 735f 666f  ce_exclude=gs_fo
-00015af0: 7263 655f 6578 636c 7564 652c 0a20 2020  rce_exclude,.   
-00015b00: 2020 2020 2072 6570 6f72 743d 626c 6163       report=blac
-00015b10: 6b2e 5265 706f 7274 2829 2c0a 2020 2020  k.Report(),.    
-00015b20: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
-00015b30: 6d65 3d73 7464 696e 5f66 696c 656e 616d  me=stdin_filenam
-00015b40: 652c 0a20 2020 2029 0a20 2020 2061 7373  e,.    ).    ass
-00015b50: 6572 7420 736f 7274 6564 2863 6f6c 6c65  ert sorted(colle
-00015b60: 6374 6564 2920 3d3d 2073 6f72 7465 6428  cted) == sorted(
-00015b70: 6773 5f65 7870 6563 7465 6429 0a0a 0a63  gs_expected)...c
-00015b80: 6c61 7373 2054 6573 7446 696c 6543 6f6c  lass TestFileCol
-00015b90: 6c65 6374 696f 6e3a 0a20 2020 2064 6566  lection:.    def
-00015ba0: 2074 6573 745f 696e 636c 7564 655f 6578   test_include_ex
-00015bb0: 636c 7564 6528 7365 6c66 2920 2d3e 204e  clude(self) -> N
-00015bc0: 6f6e 653a 0a20 2020 2020 2020 2070 6174  one:.        pat
-00015bd0: 6820 3d20 5448 4953 5f44 4952 202f 2022  h = THIS_DIR / "
-00015be0: 6461 7461 2220 2f20 2269 6e63 6c75 6465  data" / "include
-00015bf0: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
-00015c00: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
-00015c10: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
-00015c20: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
-00015c30: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-00015c40: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
-00015c50: 652f 612e 7079 2229 2c0a 2020 2020 2020  e/a.py"),.      
-00015c60: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-00015c70: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
-00015c80: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
-00015c90: 2020 205d 0a20 2020 2020 2020 2061 7373     ].        ass
-00015ca0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-00015cb0: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-00015cc0: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
-00015cd0: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
-00015ce0: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-00015cf0: 653d 7222 5c2e 7079 693f 2422 2c0a 2020  e=r"\.pyi?$",.  
-00015d00: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00015d10: 653d 7222 2f65 7863 6c75 6465 2f7c 2f5c  e=r"/exclude/|/\
-00015d20: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
-00015d30: 7564 652f 222c 0a20 2020 2020 2020 2029  ude/",.        )
-00015d40: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-00015d50: 6974 6967 6e6f 7265 5f75 7365 645f 6173  itignore_used_as
-00015d60: 5f64 6566 6175 6c74 2873 656c 6629 202d  _default(self) -
-00015d70: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00015d80: 6261 7365 203d 2050 6174 6828 4441 5441  base = Path(DATA
-00015d90: 5f44 4952 202f 2022 696e 636c 7564 655f  _DIR / "include_
-00015da0: 6578 636c 7564 655f 7465 7374 7322 290a  exclude_tests").
-00015db0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00015dc0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00015dd0: 2062 6173 6520 2f20 2262 2f2e 6465 6669   base / "b/.defi
-00015de0: 6e69 7465 6c79 5f65 7863 6c75 6465 2f61  nitely_exclude/a
-00015df0: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00015e00: 2020 6261 7365 202f 2022 622f 2e64 6566    base / "b/.def
-00015e10: 696e 6974 656c 795f 6578 636c 7564 652f  initely_exclude/
-00015e20: 612e 7079 6922 2c0a 2020 2020 2020 2020  a.pyi",.        
-00015e30: 5d0a 2020 2020 2020 2020 7372 6320 3d20  ].        src = 
-00015e40: 5b62 6173 6520 2f20 2262 2f22 5d0a 2020  [base / "b/"].  
-00015e50: 2020 2020 2020 6374 7820 3d20 4661 6b65        ctx = Fake
-00015e60: 436f 6e74 6578 7428 290a 2020 2020 2020  Context().      
-00015e70: 2020 6374 782e 6f62 6a5b 2272 6f6f 7422    ctx.obj["root"
-00015e80: 5d20 3d20 6261 7365 0a20 2020 2020 2020  ] = base.       
-00015e90: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
-00015ea0: 645f 736f 7572 6365 7328 7372 632c 2065  d_sources(src, e
-00015eb0: 7870 6563 7465 642c 2063 7478 3d63 7478  xpected, ctx=ctx
-00015ec0: 2c20 6578 7465 6e64 5f65 7863 6c75 6465  , extend_exclude
-00015ed0: 3d72 222f 6578 636c 7564 652f 2229 0a0a  =r"/exclude/")..
-00015ee0: 2020 2020 6465 6620 7465 7374 5f67 6974      def test_git
-00015ef0: 6967 6e6f 7265 5f75 7365 645f 6f6e 5f6d  ignore_used_on_m
-00015f00: 756c 7469 706c 655f 736f 7572 6365 7328  ultiple_sources(
-00015f10: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00015f20: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-00015f30: 7468 2844 4154 415f 4449 5220 2f20 2267  th(DATA_DIR / "g
-00015f40: 6974 6967 6e6f 7265 5f75 7365 645f 6f6e  itignore_used_on
-00015f50: 5f6d 756c 7469 706c 655f 736f 7572 6365  _multiple_source
-00015f60: 7322 290a 2020 2020 2020 2020 6578 7065  s").        expe
-00015f70: 6374 6564 203d 205b 0a20 2020 2020 2020  cted = [.       
-00015f80: 2020 2020 2072 6f6f 7420 2f20 2264 6972       root / "dir
-00015f90: 3122 202f 2022 622e 7079 222c 0a20 2020  1" / "b.py",.   
-00015fa0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
-00015fb0: 2264 6972 3222 202f 2022 622e 7079 222c  "dir2" / "b.py",
-00015fc0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00015fd0: 2020 2063 7478 203d 2046 616b 6543 6f6e     ctx = FakeCon
-00015fe0: 7465 7874 2829 0a20 2020 2020 2020 2063  text().        c
-00015ff0: 7478 2e6f 626a 5b22 726f 6f74 225d 203d  tx.obj["root"] =
-00016000: 2072 6f6f 740a 2020 2020 2020 2020 7372   root.        sr
-00016010: 6320 3d20 5b72 6f6f 7420 2f20 2264 6972  c = [root / "dir
-00016020: 3122 2c20 726f 6f74 202f 2022 6469 7232  1", root / "dir2
-00016030: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
-00016040: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-00016050: 6365 7328 7372 632c 2065 7870 6563 7465  ces(src, expecte
-00016060: 642c 2063 7478 3d63 7478 290a 0a20 2020  d, ctx=ctx)..   
-00016070: 2040 7061 7463 6828 2262 6c61 636b 2e66   @patch("black.f
-00016080: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
-00016090: 222c 206c 616d 6264 6120 2a61 7267 733a  ", lambda *args:
-000160a0: 2028 5448 4953 5f44 4952 2e72 6573 6f6c   (THIS_DIR.resol
-000160b0: 7665 2829 2c20 4e6f 6e65 2929 0a20 2020  ve(), None)).   
-000160c0: 2064 6566 2074 6573 745f 6578 636c 7564   def test_exclud
-000160d0: 655f 666f 725f 6973 7375 655f 3135 3732  e_for_issue_1572
-000160e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000160f0: 2020 2020 2020 2020 2320 4578 636c 7564          # Exclud
-00016100: 6520 7368 6f75 6c64 6e27 7420 746f 7563  e shouldn't touc
-00016110: 6820 6669 6c65 7320 7468 6174 2077 6572  h files that wer
-00016120: 6520 6578 706c 6963 6974 6c79 2067 6976  e explicitly giv
-00016130: 656e 2074 6f20 426c 6163 6b20 7468 726f  en to Black thro
-00016140: 7567 6820 7468 650a 2020 2020 2020 2020  ugh the.        
-00016150: 2320 434c 492e 2045 7863 6c75 6465 2069  # CLI. Exclude i
-00016160: 7320 7375 7070 6f73 6564 2074 6f20 6f6e  s supposed to on
-00016170: 6c79 2061 7070 6c79 2074 6f20 7468 6520  ly apply to the 
-00016180: 7265 6375 7273 6976 6520 6469 7363 6f76  recursive discov
-00016190: 6572 7920 6f66 2066 696c 6573 2e0a 2020  ery of files..  
-000161a0: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-000161b0: 6769 7468 7562 2e63 6f6d 2f70 7366 2f62  github.com/psf/b
-000161c0: 6c61 636b 2f69 7373 7565 732f 3135 3732  lack/issues/1572
-000161d0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-000161e0: 4441 5441 5f44 4952 202f 2022 696e 636c  DATA_DIR / "incl
-000161f0: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
-00016200: 7322 0a20 2020 2020 2020 2073 7263 203d  s".        src =
-00016210: 205b 7061 7468 202f 2022 622f 6578 636c   [path / "b/excl
-00016220: 7564 652f 612e 7079 225d 0a20 2020 2020  ude/a.py"].     
-00016230: 2020 2065 7870 6563 7465 6420 3d20 5b70     expected = [p
-00016240: 6174 6820 2f20 2262 2f65 7863 6c75 6465  ath / "b/exclude
-00016250: 2f61 2e70 7922 5d0a 2020 2020 2020 2020  /a.py"].        
-00016260: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00016270: 5f73 6f75 7263 6573 2873 7263 2c20 6578  _sources(src, ex
-00016280: 7065 6374 6564 2c20 696e 636c 7564 653d  pected, include=
-00016290: 2222 2c20 6578 636c 7564 653d 7222 2f65  "", exclude=r"/e
-000162a0: 7863 6c75 6465 2f7c 615c 2e70 7922 290a  xclude/|a\.py").
-000162b0: 0a20 2020 2064 6566 2074 6573 745f 6769  .    def test_gi
-000162c0: 7469 676e 6f72 655f 6578 636c 7564 6528  tignore_exclude(
-000162d0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000162e0: 2020 2020 2020 2070 6174 6820 3d20 5448         path = TH
-000162f0: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
-00016300: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
-00016310: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
-00016320: 2020 696e 636c 7564 6520 3d20 7265 2e63    include = re.c
-00016330: 6f6d 7069 6c65 2872 225c 2e70 7969 3f24  ompile(r"\.pyi?$
-00016340: 2229 0a20 2020 2020 2020 2065 7863 6c75  ").        exclu
-00016350: 6465 203d 2072 652e 636f 6d70 696c 6528  de = re.compile(
-00016360: 7222 2229 0a20 2020 2020 2020 2072 6570  r"").        rep
-00016370: 6f72 7420 3d20 626c 6163 6b2e 5265 706f  ort = black.Repo
-00016380: 7274 2829 0a20 2020 2020 2020 2067 6974  rt().        git
-00016390: 6967 6e6f 7265 203d 2050 6174 6853 7065  ignore = PathSpe
-000163a0: 632e 6672 6f6d 5f6c 696e 6573 280a 2020  c.from_lines(.  
-000163b0: 2020 2020 2020 2020 2020 2267 6974 7769            "gitwi
-000163c0: 6c64 6d61 7463 6822 2c20 5b22 6578 636c  ldmatch", ["excl
-000163d0: 7564 652f 222c 2022 2e64 6566 696e 6974  ude/", ".definit
-000163e0: 656c 795f 6578 636c 7564 6522 5d0a 2020  ely_exclude"].  
-000163f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016400: 736f 7572 6365 733a 204c 6973 745b 5061  sources: List[Pa
-00016410: 7468 5d20 3d20 5b5d 0a20 2020 2020 2020  th] = [].       
-00016420: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-00016430: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00016440: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00016450: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-00016460: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00016470: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00016480: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
-00016490: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-000164a0: 2074 6869 735f 6162 7320 3d20 5448 4953   this_abs = THIS
-000164b0: 5f44 4952 2e72 6573 6f6c 7665 2829 0a20  _DIR.resolve(). 
-000164c0: 2020 2020 2020 2073 6f75 7263 6573 2e65         sources.e
-000164d0: 7874 656e 6428 0a20 2020 2020 2020 2020  xtend(.         
-000164e0: 2020 2062 6c61 636b 2e67 656e 5f70 7974     black.gen_pyt
-000164f0: 686f 6e5f 6669 6c65 7328 0a20 2020 2020  hon_files(.     
-00016500: 2020 2020 2020 2020 2020 2070 6174 682e             path.
-00016510: 6974 6572 6469 7228 292c 0a20 2020 2020  iterdir(),.     
-00016520: 2020 2020 2020 2020 2020 2074 6869 735f             this_
-00016530: 6162 732c 0a20 2020 2020 2020 2020 2020  abs,.           
-00016540: 2020 2020 2069 6e63 6c75 6465 2c0a 2020       include,.  
-00016550: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00009620: 7573 6564 286e 6f64 6529 2c20 7b46 6561  used(node), {Fea
+00009630: 7475 7265 2e55 4e50 4143 4b49 4e47 5f4f  ture.UNPACKING_O
+00009640: 4e5f 464c 4f57 7d29 0a20 2020 2020 2020  N_FLOW}).       
+00009650: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+00009660: 6232 746f 335f 7061 7273 6528 2278 203d  b2to3_parse("x =
+00009670: 2061 2c20 2a62 2c20 6322 290a 2020 2020   a, *b, c").    
+00009680: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009690: 7175 616c 2862 6c61 636b 2e67 6574 5f66  qual(black.get_f
+000096a0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
+000096b0: 6529 2c20 7365 7428 2929 0a20 2020 2020  e), set()).     
+000096c0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
+000096d0: 6c69 6232 746f 335f 7061 7273 6528 2278  lib2to3_parse("x
+000096e0: 3a20 416e 7920 3d20 7265 6775 6c61 7222  : Any = regular"
+000096f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009700: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00009710: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009720: 6564 286e 6f64 6529 2c20 7365 7428 2929  ed(node), set())
+00009730: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00009740: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00009750: 7273 6528 2278 3a20 416e 7920 3d20 2872  rse("x: Any = (r
+00009760: 6567 756c 6172 2c20 7265 6775 6c61 7229  egular, regular)
+00009770: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00009780: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
+00009790: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
+000097a0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
+000097b0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+000097c0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+000097d0: 6172 7365 2822 783a 2041 6e79 203d 2043  arse("x: Any = C
+000097e0: 6f6d 706c 6578 2854 7970 6528 3129 295b  omplex(Type(1))[
+000097f0: 736f 6d65 7468 696e 675d 2229 0a20 2020  something]").   
+00009800: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009810: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+00009820: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009830: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
+00009840: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
+00009850: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
+00009860: 783a 2054 7570 6c65 5b69 6e74 2c20 2e2e  x: Tuple[int, ..
+00009870: 2e5d 203d 2061 2c20 622c 2063 2229 0a20  .] = a, b, c"). 
+00009880: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009890: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000098a0: 2020 2020 2062 6c61 636b 2e67 6574 5f66       black.get_f
+000098b0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
+000098c0: 6529 2c20 7b46 6561 7475 7265 2e41 4e4e  e), {Feature.ANN
+000098d0: 5f41 5353 4947 4e5f 4558 5445 4e44 4544  _ASSIGN_EXTENDED
+000098e0: 5f52 4853 7d0a 2020 2020 2020 2020 290a  _RHS}.        ).
+000098f0: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
+00009900: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+00009910: 7365 2822 7472 793a 2070 6173 735c 6e65  se("try: pass\ne
+00009920: 7863 6570 7420 536f 6d65 7468 696e 673a  xcept Something:
+00009930: 2070 6173 7322 290a 2020 2020 2020 2020   pass").        
+00009940: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00009950: 2862 6c61 636b 2e67 6574 5f66 6561 7475  (black.get_featu
+00009960: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
+00009970: 7365 7428 2929 0a20 2020 2020 2020 206e  set()).        n
+00009980: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+00009990: 746f 335f 7061 7273 6528 2274 7279 3a20  to3_parse("try: 
+000099a0: 7061 7373 5c6e 6578 6365 7074 2028 2a53  pass\nexcept (*S
+000099b0: 6f6d 6574 6869 6e67 2c29 3a20 7061 7373  omething,): pass
+000099c0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+000099d0: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
+000099e0: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
+000099f0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
+00009a00: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+00009a10: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+00009a20: 6172 7365 2822 7472 793a 2070 6173 735c  arse("try: pass\
+00009a30: 6e65 7863 6570 7420 2a47 726f 7570 3a20  nexcept *Group: 
+00009a40: 7061 7373 2229 0a20 2020 2020 2020 2073  pass").        s
+00009a50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00009a60: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00009a70: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00009a80: 4665 6174 7572 652e 4558 4345 5054 5f53  Feature.EXCEPT_S
+00009a90: 5441 527d 290a 2020 2020 2020 2020 6e6f  TAR}).        no
+00009aa0: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00009ab0: 6f33 5f70 6172 7365 2822 615b 2a62 5d22  o3_parse("a[*b]"
+00009ac0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009ad0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00009ae0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009af0: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00009b00: 7265 2e56 4152 4941 4449 435f 4745 4e45  re.VARIADIC_GENE
+00009b10: 5249 4353 7d29 0a20 2020 2020 2020 206e  RICS}).        n
+00009b20: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+00009b30: 746f 335f 7061 7273 6528 2261 5b78 2c20  to3_parse("a[x, 
+00009b40: 2a79 2829 2c20 7a5d 203d 2074 2229 0a20  *y(), z] = t"). 
+00009b50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009b60: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
+00009b70: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00009b80: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
+00009b90: 5641 5249 4144 4943 5f47 454e 4552 4943  VARIADIC_GENERIC
+00009ba0: 537d 290a 2020 2020 2020 2020 6e6f 6465  S}).        node
+00009bb0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+00009bc0: 5f70 6172 7365 2822 6465 6620 666e 282a  _parse("def fn(*
+00009bd0: 6172 6773 3a20 2a54 293a 2070 6173 7322  args: *T): pass"
+00009be0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009bf0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00009c00: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009c10: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00009c20: 7265 2e56 4152 4941 4449 435f 4745 4e45  re.VARIADIC_GENE
+00009c30: 5249 4353 7d29 0a0a 2020 2020 6465 6620  RICS})..    def 
+00009c40: 7465 7374 5f67 6574 5f66 6561 7475 7265  test_get_feature
+00009c50: 735f 7573 6564 5f66 6f72 5f66 7574 7572  s_used_for_futur
+00009c60: 655f 666c 6167 7328 7365 6c66 2920 2d3e  e_flags(self) ->
+00009c70: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
+00009c80: 6f72 2073 7263 2c20 6665 6174 7572 6573  or src, features
+00009c90: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
+00009ca0: 2020 2822 6672 6f6d 205f 5f66 7574 7572    ("from __futur
+00009cb0: 655f 5f20 696d 706f 7274 2061 6e6e 6f74  e__ import annot
+00009cc0: 6174 696f 6e73 222c 207b 4665 6174 7572  ations", {Featur
+00009cd0: 652e 4655 5455 5245 5f41 4e4e 4f54 4154  e.FUTURE_ANNOTAT
+00009ce0: 494f 4e53 7d29 2c0a 2020 2020 2020 2020  IONS}),.        
+00009cf0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00009d00: 2020 2020 2020 2266 726f 6d20 5f5f 6675        "from __fu
+00009d10: 7475 7265 5f5f 2069 6d70 6f72 7420 286f  ture__ import (o
+00009d20: 7468 6572 2c20 616e 6e6f 7461 7469 6f6e  ther, annotation
+00009d30: 7329 222c 0a20 2020 2020 2020 2020 2020  s)",.           
+00009d40: 2020 2020 207b 4665 6174 7572 652e 4655       {Feature.FU
+00009d50: 5455 5245 5f41 4e4e 4f54 4154 494f 4e53  TURE_ANNOTATIONS
+00009d60: 7d2c 0a20 2020 2020 2020 2020 2020 2029  },.            )
+00009d70: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00009d80: 6120 3d20 3120 2b20 325c 6e66 726f 6d20  a = 1 + 2\nfrom 
+00009d90: 736f 6d65 7468 696e 6720 696d 706f 7274  something import
+00009da0: 2061 6e6e 6f74 6174 696f 6e73 222c 2073   annotations", s
+00009db0: 6574 2829 292c 0a20 2020 2020 2020 2020  et()),.         
+00009dc0: 2020 2028 2266 726f 6d20 5f5f 6675 7475     ("from __futu
+00009dd0: 7265 5f5f 2069 6d70 6f72 7420 782c 2079  re__ import x, y
+00009de0: 222c 2073 6574 2829 292c 0a20 2020 2020  ", set()),.     
+00009df0: 2020 205d 3a0a 2020 2020 2020 2020 2020     ]:.          
+00009e00: 2020 7769 7468 2073 656c 662e 7375 6254    with self.subT
+00009e10: 6573 7428 7372 633d 7372 632c 2066 6561  est(src=src, fea
+00009e20: 7475 7265 733d 6665 6174 7572 6573 293a  tures=features):
+00009e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e40: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+00009e50: 6232 746f 335f 7061 7273 6528 7372 6329  b2to3_parse(src)
+00009e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e70: 2066 7574 7572 655f 696d 706f 7274 7320   future_imports 
+00009e80: 3d20 626c 6163 6b2e 6765 745f 6675 7475  = black.get_futu
+00009e90: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
+00009ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009eb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009ec0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00009ed0: 2020 2020 2020 2062 6c61 636b 2e67 6574         black.get
+00009ee0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009ef0: 6f64 652c 2066 7574 7572 655f 696d 706f  ode, future_impo
+00009f00: 7274 733d 6675 7475 7265 5f69 6d70 6f72  rts=future_impor
+00009f10: 7473 292c 0a20 2020 2020 2020 2020 2020  ts),.           
+00009f20: 2020 2020 2020 2020 2066 6561 7475 7265           feature
+00009f30: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00009f40: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+00009f50: 7374 5f67 6574 5f66 7574 7572 655f 696d  st_get_future_im
+00009f60: 706f 7274 7328 7365 6c66 2920 2d3e 204e  ports(self) -> N
+00009f70: 6f6e 653a 0a20 2020 2020 2020 206e 6f64  one:.        nod
+00009f80: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+00009f90: 335f 7061 7273 6528 225c 6e22 290a 2020  3_parse("\n").  
+00009fa0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009fb0: 7445 7175 616c 2873 6574 2829 2c20 626c  tEqual(set(), bl
+00009fc0: 6163 6b2e 6765 745f 6675 7475 7265 5f69  ack.get_future_i
+00009fd0: 6d70 6f72 7473 286e 6f64 6529 290a 2020  mports(node)).  
+00009fe0: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+00009ff0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+0000a000: 2822 6672 6f6d 205f 5f66 7574 7572 655f  ("from __future_
+0000a010: 5f20 696d 706f 7274 2062 6c61 636b 5c6e  _ import black\n
+0000a020: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0000a030: 6173 7365 7274 4571 7561 6c28 7b22 626c  assertEqual({"bl
+0000a040: 6163 6b22 7d2c 2062 6c61 636b 2e67 6574  ack"}, black.get
+0000a050: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
+0000a060: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
+0000a070: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+0000a080: 746f 335f 7061 7273 6528 2266 726f 6d20  to3_parse("from 
+0000a090: 5f5f 6675 7475 7265 5f5f 2069 6d70 6f72  __future__ impor
+0000a0a0: 7420 6d75 6c74 6970 6c65 2c20 696d 706f  t multiple, impo
+0000a0b0: 7274 735c 6e22 290a 2020 2020 2020 2020  rts\n").        
+0000a0c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000a0d0: 287b 226d 756c 7469 706c 6522 2c20 2269  ({"multiple", "i
+0000a0e0: 6d70 6f72 7473 227d 2c20 626c 6163 6b2e  mports"}, black.
+0000a0f0: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
+0000a100: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
+0000a110: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+0000a120: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
+0000a130: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
+0000a140: 706f 7274 2028 7061 7265 6e74 6865 7369  port (parenthesi
+0000a150: 7a65 642c 2069 6d70 6f72 7473 295c 6e22  zed, imports)\n"
+0000a160: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a170: 7373 6572 7445 7175 616c 287b 2270 6172  ssertEqual({"par
+0000a180: 656e 7468 6573 697a 6564 222c 2022 696d  enthesized", "im
+0000a190: 706f 7274 7322 7d2c 2062 6c61 636b 2e67  ports"}, black.g
+0000a1a0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+0000a1b0: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
+0000a1c0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+0000a1d0: 6232 746f 335f 7061 7273 6528 0a20 2020  b2to3_parse(.   
+0000a1e0: 2020 2020 2020 2020 2022 6672 6f6d 205f           "from _
+0000a1f0: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+0000a200: 206d 756c 7469 706c 655c 6e66 726f 6d20   multiple\nfrom 
+0000a210: 5f5f 6675 7475 7265 5f5f 2069 6d70 6f72  __future__ impor
+0000a220: 7420 696d 706f 7274 735c 6e22 0a20 2020  t imports\n".   
+0000a230: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+0000a240: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000a250: 7b22 6d75 6c74 6970 6c65 222c 2022 696d  {"multiple", "im
+0000a260: 706f 7274 7322 7d2c 2062 6c61 636b 2e67  ports"}, black.g
+0000a270: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+0000a280: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
+0000a290: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+0000a2a0: 6232 746f 335f 7061 7273 6528 2223 2063  b2to3_parse("# c
+0000a2b0: 6f6d 6d65 6e74 5c6e 6672 6f6d 205f 5f66  omment\nfrom __f
+0000a2c0: 7574 7572 655f 5f20 696d 706f 7274 2062  uture__ import b
+0000a2d0: 6c61 636b 5c6e 2229 0a20 2020 2020 2020  lack\n").       
+0000a2e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000a2f0: 6c28 7b22 626c 6163 6b22 7d2c 2062 6c61  l({"black"}, bla
+0000a300: 636b 2e67 6574 5f66 7574 7572 655f 696d  ck.get_future_im
+0000a310: 706f 7274 7328 6e6f 6465 2929 0a20 2020  ports(node)).   
+0000a320: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+0000a330: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+0000a340: 2722 2222 646f 6373 7472 696e 6722 2222  '"""docstring"""
+0000a350: 5c6e 6672 6f6d 205f 5f66 7574 7572 655f  \nfrom __future_
+0000a360: 5f20 696d 706f 7274 2062 6c61 636b 5c6e  _ import black\n
+0000a370: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
+0000a380: 6173 7365 7274 4571 7561 6c28 7b22 626c  assertEqual({"bl
+0000a390: 6163 6b22 7d2c 2062 6c61 636b 2e67 6574  ack"}, black.get
+0000a3a0: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
+0000a3b0: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
+0000a3c0: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+0000a3d0: 746f 335f 7061 7273 6528 2273 6f6d 6528  to3_parse("some(
+0000a3e0: 6f74 6865 722c 2063 6f64 6529 5c6e 6672  other, code)\nfr
+0000a3f0: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
+0000a400: 706f 7274 2062 6c61 636b 5c6e 2229 0a20  port black\n"). 
+0000a410: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000a420: 7274 4571 7561 6c28 7365 7428 292c 2062  rtEqual(set(), b
+0000a430: 6c61 636b 2e67 6574 5f66 7574 7572 655f  lack.get_future_
+0000a440: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
+0000a450: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+0000a460: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+0000a470: 6528 2266 726f 6d20 736f 6d65 2e6d 6f64  e("from some.mod
+0000a480: 756c 6520 696d 706f 7274 2062 6c61 636b  ule import black
+0000a490: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
+0000a4a0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0000a4b0: 7428 292c 2062 6c61 636b 2e67 6574 5f66  t(), black.get_f
+0000a4c0: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
+0000a4d0: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
+0000a4e0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+0000a4f0: 335f 7061 7273 6528 0a20 2020 2020 2020  3_parse(.       
+0000a500: 2020 2020 2022 6672 6f6d 205f 5f66 7574       "from __fut
+0000a510: 7572 655f 5f20 696d 706f 7274 2075 6e69  ure__ import uni
+0000a520: 636f 6465 5f6c 6974 6572 616c 7320 6173  code_literals as
+0000a530: 205f 756e 6963 6f64 655f 6c69 7465 7261   _unicode_litera
+0000a540: 6c73 220a 2020 2020 2020 2020 290a 2020  ls".        ).  
+0000a550: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a560: 7445 7175 616c 287b 2275 6e69 636f 6465  tEqual({"unicode
+0000a570: 5f6c 6974 6572 616c 7322 7d2c 2062 6c61  _literals"}, bla
+0000a580: 636b 2e67 6574 5f66 7574 7572 655f 696d  ck.get_future_im
+0000a590: 706f 7274 7328 6e6f 6465 2929 0a20 2020  ports(node)).   
+0000a5a0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+0000a5b0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+0000a5c0: 0a20 2020 2020 2020 2020 2020 2022 6672  .            "fr
+0000a5d0: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
+0000a5e0: 706f 7274 2075 6e69 636f 6465 5f6c 6974  port unicode_lit
+0000a5f0: 6572 616c 7320 6173 205f 6c6f 6c2c 2070  erals as _lol, p
+0000a600: 7269 6e74 220a 2020 2020 2020 2020 290a  rint".        ).
+0000a610: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a620: 6572 7445 7175 616c 287b 2275 6e69 636f  ertEqual({"unico
+0000a630: 6465 5f6c 6974 6572 616c 7322 2c20 2270  de_literals", "p
+0000a640: 7269 6e74 227d 2c20 626c 6163 6b2e 6765  rint"}, black.ge
+0000a650: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a660: 286e 6f64 6529 290a 0a20 2020 2040 7079  (node))..    @py
+0000a670: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
+0000a680: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
+0000a690: 630a 2020 2020 6465 6620 7465 7374 5f64  c.    def test_d
+0000a6a0: 6562 7567 5f76 6973 6974 6f72 2873 656c  ebug_visitor(sel
+0000a6b0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000a6c0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+0000a6d0: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
+0000a6e0: 6c6c 616e 656f 7573 222c 2022 6465 6275  llaneous", "debu
+0000a6f0: 675f 7669 7369 746f 7222 290a 2020 2020  g_visitor").    
+0000a700: 2020 2020 6578 7065 6374 6564 2c20 5f20      expected, _ 
+0000a710: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000a720: 6365 6c6c 616e 656f 7573 222c 2022 6465  cellaneous", "de
+0000a730: 6275 675f 7669 7369 746f 722e 6f75 7422  bug_visitor.out"
+0000a740: 290a 2020 2020 2020 2020 6f75 745f 6c69  ).        out_li
+0000a750: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
+0000a760: 2065 7272 5f6c 696e 6573 203d 205b 5d0a   err_lines = [].
+0000a770: 0a20 2020 2020 2020 2064 6566 206f 7574  .        def out
+0000a780: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
+0000a790: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
+0000a7a0: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+0000a7b0: 7574 5f6c 696e 6573 2e61 7070 656e 6428  ut_lines.append(
+0000a7c0: 6d73 6729 0a0a 2020 2020 2020 2020 6465  msg)..        de
+0000a7d0: 6620 6572 7228 6d73 673a 2073 7472 2c20  f err(msg: str, 
+0000a7e0: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
+0000a7f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000a800: 2020 2020 6572 725f 6c69 6e65 732e 6170      err_lines.ap
+0000a810: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
+0000a820: 2020 2077 6974 6820 7061 7463 6828 2262     with patch("b
+0000a830: 6c61 636b 2e64 6562 7567 2e6f 7574 222c  lack.debug.out",
+0000a840: 206f 7574 293a 0a20 2020 2020 2020 2020   out):.         
+0000a850: 2020 2044 6562 7567 5669 7369 746f 722e     DebugVisitor.
+0000a860: 7368 6f77 2873 6f75 7263 6529 0a20 2020  show(source).   
+0000a870: 2020 2020 2061 6374 7561 6c20 3d20 225c       actual = "\
+0000a880: 6e22 2e6a 6f69 6e28 6f75 745f 6c69 6e65  n".join(out_line
+0000a890: 7329 202b 2022 5c6e 220a 2020 2020 2020  s) + "\n".      
+0000a8a0: 2020 6c6f 675f 6e61 6d65 203d 2022 220a    log_name = "".
+0000a8b0: 2020 2020 2020 2020 6966 2065 7870 6563          if expec
+0000a8c0: 7465 6420 213d 2061 6374 7561 6c3a 0a20  ted != actual:. 
+0000a8d0: 2020 2020 2020 2020 2020 206c 6f67 5f6e             log_n
+0000a8e0: 616d 6520 3d20 626c 6163 6b2e 6475 6d70  ame = black.dump
+0000a8f0: 5f74 6f5f 6669 6c65 282a 6f75 745f 6c69  _to_file(*out_li
+0000a900: 6e65 7329 0a20 2020 2020 2020 2073 656c  nes).        sel
+0000a910: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+0000a920: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+0000a930: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
+0000a940: 2061 6374 7561 6c2c 0a20 2020 2020 2020   actual,.       
+0000a950: 2020 2020 2066 2241 5354 2070 7269 6e74       f"AST print
+0000a960: 206f 7574 2069 7320 6469 6666 6572 656e   out is differen
+0000a970: 742e 2041 6374 7561 6c20 7665 7273 696f  t. Actual versio
+0000a980: 6e20 6475 6d70 6564 2074 6f20 7b6c 6f67  n dumped to {log
+0000a990: 5f6e 616d 657d 222c 0a20 2020 2020 2020  _name}",.       
+0000a9a0: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0000a9b0: 5f66 6f72 6d61 745f 6669 6c65 5f63 6f6e  _format_file_con
+0000a9c0: 7465 6e74 7328 7365 6c66 2920 2d3e 204e  tents(self) -> N
+0000a9d0: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
+0000a9e0: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
+0000a9f0: 0a20 2020 2020 2020 2065 6d70 7479 203d  .        empty =
+0000aa00: 2022 220a 2020 2020 2020 2020 7769 7468   "".        with
+0000aa10: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+0000aa20: 6573 2862 6c61 636b 2e4e 6f74 6869 6e67  es(black.Nothing
+0000aa30: 4368 616e 6765 6429 3a0a 2020 2020 2020  Changed):.      
+0000aa40: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
+0000aa50: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
+0000aa60: 2865 6d70 7479 2c20 6d6f 6465 3d6d 6f64  (empty, mode=mod
+0000aa70: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
+0000aa80: 2020 2020 2020 206a 7573 745f 6e6c 203d         just_nl =
+0000aa90: 2022 5c6e 220a 2020 2020 2020 2020 7769   "\n".        wi
+0000aaa0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000aab0: 6973 6573 2862 6c61 636b 2e4e 6f74 6869  ises(black.Nothi
+0000aac0: 6e67 4368 616e 6765 6429 3a0a 2020 2020  ngChanged):.    
+0000aad0: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
+0000aae0: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
+0000aaf0: 7473 286a 7573 745f 6e6c 2c20 6d6f 6465  ts(just_nl, mode
+0000ab00: 3d6d 6f64 652c 2066 6173 743d 4661 6c73  =mode, fast=Fals
+0000ab10: 6529 0a20 2020 2020 2020 2073 616d 6520  e).        same 
+0000ab20: 3d20 226a 203d 205b 312c 2032 2c20 335d  = "j = [1, 2, 3]
+0000ab30: 5c6e 220a 2020 2020 2020 2020 7769 7468  \n".        with
+0000ab40: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+0000ab50: 6573 2862 6c61 636b 2e4e 6f74 6869 6e67  es(black.Nothing
+0000ab60: 4368 616e 6765 6429 3a0a 2020 2020 2020  Changed):.      
+0000ab70: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
+0000ab80: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
+0000ab90: 2873 616d 652c 206d 6f64 653d 6d6f 6465  (same, mode=mode
+0000aba0: 2c20 6661 7374 3d46 616c 7365 290a 2020  , fast=False).  
+0000abb0: 2020 2020 2020 6469 6666 6572 656e 7420        different 
+0000abc0: 3d20 226a 203d 205b 312c 322c 335d 220a  = "j = [1,2,3]".
+0000abd0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0000abe0: 203d 2073 616d 650a 2020 2020 2020 2020   = same.        
+0000abf0: 6163 7475 616c 203d 2062 6c61 636b 2e66  actual = black.f
+0000ac00: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
+0000ac10: 6e74 7328 6469 6666 6572 656e 742c 206d  nts(different, m
+0000ac20: 6f64 653d 6d6f 6465 2c20 6661 7374 3d46  ode=mode, fast=F
+0000ac30: 616c 7365 290a 2020 2020 2020 2020 7365  alse).        se
+0000ac40: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+0000ac50: 7870 6563 7465 642c 2061 6374 7561 6c29  xpected, actual)
+0000ac60: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
+0000ac70: 203d 2022 7265 7475 726e 2069 6620 796f   = "return if yo
+0000ac80: 7520 6361 6e22 0a20 2020 2020 2020 2077  u can".        w
+0000ac90: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000aca0: 6169 7365 7328 626c 6163 6b2e 496e 7661  aises(black.Inva
+0000acb0: 6c69 6449 6e70 7574 2920 6173 2065 3a0a  lidInput) as e:.
+0000acc0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+0000acd0: 6b2e 666f 726d 6174 5f66 696c 655f 636f  k.format_file_co
+0000ace0: 6e74 656e 7473 2869 6e76 616c 6964 2c20  ntents(invalid, 
+0000acf0: 6d6f 6465 3d6d 6f64 652c 2066 6173 743d  mode=mode, fast=
+0000ad00: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
+0000ad10: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000ad20: 7374 7228 652e 6578 6365 7074 696f 6e29  str(e.exception)
+0000ad30: 2c20 2243 616e 6e6f 7420 7061 7273 653a  , "Cannot parse:
+0000ad40: 2031 3a37 3a20 7265 7475 726e 2069 6620   1:7: return if 
+0000ad50: 796f 7520 6361 6e22 290a 0a20 2020 2020  you can")..     
+0000ad60: 2020 206d 6f64 6520 3d20 626c 6163 6b2e     mode = black.
+0000ad70: 4d6f 6465 2870 7265 7669 6577 3d54 7275  Mode(preview=Tru
+0000ad80: 6529 0a20 2020 2020 2020 206a 7573 745f  e).        just_
+0000ad90: 6372 6c66 203d 2022 5c72 5c6e 220a 2020  crlf = "\r\n".  
+0000ada0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+0000adb0: 6173 7365 7274 5261 6973 6573 2862 6c61  assertRaises(bla
+0000adc0: 636b 2e4e 6f74 6869 6e67 4368 616e 6765  ck.NothingChange
+0000add0: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
+0000ade0: 626c 6163 6b2e 666f 726d 6174 5f66 696c  black.format_fil
+0000adf0: 655f 636f 6e74 656e 7473 286a 7573 745f  e_contents(just_
+0000ae00: 6372 6c66 2c20 6d6f 6465 3d6d 6f64 652c  crlf, mode=mode,
+0000ae10: 2066 6173 743d 4661 6c73 6529 0a20 2020   fast=False).   
+0000ae20: 2020 2020 206a 7573 745f 7768 6974 6573       just_whites
+0000ae30: 7061 6365 5f6e 6c20 3d20 225c 6e5c 745c  pace_nl = "\n\t\
+0000ae40: 6e20 5c6e 5c74 205c 6e20 5c74 5c6e 5c6e  n \n\t \n \t\n\n
+0000ae50: 220a 2020 2020 2020 2020 6163 7475 616c  ".        actual
+0000ae60: 203d 2062 6c61 636b 2e66 6f72 6d61 745f   = black.format_
+0000ae70: 6669 6c65 5f63 6f6e 7465 6e74 7328 6a75  file_contents(ju
+0000ae80: 7374 5f77 6869 7465 7370 6163 655f 6e6c  st_whitespace_nl
+0000ae90: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
+0000aea0: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
+0000aeb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000aec0: 6c28 225c 6e22 2c20 6163 7475 616c 290a  l("\n", actual).
+0000aed0: 2020 2020 2020 2020 6a75 7374 5f77 6869          just_whi
+0000aee0: 7465 7370 6163 655f 6372 6c66 203d 2022  tespace_crlf = "
+0000aef0: 5c72 5c6e 5c74 5c72 5c6e 205c 725c 6e5c  \r\n\t\r\n \r\n\
+0000af00: 7420 5c72 5c6e 205c 745c 725c 6e5c 725c  t \r\n \t\r\n\r\
+0000af10: 6e22 0a20 2020 2020 2020 2061 6374 7561  n".        actua
+0000af20: 6c20 3d20 626c 6163 6b2e 666f 726d 6174  l = black.format
+0000af30: 5f66 696c 655f 636f 6e74 656e 7473 286a  _file_contents(j
+0000af40: 7573 745f 7768 6974 6573 7061 6365 5f63  ust_whitespace_c
+0000af50: 726c 662c 206d 6f64 653d 6d6f 6465 2c20  rlf, mode=mode, 
+0000af60: 6661 7374 3d46 616c 7365 290a 2020 2020  fast=False).    
+0000af70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000af80: 7175 616c 2822 5c72 5c6e 222c 2061 6374  qual("\r\n", act
+0000af90: 7561 6c29 0a0a 2020 2020 6465 6620 7465  ual)..    def te
+0000afa0: 7374 5f65 6e64 6d61 726b 6572 2873 656c  st_endmarker(sel
+0000afb0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000afc0: 2020 2020 6e20 3d20 626c 6163 6b2e 6c69      n = black.li
+0000afd0: 6232 746f 335f 7061 7273 6528 225c 6e22  b2to3_parse("\n"
+0000afe0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000aff0: 7373 6572 7445 7175 616c 286e 2e74 7970  ssertEqual(n.typ
+0000b000: 652c 2062 6c61 636b 2e73 796d 732e 6669  e, black.syms.fi
+0000b010: 6c65 5f69 6e70 7574 290a 2020 2020 2020  le_input).      
+0000b020: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000b030: 616c 286c 656e 286e 2e63 6869 6c64 7265  al(len(n.childre
+0000b040: 6e29 2c20 3129 0a20 2020 2020 2020 2073  n), 1).        s
+0000b050: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000b060: 6e2e 6368 696c 6472 656e 5b30 5d2e 7479  n.children[0].ty
+0000b070: 7065 2c20 626c 6163 6b2e 746f 6b65 6e2e  pe, black.token.
+0000b080: 454e 444d 4152 4b45 5229 0a0a 2020 2020  ENDMARKER)..    
+0000b090: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000b0a0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000b0b0: 7970 7963 0a20 2020 2040 756e 6974 7465  ypyc.    @unitte
+0000b0c0: 7374 2e73 6b69 7049 6628 6f73 2e65 6e76  st.skipIf(os.env
+0000b0d0: 6972 6f6e 2e67 6574 2822 534b 4950 5f41  iron.get("SKIP_A
+0000b0e0: 5354 5f50 5249 4e54 2229 2c20 2275 7365  ST_PRINT"), "use
+0000b0f0: 7220 7365 7420 534b 4950 5f41 5354 5f50  r set SKIP_AST_P
+0000b100: 5249 4e54 2229 0a20 2020 2064 6566 2074  RINT").    def t
+0000b110: 6573 745f 6173 7365 7274 466f 726d 6174  est_assertFormat
+0000b120: 4571 7561 6c28 7365 6c66 2920 2d3e 204e  Equal(self) -> N
+0000b130: 6f6e 653a 0a20 2020 2020 2020 206f 7574  one:.        out
+0000b140: 5f6c 696e 6573 203d 205b 5d0a 2020 2020  _lines = [].    
+0000b150: 2020 2020 6572 725f 6c69 6e65 7320 3d20      err_lines = 
+0000b160: 5b5d 0a0a 2020 2020 2020 2020 6465 6620  []..        def 
+0000b170: 6f75 7428 6d73 673a 2073 7472 2c20 2a2a  out(msg: str, **
+0000b180: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
+0000b190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000b1a0: 2020 6f75 745f 6c69 6e65 732e 6170 7065    out_lines.appe
+0000b1b0: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
+0000b1c0: 2064 6566 2065 7272 286d 7367 3a20 7374   def err(msg: st
+0000b1d0: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
+0000b1e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000b1f0: 2020 2020 2020 2065 7272 5f6c 696e 6573         err_lines
+0000b200: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
+0000b210: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+0000b220: 2822 626c 6163 6b2e 6f75 7470 7574 2e5f  ("black.output._
+0000b230: 6f75 7422 2c20 6f75 7429 2c20 7061 7463  out", out), patc
+0000b240: 6828 2262 6c61 636b 2e6f 7574 7075 742e  h("black.output.
+0000b250: 5f65 7272 222c 2065 7272 293a 0a20 2020  _err", err):.   
+0000b260: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+0000b270: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000b280: 4173 7365 7274 696f 6e45 7272 6f72 293a  AssertionError):
+0000b290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b2a0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+0000b2b0: 6174 4571 7561 6c28 226a 203d 205b 312c  atEqual("j = [1,
+0000b2c0: 2032 2c20 335d 222c 2022 6a20 3d20 5b31   2, 3]", "j = [1
+0000b2d0: 2c20 322c 2033 2c5d 2229 0a0a 2020 2020  , 2, 3,]")..    
+0000b2e0: 2020 2020 6f75 745f 7374 7220 3d20 2222      out_str = ""
+0000b2f0: 2e6a 6f69 6e28 6f75 745f 6c69 6e65 7329  .join(out_lines)
+0000b300: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000b310: 7365 7274 496e 2822 4578 7065 6374 6564  sertIn("Expected
+0000b320: 2074 7265 653a 222c 206f 7574 5f73 7472   tree:", out_str
+0000b330: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b340: 7373 6572 7449 6e28 2241 6374 7561 6c20  ssertIn("Actual 
+0000b350: 7472 6565 3a22 2c20 6f75 745f 7374 7229  tree:", out_str)
+0000b360: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000b370: 7365 7274 4571 7561 6c28 2222 2e6a 6f69  sertEqual("".joi
+0000b380: 6e28 6572 725f 6c69 6e65 7329 2c20 2222  n(err_lines), ""
+0000b390: 290a 0a20 2020 2040 6576 656e 745f 6c6f  )..    @event_lo
+0000b3a0: 6f70 2829 0a20 2020 2040 7061 7463 6828  op().    @patch(
+0000b3b0: 2263 6f6e 6375 7272 656e 742e 6675 7475  "concurrent.futu
+0000b3c0: 7265 732e 5072 6f63 6573 7350 6f6f 6c45  res.ProcessPoolE
+0000b3d0: 7865 6375 746f 7222 2c20 4d61 6769 634d  xecutor", MagicM
+0000b3e0: 6f63 6b28 7369 6465 5f65 6666 6563 743d  ock(side_effect=
+0000b3f0: 4f53 4572 726f 7229 290a 2020 2020 6465  OSError)).    de
+0000b400: 6620 7465 7374 5f77 6f72 6b73 5f69 6e5f  f test_works_in_
+0000b410: 6d6f 6e6f 5f70 726f 6365 7373 5f6f 6e6c  mono_process_onl
+0000b420: 795f 656e 7669 726f 6e6d 656e 7428 7365  y_environment(se
+0000b430: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000b440: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000b450: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+0000b460: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000b470: 666f 7220 6620 696e 205b 0a20 2020 2020  for f in [.     
+0000b480: 2020 2020 2020 2020 2020 2028 776f 726b             (work
+0000b490: 7370 6163 6520 2f20 226f 6e65 2e70 7922  space / "one.py"
+0000b4a0: 292e 7265 736f 6c76 6528 292c 0a20 2020  ).resolve(),.   
+0000b4b0: 2020 2020 2020 2020 2020 2020 2028 776f               (wo
+0000b4c0: 726b 7370 6163 6520 2f20 2274 776f 2e70  rkspace / "two.p
+0000b4d0: 7922 292e 7265 736f 6c76 6528 292c 0a20  y").resolve(),. 
+0000b4e0: 2020 2020 2020 2020 2020 205d 3a0a 2020             ]:.  
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+0000b500: 7772 6974 655f 7465 7874 2827 7072 696e  write_text('prin
+0000b510: 7428 2268 656c 6c6f 2229 5c6e 272c 2065  t("hello")\n', e
+0000b520: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+0000b530: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b540: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+0000b550: 7472 2877 6f72 6b73 7061 6365 295d 290a  tr(workspace)]).
+0000b560: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
+0000b570: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
+0000b580: 6368 6563 6b5f 6469 6666 5f75 7365 5f74  check_diff_use_t
+0000b590: 6f67 6574 6865 7228 7365 6c66 2920 2d3e  ogether(self) ->
+0000b5a0: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+0000b5b0: 6974 6820 6361 6368 655f 6469 7228 293a  ith cache_dir():
+0000b5c0: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
+0000b5d0: 696c 6573 2077 6869 6368 2077 696c 6c20  iles which will 
+0000b5e0: 6265 2072 6566 6f72 6d61 7474 6564 2e0a  be reformatted..
+0000b5f0: 2020 2020 2020 2020 2020 2020 7372 6331              src1
+0000b600: 203d 2067 6574 5f63 6173 655f 7061 7468   = get_case_path
+0000b610: 2822 6d69 7363 656c 6c61 6e65 6f75 7322  ("miscellaneous"
+0000b620: 2c20 2273 7472 696e 675f 7175 6f74 6573  , "string_quotes
+0000b630: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+0000b640: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+0000b650: 5b73 7472 2873 7263 3129 2c20 222d 2d64  [str(src1), "--d
+0000b660: 6966 6622 2c20 222d 2d63 6865 636b 225d  iff", "--check"]
+0000b670: 2c20 6578 6974 5f63 6f64 653d 3129 0a20  , exit_code=1). 
+0000b680: 2020 2020 2020 2020 2020 2023 2046 696c             # Fil
+0000b690: 6573 2077 6869 6368 2077 696c 6c20 6e6f  es which will no
+0000b6a0: 7420 6265 2072 6566 6f72 6d61 7474 6564  t be reformatted
+0000b6b0: 2e0a 2020 2020 2020 2020 2020 2020 7372  ..            sr
+0000b6c0: 6332 203d 2067 6574 5f63 6173 655f 7061  c2 = get_case_pa
+0000b6d0: 7468 2822 7369 6d70 6c65 5f63 6173 6573  th("simple_cases
+0000b6e0: 222c 2022 636f 6d70 6f73 6974 696f 6e22  ", "composition"
+0000b6f0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000b700: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000b710: 7374 7228 7372 6332 292c 2022 2d2d 6469  str(src2), "--di
+0000b720: 6666 222c 2022 2d2d 6368 6563 6b22 5d29  ff", "--check"])
+0000b730: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+0000b740: 756c 7469 2066 696c 6520 636f 6d6d 616e  ulti file comman
+0000b750: 642e 0a20 2020 2020 2020 2020 2020 2073  d..            s
+0000b760: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+0000b770: 5b73 7472 2873 7263 3129 2c20 7374 7228  [str(src1), str(
+0000b780: 7372 6332 292c 2022 2d2d 6469 6666 222c  src2), "--diff",
+0000b790: 2022 2d2d 6368 6563 6b22 5d2c 2065 7869   "--check"], exi
+0000b7a0: 745f 636f 6465 3d31 290a 0a20 2020 2064  t_code=1)..    d
+0000b7b0: 6566 2074 6573 745f 6e6f 5f73 7263 5f66  ef test_no_src_f
+0000b7c0: 6169 6c73 2873 656c 6629 202d 3e20 4e6f  ails(self) -> No
+0000b7d0: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+0000b7e0: 2063 6163 6865 5f64 6972 2829 3a0a 2020   cache_dir():.  
+0000b7f0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000b800: 6e76 6f6b 6542 6c61 636b 285b 5d2c 2065  nvokeBlack([], e
+0000b810: 7869 745f 636f 6465 3d31 290a 0a20 2020  xit_code=1)..   
+0000b820: 2064 6566 2074 6573 745f 7372 635f 616e   def test_src_an
+0000b830: 645f 636f 6465 5f66 6169 6c73 2873 656c  d_code_fails(sel
+0000b840: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000b850: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
+0000b860: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
+0000b870: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
+0000b880: 636b 285b 222e 222c 2022 2d63 222c 2022  ck([".", "-c", "
+0000b890: 3022 5d2c 2065 7869 745f 636f 6465 3d31  0"], exit_code=1
+0000b8a0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000b8b0: 6272 6f6b 656e 5f73 796d 6c69 6e6b 2873  broken_symlink(s
+0000b8c0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000b8d0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+0000b8e0: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+0000b8f0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+0000b900: 2073 796d 6c69 6e6b 203d 2077 6f72 6b73   symlink = works
+0000b910: 7061 6365 202f 2022 6272 6f6b 656e 5f6c  pace / "broken_l
+0000b920: 696e 6b2e 7079 220a 2020 2020 2020 2020  ink.py".        
+0000b930: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000b940: 2020 2020 2020 2020 2073 796d 6c69 6e6b           symlink
+0000b950: 2e73 796d 6c69 6e6b 5f74 6f28 226e 6f6e  .symlink_to("non
+0000b960: 6578 6973 7465 6e74 2e70 7922 290a 2020  existent.py").  
+0000b970: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000b980: 2028 4f53 4572 726f 722c 204e 6f74 496d   (OSError, NotIm
+0000b990: 706c 656d 656e 7465 6445 7272 6f72 2920  plementedError) 
+0000b9a0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000b9b0: 2020 2020 2020 7365 6c66 2e73 6b69 7054        self.skipT
+0000b9c0: 6573 7428 6622 4361 6e27 7420 6372 6561  est(f"Can't crea
+0000b9d0: 7465 2073 796d 6c69 6e6b 733a 207b 657d  te symlinks: {e}
+0000b9e0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+0000b9f0: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+0000ba00: 5b73 7472 2877 6f72 6b73 7061 6365 2e72  [str(workspace.r
+0000ba10: 6573 6f6c 7665 2829 295d 290a 0a20 2020  esolve())])..   
+0000ba20: 2064 6566 2074 6573 745f 7369 6e67 6c65   def test_single
+0000ba30: 5f66 696c 655f 666f 7263 655f 7079 6928  _file_force_pyi(
+0000ba40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000ba50: 2020 2020 2020 2070 7969 5f6d 6f64 6520         pyi_mode 
+0000ba60: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
+0000ba70: 545f 4d4f 4445 2c20 6973 5f70 7969 3d54  T_MODE, is_pyi=T
+0000ba80: 7275 6529 0a20 2020 2020 2020 2063 6f6e  rue).        con
+0000ba90: 7465 6e74 732c 2065 7870 6563 7465 6420  tents, expected 
+0000baa0: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000bab0: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
+0000bac0: 7263 655f 7079 6922 290a 2020 2020 2020  rce_pyi").      
+0000bad0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
+0000bae0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
+0000baf0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+0000bb00: 6820 3d20 2877 6f72 6b73 7061 6365 202f  h = (workspace /
+0000bb10: 2022 6669 6c65 2e70 7922 292e 7265 736f   "file.py").reso
+0000bb20: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
+0000bb30: 2020 7061 7468 2e77 7269 7465 5f74 6578    path.write_tex
+0000bb40: 7428 636f 6e74 656e 7473 2c20 656e 636f  t(contents, enco
+0000bb50: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
+0000bb60: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000bb70: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+0000bb80: 7061 7468 292c 2022 2d2d 7079 6922 5d29  path), "--pyi"])
+0000bb90: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+0000bba0: 7561 6c20 3d20 7061 7468 2e72 6561 645f  ual = path.read_
+0000bbb0: 7465 7874 2865 6e63 6f64 696e 673d 2275  text(encoding="u
+0000bbc0: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+0000bbd0: 2020 2023 2076 6572 6966 7920 6361 6368     # verify cach
+0000bbe0: 6520 7769 7468 202d 2d70 7969 2069 7320  e with --pyi is 
+0000bbf0: 7365 7061 7261 7465 0a20 2020 2020 2020  separate.       
+0000bc00: 2020 2020 2070 7969 5f63 6163 6865 203d       pyi_cache =
+0000bc10: 2062 6c61 636b 2e72 6561 645f 6361 6368   black.read_cach
+0000bc20: 6528 7079 695f 6d6f 6465 290a 2020 2020  e(pyi_mode).    
+0000bc30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000bc40: 6572 7449 6e28 7374 7228 7061 7468 292c  ertIn(str(path),
+0000bc50: 2070 7969 5f63 6163 6865 290a 2020 2020   pyi_cache).    
+0000bc60: 2020 2020 2020 2020 6e6f 726d 616c 5f63          normal_c
+0000bc70: 6163 6865 203d 2062 6c61 636b 2e72 6561  ache = black.rea
+0000bc80: 645f 6361 6368 6528 4445 4641 554c 545f  d_cache(DEFAULT_
+0000bc90: 4d4f 4445 290a 2020 2020 2020 2020 2020  MODE).          
+0000bca0: 2020 7365 6c66 2e61 7373 6572 744e 6f74    self.assertNot
+0000bcb0: 496e 2873 7472 2870 6174 6829 2c20 6e6f  In(str(path), no
+0000bcc0: 726d 616c 5f63 6163 6865 290a 2020 2020  rmal_cache).    
+0000bcd0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+0000bce0: 6f72 6d61 7445 7175 616c 2865 7870 6563  ormatEqual(expec
+0000bcf0: 7465 642c 2061 6374 7561 6c29 0a20 2020  ted, actual).   
+0000bd00: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+0000bd10: 745f 6571 7569 7661 6c65 6e74 2863 6f6e  t_equivalent(con
+0000bd20: 7465 6e74 732c 2061 6374 7561 6c29 0a20  tents, actual). 
+0000bd30: 2020 2020 2020 2062 6c61 636b 2e61 7373         black.ass
+0000bd40: 6572 745f 7374 6162 6c65 2863 6f6e 7465  ert_stable(conte
+0000bd50: 6e74 732c 2061 6374 7561 6c2c 2070 7969  nts, actual, pyi
+0000bd60: 5f6d 6f64 6529 0a0a 2020 2020 4065 7665  _mode)..    @eve
+0000bd70: 6e74 5f6c 6f6f 7028 290a 2020 2020 6465  nt_loop().    de
+0000bd80: 6620 7465 7374 5f6d 756c 7469 5f66 696c  f test_multi_fil
+0000bd90: 655f 666f 7263 655f 7079 6928 7365 6c66  e_force_pyi(self
+0000bda0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000bdb0: 2020 2072 6567 5f6d 6f64 6520 3d20 4445     reg_mode = DE
+0000bdc0: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
+0000bdd0: 2020 2070 7969 5f6d 6f64 6520 3d20 7265     pyi_mode = re
+0000bde0: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
+0000bdf0: 4445 2c20 6973 5f70 7969 3d54 7275 6529  DE, is_pyi=True)
+0000be00: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
+0000be10: 732c 2065 7870 6563 7465 6420 3d20 7265  s, expected = re
+0000be20: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
+0000be30: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
+0000be40: 7079 6922 290a 2020 2020 2020 2020 7769  pyi").        wi
+0000be50: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
+0000be60: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+0000be70: 2020 2020 2020 2020 2070 6174 6873 203d           paths =
+0000be80: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0000be90: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
+0000bea0: 2266 696c 6531 2e70 7922 292e 7265 736f  "file1.py").reso
+0000beb0: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
+0000bec0: 2020 2020 2020 2028 776f 726b 7370 6163         (workspac
+0000bed0: 6520 2f20 2266 696c 6532 2e70 7922 292e  e / "file2.py").
+0000bee0: 7265 736f 6c76 6528 292c 0a20 2020 2020  resolve(),.     
+0000bef0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0000bf00: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
+0000bf10: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
+0000bf20: 2020 2020 2020 2020 7061 7468 2e77 7269          path.wri
+0000bf30: 7465 5f74 6578 7428 636f 6e74 656e 7473  te_text(contents
+0000bf40: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+0000bf50: 3822 290a 2020 2020 2020 2020 2020 2020  8").            
+0000bf60: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000bf70: 285b 7374 7228 7029 2066 6f72 2070 2069  ([str(p) for p i
+0000bf80: 6e20 7061 7468 735d 202b 205b 222d 2d70  n paths] + ["--p
+0000bf90: 7969 225d 290a 2020 2020 2020 2020 2020  yi"]).          
+0000bfa0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
+0000bfb0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0000bfc0: 2020 2020 2061 6374 7561 6c20 3d20 7061       actual = pa
+0000bfd0: 7468 2e72 6561 645f 7465 7874 2865 6e63  th.read_text(enc
+0000bfe0: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000c000: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000c010: 6163 7475 616c 2c20 6578 7065 6374 6564  actual, expected
+0000c020: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000c030: 7665 7269 6679 2063 6163 6865 2077 6974  verify cache wit
+0000c040: 6820 2d2d 7079 6920 6973 2073 6570 6172  h --pyi is separ
+0000c050: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
+0000c060: 7079 695f 6361 6368 6520 3d20 626c 6163  pyi_cache = blac
+0000c070: 6b2e 7265 6164 5f63 6163 6865 2870 7969  k.read_cache(pyi
+0000c080: 5f6d 6f64 6529 0a20 2020 2020 2020 2020  _mode).         
+0000c090: 2020 206e 6f72 6d61 6c5f 6361 6368 6520     normal_cache 
+0000c0a0: 3d20 626c 6163 6b2e 7265 6164 5f63 6163  = black.read_cac
+0000c0b0: 6865 2872 6567 5f6d 6f64 6529 0a20 2020  he(reg_mode).   
+0000c0c0: 2020 2020 2020 2020 2066 6f72 2070 6174           for pat
+0000c0d0: 6820 696e 2070 6174 6873 3a0a 2020 2020  h in paths:.    
+0000c0e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c0f0: 2e61 7373 6572 7449 6e28 7374 7228 7061  .assertIn(str(pa
+0000c100: 7468 292c 2070 7969 5f63 6163 6865 290a  th), pyi_cache).
+0000c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c120: 7365 6c66 2e61 7373 6572 744e 6f74 496e  self.assertNotIn
+0000c130: 2873 7472 2870 6174 6829 2c20 6e6f 726d  (str(path), norm
+0000c140: 616c 5f63 6163 6865 290a 0a20 2020 2064  al_cache)..    d
+0000c150: 6566 2074 6573 745f 7069 7065 5f66 6f72  ef test_pipe_for
+0000c160: 6365 5f70 7969 2873 656c 6629 202d 3e20  ce_pyi(self) -> 
+0000c170: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+0000c180: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
+0000c190: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
+0000c1a0: 656c 6c61 6e65 6f75 7322 2c20 2266 6f72  ellaneous", "for
+0000c1b0: 6365 5f70 7969 2229 0a20 2020 2020 2020  ce_pyi").       
+0000c1c0: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+0000c1d0: 6e65 7228 292e 696e 766f 6b65 280a 2020  ner().invoke(.  
+0000c1e0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0000c1f0: 6d61 696e 2c20 5b22 2d22 2c20 222d 7122  main, ["-", "-q"
+0000c200: 2c20 222d 2d70 7969 225d 2c20 696e 7075  , "--pyi"], inpu
+0000c210: 743d 4279 7465 7349 4f28 736f 7572 6365  t=BytesIO(source
+0000c220: 2e65 6e63 6f64 6528 2275 7466 2d38 2229  .encode("utf-8")
+0000c230: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0000c240: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000c250: 7175 616c 2872 6573 756c 742e 6578 6974  qual(result.exit
+0000c260: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
+0000c270: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
+0000c280: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
+0000c290: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+0000c2a0: 6174 4571 7561 6c28 6163 7475 616c 2c20  atEqual(actual, 
+0000c2b0: 6578 7065 6374 6564 290a 0a20 2020 2064  expected)..    d
+0000c2c0: 6566 2074 6573 745f 7369 6e67 6c65 5f66  ef test_single_f
+0000c2d0: 696c 655f 666f 7263 655f 7079 3336 2873  ile_force_py36(s
+0000c2e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000c2f0: 2020 2020 2020 7265 675f 6d6f 6465 203d        reg_mode =
+0000c300: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+0000c310: 2020 2020 2020 7079 3336 5f6d 6f64 6520        py36_mode 
+0000c320: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
+0000c330: 545f 4d4f 4445 2c20 7461 7267 6574 5f76  T_MODE, target_v
+0000c340: 6572 7369 6f6e 733d 5059 3336 5f56 4552  ersions=PY36_VER
+0000c350: 5349 4f4e 5329 0a20 2020 2020 2020 2073  SIONS).        s
+0000c360: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+0000c370: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000c380: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
+0000c390: 7263 655f 7079 3336 2229 0a20 2020 2020  rce_py36").     
+0000c3a0: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+0000c3b0: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
+0000c3c0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000c3d0: 7468 203d 2028 776f 726b 7370 6163 6520  th = (workspace 
+0000c3e0: 2f20 2266 696c 652e 7079 2229 2e72 6573  / "file.py").res
+0000c3f0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+0000c400: 2020 2070 6174 682e 7772 6974 655f 7465     path.write_te
+0000c410: 7874 2873 6f75 7263 652c 2065 6e63 6f64  xt(source, encod
+0000c420: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+0000c430: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000c440: 766f 6b65 426c 6163 6b28 5b73 7472 2870  vokeBlack([str(p
+0000c450: 6174 6829 2c20 2a50 5933 365f 4152 4753  ath), *PY36_ARGS
+0000c460: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0000c470: 6374 7561 6c20 3d20 7061 7468 2e72 6561  ctual = path.rea
+0000c480: 645f 7465 7874 2865 6e63 6f64 696e 673d  d_text(encoding=
+0000c490: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+0000c4a0: 2020 2020 2023 2076 6572 6966 7920 6361       # verify ca
+0000c4b0: 6368 6520 7769 7468 202d 2d74 6172 6765  che with --targe
+0000c4c0: 742d 7665 7273 696f 6e20 6973 2073 6570  t-version is sep
+0000c4d0: 6172 6174 650a 2020 2020 2020 2020 2020  arate.          
+0000c4e0: 2020 7079 3336 5f63 6163 6865 203d 2062    py36_cache = b
+0000c4f0: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
+0000c500: 7079 3336 5f6d 6f64 6529 0a20 2020 2020  py36_mode).     
+0000c510: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000c520: 7274 496e 2873 7472 2870 6174 6829 2c20  rtIn(str(path), 
+0000c530: 7079 3336 5f63 6163 6865 290a 2020 2020  py36_cache).    
+0000c540: 2020 2020 2020 2020 6e6f 726d 616c 5f63          normal_c
+0000c550: 6163 6865 203d 2062 6c61 636b 2e72 6561  ache = black.rea
+0000c560: 645f 6361 6368 6528 7265 675f 6d6f 6465  d_cache(reg_mode
+0000c570: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000c580: 6c66 2e61 7373 6572 744e 6f74 496e 2873  lf.assertNotIn(s
+0000c590: 7472 2870 6174 6829 2c20 6e6f 726d 616c  tr(path), normal
+0000c5a0: 5f63 6163 6865 290a 2020 2020 2020 2020  _cache).        
+0000c5b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000c5c0: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
+0000c5d0: 6429 0a0a 2020 2020 4065 7665 6e74 5f6c  d)..    @event_l
+0000c5e0: 6f6f 7028 290a 2020 2020 6465 6620 7465  oop().    def te
+0000c5f0: 7374 5f6d 756c 7469 5f66 696c 655f 666f  st_multi_file_fo
+0000c600: 7263 655f 7079 3336 2873 656c 6629 202d  rce_py36(self) -
+0000c610: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000c620: 7265 675f 6d6f 6465 203d 2044 4546 4155  reg_mode = DEFAU
+0000c630: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
+0000c640: 7079 3336 5f6d 6f64 6520 3d20 7265 706c  py36_mode = repl
+0000c650: 6163 6528 4445 4641 554c 545f 4d4f 4445  ace(DEFAULT_MODE
+0000c660: 2c20 7461 7267 6574 5f76 6572 7369 6f6e  , target_version
+0000c670: 733d 5059 3336 5f56 4552 5349 4f4e 5329  s=PY36_VERSIONS)
+0000c680: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
+0000c690: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
+0000c6a0: 5f64 6174 6128 226d 6973 6365 6c6c 616e  _data("miscellan
+0000c6b0: 656f 7573 222c 2022 666f 7263 655f 7079  eous", "force_py
+0000c6c0: 3336 2229 0a20 2020 2020 2020 2077 6974  36").        wit
+0000c6d0: 6820 6361 6368 655f 6469 7228 2920 6173  h cache_dir() as
+0000c6e0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+0000c6f0: 2020 2020 2020 2020 7061 7468 7320 3d20          paths = 
+0000c700: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0000c710: 2020 2877 6f72 6b73 7061 6365 202f 2022    (workspace / "
+0000c720: 6669 6c65 312e 7079 2229 2e72 6573 6f6c  file1.py").resol
+0000c730: 7665 2829 2c0a 2020 2020 2020 2020 2020  ve(),.          
+0000c740: 2020 2020 2020 2877 6f72 6b73 7061 6365        (workspace
+0000c750: 202f 2022 6669 6c65 322e 7079 2229 2e72   / "file2.py").r
+0000c760: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
+0000c770: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000c780: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
+0000c790: 7061 7468 733a 0a20 2020 2020 2020 2020  paths:.         
+0000c7a0: 2020 2020 2020 2070 6174 682e 7772 6974         path.writ
+0000c7b0: 655f 7465 7874 2873 6f75 7263 652c 2065  e_text(source, e
+0000c7c0: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+0000c7d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c7e0: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+0000c7f0: 7472 2870 2920 666f 7220 7020 696e 2070  tr(p) for p in p
+0000c800: 6174 6873 5d20 2b20 5059 3336 5f41 5247  aths] + PY36_ARG
+0000c810: 5329 0a20 2020 2020 2020 2020 2020 2066  S).            f
+0000c820: 6f72 2070 6174 6820 696e 2070 6174 6873  or path in paths
+0000c830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c840: 2020 6163 7475 616c 203d 2070 6174 682e    actual = path.
+0000c850: 7265 6164 5f74 6578 7428 656e 636f 6469  read_text(encodi
+0000c860: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
+0000c870: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c880: 2e61 7373 6572 7445 7175 616c 2861 6374  .assertEqual(act
+0000c890: 7561 6c2c 2065 7870 6563 7465 6429 0a20  ual, expected). 
+0000c8a0: 2020 2020 2020 2020 2020 2023 2076 6572             # ver
+0000c8b0: 6966 7920 6361 6368 6520 7769 7468 202d  ify cache with -
+0000c8c0: 2d74 6172 6765 742d 7665 7273 696f 6e20  -target-version 
+0000c8d0: 6973 2073 6570 6172 6174 650a 2020 2020  is separate.    
+0000c8e0: 2020 2020 2020 2020 7079 695f 6361 6368          pyi_cach
+0000c8f0: 6520 3d20 626c 6163 6b2e 7265 6164 5f63  e = black.read_c
+0000c900: 6163 6865 2870 7933 365f 6d6f 6465 290a  ache(py36_mode).
+0000c910: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0000c920: 616c 5f63 6163 6865 203d 2062 6c61 636b  al_cache = black
+0000c930: 2e72 6561 645f 6361 6368 6528 7265 675f  .read_cache(reg_
+0000c940: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+0000c950: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
+0000c960: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0000c970: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000c980: 496e 2873 7472 2870 6174 6829 2c20 7079  In(str(path), py
+0000c990: 695f 6361 6368 6529 0a20 2020 2020 2020  i_cache).       
+0000c9a0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000c9b0: 7365 7274 4e6f 7449 6e28 7374 7228 7061  sertNotIn(str(pa
+0000c9c0: 7468 292c 206e 6f72 6d61 6c5f 6361 6368  th), normal_cach
+0000c9d0: 6529 0a0a 2020 2020 6465 6620 7465 7374  e)..    def test
+0000c9e0: 5f70 6970 655f 666f 7263 655f 7079 3336  _pipe_force_py36
+0000c9f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000ca00: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+0000ca10: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
+0000ca20: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+0000ca30: 6f75 7322 2c20 2266 6f72 6365 5f70 7933  ous", "force_py3
+0000ca40: 3622 290a 2020 2020 2020 2020 7265 7375  6").        resu
+0000ca50: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
+0000ca60: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+0000ca70: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
+0000ca80: 0a20 2020 2020 2020 2020 2020 205b 222d  .            ["-
+0000ca90: 222c 2022 2d71 222c 2022 2d2d 7461 7267  ", "-q", "--targ
+0000caa0: 6574 2d76 6572 7369 6f6e 3d70 7933 3622  et-version=py36"
+0000cab0: 5d2c 0a20 2020 2020 2020 2020 2020 2069  ],.            i
+0000cac0: 6e70 7574 3d42 7974 6573 494f 2873 6f75  nput=BytesIO(sou
+0000cad0: 7263 652e 656e 636f 6465 2822 7574 662d  rce.encode("utf-
+0000cae0: 3822 2929 2c0a 2020 2020 2020 2020 290a  8")),.        ).
+0000caf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000cb00: 6572 7445 7175 616c 2872 6573 756c 742e  ertEqual(result.
+0000cb10: 6578 6974 5f63 6f64 652c 2030 290a 2020  exit_code, 0).  
+0000cb20: 2020 2020 2020 6163 7475 616c 203d 2072        actual = r
+0000cb30: 6573 756c 742e 6f75 7470 7574 0a20 2020  esult.output.   
+0000cb40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000cb50: 466f 726d 6174 4571 7561 6c28 6163 7475  FormatEqual(actu
+0000cb60: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
+0000cb70: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+0000cb80: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+0000cb90: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+0000cba0: 7465 7374 5f72 6566 6f72 6d61 745f 6f6e  test_reformat_on
+0000cbb0: 655f 7769 7468 5f73 7464 696e 2873 656c  e_with_stdin(sel
+0000cbc0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000cbd0: 2020 2020 7769 7468 2070 6174 6368 280a      with patch(.
+0000cbe0: 2020 2020 2020 2020 2020 2020 2262 6c61              "bla
+0000cbf0: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
+0000cc00: 746f 5f73 7464 6f75 7422 2c0a 2020 2020  to_stdout",.    
+0000cc10: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
+0000cc20: 616c 7565 3d6c 616d 6264 6120 2a61 7267  alue=lambda *arg
+0000cc30: 732c 202a 2a6b 7761 7267 733a 2062 6c61  s, **kwargs: bla
+0000cc40: 636b 2e43 6861 6e67 6564 2e59 4553 2c0a  ck.Changed.YES,.
+0000cc50: 2020 2020 2020 2020 2920 6173 2066 7374          ) as fst
+0000cc60: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000cc70: 6570 6f72 7420 3d20 4d61 6769 634d 6f63  eport = MagicMoc
+0000cc80: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+0000cc90: 7061 7468 203d 2050 6174 6828 222d 2229  path = Path("-")
+0000cca0: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+0000ccb0: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
+0000ccc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ccd0: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
+0000cce0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
+0000ccf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cd00: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
+0000cd10: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
+0000cd20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cd30: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
+0000cd40: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
+0000cd50: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
+0000cd60: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+0000cd70: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
+0000cd80: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
+0000cd90: 5f6f 6e63 6528 290a 2020 2020 2020 2020  _once().        
+0000cda0: 2020 2020 7265 706f 7274 2e64 6f6e 652e      report.done.
+0000cdb0: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
+0000cdc0: 7468 2870 6174 682c 2062 6c61 636b 2e43  th(path, black.C
+0000cdd0: 6861 6e67 6564 2e59 4553 290a 0a20 2020  hanged.YES)..   
+0000cde0: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
+0000cdf0: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
+0000ce00: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
+0000ce10: 7374 5f72 6566 6f72 6d61 745f 6f6e 655f  st_reformat_one_
+0000ce20: 7769 7468 5f73 7464 696e 5f66 696c 656e  with_stdin_filen
+0000ce30: 616d 6528 7365 6c66 2920 2d3e 204e 6f6e  ame(self) -> Non
+0000ce40: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+0000ce50: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
+0000ce60: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
+0000ce70: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
+0000ce80: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
+0000ce90: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
+0000cea0: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
+0000ceb0: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
+0000cec0: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
+0000ced0: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
+0000cee0: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
+0000cef0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
+0000cf00: 2020 2020 2020 2070 203d 2022 666f 6f2e         p = "foo.
+0000cf10: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
+0000cf20: 7061 7468 203d 2050 6174 6828 6622 5f5f  path = Path(f"__
+0000cf30: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
+0000cf40: 4e41 4d45 5f5f 7b70 7d22 290a 2020 2020  NAME__{p}").    
+0000cf50: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0000cf60: 203d 2050 6174 6828 7029 0a20 2020 2020   = Path(p).     
+0000cf70: 2020 2020 2020 2062 6c61 636b 2e72 6566         black.ref
+0000cf80: 6f72 6d61 745f 6f6e 6528 0a20 2020 2020  ormat_one(.     
+0000cf90: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+0000cfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cfb0: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
+0000cfc0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000cfd0: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
+0000cfe0: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
+0000cff0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000d000: 3d44 4546 4155 4c54 5f4d 4f44 452c 0a20  =DEFAULT_MODE,. 
+0000d010: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d020: 6570 6f72 743d 7265 706f 7274 2c0a 2020  eport=report,.  
+0000d030: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d040: 2020 2020 2020 2020 6673 7473 2e61 7373          fsts.ass
+0000d050: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
+0000d060: 7769 7468 280a 2020 2020 2020 2020 2020  with(.          
+0000d070: 2020 2020 2020 6661 7374 3d54 7275 652c        fast=True,
+0000d080: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
+0000d090: 6b2e 5772 6974 6542 6163 6b2e 5945 532c  k.WriteBack.YES,
+0000d0a0: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
+0000d0b0: 4445 0a20 2020 2020 2020 2020 2020 2029  DE.            )
+0000d0c0: 0a20 2020 2020 2020 2020 2020 2023 205f  .            # _
+0000d0d0: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
+0000d0e0: 454e 414d 455f 5f20 7368 6f75 6c64 2068  ENAME__ should h
+0000d0f0: 6176 6520 6265 656e 2073 7472 6970 7065  ave been strippe
+0000d100: 640a 2020 2020 2020 2020 2020 2020 7265  d.            re
+0000d110: 706f 7274 2e64 6f6e 652e 6173 7365 7274  port.done.assert
+0000d120: 5f63 616c 6c65 645f 7769 7468 2865 7870  _called_with(exp
+0000d130: 6563 7465 642c 2062 6c61 636b 2e43 6861  ected, black.Cha
+0000d140: 6e67 6564 2e59 4553 290a 0a20 2020 2040  nged.YES)..    @
+0000d150: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
+0000d160: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
+0000d170: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
+0000d180: 5f72 6566 6f72 6d61 745f 6f6e 655f 7769  _reformat_one_wi
+0000d190: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
+0000d1a0: 655f 7079 6928 7365 6c66 2920 2d3e 204e  e_pyi(self) -> N
+0000d1b0: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0000d1c0: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
+0000d1d0: 2020 2020 2022 626c 6163 6b2e 666f 726d       "black.form
+0000d1e0: 6174 5f73 7464 696e 5f74 6f5f 7374 646f  at_stdin_to_stdo
+0000d1f0: 7574 222c 0a20 2020 2020 2020 2020 2020  ut",.           
+0000d200: 2072 6574 7572 6e5f 7661 6c75 653d 6c61   return_value=la
+0000d210: 6d62 6461 202a 6172 6773 2c20 2a2a 6b77  mbda *args, **kw
+0000d220: 6172 6773 3a20 626c 6163 6b2e 4368 616e  args: black.Chan
+0000d230: 6765 642e 5945 532c 0a20 2020 2020 2020  ged.YES,.       
+0000d240: 2029 2061 7320 6673 7473 3a0a 2020 2020   ) as fsts:.    
+0000d250: 2020 2020 2020 2020 7265 706f 7274 203d          report =
+0000d260: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
+0000d270: 2020 2020 2020 2020 2070 203d 2022 666f           p = "fo
+0000d280: 6f2e 7079 6922 0a20 2020 2020 2020 2020  o.pyi".         
+0000d290: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
+0000d2a0: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
+0000d2b0: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
+0000d2c0: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+0000d2d0: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
+0000d2e0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0000d2f0: 7265 666f 726d 6174 5f6f 6e65 280a 2020  reformat_one(.  
+0000d300: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000d310: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000d320: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
+0000d330: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000d340: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000d350: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
+0000d360: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000d370: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+0000d380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d390: 2020 7265 706f 7274 3d72 6570 6f72 742c    report=report,
+0000d3a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d3b0: 2020 2020 2020 2020 2020 2066 7374 732e             fsts.
+0000d3c0: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
+0000d3d0: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
+0000d3e0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000d3f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000d400: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
+0000d410: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000d420: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
+0000d430: 2020 2020 6d6f 6465 3d72 6570 6c61 6365      mode=replace
+0000d440: 2844 4546 4155 4c54 5f4d 4f44 452c 2069  (DEFAULT_MODE, i
+0000d450: 735f 7079 693d 5472 7565 292c 0a20 2020  s_pyi=True),.   
+0000d460: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000d470: 2020 2020 2020 2023 205f 5f42 4c41 434b         # __BLACK
+0000d480: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
+0000d490: 5f20 7368 6f75 6c64 2068 6176 6520 6265  _ should have be
+0000d4a0: 656e 2073 7472 6970 7065 640a 2020 2020  en stripped.    
+0000d4b0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+0000d4c0: 6f6e 652e 6173 7365 7274 5f63 616c 6c65  one.assert_calle
+0000d4d0: 645f 7769 7468 2865 7870 6563 7465 642c  d_with(expected,
+0000d4e0: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
+0000d4f0: 4553 290a 0a20 2020 2040 7079 7465 7374  ES)..    @pytest
+0000d500: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
+0000d510: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
+0000d520: 2020 6465 6620 7465 7374 5f72 6566 6f72    def test_refor
+0000d530: 6d61 745f 6f6e 655f 7769 7468 5f73 7464  mat_one_with_std
+0000d540: 696e 5f66 696c 656e 616d 655f 6970 796e  in_filename_ipyn
+0000d550: 6228 7365 6c66 2920 2d3e 204e 6f6e 653a  b(self) -> None:
+0000d560: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
+0000d570: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+0000d580: 2022 626c 6163 6b2e 666f 726d 6174 5f73   "black.format_s
+0000d590: 7464 696e 5f74 6f5f 7374 646f 7574 222c  tdin_to_stdout",
+0000d5a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d5b0: 7572 6e5f 7661 6c75 653d 6c61 6d62 6461  urn_value=lambda
+0000d5c0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+0000d5d0: 3a20 626c 6163 6b2e 4368 616e 6765 642e  : black.Changed.
+0000d5e0: 5945 532c 0a20 2020 2020 2020 2029 2061  YES,.        ) a
+0000d5f0: 7320 6673 7473 3a0a 2020 2020 2020 2020  s fsts:.        
+0000d600: 2020 2020 7265 706f 7274 203d 204d 6167      report = Mag
+0000d610: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
+0000d620: 2020 2020 2070 203d 2022 666f 6f2e 6970       p = "foo.ip
+0000d630: 796e 6222 0a20 2020 2020 2020 2020 2020  ynb".           
+0000d640: 2070 6174 6820 3d20 5061 7468 2866 225f   path = Path(f"_
+0000d650: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
+0000d660: 454e 414d 455f 5f7b 707d 2229 0a20 2020  ENAME__{p}").   
+0000d670: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
+0000d680: 6420 3d20 5061 7468 2870 290a 2020 2020  d = Path(p).    
+0000d690: 2020 2020 2020 2020 626c 6163 6b2e 7265          black.re
+0000d6a0: 666f 726d 6174 5f6f 6e65 280a 2020 2020  format_one(.    
+0000d6b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000d6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d6d0: 2020 6661 7374 3d54 7275 652c 0a20 2020    fast=True,.   
+0000d6e0: 2020 2020 2020 2020 2020 2020 2077 7269               wri
+0000d6f0: 7465 5f62 6163 6b3d 626c 6163 6b2e 5772  te_back=black.Wr
+0000d700: 6974 6542 6163 6b2e 5945 532c 0a20 2020  iteBack.YES,.   
+0000d710: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000d720: 653d 4445 4641 554c 545f 4d4f 4445 2c0a  e=DEFAULT_MODE,.
+0000d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d740: 7265 706f 7274 3d72 6570 6f72 742c 0a20  report=report,. 
+0000d750: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000d760: 2020 2020 2020 2020 2066 7374 732e 6173           fsts.as
+0000d770: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
+0000d780: 5f77 6974 6828 0a20 2020 2020 2020 2020  _with(.         
+0000d790: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
+0000d7a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d7b0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
+0000d7c0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
+0000d7d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d7e0: 2020 6d6f 6465 3d72 6570 6c61 6365 2844    mode=replace(D
+0000d7f0: 4546 4155 4c54 5f4d 4f44 452c 2069 735f  EFAULT_MODE, is_
+0000d800: 6970 796e 623d 5472 7565 292c 0a20 2020  ipynb=True),.   
+0000d810: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000d820: 2020 2020 2020 2023 205f 5f42 4c41 434b         # __BLACK
+0000d830: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
+0000d840: 5f20 7368 6f75 6c64 2068 6176 6520 6265  _ should have be
+0000d850: 656e 2073 7472 6970 7065 640a 2020 2020  en stripped.    
+0000d860: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+0000d870: 6f6e 652e 6173 7365 7274 5f63 616c 6c65  one.assert_calle
+0000d880: 645f 7769 7468 2865 7870 6563 7465 642c  d_with(expected,
+0000d890: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
+0000d8a0: 4553 290a 0a20 2020 2040 7079 7465 7374  ES)..    @pytest
+0000d8b0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
+0000d8c0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
+0000d8d0: 2020 6465 6620 7465 7374 5f72 6566 6f72    def test_refor
+0000d8e0: 6d61 745f 6f6e 655f 7769 7468 5f73 7464  mat_one_with_std
+0000d8f0: 696e 5f61 6e64 5f65 7869 7374 696e 675f  in_and_existing_
+0000d900: 7061 7468 2873 656c 6629 202d 3e20 4e6f  path(self) -> No
+0000d910: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+0000d920: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
+0000d930: 2020 2020 2262 6c61 636b 2e66 6f72 6d61      "black.forma
+0000d940: 745f 7374 6469 6e5f 746f 5f73 7464 6f75  t_stdin_to_stdou
+0000d950: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+0000d960: 7265 7475 726e 5f76 616c 7565 3d6c 616d  return_value=lam
+0000d970: 6264 6120 2a61 7267 732c 202a 2a6b 7761  bda *args, **kwa
+0000d980: 7267 733a 2062 6c61 636b 2e43 6861 6e67  rgs: black.Chang
+0000d990: 6564 2e59 4553 2c0a 2020 2020 2020 2020  ed.YES,.        
+0000d9a0: 2920 6173 2066 7374 733a 0a20 2020 2020  ) as fsts:.     
+0000d9b0: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
+0000d9c0: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+0000d9d0: 2020 2020 2020 2020 2320 4576 656e 2077          # Even w
+0000d9e0: 6974 6820 616e 2065 7869 7374 696e 6720  ith an existing 
+0000d9f0: 6669 6c65 2c20 7369 6e63 6520 7765 2061  file, since we a
+0000da00: 7265 2066 6f72 6369 6e67 2073 7464 696e  re forcing stdin
+0000da10: 2c20 626c 6163 6b0a 2020 2020 2020 2020  , black.        
+0000da20: 2020 2020 2320 7368 6f75 6c64 206f 7574      # should out
+0000da30: 7075 7420 746f 2073 7464 6f75 7420 616e  put to stdout an
+0000da40: 6420 6e6f 7420 6d6f 6469 6679 2074 6865  d not modify the
+0000da50: 2066 696c 6520 696e 706c 6163 650a 2020   file inplace.  
+0000da60: 2020 2020 2020 2020 2020 7020 3d20 5448            p = TH
+0000da70: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
+0000da80: 2f20 2273 696d 706c 655f 6361 7365 7322  / "simple_cases"
+0000da90: 202f 2022 636f 6c6c 6563 7469 6f6e 732e   / "collections.
+0000daa0: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
+0000dab0: 2320 4d61 6b65 2073 7572 6520 6973 5f66  # Make sure is_f
+0000dac0: 696c 6520 6163 7475 616c 6c79 2072 6574  ile actually ret
+0000dad0: 7572 6e73 2054 7275 650a 2020 2020 2020  urns True.      
+0000dae0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000daf0: 7454 7275 6528 702e 6973 5f66 696c 6528  tTrue(p.is_file(
+0000db00: 2929 0a20 2020 2020 2020 2020 2020 2070  )).            p
+0000db10: 6174 6820 3d20 5061 7468 2866 225f 5f42  ath = Path(f"__B
+0000db20: 4c41 434b 5f53 5444 494e 5f46 494c 454e  LACK_STDIN_FILEN
+0000db30: 414d 455f 5f7b 707d 2229 0a20 2020 2020  AME__{p}").     
+0000db40: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
+0000db50: 3d20 5061 7468 2870 290a 2020 2020 2020  = Path(p).      
+0000db60: 2020 2020 2020 626c 6163 6b2e 7265 666f        black.refo
+0000db70: 726d 6174 5f6f 6e65 280a 2020 2020 2020  rmat_one(.      
+0000db80: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+0000db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dba0: 6661 7374 3d54 7275 652c 0a20 2020 2020  fast=True,.     
+0000dbb0: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000dbc0: 5f62 6163 6b3d 626c 6163 6b2e 5772 6974  _back=black.Writ
+0000dbd0: 6542 6163 6b2e 5945 532c 0a20 2020 2020  eBack.YES,.     
+0000dbe0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
+0000dbf0: 4445 4641 554c 545f 4d4f 4445 2c0a 2020  DEFAULT_MODE,.  
+0000dc00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000dc10: 706f 7274 3d72 6570 6f72 742c 0a20 2020  port=report,.   
+0000dc20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000dc30: 2020 2020 2020 2066 7374 732e 6173 7365         fsts.asse
+0000dc40: 7274 5f63 616c 6c65 645f 6f6e 6365 2829  rt_called_once()
+0000dc50: 0a20 2020 2020 2020 2020 2020 2023 205f  .            # _
+0000dc60: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
+0000dc70: 454e 414d 455f 5f20 7368 6f75 6c64 2068  ENAME__ should h
+0000dc80: 6176 6520 6265 656e 2073 7472 6970 7065  ave been strippe
+0000dc90: 640a 2020 2020 2020 2020 2020 2020 7265  d.            re
+0000dca0: 706f 7274 2e64 6f6e 652e 6173 7365 7274  port.done.assert
+0000dcb0: 5f63 616c 6c65 645f 7769 7468 2865 7870  _called_with(exp
+0000dcc0: 6563 7465 642c 2062 6c61 636b 2e43 6861  ected, black.Cha
+0000dcd0: 6e67 6564 2e59 4553 290a 0a20 2020 2064  nged.YES)..    d
+0000dce0: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
+0000dcf0: 5f6f 6e65 5f77 6974 685f 7374 6469 6e5f  _one_with_stdin_
+0000dd00: 656d 7074 7928 7365 6c66 2920 2d3e 204e  empty(self) -> N
+0000dd10: 6f6e 653a 0a20 2020 2020 2020 2063 6173  one:.        cas
+0000dd20: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
+0000dd30: 2020 2028 2222 2c20 2222 292c 0a20 2020     ("", ""),.   
+0000dd40: 2020 2020 2020 2020 2028 225c 6e22 2c20           ("\n", 
+0000dd50: 225c 6e22 292c 0a20 2020 2020 2020 2020  "\n"),.         
+0000dd60: 2020 2028 225c 725c 6e22 2c20 225c 725c     ("\r\n", "\r\
+0000dd70: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
+0000dd80: 2028 2220 5c74 222c 2022 2229 2c0a 2020   (" \t", ""),.  
+0000dd90: 2020 2020 2020 2020 2020 2822 205c 745c            (" \t\
+0000dda0: 6e5c 7420 222c 2022 5c6e 2229 2c0a 2020  n\t ", "\n"),.  
+0000ddb0: 2020 2020 2020 2020 2020 2822 205c 745c            (" \t\
+0000ddc0: 725c 6e5c 7420 222c 2022 5c72 5c6e 2229  r\n\t ", "\r\n")
+0000ddd0: 2c0a 2020 2020 2020 2020 5d0a 0a20 2020  ,.        ]..   
+0000dde0: 2020 2020 2064 6566 205f 6e65 775f 7772       def _new_wr
+0000ddf0: 6170 7065 7228 0a20 2020 2020 2020 2020  apper(.         
+0000de00: 2020 206f 7574 7075 743a 2069 6f2e 5374     output: io.St
+0000de10: 7269 6e67 494f 2c20 696f 5f54 6578 7449  ringIO, io_TextI
+0000de20: 4f57 7261 7070 6572 3a20 5479 7065 5b69  OWrapper: Type[i
+0000de30: 6f2e 5465 7874 494f 5772 6170 7065 725d  o.TextIOWrapper]
+0000de40: 0a20 2020 2020 2020 2029 202d 3e20 4361  .        ) -> Ca
+0000de50: 6c6c 6162 6c65 5b5b 416e 792c 2041 6e79  llable[[Any, Any
+0000de60: 5d2c 2069 6f2e 5465 7874 494f 5772 6170  ], io.TextIOWrap
+0000de70: 7065 725d 3a0a 2020 2020 2020 2020 2020  per]:.          
+0000de80: 2020 6465 6620 6765 745f 6f75 7470 7574    def get_output
+0000de90: 282a 6172 6773 3a20 416e 792c 202a 2a6b  (*args: Any, **k
+0000dea0: 7761 7267 733a 2041 6e79 2920 2d3e 2069  wargs: Any) -> i
+0000deb0: 6f2e 5465 7874 494f 5772 6170 7065 723a  o.TextIOWrapper:
+0000dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ded0: 2069 6620 6172 6773 203d 3d20 2873 7973   if args == (sys
+0000dee0: 2e73 7464 6f75 742e 6275 6666 6572 2c29  .stdout.buffer,)
+0000def0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000df00: 2020 2020 2020 2320 4974 2773 2060 666f        # It's `fo
+0000df10: 726d 6174 5f73 7464 696e 5f74 6f5f 7374  rmat_stdin_to_st
+0000df20: 646f 7574 2829 6020 6361 6c6c 696e 6720  dout()` calling 
+0000df30: 6069 6f2e 5465 7874 494f 5772 6170 7065  `io.TextIOWrappe
+0000df40: 7228 2960 2c0a 2020 2020 2020 2020 2020  r()`,.          
+0000df50: 2020 2020 2020 2020 2020 2320 7265 7475            # retu
+0000df60: 726e 206f 7572 206d 6f63 6b20 6f62 6a65  rn our mock obje
+0000df70: 6374 2e0a 2020 2020 2020 2020 2020 2020  ct..            
+0000df80: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0000df90: 7574 7075 740a 2020 2020 2020 2020 2020  utput.          
+0000dfa0: 2020 2020 2020 2320 4974 2773 2073 6f6d        # It's som
+0000dfb0: 6574 6869 6e67 2065 6c73 6520 2869 2e65  ething else (i.e
+0000dfc0: 2e20 6064 6563 6f64 655f 6279 7465 7328  . `decode_bytes(
+0000dfd0: 2960 2920 6361 6c6c 696e 670a 2020 2020  )`) calling.    
+0000dfe0: 2020 2020 2020 2020 2020 2020 2320 6069              # `i
+0000dff0: 6f2e 5465 7874 494f 5772 6170 7065 7228  o.TextIOWrapper(
+0000e000: 2960 2c20 7061 7373 2074 6872 6f75 6768  )`, pass through
+0000e010: 2074 6f20 7468 6520 6f72 6967 696e 616c   to the original
+0000e020: 2069 6d70 6c65 6d65 6e74 6174 696f 6e2e   implementation.
+0000e030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e040: 2023 2053 6565 2064 6973 6375 7373 696f   # See discussio
+0000e050: 6e20 696e 2068 7474 7073 3a2f 2f67 6974  n in https://git
+0000e060: 6875 622e 636f 6d2f 7073 662f 626c 6163  hub.com/psf/blac
+0000e070: 6b2f 7075 6c6c 2f32 3438 390a 2020 2020  k/pull/2489.    
+0000e080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e090: 726e 2069 6f5f 5465 7874 494f 5772 6170  rn io_TextIOWrap
+0000e0a0: 7065 7228 2a61 7267 732c 202a 2a6b 7761  per(*args, **kwa
+0000e0b0: 7267 7329 0a0a 2020 2020 2020 2020 2020  rgs)..          
+0000e0c0: 2020 7265 7475 726e 2067 6574 5f6f 7574    return get_out
+0000e0d0: 7075 740a 0a20 2020 2020 2020 206d 6f64  put..        mod
+0000e0e0: 6520 3d20 626c 6163 6b2e 4d6f 6465 2870  e = black.Mode(p
+0000e0f0: 7265 7669 6577 3d54 7275 6529 0a20 2020  review=True).   
+0000e100: 2020 2020 2066 6f72 2063 6f6e 7465 6e74       for content
+0000e110: 2c20 6578 7065 6374 6564 2069 6e20 6361  , expected in ca
+0000e120: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
+0000e130: 206f 7574 7075 7420 3d20 696f 2e53 7472   output = io.Str
+0000e140: 696e 6749 4f28 290a 2020 2020 2020 2020  ingIO().        
+0000e150: 2020 2020 696f 5f54 6578 7449 4f57 7261      io_TextIOWra
+0000e160: 7070 6572 203d 2069 6f2e 5465 7874 494f  pper = io.TextIO
+0000e170: 5772 6170 7065 720a 0a20 2020 2020 2020  Wrapper..       
+0000e180: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+0000e190: 2269 6f2e 5465 7874 494f 5772 6170 7065  "io.TextIOWrappe
+0000e1a0: 7222 2c20 5f6e 6577 5f77 7261 7070 6572  r", _new_wrapper
+0000e1b0: 286f 7574 7075 742c 2069 6f5f 5465 7874  (output, io_Text
+0000e1c0: 494f 5772 6170 7065 7229 293a 0a20 2020  IOWrapper)):.   
+0000e1d0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0000e1e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e1f0: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
+0000e200: 6174 5f73 7464 696e 5f74 6f5f 7374 646f  at_stdin_to_stdo
+0000e210: 7574 280a 2020 2020 2020 2020 2020 2020  ut(.            
+0000e220: 2020 2020 2020 2020 2020 2020 6661 7374              fast
+0000e230: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+0000e240: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000e250: 6f6e 7465 6e74 3d63 6f6e 7465 6e74 2c0a  ontent=content,.
+0000e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e270: 2020 2020 2020 2020 7772 6974 655f 6261          write_ba
+0000e280: 636b 3d62 6c61 636b 2e57 7269 7465 4261  ck=black.WriteBa
+0000e290: 636b 2e59 4553 2c0a 2020 2020 2020 2020  ck.YES,.        
+0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2b0: 6d6f 6465 3d6d 6f64 652c 0a20 2020 2020  mode=mode,.     
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e2e0: 2065 7863 6570 7420 696f 2e55 6e73 7570   except io.Unsup
+0000e2f0: 706f 7274 6564 4f70 6572 6174 696f 6e3a  portedOperation:
+0000e300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e310: 2020 2020 2070 6173 7320 2023 2053 7472       pass  # Str
+0000e320: 696e 6749 4f20 646f 6573 206e 6f74 2073  ingIO does not s
+0000e330: 7570 706f 7274 2064 6574 6163 680a 2020  upport detach.  
+0000e340: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0000e350: 7365 7274 206f 7574 7075 742e 6765 7476  sert output.getv
+0000e360: 616c 7565 2829 203d 3d20 6578 7065 6374  alue() == expect
+0000e370: 6564 0a0a 2020 2020 2020 2020 2320 416e  ed..        # An
+0000e380: 2065 6d70 7479 2073 7472 696e 6720 6973   empty string is
+0000e390: 2074 6865 206f 6e6c 7920 7465 7374 2063   the only test c
+0000e3a0: 6173 6520 666f 7220 6070 7265 7669 6577  ase for `preview
+0000e3b0: 3d46 616c 7365 600a 2020 2020 2020 2020  =False`.        
+0000e3c0: 6f75 7470 7574 203d 2069 6f2e 5374 7269  output = io.Stri
+0000e3d0: 6e67 494f 2829 0a20 2020 2020 2020 2069  ngIO().        i
+0000e3e0: 6f5f 5465 7874 494f 5772 6170 7065 7220  o_TextIOWrapper 
+0000e3f0: 3d20 696f 2e54 6578 7449 4f57 7261 7070  = io.TextIOWrapp
+0000e400: 6572 0a20 2020 2020 2020 2077 6974 6820  er.        with 
+0000e410: 7061 7463 6828 2269 6f2e 5465 7874 494f  patch("io.TextIO
+0000e420: 5772 6170 7065 7222 2c20 5f6e 6577 5f77  Wrapper", _new_w
+0000e430: 7261 7070 6572 286f 7574 7075 742c 2069  rapper(output, i
+0000e440: 6f5f 5465 7874 494f 5772 6170 7065 7229  o_TextIOWrapper)
+0000e450: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+0000e460: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000e470: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
+0000e480: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
+0000e490: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e4a0: 2020 2020 2020 6661 7374 3d54 7275 652c        fast=True,
+0000e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e4c0: 2020 2020 2063 6f6e 7465 6e74 3d22 222c       content="",
+0000e4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e4e0: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
+0000e4f0: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
+0000e500: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
+0000e510: 2020 2020 2020 2020 206d 6f64 653d 4445           mode=DE
+0000e520: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
+0000e530: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000e540: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000e550: 2069 6f2e 556e 7375 7070 6f72 7465 644f   io.UnsupportedO
+0000e560: 7065 7261 7469 6f6e 3a0a 2020 2020 2020  peration:.      
+0000e570: 2020 2020 2020 2020 2020 7061 7373 2020            pass  
+0000e580: 2320 5374 7269 6e67 494f 2064 6f65 7320  # StringIO does 
+0000e590: 6e6f 7420 7375 7070 6f72 7420 6465 7461  not support deta
+0000e5a0: 6368 0a20 2020 2020 2020 2020 2020 2061  ch.            a
+0000e5b0: 7373 6572 7420 6f75 7470 7574 2e67 6574  ssert output.get
+0000e5c0: 7661 6c75 6528 2920 3d3d 2022 220a 0a20  value() == "".. 
+0000e5d0: 2020 2064 6566 2074 6573 745f 696e 7661     def test_inva
+0000e5e0: 6c69 645f 636c 695f 7265 6765 7828 7365  lid_cli_regex(se
+0000e5f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000e600: 2020 2020 2066 6f72 206f 7074 696f 6e20       for option 
+0000e610: 696e 205b 222d 2d69 6e63 6c75 6465 222c  in ["--include",
+0000e620: 2022 2d2d 6578 636c 7564 6522 2c20 222d   "--exclude", "-
+0000e630: 2d65 7874 656e 642d 6578 636c 7564 6522  -extend-exclude"
+0000e640: 2c20 222d 2d66 6f72 6365 2d65 7863 6c75  , "--force-exclu
+0000e650: 6465 225d 3a0a 2020 2020 2020 2020 2020  de"]:.          
+0000e660: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
+0000e670: 636b 285b 222d 222c 206f 7074 696f 6e2c  ck(["-", option,
+0000e680: 2022 2a2a 2829 2821 212a 2922 5d2c 2065   "**()(!!*)"], e
+0000e690: 7869 745f 636f 6465 3d32 290a 0a20 2020  xit_code=2)..   
+0000e6a0: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
+0000e6b0: 6564 5f76 6572 7369 6f6e 5f6d 6174 6368  ed_version_match
+0000e6c0: 6573 5f76 6572 7369 6f6e 2873 656c 6629  es_version(self)
+0000e6d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000e6e0: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
+0000e6f0: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
+0000e700: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
+0000e710: 7369 6f6e 222c 2062 6c61 636b 2e5f 5f76  sion", black.__v
+0000e720: 6572 7369 6f6e 5f5f 2c20 222d 6322 2c20  ersion__, "-c", 
+0000e730: 2230 225d 2c0a 2020 2020 2020 2020 2020  "0"],.          
+0000e740: 2020 6578 6974 5f63 6f64 653d 302c 0a20    exit_code=0,. 
+0000e750: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+0000e760: 655f 636f 6e66 6967 3d54 7275 652c 0a20  e_config=True,. 
+0000e770: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000e780: 6620 7465 7374 5f72 6571 7569 7265 645f  f test_required_
+0000e790: 7665 7273 696f 6e5f 6d61 7463 6865 735f  version_matches_
+0000e7a0: 7061 7274 6961 6c5f 7665 7273 696f 6e28  partial_version(
+0000e7b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000e7c0: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
+0000e7d0: 6b65 426c 6163 6b28 0a20 2020 2020 2020  keBlack(.       
+0000e7e0: 2020 2020 205b 222d 2d72 6571 7569 7265       ["--require
+0000e7f0: 642d 7665 7273 696f 6e22 2c20 626c 6163  d-version", blac
+0000e800: 6b2e 5f5f 7665 7273 696f 6e5f 5f2e 7370  k.__version__.sp
+0000e810: 6c69 7428 222e 2229 5b30 5d2c 2022 2d63  lit(".")[0], "-c
+0000e820: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
+0000e830: 2020 2020 2065 7869 745f 636f 6465 3d30       exit_code=0
+0000e840: 2c0a 2020 2020 2020 2020 2020 2020 6967  ,.            ig
+0000e850: 6e6f 7265 5f63 6f6e 6669 673d 5472 7565  nore_config=True
+0000e860: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000e870: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
+0000e880: 6564 5f76 6572 7369 6f6e 5f64 6f65 735f  ed_version_does_
+0000e890: 6e6f 745f 6d61 7463 685f 6f6e 5f6d 696e  not_match_on_min
+0000e8a0: 6f72 5f76 6572 7369 6f6e 2873 656c 6629  or_version(self)
+0000e8b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000e8c0: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
+0000e8d0: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
+0000e8e0: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
+0000e8f0: 7369 6f6e 222c 2062 6c61 636b 2e5f 5f76  sion", black.__v
+0000e900: 6572 7369 6f6e 5f5f 2e73 706c 6974 2822  ersion__.split("
+0000e910: 2e22 295b 305d 202b 2022 2e39 3939 222c  .")[0] + ".999",
+0000e920: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
+0000e930: 2020 2020 2020 2020 2065 7869 745f 636f           exit_co
+0000e940: 6465 3d31 2c0a 2020 2020 2020 2020 2020  de=1,.          
+0000e950: 2020 6967 6e6f 7265 5f63 6f6e 6669 673d    ignore_config=
+0000e960: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
+0000e970: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+0000e980: 7175 6972 6564 5f76 6572 7369 6f6e 5f64  quired_version_d
+0000e990: 6f65 735f 6e6f 745f 6d61 7463 685f 7665  oes_not_match_ve
+0000e9a0: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
+0000e9b0: 6f6e 653a 0a20 2020 2020 2020 2072 6573  one:.        res
+0000e9c0: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
+0000e9d0: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
+0000e9e0: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
+0000e9f0: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+0000ea00: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
+0000ea10: 7369 6f6e 222c 2022 3230 2e39 3962 222c  sion", "20.99b",
+0000ea20: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
+0000ea30: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+0000ea40: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000ea50: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
+0000ea60: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
+0000ea70: 662e 6173 7365 7274 496e 2822 7265 7175  f.assertIn("requ
+0000ea80: 6972 6564 2076 6572 7369 6f6e 222c 2072  ired version", r
+0000ea90: 6573 756c 742e 7374 6465 7272 290a 0a20  esult.stderr).. 
+0000eaa0: 2020 2064 6566 2074 6573 745f 7072 6573     def test_pres
+0000eab0: 6572 7665 735f 6c69 6e65 5f65 6e64 696e  erves_line_endin
+0000eac0: 6773 2873 656c 6629 202d 3e20 4e6f 6e65  gs(self) -> None
+0000ead0: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
+0000eae0: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
+0000eaf0: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
+0000eb00: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
+0000eb10: 7374 5f66 696c 6520 3d20 5061 7468 2877  st_file = Path(w
+0000eb20: 6f72 6b73 7061 6365 2920 2f20 2274 6573  orkspace) / "tes
+0000eb30: 742e 7079 220a 2020 2020 2020 2020 2020  t.py".          
+0000eb40: 2020 666f 7220 6e6c 2069 6e20 5b22 5c6e    for nl in ["\n
+0000eb50: 222c 2022 5c72 5c6e 225d 3a0a 2020 2020  ", "\r\n"]:.    
+0000eb60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000eb70: 656e 7473 203d 206e 6c2e 6a6f 696e 285b  ents = nl.join([
+0000eb80: 2264 6566 2066 2820 2029 3a22 2c20 2220  "def f(  ):", " 
+0000eb90: 2020 2070 6173 7322 5d29 0a20 2020 2020     pass"]).     
+0000eba0: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+0000ebb0: 6669 6c65 2e77 7269 7465 5f62 7974 6573  file.write_bytes
+0000ebc0: 2863 6f6e 7465 6e74 732e 656e 636f 6465  (contents.encode
+0000ebd0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0000ebe0: 2020 2020 6666 2874 6573 745f 6669 6c65      ff(test_file
+0000ebf0: 2c20 7772 6974 655f 6261 636b 3d62 6c61  , write_back=bla
+0000ec00: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
+0000ec10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ec20: 2020 7570 6461 7465 645f 636f 6e74 656e    updated_conten
+0000ec30: 7473 3a20 6279 7465 7320 3d20 7465 7374  ts: bytes = test
+0000ec40: 5f66 696c 652e 7265 6164 5f62 7974 6573  _file.read_bytes
+0000ec50: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000ec60: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+0000ec70: 286e 6c2e 656e 636f 6465 2829 2c20 7570  (nl.encode(), up
+0000ec80: 6461 7465 645f 636f 6e74 656e 7473 290a  dated_contents).
+0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eca0: 6966 206e 6c20 3d3d 2022 5c6e 223a 0a20  if nl == "\n":. 
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+0000ecd0: 7449 6e28 6222 5c72 5c6e 222c 2075 7064  tIn(b"\r\n", upd
+0000ece0: 6174 6564 5f63 6f6e 7465 6e74 7329 0a0a  ated_contents)..
+0000ecf0: 2020 2020 6465 6620 7465 7374 5f70 7265      def test_pre
+0000ed00: 7365 7276 6573 5f6c 696e 655f 656e 6469  serves_line_endi
+0000ed10: 6e67 735f 7669 615f 7374 6469 6e28 7365  ngs_via_stdin(se
+0000ed20: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000ed30: 2020 2020 2066 6f72 206e 6c20 696e 205b       for nl in [
+0000ed40: 225c 6e22 2c20 225c 725c 6e22 5d3a 0a20  "\n", "\r\n"]:. 
+0000ed50: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+0000ed60: 6e74 7320 3d20 6e6c 2e6a 6f69 6e28 5b22  nts = nl.join(["
+0000ed70: 6465 6620 6628 2020 293a 222c 2022 2020  def f(  ):", "  
+0000ed80: 2020 7061 7373 225d 290a 2020 2020 2020    pass"]).      
+0000ed90: 2020 2020 2020 7275 6e6e 6572 203d 2042        runner = B
+0000eda0: 6c61 636b 5275 6e6e 6572 2829 0a20 2020  lackRunner().   
+0000edb0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0000edc0: 3d20 7275 6e6e 6572 2e69 6e76 6f6b 6528  = runner.invoke(
+0000edd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ede0: 2062 6c61 636b 2e6d 6169 6e2c 205b 222d   black.main, ["-
+0000edf0: 222c 2022 2d2d 6661 7374 225d 2c20 696e  ", "--fast"], in
+0000ee00: 7075 743d 4279 7465 7349 4f28 636f 6e74  put=BytesIO(cont
+0000ee10: 656e 7473 2e65 6e63 6f64 6528 2275 7466  ents.encode("utf
+0000ee20: 2d38 2229 290a 2020 2020 2020 2020 2020  -8")).          
+0000ee30: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000ee40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000ee50: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
+0000ee60: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
+0000ee70: 2020 6f75 7470 7574 203d 2072 6573 756c    output = resul
+0000ee80: 742e 7374 646f 7574 5f62 7974 6573 0a20  t.stdout_bytes. 
+0000ee90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000eea0: 6173 7365 7274 496e 286e 6c2e 656e 636f  assertIn(nl.enco
+0000eeb0: 6465 2822 7574 662d 3822 292c 206f 7574  de("utf-8"), out
+0000eec0: 7075 7429 0a20 2020 2020 2020 2020 2020  put).           
+0000eed0: 2069 6620 6e6c 203d 3d20 225c 6e22 3a0a   if nl == "\n":.
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eef0: 7365 6c66 2e61 7373 6572 744e 6f74 496e  self.assertNotIn
+0000ef00: 2862 225c 725c 6e22 2c20 6f75 7470 7574  (b"\r\n", output
+0000ef10: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000ef20: 6e6f 726d 616c 697a 655f 6c69 6e65 5f65  normalize_line_e
+0000ef30: 6e64 696e 6773 2873 656c 6629 202d 3e20  ndings(self) -> 
+0000ef40: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+0000ef50: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
+0000ef60: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
+0000ef70: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+0000ef80: 2020 7465 7374 5f66 696c 6520 3d20 5061    test_file = Pa
+0000ef90: 7468 2877 6f72 6b73 7061 6365 2920 2f20  th(workspace) / 
+0000efa0: 2274 6573 742e 7079 220a 2020 2020 2020  "test.py".      
+0000efb0: 2020 2020 2020 666f 7220 6461 7461 2c20        for data, 
+0000efc0: 6578 7065 6374 6564 2069 6e20 280a 2020  expected in (.  
+0000efd0: 2020 2020 2020 2020 2020 2020 2020 2862                (b
+0000efe0: 2263 5c72 5c6e 635c 6e20 222c 2062 2263  "c\r\nc\n ", b"c
+0000eff0: 5c72 5c6e 635c 725c 6e22 292c 0a20 2020  \r\nc\r\n"),.   
+0000f000: 2020 2020 2020 2020 2020 2020 2028 6222               (b"
+0000f010: 6c5c 6e6c 5c72 5c6e 2022 2c20 6222 6c5c  l\nl\r\n ", b"l\
+0000f020: 6e6c 5c6e 2229 2c0a 2020 2020 2020 2020  nl\n"),.        
+0000f030: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000f040: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
+0000f050: 2e77 7269 7465 5f62 7974 6573 2864 6174  .write_bytes(dat
+0000f060: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+0000f070: 2020 2066 6628 7465 7374 5f66 696c 652c     ff(test_file,
+0000f080: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
+0000f090: 6b2e 5772 6974 6542 6163 6b2e 5945 5329  k.WriteBack.YES)
+0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f0b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000f0c0: 6c28 7465 7374 5f66 696c 652e 7265 6164  l(test_file.read
+0000f0d0: 5f62 7974 6573 2829 2c20 6578 7065 6374  _bytes(), expect
+0000f0e0: 6564 290a 0a20 2020 2064 6566 2074 6573  ed)..    def tes
+0000f0f0: 745f 6173 7365 7274 5f65 7175 6976 616c  t_assert_equival
+0000f100: 656e 745f 6469 6666 6572 656e 745f 6173  ent_different_as
+0000f110: 7473 2873 656c 6629 202d 3e20 4e6f 6e65  ts(self) -> None
+0000f120: 3a0a 2020 2020 2020 2020 7769 7468 2073  :.        with s
+0000f130: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000f140: 2841 7373 6572 7469 6f6e 4572 726f 7229  (AssertionError)
+0000f150: 3a0a 2020 2020 2020 2020 2020 2020 626c  :.            bl
+0000f160: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
+0000f170: 616c 656e 7428 227b 7d22 2c20 224e 6f6e  alent("{}", "Non
+0000f180: 6522 290a 0a20 2020 2064 6566 2074 6573  e")..    def tes
+0000f190: 745f 726f 6f74 5f6c 6f67 6765 725f 6e6f  t_root_logger_no
+0000f1a0: 745f 7573 6564 5f64 6972 6563 746c 7928  t_used_directly(
+0000f1b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000f1c0: 2020 2020 2020 2064 6566 2066 6169 6c28         def fail(
+0000f1d0: 2a61 7267 733a 2041 6e79 2c20 2a2a 6b77  *args: Any, **kw
+0000f1e0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+0000f1f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000f200: 7365 6c66 2e66 6169 6c28 2252 6563 6f72  self.fail("Recor
+0000f210: 6420 6372 6561 7465 6420 7769 7468 2072  d created with r
+0000f220: 6f6f 7420 6c6f 6767 6572 2229 0a0a 2020  oot logger")..  
+0000f230: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+0000f240: 2e6d 756c 7469 706c 6528 0a20 2020 2020  .multiple(.     
+0000f250: 2020 2020 2020 206c 6f67 6769 6e67 2e72         logging.r
+0000f260: 6f6f 742c 0a20 2020 2020 2020 2020 2020  oot,.           
+0000f270: 2064 6562 7567 3d66 6169 6c2c 0a20 2020   debug=fail,.   
+0000f280: 2020 2020 2020 2020 2069 6e66 6f3d 6661           info=fa
+0000f290: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
+0000f2a0: 7761 726e 696e 673d 6661 696c 2c0a 2020  warning=fail,.  
+0000f2b0: 2020 2020 2020 2020 2020 6572 726f 723d            error=
+0000f2c0: 6661 696c 2c0a 2020 2020 2020 2020 2020  fail,.          
+0000f2d0: 2020 6372 6974 6963 616c 3d66 6169 6c2c    critical=fail,
+0000f2e0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0000f2f0: 3d66 6169 6c2c 0a20 2020 2020 2020 2029  =fail,.        )
+0000f300: 3a0a 2020 2020 2020 2020 2020 2020 6666  :.            ff
+0000f310: 2854 4849 535f 4449 5220 2f20 2275 7469  (THIS_DIR / "uti
+0000f320: 6c2e 7079 2229 0a0a 2020 2020 6465 6620  l.py")..    def 
+0000f330: 7465 7374 5f69 6e76 616c 6964 5f63 6f6e  test_invalid_con
+0000f340: 6669 675f 7265 7475 726e 5f63 6f64 6528  fig_return_code(
+0000f350: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000f360: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
+0000f370: 3d20 5061 7468 2862 6c61 636b 2e64 756d  = Path(black.dum
+0000f380: 705f 746f 5f66 696c 6528 2929 0a20 2020  p_to_file()).   
+0000f390: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000f3a0: 2020 2020 2020 746d 705f 636f 6e66 6967        tmp_config
+0000f3b0: 203d 2050 6174 6828 626c 6163 6b2e 6475   = Path(black.du
+0000f3c0: 6d70 5f74 6f5f 6669 6c65 2829 290a 2020  mp_to_file()).  
+0000f3d0: 2020 2020 2020 2020 2020 746d 705f 636f            tmp_co
+0000f3e0: 6e66 6967 2e75 6e6c 696e 6b28 290a 2020  nfig.unlink().  
+0000f3f0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+0000f400: 205b 222d 2d63 6f6e 6669 6722 2c20 7374   ["--config", st
+0000f410: 7228 746d 705f 636f 6e66 6967 292c 2073  r(tmp_config), s
+0000f420: 7472 2874 6d70 5f66 696c 6529 5d0a 2020  tr(tmp_file)].  
+0000f430: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000f440: 6e76 6f6b 6542 6c61 636b 2861 7267 732c  nvokeBlack(args,
+0000f450: 2065 7869 745f 636f 6465 3d32 2c20 6967   exit_code=2, ig
+0000f460: 6e6f 7265 5f63 6f6e 6669 673d 4661 6c73  nore_config=Fals
+0000f470: 6529 0a20 2020 2020 2020 2066 696e 616c  e).        final
+0000f480: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000f490: 746d 705f 6669 6c65 2e75 6e6c 696e 6b28  tmp_file.unlink(
+0000f4a0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000f4b0: 7061 7273 655f 7079 7072 6f6a 6563 745f  parse_pyproject_
+0000f4c0: 746f 6d6c 2873 656c 6629 202d 3e20 4e6f  toml(self) -> No
+0000f4d0: 6e65 3a0a 2020 2020 2020 2020 7465 7374  ne:.        test
+0000f4e0: 5f74 6f6d 6c5f 6669 6c65 203d 2054 4849  _toml_file = THI
+0000f4f0: 535f 4449 5220 2f20 2274 6573 742e 746f  S_DIR / "test.to
+0000f500: 6d6c 220a 2020 2020 2020 2020 636f 6e66  ml".        conf
+0000f510: 6967 203d 2062 6c61 636b 2e70 6172 7365  ig = black.parse
+0000f520: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c28  _pyproject_toml(
+0000f530: 7374 7228 7465 7374 5f74 6f6d 6c5f 6669  str(test_toml_fi
+0000f540: 6c65 2929 0a20 2020 2020 2020 2073 656c  le)).        sel
+0000f550: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+0000f560: 6e66 6967 5b22 7665 7262 6f73 6522 5d2c  nfig["verbose"],
+0000f570: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+0000f580: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+0000f590: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
+0000f5a0: 6f22 290a 2020 2020 2020 2020 7365 6c66  o").        self
+0000f5b0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+0000f5c0: 6669 675b 2264 6966 6622 5d2c 2022 7922  fig["diff"], "y"
+0000f5d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000f5e0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f5f0: 675b 2263 6f6c 6f72 225d 2c20 5472 7565  g["color"], True
+0000f600: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000f610: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f620: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
+0000f630: 2c20 3739 290a 2020 2020 2020 2020 7365  , 79).        se
+0000f640: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+0000f650: 6f6e 6669 675b 2274 6172 6765 745f 7665  onfig["target_ve
+0000f660: 7273 696f 6e22 5d2c 205b 2270 7933 3622  rsion"], ["py36"
+0000f670: 2c20 2270 7933 3722 2c20 2270 7933 3822  , "py37", "py38"
+0000f680: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+0000f690: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
+0000f6a0: 6967 5b22 7079 7468 6f6e 5f63 656c 6c5f  ig["python_cell_
+0000f6b0: 6d61 6769 6373 225d 2c20 5b22 6375 7374  magics"], ["cust
+0000f6c0: 6f6d 3122 2c20 2263 7573 746f 6d32 225d  om1", "custom2"]
+0000f6d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000f6e0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f6f0: 675b 2265 7863 6c75 6465 225d 2c20 7222  g["exclude"], r"
+0000f700: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
+0000f710: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000f720: 616c 2863 6f6e 6669 675b 2269 6e63 6c75  al(config["inclu
+0000f730: 6465 225d 2c20 7222 5c2e 7079 3f24 2229  de"], r"\.py?$")
+0000f740: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+0000f750: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
+0000f760: 6f6d 6c5f 7072 6f6a 6563 745f 6d65 7461  oml_project_meta
+0000f770: 6461 7461 2873 656c 6629 202d 3e20 4e6f  data(self) -> No
+0000f780: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
+0000f790: 7465 7374 5f74 6f6d 6c2c 2065 7870 6563  test_toml, expec
+0000f7a0: 7465 6420 696e 205b 0a20 2020 2020 2020  ted in [.       
+0000f7b0: 2020 2020 2028 226f 6e6c 795f 626c 6163       ("only_blac
+0000f7c0: 6b5f 7079 7072 6f6a 6563 742e 746f 6d6c  k_pyproject.toml
+0000f7d0: 222c 205b 2270 7933 3130 225d 292c 0a20  ", ["py310"]),. 
+0000f7e0: 2020 2020 2020 2020 2020 2028 226f 6e6c             ("onl
+0000f7f0: 795f 6d65 7461 6461 7461 5f70 7970 726f  y_metadata_pypro
+0000f800: 6a65 6374 2e74 6f6d 6c22 2c20 5b22 7079  ject.toml", ["py
+0000f810: 3337 222c 2022 7079 3338 222c 2022 7079  37", "py38", "py
+0000f820: 3339 222c 2022 7079 3331 3022 5d29 2c0a  39", "py310"]),.
+0000f830: 2020 2020 2020 2020 2020 2020 2822 6e65              ("ne
+0000f840: 6974 6865 725f 7079 7072 6f6a 6563 742e  ither_pyproject.
+0000f850: 746f 6d6c 222c 204e 6f6e 6529 2c0a 2020  toml", None),.  
+0000f860: 2020 2020 2020 2020 2020 2822 626f 7468            ("both
+0000f870: 5f70 7970 726f 6a65 6374 2e74 6f6d 6c22  _pyproject.toml"
+0000f880: 2c20 5b22 7079 3331 3022 5d29 2c0a 2020  , ["py310"]),.  
+0000f890: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
+0000f8a0: 2020 2020 2074 6573 745f 746f 6d6c 5f66       test_toml_f
+0000f8b0: 696c 6520 3d20 5448 4953 5f44 4952 202f  ile = THIS_DIR /
+0000f8c0: 2022 6461 7461 2220 2f20 2270 726f 6a65   "data" / "proje
+0000f8d0: 6374 5f6d 6574 6164 6174 6122 202f 2074  ct_metadata" / t
+0000f8e0: 6573 745f 746f 6d6c 0a20 2020 2020 2020  est_toml.       
+0000f8f0: 2020 2020 2063 6f6e 6669 6720 3d20 626c       config = bl
+0000f900: 6163 6b2e 7061 7273 655f 7079 7072 6f6a  ack.parse_pyproj
+0000f910: 6563 745f 746f 6d6c 2873 7472 2874 6573  ect_toml(str(tes
+0000f920: 745f 746f 6d6c 5f66 696c 6529 290a 2020  t_toml_file)).  
+0000f930: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000f940: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f950: 672e 6765 7428 2274 6172 6765 745f 7665  g.get("target_ve
+0000f960: 7273 696f 6e22 292c 2065 7870 6563 7465  rsion"), expecte
+0000f970: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+0000f980: 5f69 6e66 6572 5f74 6172 6765 745f 7665  _infer_target_ve
+0000f990: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
+0000f9a0: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
+0000f9b0: 2076 6572 7369 6f6e 2c20 6578 7065 6374   version, expect
+0000f9c0: 6564 2069 6e20 5b0a 2020 2020 2020 2020  ed in [.        
+0000f9d0: 2020 2020 2822 332e 3622 2c20 5b54 6172      ("3.6", [Tar
+0000f9e0: 6765 7456 6572 7369 6f6e 2e50 5933 365d  getVersion.PY36]
+0000f9f0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000fa00: 2233 2e31 312e 3072 6331 222c 205b 5461  "3.11.0rc1", [Ta
+0000fa10: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+0000fa20: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
+0000fa30: 2028 223e 3d33 2e31 3022 2c20 5b54 6172   (">=3.10", [Tar
+0000fa40: 6765 7456 6572 7369 6f6e 2e50 5933 3130  getVersion.PY310
+0000fa50: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
+0000fa60: 5059 3331 312c 2054 6172 6765 7456 6572  PY311, TargetVer
+0000fa70: 7369 6f6e 2e50 5933 3132 5d29 2c0a 2020  sion.PY312]),.  
+0000fa80: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+0000fa90: 2020 2020 2020 2020 2020 2020 223e 3d33              ">=3
+0000faa0: 2e31 302e 3622 2c0a 2020 2020 2020 2020  .10.6",.        
+0000fab0: 2020 2020 2020 2020 5b54 6172 6765 7456          [TargetV
+0000fac0: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
+0000fad0: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+0000fae0: 312c 2054 6172 6765 7456 6572 7369 6f6e  1, TargetVersion
+0000faf0: 2e50 5933 3132 5d2c 0a20 2020 2020 2020  .PY312],.       
+0000fb00: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0000fb10: 2020 2020 2822 3c33 2e36 222c 205b 5461      ("<3.6", [Ta
+0000fb20: 7267 6574 5665 7273 696f 6e2e 5059 3333  rgetVersion.PY33
+0000fb30: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
+0000fb40: 5059 3334 2c20 5461 7267 6574 5665 7273  PY34, TargetVers
+0000fb50: 696f 6e2e 5059 3335 5d29 2c0a 2020 2020  ion.PY35]),.    
+0000fb60: 2020 2020 2020 2020 2822 3e33 2e37 2c3c          (">3.7,<
+0000fb70: 332e 3130 222c 205b 5461 7267 6574 5665  3.10", [TargetVe
+0000fb80: 7273 696f 6e2e 5059 3338 2c20 5461 7267  rsion.PY38, Targ
+0000fb90: 6574 5665 7273 696f 6e2e 5059 3339 5d29  etVersion.PY39])
+0000fba0: 2c0a 2020 2020 2020 2020 2020 2020 280a  ,.            (.
+0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbc0: 223e 332e 372c 213d 332e 382c 213d 332e  ">3.7,!=3.8,!=3.
+0000fbd0: 3922 2c0a 2020 2020 2020 2020 2020 2020  9",.            
+0000fbe0: 2020 2020 5b54 6172 6765 7456 6572 7369      [TargetVersi
+0000fbf0: 6f6e 2e50 5933 3130 2c20 5461 7267 6574  on.PY310, Target
+0000fc00: 5665 7273 696f 6e2e 5059 3331 312c 2054  Version.PY311, T
+0000fc10: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+0000fc20: 3132 5d2c 0a20 2020 2020 2020 2020 2020  12],.           
+0000fc30: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0000fc40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000fc50: 2020 223e 2033 2e39 2e34 2c20 213d 2033    "> 3.9.4, != 3
+0000fc60: 2e31 302e 3322 2c0a 2020 2020 2020 2020  .10.3",.        
+0000fc70: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000fc80: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+0000fc90: 7267 6574 5665 7273 696f 6e2e 5059 3339  rgetVersion.PY39
+0000fca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fcb0: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+0000fcc0: 696f 6e2e 5059 3331 302c 0a20 2020 2020  ion.PY310,.     
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0000fce0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+0000fcf0: 3131 2c0a 2020 2020 2020 2020 2020 2020  11,.            
+0000fd00: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000fd10: 7273 696f 6e2e 5059 3331 322c 0a20 2020  rsion.PY312,.   
+0000fd20: 2020 2020 2020 2020 2020 2020 205d 2c0a               ],.
+0000fd30: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+0000fd40: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+0000fd50: 2020 2020 2020 2020 2020 2020 2022 213d               "!=
+0000fd60: 332e 332c 213d 332e 3422 2c0a 2020 2020  3.3,!=3.4",.    
+0000fd70: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+0000fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd90: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fda0: 5059 3335 2c0a 2020 2020 2020 2020 2020  PY35,.          
+0000fdb0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fdc0: 5665 7273 696f 6e2e 5059 3336 2c0a 2020  Version.PY36,.  
+0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fde0: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fdf0: 5059 3337 2c0a 2020 2020 2020 2020 2020  PY37,.          
+0000fe00: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fe10: 5665 7273 696f 6e2e 5059 3338 2c0a 2020  Version.PY38,.  
+0000fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe30: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fe40: 5059 3339 2c0a 2020 2020 2020 2020 2020  PY39,.          
+0000fe50: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fe60: 5665 7273 696f 6e2e 5059 3331 302c 0a20  Version.PY310,. 
+0000fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe80: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+0000fe90: 2e50 5933 3131 2c0a 2020 2020 2020 2020  .PY311,.        
+0000fea0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
+0000feb0: 6574 5665 7273 696f 6e2e 5059 3331 322c  etVersion.PY312,
+0000fec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fed0: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
+0000fee0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000fef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff00: 2022 3d3d 332e 2a22 2c0a 2020 2020 2020   "==3.*",.      
+0000ff10: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
+0000ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff30: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000ff40: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+0000ff50: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000ff60: 7273 696f 6e2e 5059 3334 2c0a 2020 2020  rsion.PY34,.    
+0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff80: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000ff90: 3335 2c0a 2020 2020 2020 2020 2020 2020  35,.            
+0000ffa0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000ffb0: 7273 696f 6e2e 5059 3336 2c0a 2020 2020  rsion.PY36,.    
+0000ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffd0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000ffe0: 3337 2c0a 2020 2020 2020 2020 2020 2020  37,.            
+0000fff0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010000: 7273 696f 6e2e 5059 3338 2c0a 2020 2020  rsion.PY38,.    
+00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010020: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010030: 3339 2c0a 2020 2020 2020 2020 2020 2020  39,.            
+00010040: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010050: 7273 696f 6e2e 5059 3331 302c 0a20 2020  rsion.PY310,.   
+00010060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010070: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
+00010080: 5933 3131 2c0a 2020 2020 2020 2020 2020  Y311,.          
+00010090: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+000100a0: 5665 7273 696f 6e2e 5059 3331 322c 0a20  Version.PY312,. 
+000100b0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+000100c0: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
+000100d0: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
+000100e0: 3d33 2e38 2e2a 222c 205b 5461 7267 6574  =3.8.*", [Target
+000100f0: 5665 7273 696f 6e2e 5059 3338 5d29 2c0a  Version.PY38]),.
+00010100: 2020 2020 2020 2020 2020 2020 284e 6f6e              (Non
+00010110: 652c 204e 6f6e 6529 2c0a 2020 2020 2020  e, None),.      
+00010120: 2020 2020 2020 2822 222c 204e 6f6e 6529        ("", None)
+00010130: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00010140: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
+00010150: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
+00010160: 3d69 6e76 616c 6964 222c 204e 6f6e 6529  =invalid", None)
+00010170: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00010180: 3e33 2e39 2c21 3d69 6e76 616c 6964 222c  >3.9,!=invalid",
+00010190: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
+000101a0: 2020 2020 2822 3322 2c20 4e6f 6e65 292c      ("3", None),
+000101b0: 0a20 2020 2020 2020 2020 2020 2028 2233  .            ("3
+000101c0: 2e32 222c 204e 6f6e 6529 2c0a 2020 2020  .2", None),.    
+000101d0: 2020 2020 2020 2020 2822 322e 372e 3138          ("2.7.18
+000101e0: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
+000101f0: 2020 2020 2020 2822 3d3d 322e 3722 2c20        ("==2.7", 
+00010200: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
+00010210: 2020 2028 223e 332e 3130 2c3c 332e 3131     (">3.10,<3.11
+00010220: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
+00010230: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
+00010240: 2074 6573 745f 746f 6d6c 203d 207b 2270   test_toml = {"p
+00010250: 726f 6a65 6374 223a 207b 2272 6571 7569  roject": {"requi
+00010260: 7265 732d 7079 7468 6f6e 223a 2076 6572  res-python": ver
+00010270: 7369 6f6e 7d7d 0a20 2020 2020 2020 2020  sion}}.         
+00010280: 2020 2072 6573 756c 7420 3d20 626c 6163     result = blac
+00010290: 6b2e 6669 6c65 732e 696e 6665 725f 7461  k.files.infer_ta
+000102a0: 7267 6574 5f76 6572 7369 6f6e 2874 6573  rget_version(tes
+000102b0: 745f 746f 6d6c 290a 2020 2020 2020 2020  t_toml).        
+000102c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000102d0: 7175 616c 2872 6573 756c 742c 2065 7870  qual(result, exp
+000102e0: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+000102f0: 7465 7374 5f72 6561 645f 7079 7072 6f6a  test_read_pyproj
+00010300: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
+00010310: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00010320: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
+00010330: 2054 4849 535f 4449 5220 2f20 2274 6573   THIS_DIR / "tes
+00010340: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+00010350: 6661 6b65 5f63 7478 203d 2046 616b 6543  fake_ctx = FakeC
+00010360: 6f6e 7465 7874 2829 0a20 2020 2020 2020  ontext().       
+00010370: 2062 6c61 636b 2e72 6561 645f 7079 7072   black.read_pypr
+00010380: 6f6a 6563 745f 746f 6d6c 2866 616b 655f  oject_toml(fake_
+00010390: 6374 782c 2046 616b 6550 6172 616d 6574  ctx, FakeParamet
+000103a0: 6572 2829 2c20 7374 7228 7465 7374 5f74  er(), str(test_t
+000103b0: 6f6d 6c5f 6669 6c65 2929 0a20 2020 2020  oml_file)).     
+000103c0: 2020 2063 6f6e 6669 6720 3d20 6661 6b65     config = fake
+000103d0: 5f63 7478 2e64 6566 6175 6c74 5f6d 6170  _ctx.default_map
+000103e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000103f0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010400: 5b22 7665 7262 6f73 6522 5d2c 2022 3122  ["verbose"], "1"
+00010410: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00010420: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010430: 675b 2263 6865 636b 225d 2c20 226e 6f22  g["check"], "no"
+00010440: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00010450: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010460: 675b 2264 6966 6622 5d2c 2022 7922 290a  g["diff"], "y").
+00010470: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010480: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+00010490: 2263 6f6c 6f72 225d 2c20 2254 7275 6522  "color"], "True"
+000104a0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000104b0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+000104c0: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
+000104d0: 2c20 2237 3922 290a 2020 2020 2020 2020  , "79").        
+000104e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000104f0: 2863 6f6e 6669 675b 2274 6172 6765 745f  (config["target_
+00010500: 7665 7273 696f 6e22 5d2c 205b 2270 7933  version"], ["py3
+00010510: 3622 2c20 2270 7933 3722 2c20 2270 7933  6", "py37", "py3
+00010520: 3822 5d29 0a20 2020 2020 2020 2073 656c  8"]).        sel
+00010530: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+00010540: 6e66 6967 5b22 6578 636c 7564 6522 5d2c  nfig["exclude"],
+00010550: 2072 225c 2e70 7969 3f24 2229 0a20 2020   r"\.pyi?$").   
+00010560: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00010570: 4571 7561 6c28 636f 6e66 6967 5b22 696e  Equal(config["in
+00010580: 636c 7564 6522 5d2c 2072 225c 2e70 793f  clude"], r"\.py?
+00010590: 2422 290a 0a20 2020 2064 6566 2074 6573  $")..    def tes
+000105a0: 745f 7265 6164 5f70 7970 726f 6a65 6374  t_read_pyproject
+000105b0: 5f74 6f6d 6c5f 6672 6f6d 5f73 7464 696e  _toml_from_stdin
+000105c0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000105d0: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
+000105e0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+000105f0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00010600: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00010610: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
+00010620: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00010630: 7372 635f 6469 7220 3d20 726f 6f74 202f  src_dir = root /
+00010640: 2022 7372 6322 0a20 2020 2020 2020 2020   "src".         
+00010650: 2020 2073 7263 5f64 6972 2e6d 6b64 6972     src_dir.mkdir
+00010660: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00010670: 7372 635f 7079 7072 6f6a 6563 7420 3d20  src_pyproject = 
+00010680: 7372 635f 6469 7220 2f20 2270 7970 726f  src_dir / "pypro
+00010690: 6a65 6374 2e74 6f6d 6c22 0a20 2020 2020  ject.toml".     
+000106a0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
+000106b0: 6a65 6374 2e74 6f75 6368 2829 0a0a 2020  ject.touch()..  
+000106c0: 2020 2020 2020 2020 2020 7465 7374 5f74            test_t
+000106d0: 6f6d 6c5f 636f 6e74 656e 7420 3d20 2854  oml_content = (T
+000106e0: 4849 535f 4449 5220 2f20 2274 6573 742e  HIS_DIR / "test.
+000106f0: 746f 6d6c 2229 2e72 6561 645f 7465 7874  toml").read_text
+00010700: 2865 6e63 6f64 696e 673d 2275 7466 2d38  (encoding="utf-8
+00010710: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00010720: 7263 5f70 7970 726f 6a65 6374 2e77 7269  rc_pyproject.wri
+00010730: 7465 5f74 6578 7428 7465 7374 5f74 6f6d  te_text(test_tom
+00010740: 6c5f 636f 6e74 656e 742c 2065 6e63 6f64  l_content, encod
+00010750: 696e 673d 2275 7466 2d38 2229 0a0a 2020  ing="utf-8")..  
+00010760: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
+00010770: 7468 6f6e 203d 2073 7263 5f64 6972 202f  thon = src_dir /
+00010780: 2022 666f 6f2e 7079 220a 2020 2020 2020   "foo.py".      
+00010790: 2020 2020 2020 7372 635f 7079 7468 6f6e        src_python
+000107a0: 2e74 6f75 6368 2829 0a0a 2020 2020 2020  .touch()..      
+000107b0: 2020 2020 2020 6661 6b65 5f63 7478 203d        fake_ctx =
+000107c0: 2046 616b 6543 6f6e 7465 7874 2829 0a20   FakeContext(). 
+000107d0: 2020 2020 2020 2020 2020 2066 616b 655f             fake_
+000107e0: 6374 782e 7061 7261 6d73 5b22 7372 6322  ctx.params["src"
+000107f0: 5d20 3d20 2822 2d22 2c29 0a20 2020 2020  ] = ("-",).     
+00010800: 2020 2020 2020 2066 616b 655f 6374 782e         fake_ctx.
+00010810: 7061 7261 6d73 5b22 7374 6469 6e5f 6669  params["stdin_fi
+00010820: 6c65 6e61 6d65 225d 203d 2073 7472 2873  lename"] = str(s
+00010830: 7263 5f70 7974 686f 6e29 0a0a 2020 2020  rc_python)..    
+00010840: 2020 2020 2020 2020 7769 7468 2063 6861          with cha
+00010850: 6e67 655f 6469 7265 6374 6f72 7928 726f  nge_directory(ro
+00010860: 6f74 293a 0a20 2020 2020 2020 2020 2020  ot):.           
+00010870: 2020 2020 2062 6c61 636b 2e72 6561 645f       black.read_
+00010880: 7079 7072 6f6a 6563 745f 746f 6d6c 2866  pyproject_toml(f
+00010890: 616b 655f 6374 782c 2046 616b 6550 6172  ake_ctx, FakePar
+000108a0: 616d 6574 6572 2829 2c20 4e6f 6e65 290a  ameter(), None).
+000108b0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000108c0: 6669 6720 3d20 6661 6b65 5f63 7478 2e64  fig = fake_ctx.d
+000108d0: 6566 6175 6c74 5f6d 6170 0a20 2020 2020  efault_map.     
+000108e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000108f0: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+00010900: 7665 7262 6f73 6522 5d2c 2022 3122 290a  verbose"], "1").
+00010910: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010920: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+00010930: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
+00010940: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
+00010950: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010960: 2863 6f6e 6669 675b 2264 6966 6622 5d2c  (config["diff"],
+00010970: 2022 7922 290a 2020 2020 2020 2020 2020   "y").          
+00010980: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010990: 616c 2863 6f6e 6669 675b 2263 6f6c 6f72  al(config["color
+000109a0: 225d 2c20 2254 7275 6522 290a 2020 2020  "], "True").    
+000109b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000109c0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+000109d0: 226c 696e 655f 6c65 6e67 7468 225d 2c20  "line_length"], 
+000109e0: 2237 3922 290a 2020 2020 2020 2020 2020  "79").          
+000109f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010a00: 616c 2863 6f6e 6669 675b 2274 6172 6765  al(config["targe
+00010a10: 745f 7665 7273 696f 6e22 5d2c 205b 2270  t_version"], ["p
+00010a20: 7933 3622 2c20 2270 7933 3722 2c20 2270  y36", "py37", "p
+00010a30: 7933 3822 5d29 0a20 2020 2020 2020 2020  y38"]).         
+00010a40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00010a50: 7561 6c28 636f 6e66 6967 5b22 6578 636c  ual(config["excl
+00010a60: 7564 6522 5d2c 2072 225c 2e70 7969 3f24  ude"], r"\.pyi?$
+00010a70: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00010a80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00010a90: 636f 6e66 6967 5b22 696e 636c 7564 6522  config["include"
+00010aa0: 5d2c 2072 225c 2e70 793f 2422 290a 0a20  ], r"\.py?$").. 
+00010ab0: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00010ac0: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+00010ad0: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+00010ae0: 7465 7374 5f66 696e 645f 7072 6f6a 6563  test_find_projec
+00010af0: 745f 726f 6f74 2873 656c 6629 202d 3e20  t_root(self) -> 
+00010b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+00010b10: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
+00010b20: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
+00010b30: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+00010b40: 2020 726f 6f74 203d 2050 6174 6828 776f    root = Path(wo
+00010b50: 726b 7370 6163 6529 0a20 2020 2020 2020  rkspace).       
+00010b60: 2020 2020 2074 6573 745f 6469 7220 3d20       test_dir = 
+00010b70: 726f 6f74 202f 2022 7465 7374 220a 2020  root / "test".  
+00010b80: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
+00010b90: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
+00010ba0: 2020 2020 2020 2020 7372 635f 6469 7220          src_dir 
+00010bb0: 3d20 726f 6f74 202f 2022 7372 6322 0a20  = root / "src". 
+00010bc0: 2020 2020 2020 2020 2020 2073 7263 5f64             src_d
+00010bd0: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
+00010be0: 2020 2020 2020 2020 726f 6f74 5f70 7970          root_pyp
+00010bf0: 726f 6a65 6374 203d 2072 6f6f 7420 2f20  roject = root / 
+00010c00: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
+00010c10: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
+00010c20: 745f 7079 7072 6f6a 6563 742e 746f 7563  t_pyproject.touc
+00010c30: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
+00010c40: 7372 635f 7079 7072 6f6a 6563 7420 3d20  src_pyproject = 
+00010c50: 7372 635f 6469 7220 2f20 2270 7970 726f  src_dir / "pypro
+00010c60: 6a65 6374 2e74 6f6d 6c22 0a20 2020 2020  ject.toml".     
+00010c70: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
+00010c80: 6a65 6374 2e74 6f75 6368 2829 0a20 2020  ject.touch().   
+00010c90: 2020 2020 2020 2020 2073 7263 5f70 7974           src_pyt
+00010ca0: 686f 6e20 3d20 7372 635f 6469 7220 2f20  hon = src_dir / 
+00010cb0: 2266 6f6f 2e70 7922 0a20 2020 2020 2020  "foo.py".       
+00010cc0: 2020 2020 2073 7263 5f70 7974 686f 6e2e       src_python.
+00010cd0: 746f 7563 6828 290a 0a20 2020 2020 2020  touch()..       
+00010ce0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00010cf0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00010d00: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
+00010d10: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
+00010d20: 7372 635f 6469 722c 2074 6573 745f 6469  src_dir, test_di
+00010d30: 7229 292c 0a20 2020 2020 2020 2020 2020  r)),.           
+00010d40: 2020 2020 2028 726f 6f74 2e72 6573 6f6c       (root.resol
+00010d50: 7665 2829 2c20 2270 7970 726f 6a65 6374  ve(), "pyproject
+00010d60: 2e74 6f6d 6c22 292c 0a20 2020 2020 2020  .toml"),.       
+00010d70: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00010d80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00010d90: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00010da0: 2020 2020 2062 6c61 636b 2e66 696e 645f       black.find_
+00010db0: 7072 6f6a 6563 745f 726f 6f74 2828 7372  project_root((sr
+00010dc0: 635f 6469 722c 2929 2c0a 2020 2020 2020  c_dir,)),.      
+00010dd0: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
+00010de0: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
+00010df0: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
+00010e00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00010e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010e20: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00010e30: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
+00010e40: 636b 2e66 696e 645f 7072 6f6a 6563 745f  ck.find_project_
+00010e50: 726f 6f74 2828 7372 635f 7079 7468 6f6e  root((src_python
+00010e60: 2c29 292c 0a20 2020 2020 2020 2020 2020  ,)),.           
+00010e70: 2020 2020 2028 7372 635f 6469 722e 7265       (src_dir.re
+00010e80: 736f 6c76 6528 292c 2022 7079 7072 6f6a  solve(), "pyproj
+00010e90: 6563 742e 746f 6d6c 2229 2c0a 2020 2020  ect.toml"),.    
+00010ea0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00010eb0: 2020 2020 2020 2077 6974 6820 6368 616e         with chan
+00010ec0: 6765 5f64 6972 6563 746f 7279 2874 6573  ge_directory(tes
+00010ed0: 745f 6469 7229 3a0a 2020 2020 2020 2020  t_dir):.        
+00010ee0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010ef0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00010f00: 2020 2020 2020 2020 2020 2020 2020 626c                bl
+00010f10: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
+00010f20: 5f72 6f6f 7428 2822 2d22 2c29 2c20 7374  _root(("-",), st
+00010f30: 6469 6e5f 6669 6c65 6e61 6d65 3d22 2e2e  din_filename="..
+00010f40: 2f73 7263 2f61 2e70 7922 292c 0a20 2020  /src/a.py"),.   
+00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f60: 2028 7372 635f 6469 722e 7265 736f 6c76   (src_dir.resolv
+00010f70: 6528 292c 2022 7079 7072 6f6a 6563 742e  e(), "pyproject.
+00010f80: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
+00010f90: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+00010fa0: 7061 7463 6828 0a20 2020 2020 2020 2022  patch(.        "
+00010fb0: 626c 6163 6b2e 6669 6c65 732e 6669 6e64  black.files.find
+00010fc0: 5f75 7365 725f 7079 7072 6f6a 6563 745f  _user_pyproject_
+00010fd0: 746f 6d6c 222c 0a20 2020 2029 0a20 2020  toml",.    ).   
+00010fe0: 2064 6566 2074 6573 745f 6669 6e64 5f70   def test_find_p
+00010ff0: 7970 726f 6a65 6374 5f74 6f6d 6c28 7365  yproject_toml(se
+00011000: 6c66 2c20 6669 6e64 5f75 7365 725f 7079  lf, find_user_py
+00011010: 7072 6f6a 6563 745f 746f 6d6c 3a20 4d61  project_toml: Ma
+00011020: 6769 634d 6f63 6b29 202d 3e20 4e6f 6e65  gicMock) -> None
+00011030: 3a0a 2020 2020 2020 2020 6669 6e64 5f75  :.        find_u
+00011040: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
+00011050: 6d6c 2e73 6964 655f 6566 6665 6374 203d  ml.side_effect =
+00011060: 2052 756e 7469 6d65 4572 726f 7228 290a   RuntimeError().
+00011070: 0a20 2020 2020 2020 2077 6974 6820 7265  .        with re
+00011080: 6469 7265 6374 5f73 7464 6572 7228 696f  direct_stderr(io
+00011090: 2e53 7472 696e 6749 4f28 2929 2061 7320  .StringIO()) as 
+000110a0: 7374 6465 7272 3a0a 2020 2020 2020 2020  stderr:.        
+000110b0: 2020 2020 7265 7375 6c74 203d 2062 6c61      result = bla
+000110c0: 636b 2e66 696c 6573 2e66 696e 645f 7079  ck.files.find_py
+000110d0: 7072 6f6a 6563 745f 746f 6d6c 280a 2020  project_toml(.  
+000110e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000110f0: 7468 5f73 6561 7263 685f 7374 6172 743d  th_search_start=
+00011100: 2873 7472 2850 6174 682e 6377 6428 292e  (str(Path.cwd().
+00011110: 726f 6f74 292c 290a 2020 2020 2020 2020  root),).        
+00011120: 2020 2020 290a 0a20 2020 2020 2020 2061      )..        a
+00011130: 7373 6572 7420 7265 7375 6c74 2069 7320  ssert result is 
+00011140: 4e6f 6e65 0a20 2020 2020 2020 2065 7272  None.        err
+00011150: 203d 2073 7464 6572 722e 6765 7476 616c   = stderr.getval
+00011160: 7565 2829 0a20 2020 2020 2020 2061 7373  ue().        ass
+00011170: 6572 7420 2249 676e 6f72 696e 6720 7573  ert "Ignoring us
+00011180: 6572 2063 6f6e 6669 6775 7261 7469 6f6e  er configuration
+00011190: 2220 696e 2065 7272 0a0a 2020 2020 4070  " in err..    @p
+000111a0: 6174 6368 280a 2020 2020 2020 2020 2262  atch(.        "b
+000111b0: 6c61 636b 2e66 696c 6573 2e66 696e 645f  lack.files.find_
+000111c0: 7573 6572 5f70 7970 726f 6a65 6374 5f74  user_pyproject_t
+000111d0: 6f6d 6c22 2c0a 2020 2020 2020 2020 626c  oml",.        bl
+000111e0: 6163 6b2e 6669 6c65 732e 6669 6e64 5f75  ack.files.find_u
+000111f0: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
+00011200: 6d6c 2e5f 5f77 7261 7070 6564 5f5f 2c0a  ml.__wrapped__,.
+00011210: 2020 2020 290a 2020 2020 6465 6620 7465      ).    def te
+00011220: 7374 5f66 696e 645f 7573 6572 5f70 7970  st_find_user_pyp
+00011230: 726f 6a65 6374 5f74 6f6d 6c5f 6c69 6e75  roject_toml_linu
+00011240: 7828 7365 6c66 2920 2d3e 204e 6f6e 653a  x(self) -> None:
+00011250: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
+00011260: 656d 2829 203d 3d20 2257 696e 646f 7773  em() == "Windows
+00011270: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+00011280: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+00011290: 2054 6573 7420 6966 2058 4447 5f43 4f4e   Test if XDG_CON
+000112a0: 4649 475f 484f 4d45 2069 7320 6368 6563  FIG_HOME is chec
+000112b0: 6b65 640a 2020 2020 2020 2020 7769 7468  ked.        with
+000112c0: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+000112d0: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
+000112e0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000112f0: 746d 705f 7573 6572 5f63 6f6e 6669 6720  tmp_user_config 
+00011300: 3d20 5061 7468 2877 6f72 6b73 7061 6365  = Path(workspace
+00011310: 2920 2f20 2262 6c61 636b 220a 2020 2020  ) / "black".    
+00011320: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+00011330: 6368 2e64 6963 7428 226f 732e 656e 7669  ch.dict("os.envi
+00011340: 726f 6e22 2c20 7b22 5844 475f 434f 4e46  ron", {"XDG_CONF
+00011350: 4947 5f48 4f4d 4522 3a20 776f 726b 7370  IG_HOME": worksp
+00011360: 6163 657d 293a 0a20 2020 2020 2020 2020  ace}):.         
+00011370: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00011380: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00011390: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
+000113a0: 636b 2e66 696c 6573 2e66 696e 645f 7573  ck.files.find_us
+000113b0: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+000113c0: 6c28 292c 2074 6d70 5f75 7365 725f 636f  l(), tmp_user_co
+000113d0: 6e66 6967 2e72 6573 6f6c 7665 2829 0a20  nfig.resolve(). 
+000113e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000113f0: 0a0a 2020 2020 2020 2020 2320 5465 7374  ..        # Test
+00011400: 2066 616c 6c62 6163 6b20 666f 7220 5844   fallback for XD
+00011410: 475f 434f 4e46 4947 5f48 4f4d 450a 2020  G_CONFIG_HOME.  
+00011420: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+00011430: 2e64 6963 7428 226f 732e 656e 7669 726f  .dict("os.enviro
+00011440: 6e22 293a 0a20 2020 2020 2020 2020 2020  n"):.           
+00011450: 206f 732e 656e 7669 726f 6e2e 706f 7028   os.environ.pop(
+00011460: 2258 4447 5f43 4f4e 4649 475f 484f 4d45  "XDG_CONFIG_HOME
+00011470: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00011480: 2020 2020 2066 616c 6c62 6163 6b5f 7573       fallback_us
+00011490: 6572 5f63 6f6e 6669 6720 3d20 5061 7468  er_config = Path
+000114a0: 2822 7e2f 2e63 6f6e 6669 6722 292e 6578  ("~/.config").ex
+000114b0: 7061 6e64 7573 6572 2829 202f 2022 626c  panduser() / "bl
+000114c0: 6163 6b22 0a20 2020 2020 2020 2020 2020  ack".           
+000114d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000114e0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+000114f0: 2020 2062 6c61 636b 2e66 696c 6573 2e66     black.files.f
+00011500: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
+00011510: 6374 5f74 6f6d 6c28 292c 2066 616c 6c62  ct_toml(), fallb
+00011520: 6163 6b5f 7573 6572 5f63 6f6e 6669 672e  ack_user_config.
+00011530: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+00011540: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00011550: 2074 6573 745f 6669 6e64 5f75 7365 725f   test_find_user_
+00011560: 7079 7072 6f6a 6563 745f 746f 6d6c 5f77  pyproject_toml_w
+00011570: 696e 646f 7773 2873 656c 6629 202d 3e20  indows(self) -> 
+00011580: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+00011590: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
+000115a0: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
+000115b0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+000115c0: 2020 2020 7573 6572 5f63 6f6e 6669 675f      user_config_
+000115d0: 7061 7468 203d 2050 6174 682e 686f 6d65  path = Path.home
+000115e0: 2829 202f 2022 2e62 6c61 636b 220a 2020  () / ".black".  
+000115f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011600: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00011610: 2020 2020 626c 6163 6b2e 6669 6c65 732e      black.files.
+00011620: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
+00011630: 6563 745f 746f 6d6c 2829 2c20 7573 6572  ect_toml(), user
+00011640: 5f63 6f6e 6669 675f 7061 7468 2e72 6573  _config_path.res
+00011650: 6f6c 7665 2829 0a20 2020 2020 2020 2029  olve().        )
+00011660: 0a0a 2020 2020 6465 6620 7465 7374 5f62  ..    def test_b
+00011670: 706f 5f33 3336 3630 5f77 6f72 6b61 726f  po_33660_workaro
+00011680: 756e 6428 7365 6c66 2920 2d3e 204e 6f6e  und(self) -> Non
+00011690: 653a 0a20 2020 2020 2020 2069 6620 7379  e:.        if sy
+000116a0: 7374 656d 2829 203d 3d20 2257 696e 646f  stem() == "Windo
+000116b0: 7773 223a 0a20 2020 2020 2020 2020 2020  ws":.           
+000116c0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+000116d0: 2023 2068 7474 7073 3a2f 2f62 7567 732e   # https://bugs.
+000116e0: 7079 7468 6f6e 2e6f 7267 2f69 7373 7565  python.org/issue
+000116f0: 3333 3636 300a 2020 2020 2020 2020 726f  33660.        ro
+00011700: 6f74 203d 2050 6174 6828 222f 2229 0a20  ot = Path("/"). 
+00011710: 2020 2020 2020 2077 6974 6820 6368 616e         with chan
+00011720: 6765 5f64 6972 6563 746f 7279 2872 6f6f  ge_directory(roo
+00011730: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00011740: 7061 7468 203d 2050 6174 6828 2277 6f72  path = Path("wor
+00011750: 6b73 7061 6365 2229 202f 2022 7072 6f6a  kspace") / "proj
+00011760: 6563 7422 0a20 2020 2020 2020 2020 2020  ect".           
+00011770: 2072 6570 6f72 7420 3d20 626c 6163 6b2e   report = black.
+00011780: 5265 706f 7274 2876 6572 626f 7365 3d54  Report(verbose=T
+00011790: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000117a0: 206e 6f72 6d61 6c69 7a65 645f 7061 7468   normalized_path
+000117b0: 203d 2062 6c61 636b 2e6e 6f72 6d61 6c69   = black.normali
+000117c0: 7a65 5f70 6174 685f 6d61 7962 655f 6967  ze_path_maybe_ig
+000117d0: 6e6f 7265 2870 6174 682c 2072 6f6f 742c  nore(path, root,
+000117e0: 2072 6570 6f72 7429 0a20 2020 2020 2020   report).       
+000117f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011800: 4571 7561 6c28 6e6f 726d 616c 697a 6564  Equal(normalized
+00011810: 5f70 6174 682c 2022 776f 726b 7370 6163  _path, "workspac
+00011820: 652f 7072 6f6a 6563 7422 290a 0a20 2020  e/project")..   
+00011830: 2064 6566 2074 6573 745f 6e6f 726d 616c   def test_normal
+00011840: 697a 655f 7061 7468 5f69 676e 6f72 655f  ize_path_ignore_
+00011850: 7769 6e64 6f77 735f 6a75 6e63 7469 6f6e  windows_junction
+00011860: 735f 6f75 7473 6964 655f 6f66 5f72 6f6f  s_outside_of_roo
+00011870: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
+00011880: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
+00011890: 656d 2829 2021 3d20 2257 696e 646f 7773  em() != "Windows
+000118a0: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+000118b0: 6574 7572 6e0a 0a20 2020 2020 2020 2077  eturn..        w
+000118c0: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+000118d0: 6563 746f 7279 2829 2061 7320 776f 726b  ectory() as work
+000118e0: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+000118f0: 2020 2072 6f6f 7420 3d20 5061 7468 2877     root = Path(w
+00011900: 6f72 6b73 7061 6365 290a 2020 2020 2020  orkspace).      
+00011910: 2020 2020 2020 6a75 6e63 7469 6f6e 5f64        junction_d
+00011920: 6972 203d 2072 6f6f 7420 2f20 226a 756e  ir = root / "jun
+00011930: 6374 696f 6e22 0a20 2020 2020 2020 2020  ction".         
+00011940: 2020 206a 756e 6374 696f 6e5f 7461 7267     junction_targ
+00011950: 6574 5f6f 7574 7369 6465 5f6f 665f 726f  et_outside_of_ro
+00011960: 6f74 203d 2072 6f6f 7420 2f20 222e 2e22  ot = root / ".."
+00011970: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00011980: 7379 7374 656d 2866 226d 6b6c 696e 6b20  system(f"mklink 
+00011990: 2f4a 207b 6a75 6e63 7469 6f6e 5f64 6972  /J {junction_dir
+000119a0: 7d20 7b6a 756e 6374 696f 6e5f 7461 7267  } {junction_targ
+000119b0: 6574 5f6f 7574 7369 6465 5f6f 665f 726f  et_outside_of_ro
+000119c0: 6f74 7d22 290a 0a20 2020 2020 2020 2020  ot}")..         
+000119d0: 2020 2072 6570 6f72 7420 3d20 626c 6163     report = blac
+000119e0: 6b2e 5265 706f 7274 2876 6572 626f 7365  k.Report(verbose
+000119f0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00011a00: 2020 206e 6f72 6d61 6c69 7a65 645f 7061     normalized_pa
+00011a10: 7468 203d 2062 6c61 636b 2e6e 6f72 6d61  th = black.norma
+00011a20: 6c69 7a65 5f70 6174 685f 6d61 7962 655f  lize_path_maybe_
+00011a30: 6967 6e6f 7265 280a 2020 2020 2020 2020  ignore(.        
+00011a40: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
+00011a50: 5f64 6972 2c20 726f 6f74 2c20 7265 706f  _dir, root, repo
+00011a60: 7274 0a20 2020 2020 2020 2020 2020 2029  rt.            )
+00011a70: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+00011a80: 616e 7561 6c6c 7920 6465 6c65 7465 2066  anually delete f
+00011a90: 6f72 2050 7974 686f 6e20 3c20 332e 380a  or Python < 3.8.
+00011aa0: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
+00011ab0: 7973 7465 6d28 6622 726d 6469 7220 7b6a  ystem(f"rmdir {j
+00011ac0: 756e 6374 696f 6e5f 6469 727d 2229 0a0a  unction_dir}")..
+00011ad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011ae0: 2e61 7373 6572 7445 7175 616c 286e 6f72  .assertEqual(nor
+00011af0: 6d61 6c69 7a65 645f 7061 7468 2c20 4e6f  malized_path, No
+00011b00: 6e65 290a 0a20 2020 2064 6566 2074 6573  ne)..    def tes
+00011b10: 745f 6e65 776c 696e 655f 636f 6d6d 656e  t_newline_commen
+00011b20: 745f 696e 7465 7261 6374 696f 6e28 7365  t_interaction(se
+00011b30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00011b40: 2020 2020 2073 6f75 7263 6520 3d20 2263       source = "c
+00011b50: 6c61 7373 2041 3a5c 5c5c 725c 6e23 2074  lass A:\\\r\n# t
+00011b60: 7970 653a 2069 676e 6f72 655c 6e20 7061  ype: ignore\n pa
+00011b70: 7373 5c6e 220a 2020 2020 2020 2020 6f75  ss\n".        ou
+00011b80: 7470 7574 203d 2062 6c61 636b 2e66 6f72  tput = black.for
+00011b90: 6d61 745f 7374 7228 736f 7572 6365 2c20  mat_str(source, 
+00011ba0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+00011bb0: 4529 0a20 2020 2020 2020 2062 6c61 636b  E).        black
+00011bc0: 2e61 7373 6572 745f 7374 6162 6c65 2873  .assert_stable(s
+00011bd0: 6f75 7263 652c 206f 7574 7075 742c 206d  ource, output, m
+00011be0: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+00011bf0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00011c00: 6270 6f5f 3231 3432 5f77 6f72 6b61 726f  bpo_2142_workaro
+00011c10: 756e 6428 7365 6c66 2920 2d3e 204e 6f6e  und(self) -> Non
+00011c20: 653a 0a20 2020 2020 2020 2023 2068 7474  e:.        # htt
+00011c30: 7073 3a2f 2f62 7567 732e 7079 7468 6f6e  ps://bugs.python
+00011c40: 2e6f 7267 2f69 7373 7565 3231 3432 0a0a  .org/issue2142..
+00011c50: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+00011c60: 5f20 3d20 7265 6164 5f64 6174 6128 226d  _ = read_data("m
+00011c70: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
+00011c80: 6d69 7373 696e 675f 6669 6e61 6c5f 6e65  missing_final_ne
+00011c90: 776c 696e 6522 290a 2020 2020 2020 2020  wline").        
+00011ca0: 2320 7265 6164 5f64 6174 6120 6164 6473  # read_data adds
+00011cb0: 2061 2074 7261 696c 696e 6720 6e65 776c   a trailing newl
+00011cc0: 696e 650a 2020 2020 2020 2020 736f 7572  ine.        sour
+00011cd0: 6365 203d 2073 6f75 7263 652e 7273 7472  ce = source.rstr
+00011ce0: 6970 2829 0a20 2020 2020 2020 2065 7870  ip().        exp
+00011cf0: 6563 7465 642c 205f 203d 2072 6561 645f  ected, _ = read_
+00011d00: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+00011d10: 6f75 7322 2c20 226d 6973 7369 6e67 5f66  ous", "missing_f
+00011d20: 696e 616c 5f6e 6577 6c69 6e65 2e64 6966  inal_newline.dif
+00011d30: 6622 290a 2020 2020 2020 2020 746d 705f  f").        tmp_
+00011d40: 6669 6c65 203d 2050 6174 6828 626c 6163  file = Path(blac
+00011d50: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 2873  k.dump_to_file(s
+00011d60: 6f75 7263 652c 2065 6e73 7572 655f 6669  ource, ensure_fi
+00011d70: 6e61 6c5f 6e65 776c 696e 653d 4661 6c73  nal_newline=Fals
+00011d80: 6529 290a 2020 2020 2020 2020 6469 6666  e)).        diff
+00011d90: 5f68 6561 6465 7220 3d20 7265 2e63 6f6d  _header = re.com
+00011da0: 7069 6c65 280a 2020 2020 2020 2020 2020  pile(.          
+00011db0: 2020 7266 227b 7265 2e65 7363 6170 6528    rf"{re.escape(
+00011dc0: 7374 7228 746d 705f 6669 6c65 2929 7d5c  str(tmp_file))}\
+00011dd0: 745c 645c 645c 645c 642d 5c64 5c64 2d5c  t\d\d\d\d-\d\d-\
+00011de0: 645c 6420 220a 2020 2020 2020 2020 2020  d\d ".          
+00011df0: 2020 7222 5c64 5c64 3a5c 645c 643a 5c64    r"\d\d:\d\d:\d
+00011e00: 5c64 5c2e 5c64 5c64 5c64 5c64 5c64 5c64  \d\.\d\d\d\d\d\d
+00011e10: 5c2b 5c64 5c64 3a5c 645c 6422 0a20 2020  \+\d\d:\d\d".   
+00011e20: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
+00011e30: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00011e40: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
+00011e50: 6e6e 6572 2829 2e69 6e76 6f6b 6528 626c  nner().invoke(bl
+00011e60: 6163 6b2e 6d61 696e 2c20 5b22 2d2d 6469  ack.main, ["--di
+00011e70: 6666 222c 2073 7472 2874 6d70 5f66 696c  ff", str(tmp_fil
+00011e80: 6529 5d29 0a20 2020 2020 2020 2020 2020  e)]).           
+00011e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00011ea0: 6c28 7265 7375 6c74 2e65 7869 745f 636f  l(result.exit_co
+00011eb0: 6465 2c20 3029 0a20 2020 2020 2020 2066  de, 0).        f
+00011ec0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
+00011ed0: 2020 2020 6f73 2e75 6e6c 696e 6b28 746d      os.unlink(tm
+00011ee0: 705f 6669 6c65 290a 2020 2020 2020 2020  p_file).        
+00011ef0: 6163 7475 616c 203d 2072 6573 756c 742e  actual = result.
+00011f00: 6f75 7470 7574 0a20 2020 2020 2020 2061  output.        a
+00011f10: 6374 7561 6c20 3d20 6469 6666 5f68 6561  ctual = diff_hea
+00011f20: 6465 722e 7375 6228 4445 5445 524d 494e  der.sub(DETERMIN
+00011f30: 4953 5449 435f 4845 4144 4552 2c20 6163  ISTIC_HEADER, ac
+00011f40: 7475 616c 290a 2020 2020 2020 2020 7365  tual).        se
+00011f50: 6c66 2e61 7373 6572 7445 7175 616c 2861  lf.assertEqual(a
+00011f60: 6374 7561 6c2c 2065 7870 6563 7465 6429  ctual, expected)
+00011f70: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00011f80: 686f 640a 2020 2020 6465 6620 636f 6d70  hod.    def comp
+00011f90: 6172 655f 7265 7375 6c74 7328 0a20 2020  are_results(.   
+00011fa0: 2020 2020 2072 6573 756c 743a 2063 6c69       result: cli
+00011fb0: 636b 2e74 6573 7469 6e67 2e52 6573 756c  ck.testing.Resul
+00011fc0: 742c 2065 7870 6563 7465 645f 7661 6c75  t, expected_valu
+00011fd0: 653a 2073 7472 2c20 6578 7065 6374 6564  e: str, expected
+00011fe0: 5f65 7869 745f 636f 6465 3a20 696e 740a  _exit_code: int.
+00011ff0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+00012000: 2020 2020 2020 2022 2222 4865 6c70 6572         """Helper
+00012010: 206d 6574 686f 6420 746f 2074 6573 7420   method to test 
+00012020: 7468 6520 7661 6c75 6520 616e 6420 6578  the value and ex
+00012030: 6974 2063 6f64 6520 6f66 2061 2063 6c69  it code of a cli
+00012040: 636b 2052 6573 756c 742e 2222 220a 2020  ck Result.""".  
+00012050: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+00012060: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00012070: 742e 6f75 7470 7574 203d 3d20 6578 7065  t.output == expe
+00012080: 6374 6564 5f76 616c 7565 0a20 2020 2020  cted_value.     
+00012090: 2020 2029 2c20 2254 6865 206f 7574 7075     ), "The outpu
+000120a0: 7420 6469 6420 6e6f 7420 6d61 7463 6820  t did not match 
+000120b0: 7468 6520 6578 7065 6374 6564 2076 616c  the expected val
+000120c0: 7565 2e22 0a20 2020 2020 2020 2061 7373  ue.".        ass
+000120d0: 6572 7420 7265 7375 6c74 2e65 7869 745f  ert result.exit_
+000120e0: 636f 6465 203d 3d20 6578 7065 6374 6564  code == expected
+000120f0: 5f65 7869 745f 636f 6465 2c20 2254 6865  _exit_code, "The
+00012100: 2065 7869 7420 636f 6465 2069 7320 696e   exit code is in
+00012110: 636f 7272 6563 742e 220a 0a20 2020 2064  correct."..    d
+00012120: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
+00012130: 696f 6e28 7365 6c66 2920 2d3e 204e 6f6e  ion(self) -> Non
+00012140: 653a 0a20 2020 2020 2020 2022 2222 5465  e:.        """Te
+00012150: 7374 2074 6865 2063 6f64 6520 6f70 7469  st the code opti
+00012160: 6f6e 2077 6974 6820 6e6f 2063 6861 6e67  on with no chang
+00012170: 6573 2e22 2222 0a20 2020 2020 2020 2063  es.""".        c
+00012180: 6f64 6520 3d20 2770 7269 6e74 2822 4865  ode = 'print("He
+00012190: 6c6c 6f20 776f 726c 6422 295c 6e27 0a20  llo world")\n'. 
+000121a0: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
+000121b0: 2d2d 636f 6465 222c 2063 6f64 655d 0a20  --code", code]. 
+000121c0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000121d0: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+000121e0: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
+000121f0: 7267 7329 0a0a 2020 2020 2020 2020 7365  rgs)..        se
+00012200: 6c66 2e63 6f6d 7061 7265 5f72 6573 756c  lf.compare_resul
+00012210: 7473 2872 6573 756c 742c 2063 6f64 652c  ts(result, code,
+00012220: 2030 290a 0a20 2020 2064 6566 2074 6573   0)..    def tes
+00012230: 745f 636f 6465 5f6f 7074 696f 6e5f 6368  t_code_option_ch
+00012240: 616e 6765 6428 7365 6c66 2920 2d3e 204e  anged(self) -> N
+00012250: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00012260: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
+00012270: 7469 6f6e 2077 6865 6e20 6368 616e 6765  tion when change
+00012280: 7320 6172 6520 7265 7175 6972 6564 2e22  s are required."
+00012290: 2222 0a20 2020 2020 2020 2063 6f64 6520  "".        code 
+000122a0: 3d20 2270 7269 6e74 2827 6865 6c6c 6f20  = "print('hello 
+000122b0: 776f 726c 6427 2922 0a20 2020 2020 2020  world')".       
+000122c0: 2066 6f72 6d61 7474 6564 203d 2062 6c61   formatted = bla
+000122d0: 636b 2e66 6f72 6d61 745f 7374 7228 636f  ck.format_str(co
+000122e0: 6465 2c20 6d6f 6465 3d44 4546 4155 4c54  de, mode=DEFAULT
+000122f0: 5f4d 4f44 4529 0a0a 2020 2020 2020 2020  _MODE)..        
+00012300: 6172 6773 203d 205b 222d 2d63 6f64 6522  args = ["--code"
+00012310: 2c20 636f 6465 5d0a 2020 2020 2020 2020  , code].        
+00012320: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
+00012330: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
+00012340: 6b2e 6d61 696e 2c20 6172 6773 290a 0a20  k.main, args).. 
+00012350: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+00012360: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
+00012370: 6c74 2c20 666f 726d 6174 7465 642c 2030  lt, formatted, 0
+00012380: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00012390: 636f 6465 5f6f 7074 696f 6e5f 6368 6563  code_option_chec
+000123a0: 6b28 7365 6c66 2920 2d3e 204e 6f6e 653a  k(self) -> None:
+000123b0: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
+000123c0: 2074 6865 2063 6f64 6520 6f70 7469 6f6e   the code option
+000123d0: 2077 6865 6e20 6368 6563 6b20 6973 2070   when check is p
+000123e0: 6173 7365 642e 2222 220a 2020 2020 2020  assed.""".      
+000123f0: 2020 6172 6773 203d 205b 222d 2d63 6865    args = ["--che
+00012400: 636b 222c 2022 2d2d 636f 6465 222c 2027  ck", "--code", '
+00012410: 7072 696e 7428 2248 656c 6c6f 2077 6f72  print("Hello wor
+00012420: 6c64 2229 5c6e 275d 0a20 2020 2020 2020  ld")\n'].       
+00012430: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+00012440: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
+00012450: 636b 2e6d 6169 6e2c 2061 7267 7329 0a20  ck.main, args). 
+00012460: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+00012470: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
+00012480: 6c74 2c20 2222 2c20 3029 0a0a 2020 2020  lt, "", 0)..    
+00012490: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+000124a0: 7469 6f6e 5f63 6865 636b 5f63 6861 6e67  tion_check_chang
+000124b0: 6564 2873 656c 6629 202d 3e20 4e6f 6e65  ed(self) -> None
+000124c0: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
+000124d0: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
+000124e0: 6e20 7768 656e 2063 6861 6e67 6573 2061  n when changes a
+000124f0: 7265 2072 6571 7569 7265 642c 2061 6e64  re required, and
+00012500: 2063 6865 636b 2069 7320 7061 7373 6564   check is passed
+00012510: 2e22 2222 0a20 2020 2020 2020 2061 7267  .""".        arg
+00012520: 7320 3d20 5b22 2d2d 6368 6563 6b22 2c20  s = ["--check", 
+00012530: 222d 2d63 6f64 6522 2c20 2270 7269 6e74  "--code", "print
+00012540: 2827 6865 6c6c 6f20 776f 726c 6427 2922  ('hello world')"
+00012550: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
+00012560: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
+00012570: 6e76 6f6b 6528 626c 6163 6b2e 6d61 696e  nvoke(black.main
+00012580: 2c20 6172 6773 290a 2020 2020 2020 2020  , args).        
+00012590: 7365 6c66 2e63 6f6d 7061 7265 5f72 6573  self.compare_res
+000125a0: 756c 7473 2872 6573 756c 742c 2022 222c  ults(result, "",
+000125b0: 2031 290a 0a20 2020 2064 6566 2074 6573   1)..    def tes
+000125c0: 745f 636f 6465 5f6f 7074 696f 6e5f 6469  t_code_option_di
+000125d0: 6666 2873 656c 6629 202d 3e20 4e6f 6e65  ff(self) -> None
+000125e0: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
+000125f0: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
+00012600: 6e20 7768 656e 2064 6966 6620 6973 2070  n when diff is p
+00012610: 6173 7365 642e 2222 220a 2020 2020 2020  assed.""".      
+00012620: 2020 636f 6465 203d 2022 7072 696e 7428    code = "print(
+00012630: 2768 656c 6c6f 2077 6f72 6c64 2729 220a  'hello world')".
+00012640: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
+00012650: 6420 3d20 626c 6163 6b2e 666f 726d 6174  d = black.format
+00012660: 5f73 7472 2863 6f64 652c 206d 6f64 653d  _str(code, mode=
+00012670: 4445 4641 554c 545f 4d4f 4445 290a 2020  DEFAULT_MODE).  
+00012680: 2020 2020 2020 7265 7375 6c74 5f64 6966        result_dif
+00012690: 6620 3d20 6469 6666 2863 6f64 652c 2066  f = diff(code, f
+000126a0: 6f72 6d61 7474 6564 2c20 2253 5444 494e  ormatted, "STDIN
+000126b0: 222c 2022 5354 444f 5554 2229 0a0a 2020  ", "STDOUT")..  
+000126c0: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
+000126d0: 2d64 6966 6622 2c20 222d 2d63 6f64 6522  -diff", "--code"
+000126e0: 2c20 636f 6465 5d0a 2020 2020 2020 2020  , code].        
+000126f0: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
+00012700: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
+00012710: 6b2e 6d61 696e 2c20 6172 6773 290a 0a20  k.main, args).. 
+00012720: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+00012730: 7469 6d65 2066 726f 6d20 6469 6666 0a20  time from diff. 
+00012740: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+00012750: 4449 4646 5f54 494d 452e 7375 6228 2222  DIFF_TIME.sub(""
+00012760: 2c20 7265 7375 6c74 2e6f 7574 7075 7429  , result.output)
+00012770: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
+00012780: 206f 7574 7075 7420 3d3d 2072 6573 756c   output == resul
+00012790: 745f 6469 6666 2c20 2254 6865 206f 7574  t_diff, "The out
+000127a0: 7075 7420 6469 6420 6e6f 7420 6d61 7463  put did not matc
+000127b0: 6820 7468 6520 6578 7065 6374 6564 2076  h the expected v
+000127c0: 616c 7565 2e22 0a20 2020 2020 2020 2061  alue.".        a
+000127d0: 7373 6572 7420 7265 7375 6c74 2e65 7869  ssert result.exi
+000127e0: 745f 636f 6465 203d 3d20 302c 2022 5468  t_code == 0, "Th
+000127f0: 6520 6578 6974 2063 6f64 6520 6973 2069  e exit code is i
+00012800: 6e63 6f72 7265 6374 2e22 0a0a 2020 2020  ncorrect."..    
+00012810: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+00012820: 7469 6f6e 5f63 6f6c 6f72 5f64 6966 6628  tion_color_diff(
+00012830: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00012840: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
+00012850: 6865 2063 6f64 6520 6f70 7469 6f6e 2077  he code option w
+00012860: 6865 6e20 636f 6c6f 7220 616e 6420 6469  hen color and di
+00012870: 6666 2061 7265 2070 6173 7365 642e 2222  ff are passed.""
+00012880: 220a 2020 2020 2020 2020 636f 6465 203d  ".        code =
+00012890: 2022 7072 696e 7428 2768 656c 6c6f 2077   "print('hello w
+000128a0: 6f72 6c64 2729 220a 2020 2020 2020 2020  orld')".        
+000128b0: 666f 726d 6174 7465 6420 3d20 626c 6163  formatted = blac
+000128c0: 6b2e 666f 726d 6174 5f73 7472 2863 6f64  k.format_str(cod
+000128d0: 652c 206d 6f64 653d 4445 4641 554c 545f  e, mode=DEFAULT_
+000128e0: 4d4f 4445 290a 0a20 2020 2020 2020 2072  MODE)..        r
+000128f0: 6573 756c 745f 6469 6666 203d 2064 6966  esult_diff = dif
+00012900: 6628 636f 6465 2c20 666f 726d 6174 7465  f(code, formatte
+00012910: 642c 2022 5354 4449 4e22 2c20 2253 5444  d, "STDIN", "STD
+00012920: 4f55 5422 290a 2020 2020 2020 2020 7265  OUT").        re
+00012930: 7375 6c74 5f64 6966 6620 3d20 636f 6c6f  sult_diff = colo
+00012940: 725f 6469 6666 2872 6573 756c 745f 6469  r_diff(result_di
+00012950: 6666 290a 0a20 2020 2020 2020 2061 7267  ff)..        arg
+00012960: 7320 3d20 5b22 2d2d 6469 6666 222c 2022  s = ["--diff", "
+00012970: 2d2d 636f 6c6f 7222 2c20 222d 2d63 6f64  --color", "--cod
+00012980: 6522 2c20 636f 6465 5d0a 2020 2020 2020  e", code].      
+00012990: 2020 7265 7375 6c74 203d 2043 6c69 5275    result = CliRu
+000129a0: 6e6e 6572 2829 2e69 6e76 6f6b 6528 626c  nner().invoke(bl
+000129b0: 6163 6b2e 6d61 696e 2c20 6172 6773 290a  ack.main, args).
+000129c0: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
+000129d0: 6520 7469 6d65 2066 726f 6d20 6469 6666  e time from diff
+000129e0: 0a20 2020 2020 2020 206f 7574 7075 7420  .        output 
+000129f0: 3d20 4449 4646 5f54 494d 452e 7375 6228  = DIFF_TIME.sub(
+00012a00: 2222 2c20 7265 7375 6c74 2e6f 7574 7075  "", result.outpu
+00012a10: 7429 0a0a 2020 2020 2020 2020 6173 7365  t)..        asse
+00012a20: 7274 206f 7574 7075 7420 3d3d 2072 6573  rt output == res
+00012a30: 756c 745f 6469 6666 2c20 2254 6865 206f  ult_diff, "The o
+00012a40: 7574 7075 7420 6469 6420 6e6f 7420 6d61  utput did not ma
+00012a50: 7463 6820 7468 6520 6578 7065 6374 6564  tch the expected
+00012a60: 2076 616c 7565 2e22 0a20 2020 2020 2020   value.".       
+00012a70: 2061 7373 6572 7420 7265 7375 6c74 2e65   assert result.e
+00012a80: 7869 745f 636f 6465 203d 3d20 302c 2022  xit_code == 0, "
+00012a90: 5468 6520 6578 6974 2063 6f64 6520 6973  The exit code is
+00012aa0: 2069 6e63 6f72 7265 6374 2e22 0a0a 2020   incorrect."..  
+00012ab0: 2020 4070 7974 6573 742e 6d61 726b 2e69    @pytest.mark.i
+00012ac0: 6e63 6f6d 7061 7469 626c 655f 7769 7468  ncompatible_with
+00012ad0: 5f6d 7970 7963 0a20 2020 2064 6566 2074  _mypyc.    def t
+00012ae0: 6573 745f 636f 6465 5f6f 7074 696f 6e5f  est_code_option_
+00012af0: 7361 6665 2873 656c 6629 202d 3e20 4e6f  safe(self) -> No
+00012b00: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
+00012b10: 6573 7420 7468 6174 2074 6865 2063 6f64  est that the cod
+00012b20: 6520 6f70 7469 6f6e 2074 6872 6f77 7320  e option throws 
+00012b30: 616e 2065 7272 6f72 2077 6865 6e20 7468  an error when th
+00012b40: 6520 7361 6e69 7479 2063 6865 636b 7320  e sanity checks 
+00012b50: 6661 696c 2e22 2222 0a20 2020 2020 2020  fail.""".       
+00012b60: 2023 2050 6174 6368 2062 6c61 636b 2e61   # Patch black.a
+00012b70: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00012b80: 2074 6f20 656e 7375 7265 2074 6865 2073   to ensure the s
+00012b90: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
+00012ba0: 6c0a 2020 2020 2020 2020 7769 7468 2070  l.        with p
+00012bb0: 6174 6368 2e6f 626a 6563 7428 626c 6163  atch.object(blac
+00012bc0: 6b2c 2022 6173 7365 7274 5f65 7175 6976  k, "assert_equiv
+00012bd0: 616c 656e 7422 2c20 7369 6465 5f65 6666  alent", side_eff
+00012be0: 6563 743d 4173 7365 7274 696f 6e45 7272  ect=AssertionErr
+00012bf0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00012c00: 2063 6f64 6520 3d20 2770 7269 6e74 2822   code = 'print("
+00012c10: 4865 6c6c 6f20 776f 726c 6422 2927 0a20  Hello world")'. 
+00012c20: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00012c30: 5f6d 7367 203d 2066 227b 636f 6465 7d5c  _msg = f"{code}\
+00012c40: 6e65 7272 6f72 3a20 6361 6e6e 6f74 2066  nerror: cannot f
+00012c50: 6f72 6d61 7420 3c73 7472 696e 673e 3a20  ormat <string>: 
+00012c60: 5c6e 220a 0a20 2020 2020 2020 2020 2020  \n"..           
+00012c70: 2061 7267 7320 3d20 5b22 2d2d 7361 6665   args = ["--safe
+00012c80: 222c 2022 2d2d 636f 6465 222c 2063 6f64  ", "--code", cod
+00012c90: 655d 0a20 2020 2020 2020 2020 2020 2072  e].            r
+00012ca0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+00012cb0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
+00012cc0: 2e6d 6169 6e2c 2061 7267 7329 0a0a 2020  .main, args)..  
+00012cd0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00012ce0: 6f6d 7061 7265 5f72 6573 756c 7473 2872  ompare_results(r
+00012cf0: 6573 756c 742c 2065 7272 6f72 5f6d 7367  esult, error_msg
+00012d00: 2c20 3132 3329 0a0a 2020 2020 6465 6620  , 123)..    def 
+00012d10: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
+00012d20: 5f66 6173 7428 7365 6c66 2920 2d3e 204e  _fast(self) -> N
+00012d30: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00012d40: 5465 7374 2074 6861 7420 7468 6520 636f  Test that the co
+00012d50: 6465 206f 7074 696f 6e20 6967 6e6f 7265  de option ignore
+00012d60: 7320 6572 726f 7273 2077 6865 6e20 7468  s errors when th
+00012d70: 6520 7361 6e69 7479 2063 6865 636b 7320  e sanity checks 
+00012d80: 6661 696c 2e22 2222 0a20 2020 2020 2020  fail.""".       
+00012d90: 2023 2050 6174 6368 2062 6c61 636b 2e61   # Patch black.a
+00012da0: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00012db0: 2074 6f20 656e 7375 7265 2074 6865 2073   to ensure the s
+00012dc0: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
+00012dd0: 6c0a 2020 2020 2020 2020 7769 7468 2070  l.        with p
+00012de0: 6174 6368 2e6f 626a 6563 7428 626c 6163  atch.object(blac
+00012df0: 6b2c 2022 6173 7365 7274 5f65 7175 6976  k, "assert_equiv
+00012e00: 616c 656e 7422 2c20 7369 6465 5f65 6666  alent", side_eff
+00012e10: 6563 743d 4173 7365 7274 696f 6e45 7272  ect=AssertionErr
+00012e20: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00012e30: 2063 6f64 6520 3d20 2770 7269 6e74 2822   code = 'print("
+00012e40: 4865 6c6c 6f20 776f 726c 6422 2927 0a20  Hello world")'. 
+00012e50: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+00012e60: 7474 6564 203d 2062 6c61 636b 2e66 6f72  tted = black.for
+00012e70: 6d61 745f 7374 7228 636f 6465 2c20 6d6f  mat_str(code, mo
+00012e80: 6465 3d44 4546 4155 4c54 5f4d 4f44 4529  de=DEFAULT_MODE)
+00012e90: 0a0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
+00012ea0: 6773 203d 205b 222d 2d66 6173 7422 2c20  gs = ["--fast", 
+00012eb0: 222d 2d63 6f64 6522 2c20 636f 6465 5d0a  "--code", code].
+00012ec0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00012ed0: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
+00012ee0: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
+00012ef0: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
+00012f00: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+00012f10: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
+00012f20: 6c74 2c20 666f 726d 6174 7465 642c 2030  lt, formatted, 0
+00012f30: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
+00012f40: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
+00012f50: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
+00012f60: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+00012f70: 7469 6f6e 5f63 6f6e 6669 6728 7365 6c66  tion_config(self
+00012f80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00012f90: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00012fa0: 6573 7420 7468 6174 2074 6865 2063 6f64  est that the cod
+00012fb0: 6520 6f70 7469 6f6e 2066 696e 6473 2074  e option finds t
+00012fc0: 6865 2070 7970 726f 6a65 6374 2e74 6f6d  he pyproject.tom
+00012fd0: 6c20 696e 2074 6865 2063 7572 7265 6e74  l in the current
+00012fe0: 2064 6972 6563 746f 7279 2e0a 2020 2020   directory..    
+00012ff0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013000: 7769 7468 2070 6174 6368 2e6f 626a 6563  with patch.objec
+00013010: 7428 626c 6163 6b2c 2022 7061 7273 655f  t(black, "parse_
+00013020: 7079 7072 6f6a 6563 745f 746f 6d6c 222c  pyproject_toml",
+00013030: 2072 6574 7572 6e5f 7661 6c75 653d 7b7d   return_value={}
+00013040: 2920 6173 2070 6172 7365 3a0a 2020 2020  ) as parse:.    
+00013050: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+00013060: 222d 2d63 6f64 6522 2c20 2270 7269 6e74  "--code", "print
+00013070: 225d 0a20 2020 2020 2020 2020 2020 2023  "].            #
+00013080: 2054 6869 7320 6973 2074 6865 206f 6e6c   This is the onl
+00013090: 7920 6469 7265 6374 6f72 7920 6b6e 6f77  y directory know
+000130a0: 6e20 746f 2063 6f6e 7461 696e 2061 2070  n to contain a p
+000130b0: 7970 726f 6a65 6374 2e74 6f6d 6c0a 2020  yproject.toml.  
+000130c0: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+000130d0: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
+000130e0: 5052 4f4a 4543 545f 524f 4f54 293a 0a20  PROJECT_ROOT):. 
+000130f0: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00013100: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
+00013110: 6528 626c 6163 6b2e 6d61 696e 2c20 6172  e(black.main, ar
+00013120: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+00013130: 2020 2020 7079 7072 6f6a 6563 745f 7061      pyproject_pa
+00013140: 7468 203d 2050 6174 6828 5061 7468 2e63  th = Path(Path.c
+00013150: 7764 2829 2c20 2270 7970 726f 6a65 6374  wd(), "pyproject
+00013160: 2e74 6f6d 6c22 292e 7265 736f 6c76 6528  .toml").resolve(
+00013170: 290a 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00013180: 7373 6572 7420 280a 2020 2020 2020 2020  ssert (.        
+00013190: 2020 2020 2020 2020 6c65 6e28 7061 7273          len(pars
+000131a0: 652e 6d6f 636b 5f63 616c 6c73 2920 3e3d  e.mock_calls) >=
+000131b0: 2031 0a20 2020 2020 2020 2020 2020 2029   1.            )
+000131c0: 2c20 2245 7870 6563 7465 6420 636f 6e66  , "Expected conf
+000131d0: 6967 2070 6172 7365 2074 6f20 6265 2063  ig parse to be c
+000131e0: 616c 6c65 6420 7769 7468 2074 6865 2063  alled with the c
+000131f0: 7572 7265 6e74 2064 6972 6563 746f 7279  urrent directory
+00013200: 2e22 0a0a 2020 2020 2020 2020 2020 2020  ."..            
+00013210: 5f2c 2063 616c 6c5f 6172 6773 2c20 5f20  _, call_args, _ 
+00013220: 3d20 7061 7273 652e 6d6f 636b 5f63 616c  = parse.mock_cal
+00013230: 6c73 5b30 5d0a 2020 2020 2020 2020 2020  ls[0].          
+00013240: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
+00013250: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
+00013260: 6172 6773 5b30 5d2e 6c6f 7765 7228 2920  args[0].lower() 
+00013270: 3d3d 2073 7472 2870 7970 726f 6a65 6374  == str(pyproject
+00013280: 5f70 6174 6829 2e6c 6f77 6572 2829 0a20  _path).lower(). 
+00013290: 2020 2020 2020 2020 2020 2029 2c20 2249             ), "I
+000132a0: 6e63 6f72 7265 6374 2063 6f6e 6669 6720  ncorrect config 
+000132b0: 6c6f 6164 6564 2e22 0a0a 2020 2020 4070  loaded."..    @p
+000132c0: 7974 6573 742e 6d61 726b 2e69 6e63 6f6d  ytest.mark.incom
+000132d0: 7061 7469 626c 655f 7769 7468 5f6d 7970  patible_with_myp
+000132e0: 7963 0a20 2020 2064 6566 2074 6573 745f  yc.    def test_
+000132f0: 636f 6465 5f6f 7074 696f 6e5f 7061 7265  code_option_pare
+00013300: 6e74 5f63 6f6e 6669 6728 7365 6c66 2920  nt_config(self) 
+00013310: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00013320: 2022 2222 0a20 2020 2020 2020 2054 6573   """.        Tes
+00013330: 7420 7468 6174 2074 6865 2063 6f64 6520  t that the code 
+00013340: 6f70 7469 6f6e 2066 696e 6473 2074 6865  option finds the
+00013350: 2070 7970 726f 6a65 6374 2e74 6f6d 6c20   pyproject.toml 
+00013360: 696e 2074 6865 2070 6172 656e 7420 6469  in the parent di
+00013370: 7265 6374 6f72 792e 0a20 2020 2020 2020  rectory..       
+00013380: 2022 2222 0a20 2020 2020 2020 2077 6974   """.        wit
+00013390: 6820 7061 7463 682e 6f62 6a65 6374 2862  h patch.object(b
+000133a0: 6c61 636b 2c20 2270 6172 7365 5f70 7970  lack, "parse_pyp
+000133b0: 726f 6a65 6374 5f74 6f6d 6c22 2c20 7265  roject_toml", re
+000133c0: 7475 726e 5f76 616c 7565 3d7b 7d29 2061  turn_value={}) a
+000133d0: 7320 7061 7273 653a 0a20 2020 2020 2020  s parse:.       
+000133e0: 2020 2020 2077 6974 6820 6368 616e 6765       with change
+000133f0: 5f64 6972 6563 746f 7279 2854 4849 535f  _directory(THIS_
+00013400: 4449 5229 3a0a 2020 2020 2020 2020 2020  DIR):.          
+00013410: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
+00013420: 2d63 6f64 6522 2c20 2270 7269 6e74 225d  -code", "print"]
+00013430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013440: 2043 6c69 5275 6e6e 6572 2829 2e69 6e76   CliRunner().inv
+00013450: 6f6b 6528 626c 6163 6b2e 6d61 696e 2c20  oke(black.main, 
+00013460: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
+00013470: 2020 2020 2020 2070 7970 726f 6a65 6374         pyproject
+00013480: 5f70 6174 6820 3d20 5061 7468 2850 6174  _path = Path(Pat
+00013490: 6828 292e 6377 6428 292e 7061 7265 6e74  h().cwd().parent
+000134a0: 2c20 2270 7970 726f 6a65 6374 2e74 6f6d  , "pyproject.tom
+000134b0: 6c22 292e 7265 736f 6c76 6528 290a 2020  l").resolve().  
+000134c0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+000134d0: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
+000134e0: 2020 2020 2020 2020 2020 206c 656e 2870             len(p
+000134f0: 6172 7365 2e6d 6f63 6b5f 6361 6c6c 7329  arse.mock_calls)
+00013500: 203e 3d20 310a 2020 2020 2020 2020 2020   >= 1.          
+00013510: 2020 2020 2020 292c 2022 4578 7065 6374        ), "Expect
+00013520: 6564 2063 6f6e 6669 6720 7061 7273 6520  ed config parse 
+00013530: 746f 2062 6520 6361 6c6c 6564 2077 6974  to be called wit
+00013540: 6820 7468 6520 6375 7272 656e 7420 6469  h the current di
+00013550: 7265 6374 6f72 792e 220a 0a20 2020 2020  rectory."..     
+00013560: 2020 2020 2020 2020 2020 205f 2c20 6361             _, ca
+00013570: 6c6c 5f61 7267 732c 205f 203d 2070 6172  ll_args, _ = par
+00013580: 7365 2e6d 6f63 6b5f 6361 6c6c 735b 305d  se.mock_calls[0]
+00013590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000135a0: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
+000135b0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+000135c0: 6c6c 5f61 7267 735b 305d 2e6c 6f77 6572  ll_args[0].lower
+000135d0: 2829 203d 3d20 7374 7228 7079 7072 6f6a  () == str(pyproj
+000135e0: 6563 745f 7061 7468 292e 6c6f 7765 7228  ect_path).lower(
+000135f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013600: 2020 292c 2022 496e 636f 7272 6563 7420    ), "Incorrect 
+00013610: 636f 6e66 6967 206c 6f61 6465 642e 220a  config loaded.".
+00013620: 0a20 2020 2064 6566 2074 6573 745f 666f  .    def test_fo
+00013630: 725f 6861 6e64 6c65 645f 756e 6578 7065  r_handled_unexpe
+00013640: 6374 6564 5f65 6f66 5f65 7272 6f72 2873  cted_eof_error(s
+00013650: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00013660: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013670: 2020 5465 7374 2074 6861 7420 616e 2075    Test that an u
+00013680: 6e65 7870 6563 7465 6420 454f 4620 5379  nexpected EOF Sy
+00013690: 6e74 6178 4572 726f 7220 6973 206e 6963  ntaxError is nic
+000136a0: 656c 7920 7072 6573 656e 7465 642e 0a20  ely presented.. 
+000136b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000136c0: 2020 2077 6974 6820 7079 7465 7374 2e72     with pytest.r
+000136d0: 6169 7365 7328 626c 6163 6b2e 7061 7273  aises(black.pars
+000136e0: 696e 672e 496e 7661 6c69 6449 6e70 7574  ing.InvalidInput
+000136f0: 2920 6173 2065 7863 5f69 6e66 6f3a 0a20  ) as exc_info:. 
+00013700: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00013710: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
+00013720: 7072 696e 7428 222c 207b 7d29 0a0a 2020  print(", {})..  
+00013730: 2020 2020 2020 6578 635f 696e 666f 2e6d        exc_info.m
+00013740: 6174 6368 2822 4361 6e6e 6f74 2070 6172  atch("Cannot par
+00013750: 7365 3a20 323a 303a 2045 4f46 2069 6e20  se: 2:0: EOF in 
+00013760: 6d75 6c74 692d 6c69 6e65 2073 7461 7465  multi-line state
+00013770: 6d65 6e74 2229 0a0a 2020 2020 6465 6620  ment")..    def 
+00013780: 7465 7374 5f65 7175 6976 616c 656e 6379  test_equivalency
+00013790: 5f61 7374 5f70 6172 7365 5f66 6169 6c75  _ast_parse_failu
+000137a0: 7265 5f69 6e63 6c75 6465 735f 6572 726f  re_includes_erro
+000137b0: 7228 7365 6c66 2920 2d3e 204e 6f6e 653a  r(self) -> None:
+000137c0: 0a20 2020 2020 2020 2077 6974 6820 7079  .        with py
+000137d0: 7465 7374 2e72 6169 7365 7328 4173 7365  test.raises(Asse
+000137e0: 7274 696f 6e45 7272 6f72 2920 6173 2065  rtionError) as e
+000137f0: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
+00013800: 626c 6163 6b2e 6173 7365 7274 5f65 7175  black.assert_equ
+00013810: 6976 616c 656e 7428 2261 c2ab c2bb 6120  ivalent("a....a 
+00013820: 203d 2031 222c 2022 61c2 abc2 bb61 2020   = 1", "a....a  
+00013830: 3d20 3122 290a 0a20 2020 2020 2020 2065  = 1")..        e
+00013840: 7272 2e6d 6174 6368 2822 2d2d 7361 6665  rr.match("--safe
+00013850: 2229 0a20 2020 2020 2020 2023 2055 6e66  ").        # Unf
+00013860: 6f72 7475 6e61 7465 6c79 2074 6865 2053  ortunately the S
+00013870: 796e 7461 7845 7272 6f72 206d 6573 7361  yntaxError messa
+00013880: 6765 2068 6173 2063 6861 6e67 6564 2069  ge has changed i
+00013890: 6e20 6e65 7765 7220 7665 7273 696f 6e73  n newer versions
+000138a0: 2073 6f20 7765 0a20 2020 2020 2020 2023   so we.        #
+000138b0: 2063 616e 2774 206d 6174 6368 2069 7420   can't match it 
+000138c0: 6469 7265 6374 6c79 2e0a 2020 2020 2020  directly..      
+000138d0: 2020 6572 722e 6d61 7463 6828 2269 6e76    err.match("inv
+000138e0: 616c 6964 2063 6861 7261 6374 6572 2229  alid character")
+000138f0: 0a20 2020 2020 2020 2065 7272 2e6d 6174  .        err.mat
+00013900: 6368 2872 225c 283c 756e 6b6e 6f77 6e3e  ch(r"\(<unknown>
+00013910: 2c20 6c69 6e65 2031 5c29 2229 0a0a 0a63  , line 1\)")...c
+00013920: 6c61 7373 2054 6573 7443 6163 6869 6e67  lass TestCaching
+00013930: 3a0a 2020 2020 6465 6620 7465 7374 5f67  :.    def test_g
+00013940: 6574 5f63 6163 6865 5f64 6972 280a 2020  et_cache_dir(.  
+00013950: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00013960: 2020 2020 746d 705f 7061 7468 3a20 5061      tmp_path: Pa
+00013970: 7468 2c0a 2020 2020 2020 2020 6d6f 6e6b  th,.        monk
+00013980: 6579 7061 7463 683a 2070 7974 6573 742e  eypatch: pytest.
+00013990: 4d6f 6e6b 6579 5061 7463 682c 0a20 2020  MonkeyPatch,.   
+000139a0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+000139b0: 2020 2020 2320 4372 6561 7465 206d 756c      # Create mul
+000139c0: 7469 706c 6520 6361 6368 6520 6469 7265  tiple cache dire
+000139d0: 6374 6f72 6965 730a 2020 2020 2020 2020  ctories.        
+000139e0: 776f 726b 7370 6163 6531 203d 2074 6d70  workspace1 = tmp
+000139f0: 5f70 6174 6820 2f20 2277 7331 220a 2020  _path / "ws1".  
+00013a00: 2020 2020 2020 776f 726b 7370 6163 6531        workspace1
+00013a10: 2e6d 6b64 6972 2829 0a20 2020 2020 2020  .mkdir().       
+00013a20: 2077 6f72 6b73 7061 6365 3220 3d20 746d   workspace2 = tm
+00013a30: 705f 7061 7468 202f 2022 7773 3222 0a20  p_path / "ws2". 
+00013a40: 2020 2020 2020 2077 6f72 6b73 7061 6365         workspace
+00013a50: 322e 6d6b 6469 7228 290a 0a20 2020 2020  2.mkdir()..     
+00013a60: 2020 2023 2046 6f72 6365 2075 7365 725f     # Force user_
+00013a70: 6361 6368 655f 6469 7220 746f 2075 7365  cache_dir to use
+00013a80: 2074 6865 2074 656d 706f 7261 7279 2064   the temporary d
+00013a90: 6972 6563 746f 7279 2066 6f72 2065 6173  irectory for eas
+00013aa0: 6965 7220 6173 7365 7274 696f 6e73 0a20  ier assertions. 
+00013ab0: 2020 2020 2020 2070 6174 6368 5f75 7365         patch_use
+00013ac0: 725f 6361 6368 655f 6469 7220 3d20 7061  r_cache_dir = pa
+00013ad0: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+00013ae0: 2074 6172 6765 743d 2262 6c61 636b 2e63   target="black.c
+00013af0: 6163 6865 2e75 7365 725f 6361 6368 655f  ache.user_cache_
+00013b00: 6469 7222 2c0a 2020 2020 2020 2020 2020  dir",.          
+00013b10: 2020 6175 746f 7370 6563 3d54 7275 652c    autospec=True,
+00013b20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00013b30: 7572 6e5f 7661 6c75 653d 7374 7228 776f  urn_value=str(wo
+00013b40: 726b 7370 6163 6531 292c 0a20 2020 2020  rkspace1),.     
+00013b50: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00013b60: 4966 2042 4c41 434b 5f43 4143 4845 5f44  If BLACK_CACHE_D
+00013b70: 4952 2069 7320 6e6f 7420 7365 742c 2075  IR is not set, u
+00013b80: 7365 2075 7365 725f 6361 6368 655f 6469  se user_cache_di
+00013b90: 720a 2020 2020 2020 2020 6d6f 6e6b 6579  r.        monkey
+00013ba0: 7061 7463 682e 6465 6c65 6e76 2822 424c  patch.delenv("BL
+00013bb0: 4143 4b5f 4341 4348 455f 4449 5222 2c20  ACK_CACHE_DIR", 
+00013bc0: 7261 6973 696e 673d 4661 6c73 6529 0a20  raising=False). 
+00013bd0: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+00013be0: 685f 7573 6572 5f63 6163 6865 5f64 6972  h_user_cache_dir
+00013bf0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+00013c00: 7365 7274 2067 6574 5f63 6163 6865 5f64  sert get_cache_d
+00013c10: 6972 2829 203d 3d20 776f 726b 7370 6163  ir() == workspac
+00013c20: 6531 0a0a 2020 2020 2020 2020 2320 4966  e1..        # If
+00013c30: 2069 7420 6973 2073 6574 2c20 7573 6520   it is set, use 
+00013c40: 7468 6520 7061 7468 2070 726f 7669 6465  the path provide
+00013c50: 6420 696e 2074 6865 2065 6e76 2076 6172  d in the env var
+00013c60: 2e0a 2020 2020 2020 2020 6d6f 6e6b 6579  ..        monkey
+00013c70: 7061 7463 682e 7365 7465 6e76 2822 424c  patch.setenv("BL
+00013c80: 4143 4b5f 4341 4348 455f 4449 5222 2c20  ACK_CACHE_DIR", 
+00013c90: 7374 7228 776f 726b 7370 6163 6532 2929  str(workspace2))
+00013ca0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00013cb0: 6765 745f 6361 6368 655f 6469 7228 2920  get_cache_dir() 
+00013cc0: 3d3d 2077 6f72 6b73 7061 6365 320a 0a20  == workspace2.. 
+00013cd0: 2020 2064 6566 2074 6573 745f 6361 6368     def test_cach
+00013ce0: 655f 6272 6f6b 656e 5f66 696c 6528 7365  e_broken_file(se
+00013cf0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00013d00: 2020 2020 206d 6f64 6520 3d20 4445 4641       mode = DEFA
+00013d10: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
+00013d20: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+00013d30: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00013d40: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00013d50: 655f 6669 6c65 203d 2067 6574 5f63 6163  e_file = get_cac
+00013d60: 6865 5f66 696c 6528 6d6f 6465 290a 2020  he_file(mode).  
+00013d70: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
+00013d80: 6669 6c65 2e77 7269 7465 5f74 6578 7428  file.write_text(
+00013d90: 2274 6869 7320 6973 206e 6f74 2061 2070  "this is not a p
+00013da0: 6963 6b6c 6522 2c20 656e 636f 6469 6e67  ickle", encoding
+00013db0: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
+00013dc0: 2020 2020 2020 6173 7365 7274 2062 6c61        assert bla
+00013dd0: 636b 2e72 6561 645f 6361 6368 6528 6d6f  ck.read_cache(mo
+00013de0: 6465 2920 3d3d 207b 7d0a 2020 2020 2020  de) == {}.      
+00013df0: 2020 2020 2020 7372 6320 3d20 2877 6f72        src = (wor
+00013e00: 6b73 7061 6365 202f 2022 7465 7374 2e70  kspace / "test.p
+00013e10: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+00013e20: 2020 2020 2020 2020 2020 7372 632e 7772            src.wr
+00013e30: 6974 655f 7465 7874 2822 7072 696e 7428  ite_text("print(
+00013e40: 2768 656c 6c6f 2729 222c 2065 6e63 6f64  'hello')", encod
+00013e50: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+00013e60: 2020 2020 2020 2020 2069 6e76 6f6b 6542           invokeB
+00013e70: 6c61 636b 285b 7374 7228 7372 6329 5d29  lack([str(src)])
+00013e80: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00013e90: 6865 203d 2062 6c61 636b 2e72 6561 645f  he = black.read_
+00013ea0: 6361 6368 6528 6d6f 6465 290a 2020 2020  cache(mode).    
+00013eb0: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+00013ec0: 7472 2873 7263 2920 696e 2063 6163 6865  tr(src) in cache
+00013ed0: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
+00013ee0: 6163 6865 5f73 696e 676c 655f 6669 6c65  ache_single_file
+00013ef0: 5f61 6c72 6561 6479 5f63 6163 6865 6428  _already_cached(
+00013f00: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00013f10: 2020 2020 2020 206d 6f64 6520 3d20 4445         mode = DE
+00013f20: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
+00013f30: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+00013f40: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
+00013f50: 3a0a 2020 2020 2020 2020 2020 2020 7372  :.            sr
+00013f60: 6320 3d20 2877 6f72 6b73 7061 6365 202f  c = (workspace /
+00013f70: 2022 7465 7374 2e70 7922 292e 7265 736f   "test.py").reso
+00013f80: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
+00013f90: 2020 7372 632e 7772 6974 655f 7465 7874    src.write_text
+00013fa0: 2822 7072 696e 7428 2768 656c 6c6f 2729  ("print('hello')
+00013fb0: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
+00013fc0: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
+00013fd0: 2062 6c61 636b 2e77 7269 7465 5f63 6163   black.write_cac
+00013fe0: 6865 287b 7d2c 205b 7372 635d 2c20 6d6f  he({}, [src], mo
+00013ff0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+00014000: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
+00014010: 2873 7263 295d 290a 2020 2020 2020 2020  (src)]).        
+00014020: 2020 2020 6173 7365 7274 2073 7263 2e72      assert src.r
+00014030: 6561 645f 7465 7874 2865 6e63 6f64 696e  ead_text(encodin
+00014040: 673d 2275 7466 2d38 2229 203d 3d20 2270  g="utf-8") == "p
+00014050: 7269 6e74 2827 6865 6c6c 6f27 2922 0a0a  rint('hello')"..
+00014060: 2020 2020 4065 7665 6e74 5f6c 6f6f 7028      @event_loop(
+00014070: 290a 2020 2020 6465 6620 7465 7374 5f63  ).    def test_c
+00014080: 6163 6865 5f6d 756c 7469 706c 655f 6669  ache_multiple_fi
+00014090: 6c65 7328 7365 6c66 2920 2d3e 204e 6f6e  les(self) -> Non
+000140a0: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+000140b0: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+000140c0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+000140d0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
+000140e0: 7061 6365 2c20 7061 7463 6828 0a20 2020  pace, patch(.   
+000140f0: 2020 2020 2020 2020 2022 636f 6e63 7572           "concur
+00014100: 7265 6e74 2e66 7574 7572 6573 2e50 726f  rent.futures.Pro
+00014110: 6365 7373 506f 6f6c 4578 6563 7574 6f72  cessPoolExecutor
+00014120: 222c 206e 6577 3d54 6872 6561 6450 6f6f  ", new=ThreadPoo
+00014130: 6c45 7865 6375 746f 720a 2020 2020 2020  lExecutor.      
+00014140: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00014150: 206f 6e65 203d 2028 776f 726b 7370 6163   one = (workspac
+00014160: 6520 2f20 226f 6e65 2e70 7922 292e 7265  e / "one.py").re
+00014170: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
+00014180: 2020 2020 6f6e 652e 7772 6974 655f 7465      one.write_te
+00014190: 7874 2822 7072 696e 7428 2768 656c 6c6f  xt("print('hello
+000141a0: 2729 222c 2065 6e63 6f64 696e 673d 2275  ')", encoding="u
+000141b0: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+000141c0: 2020 2074 776f 203d 2028 776f 726b 7370     two = (worksp
+000141d0: 6163 6520 2f20 2274 776f 2e70 7922 292e  ace / "two.py").
+000141e0: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+000141f0: 2020 2020 2020 7477 6f2e 7772 6974 655f        two.write_
+00014200: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
+00014210: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
+00014220: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+00014230: 2020 2020 2062 6c61 636b 2e77 7269 7465       black.write
+00014240: 5f63 6163 6865 287b 7d2c 205b 6f6e 655d  _cache({}, [one]
+00014250: 2c20 6d6f 6465 290a 2020 2020 2020 2020  , mode).        
+00014260: 2020 2020 696e 766f 6b65 426c 6163 6b28      invokeBlack(
+00014270: 5b73 7472 2877 6f72 6b73 7061 6365 295d  [str(workspace)]
+00014280: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00014290: 7365 7274 206f 6e65 2e72 6561 645f 7465  sert one.read_te
+000142a0: 7874 2865 6e63 6f64 696e 673d 2275 7466  xt(encoding="utf
+000142b0: 2d38 2229 203d 3d20 2270 7269 6e74 2827  -8") == "print('
+000142c0: 6865 6c6c 6f27 2922 0a20 2020 2020 2020  hello')".       
+000142d0: 2020 2020 2061 7373 6572 7420 7477 6f2e       assert two.
+000142e0: 7265 6164 5f74 6578 7428 656e 636f 6469  read_text(encodi
+000142f0: 6e67 3d22 7574 662d 3822 2920 3d3d 2027  ng="utf-8") == '
+00014300: 7072 696e 7428 2268 656c 6c6f 2229 5c6e  print("hello")\n
+00014310: 270a 2020 2020 2020 2020 2020 2020 6361  '.            ca
+00014320: 6368 6520 3d20 626c 6163 6b2e 7265 6164  che = black.read
+00014330: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
+00014340: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014350: 7374 7228 6f6e 6529 2069 6e20 6361 6368  str(one) in cach
+00014360: 650a 2020 2020 2020 2020 2020 2020 6173  e.            as
+00014370: 7365 7274 2073 7472 2874 776f 2920 696e  sert str(two) in
+00014380: 2063 6163 6865 0a0a 2020 2020 4070 7974   cache..    @pyt
+00014390: 6573 742e 6d61 726b 2e70 6172 616d 6574  est.mark.paramet
+000143a0: 7269 7a65 2822 636f 6c6f 7222 2c20 5b46  rize("color", [F
+000143b0: 616c 7365 2c20 5472 7565 5d2c 2069 6473  alse, True], ids
+000143c0: 3d5b 226e 6f2d 636f 6c6f 7222 2c20 2277  =["no-color", "w
+000143d0: 6974 682d 636f 6c6f 7222 5d29 0a20 2020  ith-color"]).   
+000143e0: 2064 6566 2074 6573 745f 6e6f 5f63 6163   def test_no_cac
+000143f0: 6865 5f77 6865 6e5f 7772 6974 6562 6163  he_when_writebac
+00014400: 6b5f 6469 6666 2873 656c 662c 2063 6f6c  k_diff(self, col
+00014410: 6f72 3a20 626f 6f6c 2920 2d3e 204e 6f6e  or: bool) -> Non
+00014420: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+00014430: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+00014440: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+00014450: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
+00014460: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+00014470: 2020 7372 6320 3d20 2877 6f72 6b73 7061    src = (workspa
+00014480: 6365 202f 2022 7465 7374 2e70 7922 292e  ce / "test.py").
+00014490: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+000144a0: 2020 2020 2020 7372 632e 7772 6974 655f        src.write_
+000144b0: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
+000144c0: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
+000144d0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+000144e0: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+000144f0: 2262 6c61 636b 2e72 6561 645f 6361 6368  "black.read_cach
+00014500: 6522 2920 6173 2072 6561 645f 6361 6368  e") as read_cach
+00014510: 652c 2070 6174 6368 280a 2020 2020 2020  e, patch(.      
+00014520: 2020 2020 2020 2020 2020 2262 6c61 636b            "black
+00014530: 2e77 7269 7465 5f63 6163 6865 220a 2020  .write_cache".  
+00014540: 2020 2020 2020 2020 2020 2920 6173 2077            ) as w
+00014550: 7269 7465 5f63 6163 6865 3a0a 2020 2020  rite_cache:.    
+00014560: 2020 2020 2020 2020 2020 2020 636d 6420              cmd 
+00014570: 3d20 5b73 7472 2873 7263 292c 2022 2d2d  = [str(src), "--
+00014580: 6469 6666 225d 0a20 2020 2020 2020 2020  diff"].         
+00014590: 2020 2020 2020 2069 6620 636f 6c6f 723a         if color:
+000145a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000145b0: 2020 2020 2063 6d64 2e61 7070 656e 6428       cmd.append(
+000145c0: 222d 2d63 6f6c 6f72 2229 0a20 2020 2020  "--color").     
+000145d0: 2020 2020 2020 2020 2020 2069 6e76 6f6b             invok
+000145e0: 6542 6c61 636b 2863 6d64 290a 2020 2020  eBlack(cmd).    
+000145f0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00014600: 655f 6669 6c65 203d 2067 6574 5f63 6163  e_file = get_cac
+00014610: 6865 5f66 696c 6528 6d6f 6465 290a 2020  he_file(mode).  
+00014620: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00014630: 7365 7274 2063 6163 6865 5f66 696c 652e  sert cache_file.
+00014640: 6578 6973 7473 2829 2069 7320 4661 6c73  exists() is Fals
+00014650: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00014660: 2020 7772 6974 655f 6361 6368 652e 6173    write_cache.as
+00014670: 7365 7274 5f6e 6f74 5f63 616c 6c65 6428  sert_not_called(
+00014680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014690: 2020 7265 6164 5f63 6163 6865 2e61 7373    read_cache.ass
+000146a0: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
+000146b0: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+000146c0: 726b 2e70 6172 616d 6574 7269 7a65 2822  rk.parametrize("
+000146d0: 636f 6c6f 7222 2c20 5b46 616c 7365 2c20  color", [False, 
+000146e0: 5472 7565 5d2c 2069 6473 3d5b 226e 6f2d  True], ids=["no-
+000146f0: 636f 6c6f 7222 2c20 2277 6974 682d 636f  color", "with-co
+00014700: 6c6f 7222 5d29 0a20 2020 2040 6576 656e  lor"]).    @even
+00014710: 745f 6c6f 6f70 2829 0a20 2020 2064 6566  t_loop().    def
+00014720: 2074 6573 745f 6f75 7470 7574 5f6c 6f63   test_output_loc
+00014730: 6b69 6e67 5f77 6865 6e5f 7772 6974 6562  king_when_writeb
+00014740: 6163 6b5f 6469 6666 2873 656c 662c 2063  ack_diff(self, c
+00014750: 6f6c 6f72 3a20 626f 6f6c 2920 2d3e 204e  olor: bool) -> N
+00014760: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+00014770: 6820 6361 6368 655f 6469 7228 2920 6173  h cache_dir() as
+00014780: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+00014790: 2020 2020 2020 2020 666f 7220 7461 6720          for tag 
+000147a0: 696e 2072 616e 6765 2830 2c20 3429 3a0a  in range(0, 4):.
+000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147c0: 7372 6320 3d20 2877 6f72 6b73 7061 6365  src = (workspace
+000147d0: 202f 2066 2274 6573 747b 7461 677d 2e70   / f"test{tag}.p
+000147e0: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+000147f0: 2020 2020 2020 2020 2020 2020 2020 7372                sr
+00014800: 632e 7772 6974 655f 7465 7874 2822 7072  c.write_text("pr
+00014810: 696e 7428 2768 656c 6c6f 2729 222c 2065  int('hello')", e
+00014820: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+00014830: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00014840: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
+00014850: 2020 2020 2020 2020 2022 626c 6163 6b2e           "black.
+00014860: 636f 6e63 7572 7265 6e63 792e 4d61 6e61  concurrency.Mana
+00014870: 6765 7222 2c20 7772 6170 733d 6d75 6c74  ger", wraps=mult
+00014880: 6970 726f 6365 7373 696e 672e 4d61 6e61  iprocessing.Mana
+00014890: 6765 720a 2020 2020 2020 2020 2020 2020  ger.            
+000148a0: 2920 6173 206d 6772 3a0a 2020 2020 2020  ) as mgr:.      
+000148b0: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
+000148c0: 5b22 2d2d 6469 6666 222c 2073 7472 2877  ["--diff", str(w
+000148d0: 6f72 6b73 7061 6365 295d 0a20 2020 2020  orkspace)].     
+000148e0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+000148f0: 6c6f 723a 0a20 2020 2020 2020 2020 2020  lor:.           
+00014900: 2020 2020 2020 2020 2063 6d64 2e61 7070           cmd.app
+00014910: 656e 6428 222d 2d63 6f6c 6f72 2229 0a20  end("--color"). 
+00014920: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014930: 6e76 6f6b 6542 6c61 636b 2863 6d64 2c20  nvokeBlack(cmd, 
+00014940: 6578 6974 5f63 6f64 653d 3029 0a20 2020  exit_code=0).   
+00014950: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00014960: 6869 7320 6973 6e27 7420 7175 6974 6520  his isn't quite 
+00014970: 646f 696e 6720 7768 6174 2077 6520 7761  doing what we wa
+00014980: 6e74 2c20 6275 7420 6966 2069 7420 5f69  nt, but if it _i
+00014990: 736e 2774 5f0a 2020 2020 2020 2020 2020  sn't_.          
+000149a0: 2020 2020 2020 2320 6361 6c6c 6564 2074        # called t
+000149b0: 6865 6e20 7765 2063 616e 6e6f 7420 6265  hen we cannot be
+000149c0: 2075 7369 6e67 2074 6865 206c 6f63 6b20   using the lock 
+000149d0: 6974 2070 726f 7669 6465 730a 2020 2020  it provides.    
+000149e0: 2020 2020 2020 2020 2020 2020 6d67 722e              mgr.
+000149f0: 6173 7365 7274 5f63 616c 6c65 6428 290a  assert_called().
+00014a00: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
+00014a10: 5f63 6163 6865 5f77 6865 6e5f 7374 6469  _cache_when_stdi
+00014a20: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+00014a30: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+00014a40: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+00014a50: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+00014a60: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+00014a70: 2020 2072 6573 756c 7420 3d20 436c 6952     result = CliR
+00014a80: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014aa0: 626c 6163 6b2e 6d61 696e 2c20 5b22 2d22  black.main, ["-"
+00014ab0: 5d2c 2069 6e70 7574 3d42 7974 6573 494f  ], input=BytesIO
+00014ac0: 2862 2270 7269 6e74 2827 6865 6c6c 6f27  (b"print('hello'
+00014ad0: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
+00014ae0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00014af0: 7365 7274 206e 6f74 2072 6573 756c 742e  sert not result.
+00014b00: 6578 6974 5f63 6f64 650a 2020 2020 2020  exit_code.      
+00014b10: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
+00014b20: 203d 2067 6574 5f63 6163 6865 5f66 696c   = get_cache_fil
+00014b30: 6528 6d6f 6465 290a 2020 2020 2020 2020  e(mode).        
+00014b40: 2020 2020 6173 7365 7274 206e 6f74 2063      assert not c
+00014b50: 6163 6865 5f66 696c 652e 6578 6973 7473  ache_file.exists
+00014b60: 2829 0a0a 2020 2020 6465 6620 7465 7374  ()..    def test
+00014b70: 5f72 6561 645f 6361 6368 655f 6e6f 5f63  _read_cache_no_c
+00014b80: 6163 6865 6669 6c65 2873 656c 6629 202d  achefile(self) -
+00014b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00014ba0: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
+00014bb0: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
+00014bc0: 2063 6163 6865 5f64 6972 2829 3a0a 2020   cache_dir():.  
+00014bd0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00014be0: 2062 6c61 636b 2e72 6561 645f 6361 6368   black.read_cach
+00014bf0: 6528 6d6f 6465 2920 3d3d 207b 7d0a 0a20  e(mode) == {}.. 
+00014c00: 2020 2064 6566 2074 6573 745f 7772 6974     def test_writ
+00014c10: 655f 6361 6368 655f 7265 6164 5f63 6163  e_cache_read_cac
+00014c20: 6865 2873 656c 6629 202d 3e20 4e6f 6e65  he(self) -> None
+00014c30: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
+00014c40: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+00014c50: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+00014c60: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+00014c70: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+00014c80: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
+00014c90: 6520 2f20 2274 6573 742e 7079 2229 2e72  e / "test.py").r
+00014ca0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+00014cb0: 2020 2020 2073 7263 2e74 6f75 6368 2829       src.touch()
+00014cc0: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+00014cd0: 636b 2e77 7269 7465 5f63 6163 6865 287b  ck.write_cache({
+00014ce0: 7d2c 205b 7372 635d 2c20 6d6f 6465 290a  }, [src], mode).
+00014cf0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00014d00: 6520 3d20 626c 6163 6b2e 7265 6164 5f63  e = black.read_c
+00014d10: 6163 6865 286d 6f64 6529 0a20 2020 2020  ache(mode).     
+00014d20: 2020 2020 2020 2061 7373 6572 7420 7374         assert st
+00014d30: 7228 7372 6329 2069 6e20 6361 6368 650a  r(src) in cache.
+00014d40: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00014d50: 7274 2063 6163 6865 5b73 7472 2873 7263  rt cache[str(src
+00014d60: 295d 203d 3d20 626c 6163 6b2e 6765 745f  )] == black.get_
+00014d70: 6361 6368 655f 696e 666f 2873 7263 290a  cache_info(src).
+00014d80: 0a20 2020 2064 6566 2074 6573 745f 6669  .    def test_fi
+00014d90: 6c74 6572 5f63 6163 6865 6428 7365 6c66  lter_cached(self
+00014da0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00014db0: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
+00014dc0: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
+00014dd0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+00014de0: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+00014df0: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
+00014e00: 2020 2020 2020 2020 2020 756e 6361 6368            uncach
+00014e10: 6564 203d 2028 7061 7468 202f 2022 756e  ed = (path / "un
+00014e20: 6361 6368 6564 2229 2e72 6573 6f6c 7665  cached").resolve
+00014e30: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
+00014e40: 6163 6865 6420 3d20 2870 6174 6820 2f20  ached = (path / 
+00014e50: 2263 6163 6865 6422 292e 7265 736f 6c76  "cached").resolv
+00014e60: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00014e70: 6361 6368 6564 5f62 7574 5f63 6861 6e67  cached_but_chang
+00014e80: 6564 203d 2028 7061 7468 202f 2022 6368  ed = (path / "ch
+00014e90: 616e 6765 6422 292e 7265 736f 6c76 6528  anged").resolve(
+00014ea0: 290a 2020 2020 2020 2020 2020 2020 756e  ).            un
+00014eb0: 6361 6368 6564 2e74 6f75 6368 2829 0a20  cached.touch(). 
+00014ec0: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00014ed0: 642e 746f 7563 6828 290a 2020 2020 2020  d.touch().      
+00014ee0: 2020 2020 2020 6361 6368 6564 5f62 7574        cached_but
+00014ef0: 5f63 6861 6e67 6564 2e74 6f75 6368 2829  _changed.touch()
+00014f00: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00014f10: 6865 203d 207b 0a20 2020 2020 2020 2020  he = {.         
+00014f20: 2020 2020 2020 2073 7472 2863 6163 6865         str(cache
+00014f30: 6429 3a20 626c 6163 6b2e 6765 745f 6361  d): black.get_ca
+00014f40: 6368 655f 696e 666f 2863 6163 6865 6429  che_info(cached)
+00014f50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014f60: 2020 7374 7228 6361 6368 6564 5f62 7574    str(cached_but
+00014f70: 5f63 6861 6e67 6564 293a 2028 302e 302c  _changed): (0.0,
+00014f80: 2030 292c 0a20 2020 2020 2020 2020 2020   0),.           
+00014f90: 207d 0a20 2020 2020 2020 2020 2020 2074   }.            t
+00014fa0: 6f64 6f2c 2064 6f6e 6520 3d20 626c 6163  odo, done = blac
+00014fb0: 6b2e 6361 6368 652e 6669 6c74 6572 5f63  k.cache.filter_c
+00014fc0: 6163 6865 6428 0a20 2020 2020 2020 2020  ached(.         
+00014fd0: 2020 2020 2020 2063 6163 6865 2c20 7b75         cache, {u
+00014fe0: 6e63 6163 6865 642c 2063 6163 6865 642c  ncached, cached,
+00014ff0: 2063 6163 6865 645f 6275 745f 6368 616e   cached_but_chan
+00015000: 6765 647d 0a20 2020 2020 2020 2020 2020  ged}.           
+00015010: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
+00015020: 7373 6572 7420 746f 646f 203d 3d20 7b75  ssert todo == {u
+00015030: 6e63 6163 6865 642c 2063 6163 6865 645f  ncached, cached_
+00015040: 6275 745f 6368 616e 6765 647d 0a20 2020  but_changed}.   
+00015050: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00015060: 646f 6e65 203d 3d20 7b63 6163 6865 647d  done == {cached}
+00015070: 0a0a 2020 2020 6465 6620 7465 7374 5f77  ..    def test_w
+00015080: 7269 7465 5f63 6163 6865 5f63 7265 6174  rite_cache_creat
+00015090: 6573 5f64 6972 6563 746f 7279 5f69 665f  es_directory_if_
+000150a0: 6e65 6564 6564 2873 656c 6629 202d 3e20  needed(self) -> 
+000150b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+000150c0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+000150d0: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
+000150e0: 6163 6865 5f64 6972 2865 7869 7374 733d  ache_dir(exists=
+000150f0: 4661 6c73 6529 2061 7320 776f 726b 7370  False) as worksp
+00015100: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+00015110: 2061 7373 6572 7420 6e6f 7420 776f 726b   assert not work
+00015120: 7370 6163 652e 6578 6973 7473 2829 0a20  space.exists(). 
+00015130: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00015140: 2e77 7269 7465 5f63 6163 6865 287b 7d2c  .write_cache({},
+00015150: 205b 5d2c 206d 6f64 6529 0a20 2020 2020   [], mode).     
+00015160: 2020 2020 2020 2061 7373 6572 7420 776f         assert wo
+00015170: 726b 7370 6163 652e 6578 6973 7473 2829  rkspace.exists()
+00015180: 0a0a 2020 2020 4065 7665 6e74 5f6c 6f6f  ..    @event_loo
+00015190: 7028 290a 2020 2020 6465 6620 7465 7374  p().    def test
+000151a0: 5f66 6169 6c65 645f 666f 726d 6174 7469  _failed_formatti
+000151b0: 6e67 5f64 6f65 735f 6e6f 745f 6765 745f  ng_does_not_get_
+000151c0: 6361 6368 6564 2873 656c 6629 202d 3e20  cached(self) -> 
+000151d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+000151e0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+000151f0: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
+00015200: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
+00015210: 726b 7370 6163 652c 2070 6174 6368 280a  rkspace, patch(.
+00015220: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
+00015230: 6375 7272 656e 742e 6675 7475 7265 732e  current.futures.
+00015240: 5072 6f63 6573 7350 6f6f 6c45 7865 6375  ProcessPoolExecu
+00015250: 746f 7222 2c20 6e65 773d 5468 7265 6164  tor", new=Thread
+00015260: 506f 6f6c 4578 6563 7574 6f72 0a20 2020  PoolExecutor.   
+00015270: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00015280: 2020 2020 6661 696c 696e 6720 3d20 2877      failing = (w
+00015290: 6f72 6b73 7061 6365 202f 2022 6661 696c  orkspace / "fail
+000152a0: 696e 672e 7079 2229 2e72 6573 6f6c 7665  ing.py").resolve
+000152b0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+000152c0: 6169 6c69 6e67 2e77 7269 7465 5f74 6578  ailing.write_tex
+000152d0: 7428 226e 6f74 2061 6374 7561 6c6c 7920  t("not actually 
+000152e0: 7079 7468 6f6e 222c 2065 6e63 6f64 696e  python", encodin
+000152f0: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
+00015300: 2020 2020 2020 2063 6c65 616e 203d 2028         clean = (
+00015310: 776f 726b 7370 6163 6520 2f20 2263 6c65  workspace / "cle
+00015320: 616e 2e70 7922 292e 7265 736f 6c76 6528  an.py").resolve(
+00015330: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
+00015340: 6561 6e2e 7772 6974 655f 7465 7874 2827  ean.write_text('
+00015350: 7072 696e 7428 2268 656c 6c6f 2229 5c6e  print("hello")\n
+00015360: 272c 2065 6e63 6f64 696e 673d 2275 7466  ', encoding="utf
+00015370: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
+00015380: 2069 6e76 6f6b 6542 6c61 636b 285b 7374   invokeBlack([st
+00015390: 7228 776f 726b 7370 6163 6529 5d2c 2065  r(workspace)], e
+000153a0: 7869 745f 636f 6465 3d31 3233 290a 2020  xit_code=123).  
+000153b0: 2020 2020 2020 2020 2020 6361 6368 6520            cache 
+000153c0: 3d20 626c 6163 6b2e 7265 6164 5f63 6163  = black.read_cac
+000153d0: 6865 286d 6f64 6529 0a20 2020 2020 2020  he(mode).       
+000153e0: 2020 2020 2061 7373 6572 7420 7374 7228       assert str(
+000153f0: 6661 696c 696e 6729 206e 6f74 2069 6e20  failing) not in 
+00015400: 6361 6368 650a 2020 2020 2020 2020 2020  cache.          
+00015410: 2020 6173 7365 7274 2073 7472 2863 6c65    assert str(cle
+00015420: 616e 2920 696e 2063 6163 6865 0a0a 2020  an) in cache..  
+00015430: 2020 6465 6620 7465 7374 5f77 7269 7465    def test_write
+00015440: 5f63 6163 6865 5f77 7269 7465 5f66 6169  _cache_write_fai
+00015450: 6c28 7365 6c66 2920 2d3e 204e 6f6e 653a  l(self) -> None:
+00015460: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+00015470: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+00015480: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+00015490: 6469 7228 292c 2070 6174 6368 2e6f 626a  dir(), patch.obj
+000154a0: 6563 7428 5061 7468 2c20 226f 7065 6e22  ect(Path, "open"
+000154b0: 2920 6173 206d 6f63 6b3a 0a20 2020 2020  ) as mock:.     
+000154c0: 2020 2020 2020 206d 6f63 6b2e 7369 6465         mock.side
+000154d0: 5f65 6666 6563 7420 3d20 4f53 4572 726f  _effect = OSErro
+000154e0: 720a 2020 2020 2020 2020 2020 2020 626c  r.            bl
+000154f0: 6163 6b2e 7772 6974 655f 6361 6368 6528  ack.write_cache(
+00015500: 7b7d 2c20 5b5d 2c20 6d6f 6465 290a 0a20  {}, [], mode).. 
+00015510: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+00015520: 5f63 6163 6865 5f6c 696e 655f 6c65 6e67  _cache_line_leng
+00015530: 7468 7328 7365 6c66 2920 2d3e 204e 6f6e  ths(self) -> Non
+00015540: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+00015550: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+00015560: 2020 2020 2020 2073 686f 7274 5f6d 6f64         short_mod
+00015570: 6520 3d20 7265 706c 6163 6528 4445 4641  e = replace(DEFA
+00015580: 554c 545f 4d4f 4445 2c20 6c69 6e65 5f6c  ULT_MODE, line_l
+00015590: 656e 6774 683d 3129 0a20 2020 2020 2020  ength=1).       
+000155a0: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+000155b0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+000155c0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000155d0: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
+000155e0: 2266 696c 652e 7079 2229 2e72 6573 6f6c  "file.py").resol
+000155f0: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+00015600: 2070 6174 682e 746f 7563 6828 290a 2020   path.touch().  
+00015610: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00015620: 7772 6974 655f 6361 6368 6528 7b7d 2c20  write_cache({}, 
+00015630: 5b70 6174 685d 2c20 6d6f 6465 290a 2020  [path], mode).  
+00015640: 2020 2020 2020 2020 2020 6f6e 6520 3d20            one = 
+00015650: 626c 6163 6b2e 7265 6164 5f63 6163 6865  black.read_cache
+00015660: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+00015670: 2020 2061 7373 6572 7420 7374 7228 7061     assert str(pa
+00015680: 7468 2920 696e 206f 6e65 0a20 2020 2020  th) in one.     
+00015690: 2020 2020 2020 2074 776f 203d 2062 6c61         two = bla
+000156a0: 636b 2e72 6561 645f 6361 6368 6528 7368  ck.read_cache(sh
+000156b0: 6f72 745f 6d6f 6465 290a 2020 2020 2020  ort_mode).      
+000156c0: 2020 2020 2020 6173 7365 7274 2073 7472        assert str
+000156d0: 2870 6174 6829 206e 6f74 2069 6e20 7477  (path) not in tw
+000156e0: 6f0a 0a0a 6465 6620 6173 7365 7274 5f63  o...def assert_c
+000156f0: 6f6c 6c65 6374 6564 5f73 6f75 7263 6573  ollected_sources
+00015700: 280a 2020 2020 7372 633a 2053 6571 7565  (.    src: Seque
+00015710: 6e63 655b 556e 696f 6e5b 7374 722c 2050  nce[Union[str, P
+00015720: 6174 685d 5d2c 0a20 2020 2065 7870 6563  ath]],.    expec
+00015730: 7465 643a 2053 6571 7565 6e63 655b 556e  ted: Sequence[Un
+00015740: 696f 6e5b 7374 722c 2050 6174 685d 5d2c  ion[str, Path]],
+00015750: 0a20 2020 202a 2c0a 2020 2020 6374 783a  .    *,.    ctx:
+00015760: 204f 7074 696f 6e61 6c5b 4661 6b65 436f   Optional[FakeCo
+00015770: 6e74 6578 745d 203d 204e 6f6e 652c 0a20  ntext] = None,. 
+00015780: 2020 2065 7863 6c75 6465 3a20 4f70 7469     exclude: Opti
+00015790: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+000157a0: 2c0a 2020 2020 696e 636c 7564 653a 204f  ,.    include: O
+000157b0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+000157c0: 6f6e 652c 0a20 2020 2065 7874 656e 645f  one,.    extend_
+000157d0: 6578 636c 7564 653a 204f 7074 696f 6e61  exclude: Optiona
+000157e0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+000157f0: 2020 2066 6f72 6365 5f65 7863 6c75 6465     force_exclude
+00015800: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+00015810: 3d20 4e6f 6e65 2c0a 2020 2020 7374 6469  = None,.    stdi
+00015820: 6e5f 6669 6c65 6e61 6d65 3a20 4f70 7469  n_filename: Opti
+00015830: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00015840: 2c0a 2920 2d3e 204e 6f6e 653a 0a20 2020  ,.) -> None:.   
+00015850: 2067 735f 7372 6320 3d20 7475 706c 6528   gs_src = tuple(
+00015860: 7374 7228 5061 7468 2873 2929 2066 6f72  str(Path(s)) for
+00015870: 2073 2069 6e20 7372 6329 0a20 2020 2067   s in src).    g
+00015880: 735f 6578 7065 6374 6564 203d 205b 5061  s_expected = [Pa
+00015890: 7468 2873 2920 666f 7220 7320 696e 2065  th(s) for s in e
+000158a0: 7870 6563 7465 645d 0a20 2020 2067 735f  xpected].    gs_
+000158b0: 6578 636c 7564 6520 3d20 4e6f 6e65 2069  exclude = None i
+000158c0: 6620 6578 636c 7564 6520 6973 204e 6f6e  f exclude is Non
+000158d0: 6520 656c 7365 2063 6f6d 7069 6c65 5f70  e else compile_p
+000158e0: 6174 7465 726e 2865 7863 6c75 6465 290a  attern(exclude).
+000158f0: 2020 2020 6773 5f69 6e63 6c75 6465 203d      gs_include =
+00015900: 2044 4546 4155 4c54 5f49 4e43 4c55 4445   DEFAULT_INCLUDE
+00015910: 2069 6620 696e 636c 7564 6520 6973 204e   if include is N
+00015920: 6f6e 6520 656c 7365 2063 6f6d 7069 6c65  one else compile
+00015930: 5f70 6174 7465 726e 2869 6e63 6c75 6465  _pattern(include
+00015940: 290a 2020 2020 6773 5f65 7874 656e 645f  ).    gs_extend_
+00015950: 6578 636c 7564 6520 3d20 280a 2020 2020  exclude = (.    
+00015960: 2020 2020 4e6f 6e65 2069 6620 6578 7465      None if exte
+00015970: 6e64 5f65 7863 6c75 6465 2069 7320 4e6f  nd_exclude is No
+00015980: 6e65 2065 6c73 6520 636f 6d70 696c 655f  ne else compile_
+00015990: 7061 7474 6572 6e28 6578 7465 6e64 5f65  pattern(extend_e
+000159a0: 7863 6c75 6465 290a 2020 2020 290a 2020  xclude).    ).  
+000159b0: 2020 6773 5f66 6f72 6365 5f65 7863 6c75    gs_force_exclu
+000159c0: 6465 203d 204e 6f6e 6520 6966 2066 6f72  de = None if for
+000159d0: 6365 5f65 7863 6c75 6465 2069 7320 4e6f  ce_exclude is No
+000159e0: 6e65 2065 6c73 6520 636f 6d70 696c 655f  ne else compile_
+000159f0: 7061 7474 6572 6e28 666f 7263 655f 6578  pattern(force_ex
+00015a00: 636c 7564 6529 0a20 2020 2063 6f6c 6c65  clude).    colle
+00015a10: 6374 6564 203d 2062 6c61 636b 2e67 6574  cted = black.get
+00015a20: 5f73 6f75 7263 6573 280a 2020 2020 2020  _sources(.      
+00015a30: 2020 6374 783d 6374 7820 6f72 2046 616b    ctx=ctx or Fak
+00015a40: 6543 6f6e 7465 7874 2829 2c0a 2020 2020  eContext(),.    
+00015a50: 2020 2020 7372 633d 6773 5f73 7263 2c0a      src=gs_src,.
+00015a60: 2020 2020 2020 2020 7175 6965 743d 4661          quiet=Fa
+00015a70: 6c73 652c 0a20 2020 2020 2020 2076 6572  lse,.        ver
+00015a80: 626f 7365 3d46 616c 7365 2c0a 2020 2020  bose=False,.    
+00015a90: 2020 2020 696e 636c 7564 653d 6773 5f69      include=gs_i
+00015aa0: 6e63 6c75 6465 2c0a 2020 2020 2020 2020  nclude,.        
+00015ab0: 6578 636c 7564 653d 6773 5f65 7863 6c75  exclude=gs_exclu
+00015ac0: 6465 2c0a 2020 2020 2020 2020 6578 7465  de,.        exte
+00015ad0: 6e64 5f65 7863 6c75 6465 3d67 735f 6578  nd_exclude=gs_ex
+00015ae0: 7465 6e64 5f65 7863 6c75 6465 2c0a 2020  tend_exclude,.  
+00015af0: 2020 2020 2020 666f 7263 655f 6578 636c        force_excl
+00015b00: 7564 653d 6773 5f66 6f72 6365 5f65 7863  ude=gs_force_exc
+00015b10: 6c75 6465 2c0a 2020 2020 2020 2020 7265  lude,.        re
+00015b20: 706f 7274 3d62 6c61 636b 2e52 6570 6f72  port=black.Repor
+00015b30: 7428 292c 0a20 2020 2020 2020 2073 7464  t(),.        std
+00015b40: 696e 5f66 696c 656e 616d 653d 7374 6469  in_filename=stdi
+00015b50: 6e5f 6669 6c65 6e61 6d65 2c0a 2020 2020  n_filename,.    
+00015b60: 290a 2020 2020 6173 7365 7274 2073 6f72  ).    assert sor
+00015b70: 7465 6428 636f 6c6c 6563 7465 6429 203d  ted(collected) =
+00015b80: 3d20 736f 7274 6564 2867 735f 6578 7065  = sorted(gs_expe
+00015b90: 6374 6564 290a 0a0a 636c 6173 7320 5465  cted)...class Te
+00015ba0: 7374 4669 6c65 436f 6c6c 6563 7469 6f6e  stFileCollection
+00015bb0: 3a0a 2020 2020 6465 6620 7465 7374 5f69  :.    def test_i
+00015bc0: 6e63 6c75 6465 5f65 7863 6c75 6465 2873  nclude_exclude(s
+00015bd0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00015be0: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
+00015bf0: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
+00015c00: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
+00015c10: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
+00015c20: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
+00015c30: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00015c40: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
+00015c50: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00015c60: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
+00015c70: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+00015c80: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00015c90: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
+00015ca0: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
+00015cb0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+00015cc0: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+00015cd0: 2020 2020 2020 2020 2020 2020 7372 632c              src,
+00015ce0: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+00015cf0: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
+00015d00: 2020 2069 6e63 6c75 6465 3d72 225c 2e70     include=r"\.p
+00015d10: 7969 3f24 222c 0a20 2020 2020 2020 2020  yi?$",.         
+00015d20: 2020 2065 7863 6c75 6465 3d72 222f 6578     exclude=r"/ex
+00015d30: 636c 7564 652f 7c2f 5c2e 6465 6669 6e69  clude/|/\.defini
+00015d40: 7465 6c79 5f65 7863 6c75 6465 2f22 2c0a  tely_exclude/",.
+00015d50: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00015d60: 6566 2074 6573 745f 6769 7469 676e 6f72  ef test_gitignor
+00015d70: 655f 7573 6564 5f61 735f 6465 6661 756c  e_used_as_defaul
+00015d80: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
+00015d90: 0a20 2020 2020 2020 2062 6173 6520 3d20  .        base = 
+00015da0: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
+00015db0: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
+00015dc0: 5f74 6573 7473 2229 0a20 2020 2020 2020  _tests").       
+00015dd0: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
+00015de0: 2020 2020 2020 2020 2020 6261 7365 202f            base /
+00015df0: 2022 622f 2e64 6566 696e 6974 656c 795f   "b/.definitely_
+00015e00: 6578 636c 7564 652f 612e 7079 222c 0a20  exclude/a.py",. 
+00015e10: 2020 2020 2020 2020 2020 2062 6173 6520             base 
+00015e20: 2f20 2262 2f2e 6465 6669 6e69 7465 6c79  / "b/.definitely
+00015e30: 5f65 7863 6c75 6465 2f61 2e70 7969 222c  _exclude/a.pyi",
+00015e40: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00015e50: 2020 2073 7263 203d 205b 6261 7365 202f     src = [base /
+00015e60: 2022 622f 225d 0a20 2020 2020 2020 2063   "b/"].        c
+00015e70: 7478 203d 2046 616b 6543 6f6e 7465 7874  tx = FakeContext
+00015e80: 2829 0a20 2020 2020 2020 2063 7478 2e6f  ().        ctx.o
+00015e90: 626a 5b22 726f 6f74 225d 203d 2062 6173  bj["root"] = bas
+00015ea0: 650a 2020 2020 2020 2020 6173 7365 7274  e.        assert
+00015eb0: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
+00015ec0: 6573 2873 7263 2c20 6578 7065 6374 6564  es(src, expected
+00015ed0: 2c20 6374 783d 6374 782c 2065 7874 656e  , ctx=ctx, exten
+00015ee0: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
+00015ef0: 6c75 6465 2f22 290a 0a20 2020 2064 6566  lude/")..    def
+00015f00: 2074 6573 745f 6769 7469 676e 6f72 655f   test_gitignore_
+00015f10: 7573 6564 5f6f 6e5f 6d75 6c74 6970 6c65  used_on_multiple
+00015f20: 5f73 6f75 7263 6573 2873 656c 6629 202d  _sources(self) -
+00015f30: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00015f40: 726f 6f74 203d 2050 6174 6828 4441 5441  root = Path(DATA
+00015f50: 5f44 4952 202f 2022 6769 7469 676e 6f72  _DIR / "gitignor
+00015f60: 655f 7573 6564 5f6f 6e5f 6d75 6c74 6970  e_used_on_multip
+00015f70: 6c65 5f73 6f75 7263 6573 2229 0a20 2020  le_sources").   
+00015f80: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+00015f90: 5b0a 2020 2020 2020 2020 2020 2020 726f  [.            ro
+00015fa0: 6f74 202f 2022 6469 7231 2220 2f20 2262  ot / "dir1" / "b
+00015fb0: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
+00015fc0: 2020 726f 6f74 202f 2022 6469 7232 2220    root / "dir2" 
+00015fd0: 2f20 2262 2e70 7922 2c0a 2020 2020 2020  / "b.py",.      
+00015fe0: 2020 5d0a 2020 2020 2020 2020 6374 7820    ].        ctx 
+00015ff0: 3d20 4661 6b65 436f 6e74 6578 7428 290a  = FakeContext().
+00016000: 2020 2020 2020 2020 6374 782e 6f62 6a5b          ctx.obj[
+00016010: 2272 6f6f 7422 5d20 3d20 726f 6f74 0a20  "root"] = root. 
+00016020: 2020 2020 2020 2073 7263 203d 205b 726f         src = [ro
+00016030: 6f74 202f 2022 6469 7231 222c 2072 6f6f  ot / "dir1", roo
+00016040: 7420 2f20 2264 6972 3222 5d0a 2020 2020  t / "dir2"].    
+00016050: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+00016060: 6374 6564 5f73 6f75 7263 6573 2873 7263  cted_sources(src
+00016070: 2c20 6578 7065 6374 6564 2c20 6374 783d  , expected, ctx=
+00016080: 6374 7829 0a0a 2020 2020 4070 6174 6368  ctx)..    @patch
+00016090: 2822 626c 6163 6b2e 6669 6e64 5f70 726f  ("black.find_pro
+000160a0: 6a65 6374 5f72 6f6f 7422 2c20 6c61 6d62  ject_root", lamb
+000160b0: 6461 202a 6172 6773 3a20 2854 4849 535f  da *args: (THIS_
+000160c0: 4449 522e 7265 736f 6c76 6528 292c 204e  DIR.resolve(), N
+000160d0: 6f6e 6529 290a 2020 2020 6465 6620 7465  one)).    def te
+000160e0: 7374 5f65 7863 6c75 6465 5f66 6f72 5f69  st_exclude_for_i
+000160f0: 7373 7565 5f31 3537 3228 7365 6c66 2920  ssue_1572(self) 
+00016100: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00016110: 2023 2045 7863 6c75 6465 2073 686f 756c   # Exclude shoul
+00016120: 646e 2774 2074 6f75 6368 2066 696c 6573  dn't touch files
+00016130: 2074 6861 7420 7765 7265 2065 7870 6c69   that were expli
+00016140: 6369 746c 7920 6769 7665 6e20 746f 2042  citly given to B
+00016150: 6c61 636b 2074 6872 6f75 6768 2074 6865  lack through the
+00016160: 0a20 2020 2020 2020 2023 2043 4c49 2e20  .        # CLI. 
+00016170: 4578 636c 7564 6520 6973 2073 7570 706f  Exclude is suppo
+00016180: 7365 6420 746f 206f 6e6c 7920 6170 706c  sed to only appl
+00016190: 7920 746f 2074 6865 2072 6563 7572 7369  y to the recursi
+000161a0: 7665 2064 6973 636f 7665 7279 206f 6620  ve discovery of 
+000161b0: 6669 6c65 732e 0a20 2020 2020 2020 2023  files..        #
+000161c0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+000161d0: 636f 6d2f 7073 662f 626c 6163 6b2f 6973  com/psf/black/is
+000161e0: 7375 6573 2f31 3537 320a 2020 2020 2020  sues/1572.      
+000161f0: 2020 7061 7468 203d 2044 4154 415f 4449    path = DATA_DI
+00016200: 5220 2f20 2269 6e63 6c75 6465 5f65 7863  R / "include_exc
+00016210: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
+00016220: 2020 2020 7372 6320 3d20 5b70 6174 6820      src = [path 
+00016230: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+00016240: 7922 5d0a 2020 2020 2020 2020 6578 7065  y"].        expe
+00016250: 6374 6564 203d 205b 7061 7468 202f 2022  cted = [path / "
+00016260: 622f 6578 636c 7564 652f 612e 7079 225d  b/exclude/a.py"]
+00016270: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+00016280: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+00016290: 7328 7372 632c 2065 7870 6563 7465 642c  s(src, expected,
+000162a0: 2069 6e63 6c75 6465 3d22 222c 2065 7863   include="", exc
+000162b0: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
+000162c0: 7c61 5c2e 7079 2229 0a0a 2020 2020 6465  |a\.py")..    de
+000162d0: 6620 7465 7374 5f67 6974 6967 6e6f 7265  f test_gitignore
+000162e0: 5f65 7863 6c75 6465 2873 656c 6629 202d  _exclude(self) -
+000162f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00016300: 7061 7468 203d 2054 4849 535f 4449 5220  path = THIS_DIR 
+00016310: 2f20 2264 6174 6122 202f 2022 696e 636c  / "data" / "incl
+00016320: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
+00016330: 7322 0a20 2020 2020 2020 2069 6e63 6c75  s".        inclu
+00016340: 6465 203d 2072 652e 636f 6d70 696c 6528  de = re.compile(
+00016350: 7222 5c2e 7079 693f 2422 290a 2020 2020  r"\.pyi?$").    
+00016360: 2020 2020 6578 636c 7564 6520 3d20 7265      exclude = re
+00016370: 2e63 6f6d 7069 6c65 2872 2222 290a 2020  .compile(r"").  
+00016380: 2020 2020 2020 7265 706f 7274 203d 2062        report = b
+00016390: 6c61 636b 2e52 6570 6f72 7428 290a 2020  lack.Report().  
+000163a0: 2020 2020 2020 6769 7469 676e 6f72 6520        gitignore 
+000163b0: 3d20 5061 7468 5370 6563 2e66 726f 6d5f  = PathSpec.from_
+000163c0: 6c69 6e65 7328 0a20 2020 2020 2020 2020  lines(.         
+000163d0: 2020 2022 6769 7477 696c 646d 6174 6368     "gitwildmatch
+000163e0: 222c 205b 2265 7863 6c75 6465 2f22 2c20  ", ["exclude/", 
+000163f0: 222e 6465 6669 6e69 7465 6c79 5f65 7863  ".definitely_exc
+00016400: 6c75 6465 225d 0a20 2020 2020 2020 2029  lude"].        )
+00016410: 0a20 2020 2020 2020 2073 6f75 7263 6573  .        sources
+00016420: 3a20 4c69 7374 5b50 6174 685d 203d 205b  : List[Path] = [
+00016430: 5d0a 2020 2020 2020 2020 6578 7065 6374  ].        expect
+00016440: 6564 203d 205b 0a20 2020 2020 2020 2020  ed = [.         
+00016450: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00016460: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
+00016470: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00016480: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00016490: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
+000164a0: 2e70 7969 2229 2c0a 2020 2020 2020 2020  .pyi"),.        
+000164b0: 5d0a 2020 2020 2020 2020 7468 6973 5f61  ].        this_a
+000164c0: 6273 203d 2054 4849 535f 4449 522e 7265  bs = THIS_DIR.re
+000164d0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
+000164e0: 736f 7572 6365 732e 6578 7465 6e64 280a  sources.extend(.
+000164f0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00016500: 6b2e 6765 6e5f 7079 7468 6f6e 5f66 696c  k.gen_python_fil
+00016510: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00016520: 2020 2020 7061 7468 2e69 7465 7264 6972      path.iterdir
+00016530: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00016540: 2020 2020 7468 6973 5f61 6273 2c0a 2020      this_abs,.  
+00016550: 2020 2020 2020 2020 2020 2020 2020 696e                in
 00016560: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
-00016570: 2020 2020 2020 204e 6f6e 652c 0a20 2020         None,.   
-00016580: 2020 2020 2020 2020 2020 2020 204e 6f6e               Non
-00016590: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000165a0: 2020 2072 6570 6f72 742c 0a20 2020 2020     report,.     
-000165b0: 2020 2020 2020 2020 2020 207b 7061 7468             {path
-000165c0: 3a20 6769 7469 676e 6f72 657d 2c0a 2020  : gitignore},.  
-000165d0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-000165e0: 7262 6f73 653d 4661 6c73 652c 0a20 2020  rbose=False,.   
-000165f0: 2020 2020 2020 2020 2020 2020 2071 7569               qui
-00016600: 6574 3d46 616c 7365 2c0a 2020 2020 2020  et=False,.      
-00016610: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016620: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00016630: 2073 6f72 7465 6428 6578 7065 6374 6564   sorted(expected
-00016640: 2920 3d3d 2073 6f72 7465 6428 736f 7572  ) == sorted(sour
-00016650: 6365 7329 0a0a 2020 2020 6465 6620 7465  ces)..    def te
-00016660: 7374 5f6e 6573 7465 645f 6769 7469 676e  st_nested_gitign
-00016670: 6f72 6528 7365 6c66 2920 2d3e 204e 6f6e  ore(self) -> Non
-00016680: 653a 0a20 2020 2020 2020 2070 6174 6820  e:.        path 
-00016690: 3d20 5061 7468 2854 4849 535f 4449 5220  = Path(THIS_DIR 
-000166a0: 2f20 2264 6174 6122 202f 2022 6e65 7374  / "data" / "nest
-000166b0: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
-000166c0: 7473 2229 0a20 2020 2020 2020 2069 6e63  ts").        inc
-000166d0: 6c75 6465 203d 2072 652e 636f 6d70 696c  lude = re.compil
-000166e0: 6528 7222 5c2e 7079 693f 2422 290a 2020  e(r"\.pyi?$").  
-000166f0: 2020 2020 2020 6578 636c 7564 6520 3d20        exclude = 
-00016700: 7265 2e63 6f6d 7069 6c65 2872 2222 290a  re.compile(r"").
-00016710: 2020 2020 2020 2020 726f 6f74 5f67 6974          root_git
-00016720: 6967 6e6f 7265 203d 2062 6c61 636b 2e66  ignore = black.f
-00016730: 696c 6573 2e67 6574 5f67 6974 6967 6e6f  iles.get_gitigno
-00016740: 7265 2870 6174 6829 0a20 2020 2020 2020  re(path).       
-00016750: 2072 6570 6f72 7420 3d20 626c 6163 6b2e   report = black.
-00016760: 5265 706f 7274 2829 0a20 2020 2020 2020  Report().       
-00016770: 2065 7870 6563 7465 643a 204c 6973 745b   expected: List[
-00016780: 5061 7468 5d20 3d20 5b0a 2020 2020 2020  Path] = [.      
-00016790: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-000167a0: 2f20 2278 2e70 7922 292c 0a20 2020 2020  / "x.py"),.     
-000167b0: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
-000167c0: 202f 2022 726f 6f74 2f62 2e70 7922 292c   / "root/b.py"),
-000167d0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-000167e0: 6828 7061 7468 202f 2022 726f 6f74 2f63  h(path / "root/c
-000167f0: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
-00016800: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00016810: 726f 6f74 2f63 6869 6c64 2f63 2e70 7922  root/child/c.py"
-00016820: 292c 0a20 2020 2020 2020 205d 0a20 2020  ),.        ].   
-00016830: 2020 2020 2074 6869 735f 6162 7320 3d20       this_abs = 
-00016840: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
-00016850: 2829 0a20 2020 2020 2020 2073 6f75 7263  ().        sourc
-00016860: 6573 203d 206c 6973 7428 0a20 2020 2020  es = list(.     
-00016870: 2020 2020 2020 2062 6c61 636b 2e67 656e         black.gen
-00016880: 5f70 7974 686f 6e5f 6669 6c65 7328 0a20  _python_files(. 
-00016890: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000168a0: 6174 682e 6974 6572 6469 7228 292c 0a20  ath.iterdir(),. 
-000168b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000168c0: 6869 735f 6162 732c 0a20 2020 2020 2020  his_abs,.       
-000168d0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+00016570: 2020 2020 2020 2065 7863 6c75 6465 2c0a         exclude,.
+00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016590: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000165a0: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
+000165b0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000165c0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+000165d0: 2020 2020 7b70 6174 683a 2067 6974 6967      {path: gitig
+000165e0: 6e6f 7265 7d2c 0a20 2020 2020 2020 2020  nore},.         
+000165f0: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
+00016600: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00016610: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+00016620: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+00016630: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016640: 2020 2061 7373 6572 7420 736f 7274 6564     assert sorted
+00016650: 2865 7870 6563 7465 6429 203d 3d20 736f  (expected) == so
+00016660: 7274 6564 2873 6f75 7263 6573 290a 0a20  rted(sources).. 
+00016670: 2020 2064 6566 2074 6573 745f 6e65 7374     def test_nest
+00016680: 6564 5f67 6974 6967 6e6f 7265 2873 656c  ed_gitignore(sel
+00016690: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000166a0: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+000166b0: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
+000166c0: 2220 2f20 226e 6573 7465 645f 6769 7469  " / "nested_giti
+000166d0: 676e 6f72 655f 7465 7374 7322 290a 2020  gnore_tests").  
+000166e0: 2020 2020 2020 696e 636c 7564 6520 3d20        include = 
+000166f0: 7265 2e63 6f6d 7069 6c65 2872 225c 2e70  re.compile(r"\.p
+00016700: 7969 3f24 2229 0a20 2020 2020 2020 2065  yi?$").        e
+00016710: 7863 6c75 6465 203d 2072 652e 636f 6d70  xclude = re.comp
+00016720: 696c 6528 7222 2229 0a20 2020 2020 2020  ile(r"").       
+00016730: 2072 6f6f 745f 6769 7469 676e 6f72 6520   root_gitignore 
+00016740: 3d20 626c 6163 6b2e 6669 6c65 732e 6765  = black.files.ge
+00016750: 745f 6769 7469 676e 6f72 6528 7061 7468  t_gitignore(path
+00016760: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
+00016770: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
+00016780: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
+00016790: 6564 3a20 4c69 7374 5b50 6174 685d 203d  ed: List[Path] =
+000167a0: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
+000167b0: 6174 6828 7061 7468 202f 2022 782e 7079  ath(path / "x.py
+000167c0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+000167d0: 5061 7468 2870 6174 6820 2f20 2272 6f6f  Path(path / "roo
+000167e0: 742f 622e 7079 2229 2c0a 2020 2020 2020  t/b.py"),.      
+000167f0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00016800: 2f20 2272 6f6f 742f 632e 7079 2229 2c0a  / "root/c.py"),.
+00016810: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00016820: 2870 6174 6820 2f20 2272 6f6f 742f 6368  (path / "root/ch
+00016830: 696c 642f 632e 7079 2229 2c0a 2020 2020  ild/c.py"),.    
+00016840: 2020 2020 5d0a 2020 2020 2020 2020 7468      ].        th
+00016850: 6973 5f61 6273 203d 2054 4849 535f 4449  is_abs = THIS_DI
+00016860: 522e 7265 736f 6c76 6528 290a 2020 2020  R.resolve().    
+00016870: 2020 2020 736f 7572 6365 7320 3d20 6c69      sources = li
+00016880: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
+00016890: 626c 6163 6b2e 6765 6e5f 7079 7468 6f6e  black.gen_python
+000168a0: 5f66 696c 6573 280a 2020 2020 2020 2020  _files(.        
+000168b0: 2020 2020 2020 2020 7061 7468 2e69 7465          path.ite
+000168c0: 7264 6972 2829 2c0a 2020 2020 2020 2020  rdir(),.        
+000168d0: 2020 2020 2020 2020 7468 6973 5f61 6273          this_abs
 000168e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000168f0: 2020 6578 636c 7564 652c 0a20 2020 2020    exclude,.     
-00016900: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
-00016910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016920: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00016930: 2020 2020 2020 2072 6570 6f72 742c 0a20         report,. 
-00016940: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00016950: 7061 7468 3a20 726f 6f74 5f67 6974 6967  path: root_gitig
-00016960: 6e6f 7265 7d2c 0a20 2020 2020 2020 2020  nore},.         
-00016970: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
-00016980: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00016990: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
-000169a0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-000169b0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000169c0: 2020 2061 7373 6572 7420 736f 7274 6564     assert sorted
-000169d0: 2865 7870 6563 7465 6429 203d 3d20 736f  (expected) == so
-000169e0: 7274 6564 2873 6f75 7263 6573 290a 0a20  rted(sources).. 
-000169f0: 2020 2064 6566 2074 6573 745f 6e65 7374     def test_nest
-00016a00: 6564 5f67 6974 6967 6e6f 7265 5f64 6972  ed_gitignore_dir
-00016a10: 6563 746c 795f 696e 5f73 6f75 7263 655f  ectly_in_source_
-00016a20: 6469 7265 6374 6f72 7928 7365 6c66 2920  directory(self) 
-00016a30: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00016a40: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
-00016a50: 622e 636f 6d2f 7073 662f 626c 6163 6b2f  b.com/psf/black/
-00016a60: 6973 7375 6573 2f32 3539 380a 2020 2020  issues/2598.    
-00016a70: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-00016a80: 4441 5441 5f44 4952 202f 2022 6e65 7374  DATA_DIR / "nest
-00016a90: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
-00016aa0: 7473 2229 0a20 2020 2020 2020 2073 7263  ts").        src
-00016ab0: 203d 2050 6174 6828 7061 7468 202f 2022   = Path(path / "
-00016ac0: 726f 6f74 2220 2f20 2263 6869 6c64 2229  root" / "child")
-00016ad0: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
-00016ae0: 6420 3d20 5b73 7263 202f 2022 612e 7079  d = [src / "a.py
-00016af0: 222c 2073 7263 202f 2022 632e 7079 225d  ", src / "c.py"]
-00016b00: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
-00016b10: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
-00016b20: 7328 5b73 7263 5d2c 2065 7870 6563 7465  s([src], expecte
-00016b30: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
-00016b40: 5f69 6e76 616c 6964 5f67 6974 6967 6e6f  _invalid_gitigno
-00016b50: 7265 2873 656c 6629 202d 3e20 4e6f 6e65  re(self) -> None
-00016b60: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
-00016b70: 2054 4849 535f 4449 5220 2f20 2264 6174   THIS_DIR / "dat
-00016b80: 6122 202f 2022 696e 7661 6c69 645f 6769  a" / "invalid_gi
-00016b90: 7469 676e 6f72 655f 7465 7374 7322 0a20  tignore_tests". 
-00016ba0: 2020 2020 2020 2065 6d70 7479 5f63 6f6e         empty_con
-00016bb0: 6669 6720 3d20 7061 7468 202f 2022 7079  fig = path / "py
-00016bc0: 7072 6f6a 6563 742e 746f 6d6c 220a 2020  project.toml".  
-00016bd0: 2020 2020 2020 7265 7375 6c74 203d 2042        result = B
-00016be0: 6c61 636b 5275 6e6e 6572 2829 2e69 6e76  lackRunner().inv
-00016bf0: 6f6b 6528 0a20 2020 2020 2020 2020 2020  oke(.           
-00016c00: 2062 6c61 636b 2e6d 6169 6e2c 205b 222d   black.main, ["-
-00016c10: 2d76 6572 626f 7365 222c 2022 2d2d 636f  -verbose", "--co
-00016c20: 6e66 6967 222c 2073 7472 2865 6d70 7479  nfig", str(empty
-00016c30: 5f63 6f6e 6669 6729 2c20 7374 7228 7061  _config), str(pa
-00016c40: 7468 295d 0a20 2020 2020 2020 2029 0a20  th)].        ). 
-00016c50: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
-00016c60: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
-00016c70: 3d20 310a 2020 2020 2020 2020 6173 7365  = 1.        asse
-00016c80: 7274 2072 6573 756c 742e 7374 6465 7272  rt result.stderr
-00016c90: 5f62 7974 6573 2069 7320 6e6f 7420 4e6f  _bytes is not No
-00016ca0: 6e65 0a0a 2020 2020 2020 2020 6769 7469  ne..        giti
-00016cb0: 676e 6f72 6520 3d20 7061 7468 202f 2022  gnore = path / "
-00016cc0: 2e67 6974 6967 6e6f 7265 220a 2020 2020  .gitignore".    
-00016cd0: 2020 2020 6173 7365 7274 2066 2243 6f75      assert f"Cou
-00016ce0: 6c64 206e 6f74 2070 6172 7365 207b 6769  ld not parse {gi
-00016cf0: 7469 676e 6f72 657d 2220 696e 2072 6573  tignore}" in res
-00016d00: 756c 742e 7374 6465 7272 5f62 7974 6573  ult.stderr_bytes
-00016d10: 2e64 6563 6f64 6528 290a 0a20 2020 2064  .decode()..    d
-00016d20: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
-00016d30: 6e65 7374 6564 5f67 6974 6967 6e6f 7265  nested_gitignore
-00016d40: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00016d50: 2020 2020 2020 2020 7061 7468 203d 2054          path = T
-00016d60: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
-00016d70: 202f 2022 696e 7661 6c69 645f 6e65 7374   / "invalid_nest
-00016d80: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
-00016d90: 7473 220a 2020 2020 2020 2020 656d 7074  ts".        empt
-00016da0: 795f 636f 6e66 6967 203d 2070 6174 6820  y_config = path 
-00016db0: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
-00016dc0: 6c22 0a20 2020 2020 2020 2072 6573 756c  l".        resul
-00016dd0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
-00016de0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
-00016df0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
-00016e00: 2c20 5b22 2d2d 7665 7262 6f73 6522 2c20  , ["--verbose", 
-00016e10: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
-00016e20: 656d 7074 795f 636f 6e66 6967 292c 2073  empty_config), s
-00016e30: 7472 2870 6174 6829 5d0a 2020 2020 2020  tr(path)].      
-00016e40: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
-00016e50: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-00016e60: 6f64 6520 3d3d 2031 0a20 2020 2020 2020  ode == 1.       
-00016e70: 2061 7373 6572 7420 7265 7375 6c74 2e73   assert result.s
-00016e80: 7464 6572 725f 6279 7465 7320 6973 206e  tderr_bytes is n
-00016e90: 6f74 204e 6f6e 650a 0a20 2020 2020 2020  ot None..       
-00016ea0: 2067 6974 6967 6e6f 7265 203d 2070 6174   gitignore = pat
-00016eb0: 6820 2f20 2261 2220 2f20 222e 6769 7469  h / "a" / ".giti
-00016ec0: 676e 6f72 6522 0a20 2020 2020 2020 2061  gnore".        a
-00016ed0: 7373 6572 7420 6622 436f 756c 6420 6e6f  ssert f"Could no
-00016ee0: 7420 7061 7273 6520 7b67 6974 6967 6e6f  t parse {gitigno
-00016ef0: 7265 7d22 2069 6e20 7265 7375 6c74 2e73  re}" in result.s
-00016f00: 7464 6572 725f 6279 7465 732e 6465 636f  tderr_bytes.deco
-00016f10: 6465 2829 0a0a 2020 2020 6465 6620 7465  de()..    def te
-00016f20: 7374 5f67 6974 6967 6e6f 7265 5f74 6861  st_gitignore_tha
-00016f30: 745f 6967 6e6f 7265 735f 7375 6266 6f6c  t_ignores_subfol
-00016f40: 6465 7273 2873 656c 6629 202d 3e20 4e6f  ders(self) -> No
-00016f50: 6e65 3a0a 2020 2020 2020 2020 2320 4966  ne:.        # If
-00016f60: 2067 6974 6967 6e6f 7265 2077 6974 6820   gitignore with 
-00016f70: 2a2f 2a20 6973 2069 6e20 726f 6f74 0a20  */* is in root. 
-00016f80: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-00016f90: 7468 2844 4154 415f 4449 5220 2f20 2269  th(DATA_DIR / "i
-00016fa0: 676e 6f72 655f 7375 6266 6f6c 6465 7273  gnore_subfolders
-00016fb0: 5f67 6974 6967 6e6f 7265 5f74 6573 7473  _gitignore_tests
-00016fc0: 2220 2f20 2273 7562 6469 7222 290a 2020  " / "subdir").  
-00016fd0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00016fe0: 205b 726f 6f74 202f 2022 622e 7079 225d   [root / "b.py"]
-00016ff0: 0a20 2020 2020 2020 2063 7478 203d 2046  .        ctx = F
-00017000: 616b 6543 6f6e 7465 7874 2829 0a20 2020  akeContext().   
-00017010: 2020 2020 2063 7478 2e6f 626a 5b22 726f       ctx.obj["ro
-00017020: 6f74 225d 203d 2072 6f6f 740a 2020 2020  ot"] = root.    
-00017030: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00017040: 6374 6564 5f73 6f75 7263 6573 285b 726f  cted_sources([ro
-00017050: 6f74 5d2c 2065 7870 6563 7465 642c 2063  ot], expected, c
-00017060: 7478 3d63 7478 290a 0a20 2020 2020 2020  tx=ctx)..       
-00017070: 2023 2049 6620 2e67 6974 6967 6e6f 7265   # If .gitignore
-00017080: 2077 6974 6820 2a2f 2a20 6973 206e 6573   with */* is nes
-00017090: 7465 640a 2020 2020 2020 2020 726f 6f74  ted.        root
-000170a0: 203d 2050 6174 6828 4441 5441 5f44 4952   = Path(DATA_DIR
-000170b0: 202f 2022 6967 6e6f 7265 5f73 7562 666f   / "ignore_subfo
-000170c0: 6c64 6572 735f 6769 7469 676e 6f72 655f  lders_gitignore_
-000170d0: 7465 7374 7322 290a 2020 2020 2020 2020  tests").        
-000170e0: 6578 7065 6374 6564 203d 205b 0a20 2020  expected = [.   
-000170f0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
-00017100: 2261 2e70 7922 2c0a 2020 2020 2020 2020  "a.py",.        
-00017110: 2020 2020 726f 6f74 202f 2022 7375 6264      root / "subd
-00017120: 6972 2220 2f20 2262 2e70 7922 2c0a 2020  ir" / "b.py",.  
-00017130: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00017140: 6374 7820 3d20 4661 6b65 436f 6e74 6578  ctx = FakeContex
-00017150: 7428 290a 2020 2020 2020 2020 6374 782e  t().        ctx.
-00017160: 6f62 6a5b 2272 6f6f 7422 5d20 3d20 726f  obj["root"] = ro
-00017170: 6f74 0a20 2020 2020 2020 2061 7373 6572  ot.        asser
-00017180: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-00017190: 6365 7328 5b72 6f6f 745d 2c20 6578 7065  ces([root], expe
-000171a0: 6374 6564 2c20 6374 783d 6374 7829 0a0a  cted, ctx=ctx)..
-000171b0: 2020 2020 2020 2020 2320 4966 2063 6f6d          # If com
-000171c0: 6d61 6e64 2069 7320 6578 6563 7574 6564  mand is executed
-000171d0: 2066 726f 6d20 6f75 7465 7220 6469 720a   from outer dir.
-000171e0: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
-000171f0: 6174 6828 4441 5441 5f44 4952 202f 2022  ath(DATA_DIR / "
-00017200: 6967 6e6f 7265 5f73 7562 666f 6c64 6572  ignore_subfolder
-00017210: 735f 6769 7469 676e 6f72 655f 7465 7374  s_gitignore_test
-00017220: 7322 290a 2020 2020 2020 2020 7461 7267  s").        targ
-00017230: 6574 203d 2072 6f6f 7420 2f20 2273 7562  et = root / "sub
-00017240: 6469 7222 0a20 2020 2020 2020 2065 7870  dir".        exp
-00017250: 6563 7465 6420 3d20 5b74 6172 6765 7420  ected = [target 
-00017260: 2f20 2262 2e70 7922 5d0a 2020 2020 2020  / "b.py"].      
-00017270: 2020 6374 7820 3d20 4661 6b65 436f 6e74    ctx = FakeCont
-00017280: 6578 7428 290a 2020 2020 2020 2020 6374  ext().        ct
-00017290: 782e 6f62 6a5b 2272 6f6f 7422 5d20 3d20  x.obj["root"] = 
-000172a0: 726f 6f74 0a20 2020 2020 2020 2061 7373  root.        ass
-000172b0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-000172c0: 7572 6365 7328 5b74 6172 6765 745d 2c20  urces([target], 
-000172d0: 6578 7065 6374 6564 2c20 6374 783d 6374  expected, ctx=ct
-000172e0: 7829 0a0a 2020 2020 6465 6620 7465 7374  x)..    def test
-000172f0: 5f65 6d70 7479 5f69 6e63 6c75 6465 2873  _empty_include(s
-00017300: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00017310: 2020 2020 2020 7061 7468 203d 2044 4154        path = DAT
-00017320: 415f 4449 5220 2f20 2269 6e63 6c75 6465  A_DIR / "include
-00017330: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
-00017340: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
-00017350: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
-00017360: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
-00017370: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-00017380: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-00017390: 6965 2229 2c0a 2020 2020 2020 2020 2020  ie"),.          
-000173a0: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-000173b0: 2f65 7863 6c75 6465 2f61 2e70 7922 292c  /exclude/a.py"),
-000173c0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-000173d0: 6828 7061 7468 202f 2022 622f 6578 636c  h(path / "b/excl
-000173e0: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
-000173f0: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
-00017400: 7468 202f 2022 622f 646f 6e74 5f65 7863  th / "b/dont_exc
-00017410: 6c75 6465 2f61 2e70 6965 2229 2c0a 2020  lude/a.pie"),.  
-00017420: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00017430: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00017440: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-00017450: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00017460: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00017470: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
-00017480: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00017490: 7061 7468 202f 2022 622f 2e64 6566 696e  path / "b/.defin
-000174a0: 6974 656c 795f 6578 636c 7564 652f 612e  itely_exclude/a.
-000174b0: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
-000174c0: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-000174d0: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
-000174e0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-000174f0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00017500: 6174 6820 2f20 2262 2f2e 6465 6669 6e69  ath / "b/.defini
-00017510: 7465 6c79 5f65 7863 6c75 6465 2f61 2e70  tely_exclude/a.p
-00017520: 7969 2229 2c0a 2020 2020 2020 2020 2020  yi"),.          
-00017530: 2020 5061 7468 2870 6174 6820 2f20 222e    Path(path / ".
-00017540: 6769 7469 676e 6f72 6522 292c 0a20 2020  gitignore"),.   
-00017550: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
-00017560: 7468 202f 2022 7079 7072 6f6a 6563 742e  th / "pyproject.
-00017570: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
-00017580: 5d0a 2020 2020 2020 2020 2320 5365 7474  ].        # Sett
-00017590: 696e 6720 6578 636c 7564 6520 6578 706c  ing exclude expl
-000175a0: 6963 6974 6c79 2074 6f20 616e 2065 6d70  icitly to an emp
-000175b0: 7479 2073 7472 696e 6720 746f 2062 6c6f  ty string to blo
-000175c0: 636b 202e 6769 7469 676e 6f72 6520 7573  ck .gitignore us
-000175d0: 6167 652e 0a20 2020 2020 2020 2061 7373  age..        ass
-000175e0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-000175f0: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
-00017600: 7465 642c 2069 6e63 6c75 6465 3d22 222c  ted, include="",
-00017610: 2065 7863 6c75 6465 3d22 2229 0a0a 2020   exclude="")..  
-00017620: 2020 6465 6620 7465 7374 5f65 7874 656e    def test_exten
-00017630: 645f 6578 636c 7564 6528 7365 6c66 2920  d_exclude(self) 
-00017640: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00017650: 2070 6174 6820 3d20 4441 5441 5f44 4952   path = DATA_DIR
-00017660: 202f 2022 696e 636c 7564 655f 6578 636c   / "include_excl
-00017670: 7564 655f 7465 7374 7322 0a20 2020 2020  ude_tests".     
-00017680: 2020 2073 7263 203d 205b 7061 7468 5d0a     src = [path].
-00017690: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-000176a0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-000176b0: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-000176c0: 6578 636c 7564 652f 612e 7079 2229 2c0a  exclude/a.py"),.
-000176d0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-000176e0: 2870 6174 6820 2f20 2262 2f64 6f6e 745f  (path / "b/dont_
-000176f0: 6578 636c 7564 652f 612e 7079 2229 2c0a  exclude/a.py"),.
-00017700: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00017710: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-00017720: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
-00017730: 2020 2020 2020 2020 7372 632c 2065 7870          src, exp
-00017740: 6563 7465 642c 2065 7863 6c75 6465 3d72  ected, exclude=r
-00017750: 225c 2e70 7969 2422 2c20 6578 7465 6e64  "\.pyi$", extend
-00017760: 5f65 7863 6c75 6465 3d72 225c 2e64 6566  _exclude=r"\.def
-00017770: 696e 6974 656c 795f 6578 636c 7564 6522  initely_exclude"
-00017780: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00017790: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
-000177a0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
-000177b0: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
-000177c0: 745f 7379 6d6c 696e 6b5f 6f75 745f 6f66  t_symlink_out_of
-000177d0: 5f72 6f6f 745f 6469 7265 6374 6f72 7928  _root_directory(
-000177e0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000177f0: 2020 2020 2020 2070 6174 6820 3d20 4d61         path = Ma
-00017800: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
-00017810: 2020 726f 6f74 203d 2054 4849 535f 4449    root = THIS_DI
-00017820: 522e 7265 736f 6c76 6528 290a 2020 2020  R.resolve().    
-00017830: 2020 2020 6368 696c 6420 3d20 4d61 6769      child = Magi
-00017840: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-00017850: 696e 636c 7564 6520 3d20 7265 2e63 6f6d  include = re.com
-00017860: 7069 6c65 2862 6c61 636b 2e44 4546 4155  pile(black.DEFAU
-00017870: 4c54 5f49 4e43 4c55 4445 5329 0a20 2020  LT_INCLUDES).   
-00017880: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
-00017890: 652e 636f 6d70 696c 6528 626c 6163 6b2e  e.compile(black.
-000178a0: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
-000178b0: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
-000178c0: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
-000178d0: 290a 2020 2020 2020 2020 6769 7469 676e  ).        gitign
-000178e0: 6f72 6520 3d20 5061 7468 5370 6563 2e66  ore = PathSpec.f
-000178f0: 726f 6d5f 6c69 6e65 7328 2267 6974 7769  rom_lines("gitwi
-00017900: 6c64 6d61 7463 6822 2c20 5b5d 290a 2020  ldmatch", []).  
-00017910: 2020 2020 2020 2320 6063 6869 6c64 6020        # `child` 
-00017920: 7368 6f75 6c64 2062 6568 6176 6520 6c69  should behave li
-00017930: 6b65 2061 2073 796d 6c69 6e6b 2077 6869  ke a symlink whi
-00017940: 6368 2072 6573 6f6c 7665 6420 7061 7468  ch resolved path
-00017950: 2069 7320 636c 6561 726c 790a 2020 2020   is clearly.    
-00017960: 2020 2020 2320 6f75 7473 6964 6520 6f66      # outside of
-00017970: 2074 6865 2060 726f 6f74 6020 6469 7265   the `root` dire
-00017980: 6374 6f72 792e 0a20 2020 2020 2020 2070  ctory..        p
-00017990: 6174 682e 6974 6572 6469 722e 7265 7475  ath.iterdir.retu
-000179a0: 726e 5f76 616c 7565 203d 205b 6368 696c  rn_value = [chil
-000179b0: 645d 0a20 2020 2020 2020 2063 6869 6c64  d].        child
-000179c0: 2e72 6573 6f6c 7665 2e72 6574 7572 6e5f  .resolve.return_
-000179d0: 7661 6c75 6520 3d20 5061 7468 2822 2f61  value = Path("/a
-000179e0: 2f62 2f63 2229 0a20 2020 2020 2020 2063  /b/c").        c
-000179f0: 6869 6c64 2e61 735f 706f 7369 782e 7265  hild.as_posix.re
-00017a00: 7475 726e 5f76 616c 7565 203d 2022 2f61  turn_value = "/a
-00017a10: 2f62 2f63 220a 2020 2020 2020 2020 7472  /b/c".        tr
-00017a20: 793a 0a20 2020 2020 2020 2020 2020 206c  y:.            l
-00017a30: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
-00017a40: 2020 2020 2062 6c61 636b 2e67 656e 5f70       black.gen_p
-00017a50: 7974 686f 6e5f 6669 6c65 7328 0a20 2020  ython_files(.   
-00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a70: 2070 6174 682e 6974 6572 6469 7228 292c   path.iterdir(),
-00017a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017a90: 2020 2020 2072 6f6f 742c 0a20 2020 2020       root,.     
-00017aa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017ab0: 6e63 6c75 6465 2c0a 2020 2020 2020 2020  nclude,.        
-00017ac0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-00017ad0: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
-00017ae0: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+000168f0: 2020 696e 636c 7564 652c 0a20 2020 2020    include,.     
+00016900: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00016910: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00016920: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
+00016930: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
+00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016950: 7265 706f 7274 2c0a 2020 2020 2020 2020  report,.        
+00016960: 2020 2020 2020 2020 7b70 6174 683a 2072          {path: r
+00016970: 6f6f 745f 6769 7469 676e 6f72 657d 2c0a  oot_gitignore},.
+00016980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016990: 7665 7262 6f73 653d 4661 6c73 652c 0a20  verbose=False,. 
+000169a0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+000169b0: 7569 6574 3d46 616c 7365 2c0a 2020 2020  uiet=False,.    
+000169c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000169d0: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
+000169e0: 7274 2073 6f72 7465 6428 6578 7065 6374  rt sorted(expect
+000169f0: 6564 2920 3d3d 2073 6f72 7465 6428 736f  ed) == sorted(so
+00016a00: 7572 6365 7329 0a0a 2020 2020 6465 6620  urces)..    def 
+00016a10: 7465 7374 5f6e 6573 7465 645f 6769 7469  test_nested_giti
+00016a20: 676e 6f72 655f 6469 7265 6374 6c79 5f69  gnore_directly_i
+00016a30: 6e5f 736f 7572 6365 5f64 6972 6563 746f  n_source_directo
+00016a40: 7279 2873 656c 6629 202d 3e20 4e6f 6e65  ry(self) -> None
+00016a50: 3a0a 2020 2020 2020 2020 2320 6874 7470  :.        # http
+00016a60: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+00016a70: 7366 2f62 6c61 636b 2f69 7373 7565 732f  sf/black/issues/
+00016a80: 3235 3938 0a20 2020 2020 2020 2070 6174  2598.        pat
+00016a90: 6820 3d20 5061 7468 2844 4154 415f 4449  h = Path(DATA_DI
+00016aa0: 5220 2f20 226e 6573 7465 645f 6769 7469  R / "nested_giti
+00016ab0: 676e 6f72 655f 7465 7374 7322 290a 2020  gnore_tests").  
+00016ac0: 2020 2020 2020 7372 6320 3d20 5061 7468        src = Path
+00016ad0: 2870 6174 6820 2f20 2272 6f6f 7422 202f  (path / "root" /
+00016ae0: 2022 6368 696c 6422 290a 2020 2020 2020   "child").      
+00016af0: 2020 6578 7065 6374 6564 203d 205b 7372    expected = [sr
+00016b00: 6320 2f20 2261 2e70 7922 2c20 7372 6320  c / "a.py", src 
+00016b10: 2f20 2263 2e70 7922 5d0a 2020 2020 2020  / "c.py"].      
+00016b20: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+00016b30: 6564 5f73 6f75 7263 6573 285b 7372 635d  ed_sources([src]
+00016b40: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
+00016b50: 2064 6566 2074 6573 745f 696e 7661 6c69   def test_invali
+00016b60: 645f 6769 7469 676e 6f72 6528 7365 6c66  d_gitignore(self
+00016b70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00016b80: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
+00016b90: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
+00016ba0: 6e76 616c 6964 5f67 6974 6967 6e6f 7265  nvalid_gitignore
+00016bb0: 5f74 6573 7473 220a 2020 2020 2020 2020  _tests".        
+00016bc0: 656d 7074 795f 636f 6e66 6967 203d 2070  empty_config = p
+00016bd0: 6174 6820 2f20 2270 7970 726f 6a65 6374  ath / "pyproject
+00016be0: 2e74 6f6d 6c22 0a20 2020 2020 2020 2072  .toml".        r
+00016bf0: 6573 756c 7420 3d20 426c 6163 6b52 756e  esult = BlackRun
+00016c00: 6e65 7228 292e 696e 766f 6b65 280a 2020  ner().invoke(.  
+00016c10: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00016c20: 6d61 696e 2c20 5b22 2d2d 7665 7262 6f73  main, ["--verbos
+00016c30: 6522 2c20 222d 2d63 6f6e 6669 6722 2c20  e", "--config", 
+00016c40: 7374 7228 656d 7074 795f 636f 6e66 6967  str(empty_config
+00016c50: 292c 2073 7472 2870 6174 6829 5d0a 2020  ), str(path)].  
+00016c60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00016c70: 6173 7365 7274 2072 6573 756c 742e 6578  assert result.ex
+00016c80: 6974 5f63 6f64 6520 3d3d 2031 0a20 2020  it_code == 1.   
+00016c90: 2020 2020 2061 7373 6572 7420 7265 7375       assert resu
+00016ca0: 6c74 2e73 7464 6572 725f 6279 7465 7320  lt.stderr_bytes 
+00016cb0: 6973 206e 6f74 204e 6f6e 650a 0a20 2020  is not None..   
+00016cc0: 2020 2020 2067 6974 6967 6e6f 7265 203d       gitignore =
+00016cd0: 2070 6174 6820 2f20 222e 6769 7469 676e   path / ".gitign
+00016ce0: 6f72 6522 0a20 2020 2020 2020 2061 7373  ore".        ass
+00016cf0: 6572 7420 6622 436f 756c 6420 6e6f 7420  ert f"Could not 
+00016d00: 7061 7273 6520 7b67 6974 6967 6e6f 7265  parse {gitignore
+00016d10: 7d22 2069 6e20 7265 7375 6c74 2e73 7464  }" in result.std
+00016d20: 6572 725f 6279 7465 732e 6465 636f 6465  err_bytes.decode
+00016d30: 2829 0a0a 2020 2020 6465 6620 7465 7374  ()..    def test
+00016d40: 5f69 6e76 616c 6964 5f6e 6573 7465 645f  _invalid_nested_
+00016d50: 6769 7469 676e 6f72 6528 7365 6c66 2920  gitignore(self) 
+00016d60: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00016d70: 2070 6174 6820 3d20 5448 4953 5f44 4952   path = THIS_DIR
+00016d80: 202f 2022 6461 7461 2220 2f20 2269 6e76   / "data" / "inv
+00016d90: 616c 6964 5f6e 6573 7465 645f 6769 7469  alid_nested_giti
+00016da0: 676e 6f72 655f 7465 7374 7322 0a20 2020  gnore_tests".   
+00016db0: 2020 2020 2065 6d70 7479 5f63 6f6e 6669       empty_confi
+00016dc0: 6720 3d20 7061 7468 202f 2022 7079 7072  g = path / "pypr
+00016dd0: 6f6a 6563 742e 746f 6d6c 220a 2020 2020  oject.toml".    
+00016de0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
+00016df0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
+00016e00: 6528 0a20 2020 2020 2020 2020 2020 2062  e(.            b
+00016e10: 6c61 636b 2e6d 6169 6e2c 205b 222d 2d76  lack.main, ["--v
+00016e20: 6572 626f 7365 222c 2022 2d2d 636f 6e66  erbose", "--conf
+00016e30: 6967 222c 2073 7472 2865 6d70 7479 5f63  ig", str(empty_c
+00016e40: 6f6e 6669 6729 2c20 7374 7228 7061 7468  onfig), str(path
+00016e50: 295d 0a20 2020 2020 2020 2029 0a20 2020  )].        ).   
+00016e60: 2020 2020 2061 7373 6572 7420 7265 7375       assert resu
+00016e70: 6c74 2e65 7869 745f 636f 6465 203d 3d20  lt.exit_code == 
+00016e80: 310a 2020 2020 2020 2020 6173 7365 7274  1.        assert
+00016e90: 2072 6573 756c 742e 7374 6465 7272 5f62   result.stderr_b
+00016ea0: 7974 6573 2069 7320 6e6f 7420 4e6f 6e65  ytes is not None
+00016eb0: 0a0a 2020 2020 2020 2020 6769 7469 676e  ..        gitign
+00016ec0: 6f72 6520 3d20 7061 7468 202f 2022 6122  ore = path / "a"
+00016ed0: 202f 2022 2e67 6974 6967 6e6f 7265 220a   / ".gitignore".
+00016ee0: 2020 2020 2020 2020 6173 7365 7274 2066          assert f
+00016ef0: 2243 6f75 6c64 206e 6f74 2070 6172 7365  "Could not parse
+00016f00: 207b 6769 7469 676e 6f72 657d 2220 696e   {gitignore}" in
+00016f10: 2072 6573 756c 742e 7374 6465 7272 5f62   result.stderr_b
+00016f20: 7974 6573 2e64 6563 6f64 6528 290a 0a20  ytes.decode().. 
+00016f30: 2020 2064 6566 2074 6573 745f 6769 7469     def test_giti
+00016f40: 676e 6f72 655f 7468 6174 5f69 676e 6f72  gnore_that_ignor
+00016f50: 6573 5f73 7562 666f 6c64 6572 7328 7365  es_subfolders(se
+00016f60: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00016f70: 2020 2020 2023 2049 6620 6769 7469 676e       # If gitign
+00016f80: 6f72 6520 7769 7468 202a 2f2a 2069 7320  ore with */* is 
+00016f90: 696e 2072 6f6f 740a 2020 2020 2020 2020  in root.        
+00016fa0: 726f 6f74 203d 2050 6174 6828 4441 5441  root = Path(DATA
+00016fb0: 5f44 4952 202f 2022 6967 6e6f 7265 5f73  _DIR / "ignore_s
+00016fc0: 7562 666f 6c64 6572 735f 6769 7469 676e  ubfolders_gitign
+00016fd0: 6f72 655f 7465 7374 7322 202f 2022 7375  ore_tests" / "su
+00016fe0: 6264 6972 2229 0a20 2020 2020 2020 2065  bdir").        e
+00016ff0: 7870 6563 7465 6420 3d20 5b72 6f6f 7420  xpected = [root 
+00017000: 2f20 2262 2e70 7922 5d0a 2020 2020 2020  / "b.py"].      
+00017010: 2020 6374 7820 3d20 4661 6b65 436f 6e74    ctx = FakeCont
+00017020: 6578 7428 290a 2020 2020 2020 2020 6374  ext().        ct
+00017030: 782e 6f62 6a5b 2272 6f6f 7422 5d20 3d20  x.obj["root"] = 
+00017040: 726f 6f74 0a20 2020 2020 2020 2061 7373  root.        ass
+00017050: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+00017060: 7572 6365 7328 5b72 6f6f 745d 2c20 6578  urces([root], ex
+00017070: 7065 6374 6564 2c20 6374 783d 6374 7829  pected, ctx=ctx)
+00017080: 0a0a 2020 2020 2020 2020 2320 4966 202e  ..        # If .
+00017090: 6769 7469 676e 6f72 6520 7769 7468 202a  gitignore with *
+000170a0: 2f2a 2069 7320 6e65 7374 6564 0a20 2020  /* is nested.   
+000170b0: 2020 2020 2072 6f6f 7420 3d20 5061 7468       root = Path
+000170c0: 2844 4154 415f 4449 5220 2f20 2269 676e  (DATA_DIR / "ign
+000170d0: 6f72 655f 7375 6266 6f6c 6465 7273 5f67  ore_subfolders_g
+000170e0: 6974 6967 6e6f 7265 5f74 6573 7473 2229  itignore_tests")
+000170f0: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00017100: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
+00017110: 2020 726f 6f74 202f 2022 612e 7079 222c    root / "a.py",
+00017120: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
+00017130: 7420 2f20 2273 7562 6469 7222 202f 2022  t / "subdir" / "
+00017140: 622e 7079 222c 0a20 2020 2020 2020 205d  b.py",.        ]
+00017150: 0a20 2020 2020 2020 2063 7478 203d 2046  .        ctx = F
+00017160: 616b 6543 6f6e 7465 7874 2829 0a20 2020  akeContext().   
+00017170: 2020 2020 2063 7478 2e6f 626a 5b22 726f       ctx.obj["ro
+00017180: 6f74 225d 203d 2072 6f6f 740a 2020 2020  ot"] = root.    
+00017190: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+000171a0: 6374 6564 5f73 6f75 7263 6573 285b 726f  cted_sources([ro
+000171b0: 6f74 5d2c 2065 7870 6563 7465 642c 2063  ot], expected, c
+000171c0: 7478 3d63 7478 290a 0a20 2020 2020 2020  tx=ctx)..       
+000171d0: 2023 2049 6620 636f 6d6d 616e 6420 6973   # If command is
+000171e0: 2065 7865 6375 7465 6420 6672 6f6d 206f   executed from o
+000171f0: 7574 6572 2064 6972 0a20 2020 2020 2020  uter dir.       
+00017200: 2072 6f6f 7420 3d20 5061 7468 2844 4154   root = Path(DAT
+00017210: 415f 4449 5220 2f20 2269 676e 6f72 655f  A_DIR / "ignore_
+00017220: 7375 6266 6f6c 6465 7273 5f67 6974 6967  subfolders_gitig
+00017230: 6e6f 7265 5f74 6573 7473 2229 0a20 2020  nore_tests").   
+00017240: 2020 2020 2074 6172 6765 7420 3d20 726f       target = ro
+00017250: 6f74 202f 2022 7375 6264 6972 220a 2020  ot / "subdir".  
+00017260: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00017270: 205b 7461 7267 6574 202f 2022 622e 7079   [target / "b.py
+00017280: 225d 0a20 2020 2020 2020 2063 7478 203d  "].        ctx =
+00017290: 2046 616b 6543 6f6e 7465 7874 2829 0a20   FakeContext(). 
+000172a0: 2020 2020 2020 2063 7478 2e6f 626a 5b22         ctx.obj["
+000172b0: 726f 6f74 225d 203d 2072 6f6f 740a 2020  root"] = root.  
+000172c0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+000172d0: 6c65 6374 6564 5f73 6f75 7263 6573 285b  lected_sources([
+000172e0: 7461 7267 6574 5d2c 2065 7870 6563 7465  target], expecte
+000172f0: 642c 2063 7478 3d63 7478 290a 0a20 2020  d, ctx=ctx)..   
+00017300: 2064 6566 2074 6573 745f 656d 7074 795f   def test_empty_
+00017310: 696e 636c 7564 6528 7365 6c66 2920 2d3e  include(self) ->
+00017320: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
+00017330: 6174 6820 3d20 4441 5441 5f44 4952 202f  ath = DATA_DIR /
+00017340: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
+00017350: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
+00017360: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
+00017370: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00017380: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
+00017390: 6174 6828 7061 7468 202f 2022 622f 6578  ath(path / "b/ex
+000173a0: 636c 7564 652f 612e 7069 6522 292c 0a20  clude/a.pie"),. 
+000173b0: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+000173c0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
+000173d0: 652f 612e 7079 2229 2c0a 2020 2020 2020  e/a.py"),.      
+000173e0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+000173f0: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+00017400: 7969 2229 2c0a 2020 2020 2020 2020 2020  yi"),.          
+00017410: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00017420: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
+00017430: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
+00017440: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00017450: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
+00017460: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00017470: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00017480: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
+00017490: 2e70 7969 2229 2c0a 2020 2020 2020 2020  .pyi"),.        
+000174a0: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+000174b0: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
+000174c0: 7863 6c75 6465 2f61 2e70 6965 2229 2c0a  xclude/a.pie"),.
+000174d0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+000174e0: 2870 6174 6820 2f20 2262 2f2e 6465 6669  (path / "b/.defi
+000174f0: 6e69 7465 6c79 5f65 7863 6c75 6465 2f61  nitely_exclude/a
+00017500: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00017510: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00017520: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
+00017530: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
+00017540: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+00017550: 7061 7468 202f 2022 2e67 6974 6967 6e6f  path / ".gitigno
+00017560: 7265 2229 2c0a 2020 2020 2020 2020 2020  re"),.          
+00017570: 2020 5061 7468 2870 6174 6820 2f20 2270    Path(path / "p
+00017580: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
+00017590: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+000175a0: 2020 2023 2053 6574 7469 6e67 2065 7863     # Setting exc
+000175b0: 6c75 6465 2065 7870 6c69 6369 746c 7920  lude explicitly 
+000175c0: 746f 2061 6e20 656d 7074 7920 7374 7269  to an empty stri
+000175d0: 6e67 2074 6f20 626c 6f63 6b20 2e67 6974  ng to block .git
+000175e0: 6967 6e6f 7265 2075 7361 6765 2e0a 2020  ignore usage..  
+000175f0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+00017600: 6c65 6374 6564 5f73 6f75 7263 6573 2873  lected_sources(s
+00017610: 7263 2c20 6578 7065 6374 6564 2c20 696e  rc, expected, in
+00017620: 636c 7564 653d 2222 2c20 6578 636c 7564  clude="", exclud
+00017630: 653d 2222 290a 0a20 2020 2064 6566 2074  e="")..    def t
+00017640: 6573 745f 6578 7465 6e64 5f65 7863 6c75  est_extend_exclu
+00017650: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
+00017660: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
+00017670: 2044 4154 415f 4449 5220 2f20 2269 6e63   DATA_DIR / "inc
+00017680: 6c75 6465 5f65 7863 6c75 6465 5f74 6573  lude_exclude_tes
+00017690: 7473 220a 2020 2020 2020 2020 7372 6320  ts".        src 
+000176a0: 3d20 5b70 6174 685d 0a20 2020 2020 2020  = [path].       
+000176b0: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
+000176c0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+000176d0: 6174 6820 2f20 2262 2f65 7863 6c75 6465  ath / "b/exclude
+000176e0: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
+000176f0: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
+00017700: 2022 622f 646f 6e74 5f65 7863 6c75 6465   "b/dont_exclude
+00017710: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
+00017720: 205d 0a20 2020 2020 2020 2061 7373 6572   ].        asser
+00017730: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00017740: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
+00017750: 2073 7263 2c20 6578 7065 6374 6564 2c20   src, expected, 
+00017760: 6578 636c 7564 653d 7222 5c2e 7079 6924  exclude=r"\.pyi$
+00017770: 222c 2065 7874 656e 645f 6578 636c 7564  ", extend_exclud
+00017780: 653d 7222 5c2e 6465 6669 6e69 7465 6c79  e=r"\.definitely
+00017790: 5f65 7863 6c75 6465 220a 2020 2020 2020  _exclude".      
+000177a0: 2020 290a 0a20 2020 2040 7079 7465 7374    )..    @pytest
+000177b0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
+000177c0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
+000177d0: 2020 6465 6620 7465 7374 5f73 796d 6c69    def test_symli
+000177e0: 6e6b 5f6f 7574 5f6f 665f 726f 6f74 5f64  nk_out_of_root_d
+000177f0: 6972 6563 746f 7279 2873 656c 6629 202d  irectory(self) -
+00017800: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00017810: 7061 7468 203d 204d 6167 6963 4d6f 636b  path = MagicMock
+00017820: 2829 0a20 2020 2020 2020 2072 6f6f 7420  ().        root 
+00017830: 3d20 5448 4953 5f44 4952 2e72 6573 6f6c  = THIS_DIR.resol
+00017840: 7665 2829 0a20 2020 2020 2020 2063 6869  ve().        chi
+00017850: 6c64 203d 204d 6167 6963 4d6f 636b 2829  ld = MagicMock()
+00017860: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+00017870: 203d 2072 652e 636f 6d70 696c 6528 626c   = re.compile(bl
+00017880: 6163 6b2e 4445 4641 554c 545f 494e 434c  ack.DEFAULT_INCL
+00017890: 5544 4553 290a 2020 2020 2020 2020 6578  UDES).        ex
+000178a0: 636c 7564 6520 3d20 7265 2e63 6f6d 7069  clude = re.compi
+000178b0: 6c65 2862 6c61 636b 2e44 4546 4155 4c54  le(black.DEFAULT
+000178c0: 5f45 5843 4c55 4445 5329 0a20 2020 2020  _EXCLUDES).     
+000178d0: 2020 2072 6570 6f72 7420 3d20 626c 6163     report = blac
+000178e0: 6b2e 5265 706f 7274 2829 0a20 2020 2020  k.Report().     
+000178f0: 2020 2067 6974 6967 6e6f 7265 203d 2050     gitignore = P
+00017900: 6174 6853 7065 632e 6672 6f6d 5f6c 696e  athSpec.from_lin
+00017910: 6573 2822 6769 7477 696c 646d 6174 6368  es("gitwildmatch
+00017920: 222c 205b 5d29 0a20 2020 2020 2020 2023  ", []).        #
+00017930: 2060 6368 696c 6460 2073 686f 756c 6420   `child` should 
+00017940: 6265 6861 7665 206c 696b 6520 6120 7379  behave like a sy
+00017950: 6d6c 696e 6b20 7768 6963 6820 7265 736f  mlink which reso
+00017960: 6c76 6564 2070 6174 6820 6973 2063 6c65  lved path is cle
+00017970: 6172 6c79 0a20 2020 2020 2020 2023 206f  arly.        # o
+00017980: 7574 7369 6465 206f 6620 7468 6520 6072  utside of the `r
+00017990: 6f6f 7460 2064 6972 6563 746f 7279 2e0a  oot` directory..
+000179a0: 2020 2020 2020 2020 7061 7468 2e69 7465          path.ite
+000179b0: 7264 6972 2e72 6574 7572 6e5f 7661 6c75  rdir.return_valu
+000179c0: 6520 3d20 5b63 6869 6c64 5d0a 2020 2020  e = [child].    
+000179d0: 2020 2020 6368 696c 642e 7265 736f 6c76      child.resolv
+000179e0: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
+000179f0: 2050 6174 6828 222f 612f 622f 6322 290a   Path("/a/b/c").
+00017a00: 2020 2020 2020 2020 6368 696c 642e 6173          child.as
+00017a10: 5f70 6f73 6978 2e72 6574 7572 6e5f 7661  _posix.return_va
+00017a20: 6c75 6520 3d20 222f 612f 622f 6322 0a20  lue = "/a/b/c". 
+00017a30: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00017a40: 2020 2020 2020 2020 6c69 7374 280a 2020          list(.  
+00017a50: 2020 2020 2020 2020 2020 2020 2020 626c                bl
+00017a60: 6163 6b2e 6765 6e5f 7079 7468 6f6e 5f66  ack.gen_python_f
+00017a70: 696c 6573 280a 2020 2020 2020 2020 2020  iles(.          
+00017a80: 2020 2020 2020 2020 2020 7061 7468 2e69            path.i
+00017a90: 7465 7264 6972 2829 2c0a 2020 2020 2020  terdir(),.      
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00017ab0: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
+00017ac0: 2020 2020 2020 2020 696e 636c 7564 652c          include,
+00017ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ae0: 2020 2020 2065 7863 6c75 6465 2c0a 2020       exclude,.  
 00017af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b00: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
-00017b10: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-00017b20: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-00017b30: 2020 2020 2020 2020 207b 7061 7468 3a20           {path: 
-00017b40: 6769 7469 676e 6f72 657d 2c0a 2020 2020  gitignore},.    
-00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b60: 7665 7262 6f73 653d 4661 6c73 652c 0a20  verbose=False,. 
-00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b80: 2020 2071 7569 6574 3d46 616c 7365 2c0a     quiet=False,.
-00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ba0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00017bb0: 2020 2020 2020 2020 6578 6365 7074 2056          except V
-00017bc0: 616c 7565 4572 726f 7220 6173 2076 653a  alueError as ve:
-00017bd0: 0a20 2020 2020 2020 2020 2020 2070 7974  .            pyt
-00017be0: 6573 742e 6661 696c 2866 2260 6765 745f  est.fail(f"`get_
-00017bf0: 7079 7468 6f6e 5f66 696c 6573 5f69 6e5f  python_files_in_
-00017c00: 6469 7228 2960 2066 6169 6c65 643a 207b  dir()` failed: {
-00017c10: 7665 7d22 290a 2020 2020 2020 2020 7061  ve}").        pa
-00017c20: 7468 2e69 7465 7264 6972 2e61 7373 6572  th.iterdir.asser
-00017c30: 745f 6361 6c6c 6564 5f6f 6e63 6528 290a  t_called_once().
-00017c40: 2020 2020 2020 2020 6368 696c 642e 7265          child.re
-00017c50: 736f 6c76 652e 6173 7365 7274 5f63 616c  solve.assert_cal
-00017c60: 6c65 645f 6f6e 6365 2829 0a0a 2020 2020  led_once()..    
-00017c70: 4070 6174 6368 2822 626c 6163 6b2e 6669  @patch("black.fi
-00017c80: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7422  nd_project_root"
-00017c90: 2c20 6c61 6d62 6461 202a 6172 6773 3a20  , lambda *args: 
-00017ca0: 2854 4849 535f 4449 522e 7265 736f 6c76  (THIS_DIR.resolv
-00017cb0: 6528 292c 204e 6f6e 6529 290a 2020 2020  e(), None)).    
-00017cc0: 6465 6620 7465 7374 5f67 6574 5f73 6f75  def test_get_sou
-00017cd0: 7263 6573 5f77 6974 685f 7374 6469 6e28  rces_with_stdin(
-00017ce0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00017cf0: 2020 2020 2020 2073 7263 203d 205b 222d         src = ["-
-00017d00: 225d 0a20 2020 2020 2020 2065 7870 6563  "].        expec
-00017d10: 7465 6420 3d20 5b22 2d22 5d0a 2020 2020  ted = ["-"].    
-00017d20: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00017d30: 6374 6564 5f73 6f75 7263 6573 2873 7263  cted_sources(src
-00017d40: 2c20 6578 7065 6374 6564 2c20 696e 636c  , expected, incl
-00017d50: 7564 653d 2222 2c20 6578 636c 7564 653d  ude="", exclude=
-00017d60: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
-00017d70: 7922 290a 0a20 2020 2040 7061 7463 6828  y")..    @patch(
-00017d80: 2262 6c61 636b 2e66 696e 645f 7072 6f6a  "black.find_proj
-00017d90: 6563 745f 726f 6f74 222c 206c 616d 6264  ect_root", lambd
-00017da0: 6120 2a61 7267 733a 2028 5448 4953 5f44  a *args: (THIS_D
-00017db0: 4952 2e72 6573 6f6c 7665 2829 2c20 4e6f  IR.resolve(), No
-00017dc0: 6e65 2929 0a20 2020 2064 6566 2074 6573  ne)).    def tes
-00017dd0: 745f 6765 745f 736f 7572 6365 735f 7769  t_get_sources_wi
-00017de0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
-00017df0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00017e00: 0a20 2020 2020 2020 2073 7263 203d 205b  .        src = [
-00017e10: 222d 225d 0a20 2020 2020 2020 2073 7464  "-"].        std
-00017e20: 696e 5f66 696c 656e 616d 6520 3d20 7374  in_filename = st
-00017e30: 7228 5448 4953 5f44 4952 202f 2022 6461  r(THIS_DIR / "da
-00017e40: 7461 2f63 6f6c 6c65 6374 696f 6e73 2e70  ta/collections.p
-00017e50: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
-00017e60: 6374 6564 203d 205b 6622 5f5f 424c 4143  cted = [f"__BLAC
-00017e70: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
-00017e80: 5f5f 7b73 7464 696e 5f66 696c 656e 616d  __{stdin_filenam
-00017e90: 657d 225d 0a20 2020 2020 2020 2061 7373  e}"].        ass
-00017ea0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-00017eb0: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-00017ec0: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
-00017ed0: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
-00017ee0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00017ef0: 653d 7222 2f65 7863 6c75 6465 2f61 5c2e  e=r"/exclude/a\.
-00017f00: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
-00017f10: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
-00017f20: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
-00017f30: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-00017f40: 7061 7463 6828 2262 6c61 636b 2e66 696e  patch("black.fin
-00017f50: 645f 7072 6f6a 6563 745f 726f 6f74 222c  d_project_root",
-00017f60: 206c 616d 6264 6120 2a61 7267 733a 2028   lambda *args: (
-00017f70: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
-00017f80: 2829 2c20 4e6f 6e65 2929 0a20 2020 2064  (), None)).    d
-00017f90: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
-00017fa0: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
-00017fb0: 696c 656e 616d 655f 616e 645f 6578 636c  ilename_and_excl
-00017fc0: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
-00017fd0: 653a 0a20 2020 2020 2020 2023 2045 7863  e:.        # Exc
-00017fe0: 6c75 6465 2073 686f 756c 646e 2774 2065  lude shouldn't e
-00017ff0: 7863 6c75 6465 2073 7464 696e 5f66 696c  xclude stdin_fil
-00018000: 656e 616d 6520 7369 6e63 6520 6974 2069  ename since it i
-00018010: 7320 6d69 6d69 636b 696e 6720 7468 650a  s mimicking the.
-00018020: 2020 2020 2020 2020 2320 6669 6c65 2062          # file b
-00018030: 6569 6e67 2070 6173 7365 6420 6469 7265  eing passed dire
-00018040: 6374 6c79 2e20 5468 6973 2069 7320 7468  ctly. This is th
-00018050: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
-00018060: 2020 2320 7465 7374 5f65 7863 6c75 6465    # test_exclude
-00018070: 5f66 6f72 5f69 7373 7565 5f31 3537 320a  _for_issue_1572.
-00018080: 2020 2020 2020 2020 7061 7468 203d 2044          path = D
-00018090: 4154 415f 4449 5220 2f20 2269 6e63 6c75  ATA_DIR / "inclu
-000180a0: 6465 5f65 7863 6c75 6465 5f74 6573 7473  de_exclude_tests
-000180b0: 220a 2020 2020 2020 2020 7372 6320 3d20  ".        src = 
-000180c0: 5b22 2d22 5d0a 2020 2020 2020 2020 7374  ["-"].        st
-000180d0: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
-000180e0: 7472 2870 6174 6820 2f20 2262 2f65 7863  tr(path / "b/exc
-000180f0: 6c75 6465 2f61 2e70 7922 290a 2020 2020  lude/a.py").    
-00018100: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
-00018110: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
-00018120: 4649 4c45 4e41 4d45 5f5f 7b73 7464 696e  FILENAME__{stdin
-00018130: 5f66 696c 656e 616d 657d 225d 0a20 2020  _filename}"].   
-00018140: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00018150: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
-00018160: 2020 2020 2020 2020 2020 2073 7263 2c0a             src,.
-00018170: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-00018180: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
-00018190: 2020 6578 636c 7564 653d 7222 2f65 7863    exclude=r"/exc
-000181a0: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
-000181b0: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
-000181c0: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
-000181d0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-000181e0: 2029 0a0a 2020 2020 4070 6174 6368 2822   )..    @patch("
-000181f0: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
-00018200: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
-00018210: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
-00018220: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
-00018230: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
-00018240: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
-00018250: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
-00018260: 5f61 6e64 5f65 7874 656e 645f 6578 636c  _and_extend_excl
-00018270: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
-00018280: 653a 0a20 2020 2020 2020 2023 2045 7874  e:.        # Ext
-00018290: 656e 6420 6578 636c 7564 6520 7368 6f75  end exclude shou
-000182a0: 6c64 6e27 7420 6578 636c 7564 6520 7374  ldn't exclude st
-000182b0: 6469 6e5f 6669 6c65 6e61 6d65 2073 696e  din_filename sin
-000182c0: 6365 2069 7420 6973 206d 696d 6963 6b69  ce it is mimicki
-000182d0: 6e67 2074 6865 0a20 2020 2020 2020 2023  ng the.        #
-000182e0: 2066 696c 6520 6265 696e 6720 7061 7373   file being pass
-000182f0: 6564 2064 6972 6563 746c 792e 2054 6869  ed directly. Thi
-00018300: 7320 6973 2074 6865 2073 616d 6520 6173  s is the same as
-00018310: 0a20 2020 2020 2020 2023 2074 6573 745f  .        # test_
-00018320: 6578 636c 7564 655f 666f 725f 6973 7375  exclude_for_issu
-00018330: 655f 3135 3732 0a20 2020 2020 2020 2073  e_1572.        s
-00018340: 7263 203d 205b 222d 225d 0a20 2020 2020  rc = ["-"].     
-00018350: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
-00018360: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
-00018370: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
-00018380: 6573 7473 220a 2020 2020 2020 2020 7374  ests".        st
-00018390: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
-000183a0: 7472 2870 6174 6820 2f20 2262 2f65 7863  tr(path / "b/exc
-000183b0: 6c75 6465 2f61 2e70 7922 290a 2020 2020  lude/a.py").    
-000183c0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
-000183d0: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
-000183e0: 4649 4c45 4e41 4d45 5f5f 7b73 7464 696e  FILENAME__{stdin
-000183f0: 5f66 696c 656e 616d 657d 225d 0a20 2020  _filename}"].   
-00018400: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00018410: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
-00018420: 2020 2020 2020 2020 2020 2073 7263 2c0a             src,.
-00018430: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-00018440: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
-00018450: 2020 6578 7465 6e64 5f65 7863 6c75 6465    extend_exclude
-00018460: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
-00018470: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
-00018480: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
-00018490: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
-000184a0: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-000184b0: 7061 7463 6828 2262 6c61 636b 2e66 696e  patch("black.fin
-000184c0: 645f 7072 6f6a 6563 745f 726f 6f74 222c  d_project_root",
-000184d0: 206c 616d 6264 6120 2a61 7267 733a 2028   lambda *args: (
-000184e0: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
-000184f0: 2829 2c20 4e6f 6e65 2929 0a20 2020 2064  (), None)).    d
-00018500: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
-00018510: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
-00018520: 696c 656e 616d 655f 616e 645f 666f 7263  ilename_and_forc
-00018530: 655f 6578 636c 7564 6528 7365 6c66 2920  e_exclude(self) 
-00018540: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00018550: 2023 2046 6f72 6365 2065 7863 6c75 6465   # Force exclude
-00018560: 2073 686f 756c 6420 6578 636c 7564 6520   should exclude 
-00018570: 7468 6520 6669 6c65 2077 6865 6e20 7061  the file when pa
-00018580: 7373 696e 6720 6974 2074 6872 6f75 6768  ssing it through
-00018590: 0a20 2020 2020 2020 2023 2073 7464 696e  .        # stdin
-000185a0: 5f66 696c 656e 616d 650a 2020 2020 2020  _filename.      
-000185b0: 2020 7061 7468 203d 2054 4849 535f 4449    path = THIS_DI
-000185c0: 5220 2f20 2264 6174 6122 202f 2022 696e  R / "data" / "in
-000185d0: 636c 7564 655f 6578 636c 7564 655f 7465  clude_exclude_te
-000185e0: 7374 7322 0a20 2020 2020 2020 2073 7464  sts".        std
-000185f0: 696e 5f66 696c 656e 616d 6520 3d20 7374  in_filename = st
-00018600: 7228 7061 7468 202f 2022 622f 6578 636c  r(path / "b/excl
-00018610: 7564 652f 612e 7079 2229 0a20 2020 2020  ude/a.py").     
-00018620: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
-00018630: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
-00018640: 2020 2020 2020 2020 2073 7263 3d5b 222d           src=["-
-00018650: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00018660: 6578 7065 6374 6564 3d5b 5d2c 0a20 2020  expected=[],.   
-00018670: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
-00018680: 7863 6c75 6465 3d72 222f 6578 636c 7564  xclude=r"/exclud
-00018690: 652f 7c61 5c2e 7079 222c 0a20 2020 2020  e/|a\.py",.     
-000186a0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
-000186b0: 656e 616d 653d 7374 6469 6e5f 6669 6c65  ename=stdin_file
-000186c0: 6e61 6d65 2c0a 2020 2020 2020 2020 290a  name,.        ).
-000186d0: 0a0a 7472 793a 0a20 2020 2077 6974 6820  ..try:.    with 
-000186e0: 6f70 656e 2862 6c61 636b 2e5f 5f66 696c  open(black.__fil
-000186f0: 655f 5f2c 2022 7222 2c20 656e 636f 6469  e__, "r", encodi
-00018700: 6e67 3d22 7574 662d 3822 2920 6173 205f  ng="utf-8") as _
-00018710: 6266 3a0a 2020 2020 2020 2020 626c 6163  bf:.        blac
-00018720: 6b5f 736f 7572 6365 5f6c 696e 6573 203d  k_source_lines =
-00018730: 205f 6266 2e72 6561 646c 696e 6573 2829   _bf.readlines()
-00018740: 0a65 7863 6570 7420 556e 6963 6f64 6544  .except UnicodeD
-00018750: 6563 6f64 6545 7272 6f72 3a0a 2020 2020  ecodeError:.    
-00018760: 6966 206e 6f74 2062 6c61 636b 2e43 4f4d  if not black.COM
-00018770: 5049 4c45 443a 0a20 2020 2020 2020 2072  PILED:.        r
-00018780: 6169 7365 0a0a 0a64 6566 2074 7261 6365  aise...def trace
-00018790: 6675 6e63 280a 2020 2020 6672 616d 653a  func(.    frame:
-000187a0: 2074 7970 6573 2e46 7261 6d65 5479 7065   types.FrameType
-000187b0: 2c20 6576 656e 743a 2073 7472 2c20 6172  , event: str, ar
-000187c0: 673a 2041 6e79 0a29 202d 3e20 4361 6c6c  g: Any.) -> Call
-000187d0: 6162 6c65 5b5b 7479 7065 732e 4672 616d  able[[types.Fram
-000187e0: 6554 7970 652c 2073 7472 2c20 416e 795d  eType, str, Any]
-000187f0: 2c20 416e 795d 3a0a 2020 2020 2222 2253  , Any]:.    """S
-00018800: 686f 7720 6675 6e63 7469 6f6e 2063 616c  how function cal
-00018810: 6c73 2060 6672 6f6d 2062 6c61 636b 2f5f  ls `from black/_
-00018820: 5f69 6e69 745f 5f2e 7079 6020 6173 2074  _init__.py` as t
-00018830: 6865 7920 6861 7070 656e 2e0a 0a20 2020  hey happen...   
-00018840: 2052 6567 6973 7465 7220 7468 6973 2077   Register this w
-00018850: 6974 6820 6073 7973 2e73 6574 7472 6163  ith `sys.settrac
-00018860: 6528 2960 2069 6e20 6120 7465 7374 2079  e()` in a test y
-00018870: 6f75 2772 6520 6465 6275 6767 696e 672e  ou're debugging.
-00018880: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-00018890: 6576 656e 7420 213d 2022 6361 6c6c 223a  event != "call":
-000188a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000188b0: 7472 6163 6566 756e 630a 0a20 2020 2073  tracefunc..    s
-000188c0: 7461 636b 203d 206c 656e 2869 6e73 7065  tack = len(inspe
-000188d0: 6374 2e73 7461 636b 2829 2920 2d20 3139  ct.stack()) - 19
-000188e0: 0a20 2020 2073 7461 636b 202a 3d20 320a  .    stack *= 2.
-000188f0: 2020 2020 6669 6c65 6e61 6d65 203d 2066      filename = f
-00018900: 7261 6d65 2e66 5f63 6f64 652e 636f 5f66  rame.f_code.co_f
-00018910: 696c 656e 616d 650a 2020 2020 6c69 6e65  ilename.    line
-00018920: 6e6f 203d 2066 7261 6d65 2e66 5f6c 696e  no = frame.f_lin
-00018930: 656e 6f0a 2020 2020 6675 6e63 5f73 6967  eno.    func_sig
-00018940: 5f6c 696e 656e 6f20 3d20 6c69 6e65 6e6f  _lineno = lineno
-00018950: 202d 2031 0a20 2020 2066 756e 636e 616d   - 1.    funcnam
-00018960: 6520 3d20 626c 6163 6b5f 736f 7572 6365  e = black_source
-00018970: 5f6c 696e 6573 5b66 756e 635f 7369 675f  _lines[func_sig_
-00018980: 6c69 6e65 6e6f 5d2e 7374 7269 7028 290a  lineno].strip().
-00018990: 2020 2020 7768 696c 6520 6675 6e63 6e61      while funcna
-000189a0: 6d65 2e73 7461 7274 7377 6974 6828 2240  me.startswith("@
-000189b0: 2229 3a0a 2020 2020 2020 2020 6675 6e63  "):.        func
-000189c0: 5f73 6967 5f6c 696e 656e 6f20 2b3d 2031  _sig_lineno += 1
-000189d0: 0a20 2020 2020 2020 2066 756e 636e 616d  .        funcnam
-000189e0: 6520 3d20 626c 6163 6b5f 736f 7572 6365  e = black_source
-000189f0: 5f6c 696e 6573 5b66 756e 635f 7369 675f  _lines[func_sig_
-00018a00: 6c69 6e65 6e6f 5d2e 7374 7269 7028 290a  lineno].strip().
-00018a10: 2020 2020 6966 2022 626c 6163 6b2f 5f5f      if "black/__
-00018a20: 696e 6974 5f5f 2e70 7922 2069 6e20 6669  init__.py" in fi
-00018a30: 6c65 6e61 6d65 3a0a 2020 2020 2020 2020  lename:.        
-00018a40: 7072 696e 7428 6622 7b27 2027 202a 2073  print(f"{' ' * s
-00018a50: 7461 636b 7d7b 6c69 6e65 6e6f 7d3a 7b66  tack}{lineno}:{f
-00018a60: 756e 636e 616d 657d 2229 0a20 2020 2072  uncname}").    r
-00018a70: 6574 7572 6e20 7472 6163 6566 756e 630a  eturn tracefunc.
+00017b00: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
+00017b10: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
+00017b20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017b30: 2020 2020 2020 7265 706f 7274 2c0a 2020        report,.  
+00017b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b50: 2020 7b70 6174 683a 2067 6974 6967 6e6f    {path: gitigno
+00017b60: 7265 7d2c 0a20 2020 2020 2020 2020 2020  re},.           
+00017b70: 2020 2020 2020 2020 2076 6572 626f 7365           verbose
+00017b80: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00017b90: 2020 2020 2020 2020 2020 2020 7175 6965              quie
+00017ba0: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
+00017bb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00017bc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017bd0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00017be0: 6f72 2061 7320 7665 3a0a 2020 2020 2020  or as ve:.      
+00017bf0: 2020 2020 2020 7079 7465 7374 2e66 6169        pytest.fai
+00017c00: 6c28 6622 6067 6574 5f70 7974 686f 6e5f  l(f"`get_python_
+00017c10: 6669 6c65 735f 696e 5f64 6972 2829 6020  files_in_dir()` 
+00017c20: 6661 696c 6564 3a20 7b76 657d 2229 0a20  failed: {ve}"). 
+00017c30: 2020 2020 2020 2070 6174 682e 6974 6572         path.iter
+00017c40: 6469 722e 6173 7365 7274 5f63 616c 6c65  dir.assert_calle
+00017c50: 645f 6f6e 6365 2829 0a20 2020 2020 2020  d_once().       
+00017c60: 2063 6869 6c64 2e72 6573 6f6c 7665 2e61   child.resolve.a
+00017c70: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
+00017c80: 6528 290a 0a20 2020 2040 7061 7463 6828  e()..    @patch(
+00017c90: 2262 6c61 636b 2e66 696e 645f 7072 6f6a  "black.find_proj
+00017ca0: 6563 745f 726f 6f74 222c 206c 616d 6264  ect_root", lambd
+00017cb0: 6120 2a61 7267 733a 2028 5448 4953 5f44  a *args: (THIS_D
+00017cc0: 4952 2e72 6573 6f6c 7665 2829 2c20 4e6f  IR.resolve(), No
+00017cd0: 6e65 2929 0a20 2020 2064 6566 2074 6573  ne)).    def tes
+00017ce0: 745f 6765 745f 736f 7572 6365 735f 7769  t_get_sources_wi
+00017cf0: 7468 5f73 7464 696e 2873 656c 6629 202d  th_stdin(self) -
+00017d00: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00017d10: 7372 6320 3d20 5b22 2d22 5d0a 2020 2020  src = ["-"].    
+00017d20: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+00017d30: 222d 225d 0a20 2020 2020 2020 2061 7373  "-"].        ass
+00017d40: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+00017d50: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
+00017d60: 7465 642c 2069 6e63 6c75 6465 3d22 222c  ted, include="",
+00017d70: 2065 7863 6c75 6465 3d72 222f 6578 636c   exclude=r"/excl
+00017d80: 7564 652f 7c61 5c2e 7079 2229 0a0a 2020  ude/|a\.py")..  
+00017d90: 2020 4070 6174 6368 2822 626c 6163 6b2e    @patch("black.
+00017da0: 6669 6e64 5f70 726f 6a65 6374 5f72 6f6f  find_project_roo
+00017db0: 7422 2c20 6c61 6d62 6461 202a 6172 6773  t", lambda *args
+00017dc0: 3a20 2854 4849 535f 4449 522e 7265 736f  : (THIS_DIR.reso
+00017dd0: 6c76 6528 292c 204e 6f6e 6529 290a 2020  lve(), None)).  
+00017de0: 2020 6465 6620 7465 7374 5f67 6574 5f73    def test_get_s
+00017df0: 6f75 7263 6573 5f77 6974 685f 7374 6469  ources_with_stdi
+00017e00: 6e5f 6669 6c65 6e61 6d65 2873 656c 6629  n_filename(self)
+00017e10: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00017e20: 2020 7372 6320 3d20 5b22 2d22 5d0a 2020    src = ["-"].  
+00017e30: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
+00017e40: 6e61 6d65 203d 2073 7472 2854 4849 535f  name = str(THIS_
+00017e50: 4449 5220 2f20 2264 6174 612f 636f 6c6c  DIR / "data/coll
+00017e60: 6563 7469 6f6e 732e 7079 2229 0a20 2020  ections.py").   
+00017e70: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+00017e80: 5b66 225f 5f42 4c41 434b 5f53 5444 494e  [f"__BLACK_STDIN
+00017e90: 5f46 494c 454e 414d 455f 5f7b 7374 6469  _FILENAME__{stdi
+00017ea0: 6e5f 6669 6c65 6e61 6d65 7d22 5d0a 2020  n_filename}"].  
+00017eb0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+00017ec0: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+00017ed0: 2020 2020 2020 2020 2020 2020 7372 632c              src,
+00017ee0: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+00017ef0: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
+00017f00: 2020 2065 7863 6c75 6465 3d72 222f 6578     exclude=r"/ex
+00017f10: 636c 7564 652f 615c 2e70 7922 2c0a 2020  clude/a\.py",.  
+00017f20: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
+00017f30: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
+00017f40: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+00017f50: 2029 0a0a 2020 2020 4070 6174 6368 2822   )..    @patch("
+00017f60: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
+00017f70: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
+00017f80: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
+00017f90: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
+00017fa0: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
+00017fb0: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
+00017fc0: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
+00017fd0: 5f61 6e64 5f65 7863 6c75 6465 2873 656c  _and_exclude(sel
+00017fe0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00017ff0: 2020 2020 2320 4578 636c 7564 6520 7368      # Exclude sh
+00018000: 6f75 6c64 6e27 7420 6578 636c 7564 6520  ouldn't exclude 
+00018010: 7374 6469 6e5f 6669 6c65 6e61 6d65 2073  stdin_filename s
+00018020: 696e 6365 2069 7420 6973 206d 696d 6963  ince it is mimic
+00018030: 6b69 6e67 2074 6865 0a20 2020 2020 2020  king the.       
+00018040: 2023 2066 696c 6520 6265 696e 6720 7061   # file being pa
+00018050: 7373 6564 2064 6972 6563 746c 792e 2054  ssed directly. T
+00018060: 6869 7320 6973 2074 6865 2073 616d 6520  his is the same 
+00018070: 6173 0a20 2020 2020 2020 2023 2074 6573  as.        # tes
+00018080: 745f 6578 636c 7564 655f 666f 725f 6973  t_exclude_for_is
+00018090: 7375 655f 3135 3732 0a20 2020 2020 2020  sue_1572.       
+000180a0: 2070 6174 6820 3d20 4441 5441 5f44 4952   path = DATA_DIR
+000180b0: 202f 2022 696e 636c 7564 655f 6578 636c   / "include_excl
+000180c0: 7564 655f 7465 7374 7322 0a20 2020 2020  ude_tests".     
+000180d0: 2020 2073 7263 203d 205b 222d 225d 0a20     src = ["-"]. 
+000180e0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+000180f0: 656e 616d 6520 3d20 7374 7228 7061 7468  ename = str(path
+00018100: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
+00018110: 7079 2229 0a20 2020 2020 2020 2065 7870  py").        exp
+00018120: 6563 7465 6420 3d20 5b66 225f 5f42 4c41  ected = [f"__BLA
+00018130: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
+00018140: 455f 5f7b 7374 6469 6e5f 6669 6c65 6e61  E__{stdin_filena
+00018150: 6d65 7d22 5d0a 2020 2020 2020 2020 6173  me}"].        as
+00018160: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+00018170: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
+00018180: 2020 2020 7372 632c 0a20 2020 2020 2020      src,.       
+00018190: 2020 2020 2065 7870 6563 7465 642c 0a20       expected,. 
+000181a0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+000181b0: 6465 3d72 222f 6578 636c 7564 652f 7c61  de=r"/exclude/|a
+000181c0: 5c2e 7079 222c 0a20 2020 2020 2020 2020  \.py",.         
+000181d0: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
+000181e0: 653d 7374 6469 6e5f 6669 6c65 6e61 6d65  e=stdin_filename
+000181f0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00018200: 2040 7061 7463 6828 2262 6c61 636b 2e66   @patch("black.f
+00018210: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
+00018220: 222c 206c 616d 6264 6120 2a61 7267 733a  ", lambda *args:
+00018230: 2028 5448 4953 5f44 4952 2e72 6573 6f6c   (THIS_DIR.resol
+00018240: 7665 2829 2c20 4e6f 6e65 2929 0a20 2020  ve(), None)).   
+00018250: 2064 6566 2074 6573 745f 6765 745f 736f   def test_get_so
+00018260: 7572 6365 735f 7769 7468 5f73 7464 696e  urces_with_stdin
+00018270: 5f66 696c 656e 616d 655f 616e 645f 6578  _filename_and_ex
+00018280: 7465 6e64 5f65 7863 6c75 6465 2873 656c  tend_exclude(sel
+00018290: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000182a0: 2020 2020 2320 4578 7465 6e64 2065 7863      # Extend exc
+000182b0: 6c75 6465 2073 686f 756c 646e 2774 2065  lude shouldn't e
+000182c0: 7863 6c75 6465 2073 7464 696e 5f66 696c  xclude stdin_fil
+000182d0: 656e 616d 6520 7369 6e63 6520 6974 2069  ename since it i
+000182e0: 7320 6d69 6d69 636b 696e 6720 7468 650a  s mimicking the.
+000182f0: 2020 2020 2020 2020 2320 6669 6c65 2062          # file b
+00018300: 6569 6e67 2070 6173 7365 6420 6469 7265  eing passed dire
+00018310: 6374 6c79 2e20 5468 6973 2069 7320 7468  ctly. This is th
+00018320: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
+00018330: 2020 2320 7465 7374 5f65 7863 6c75 6465    # test_exclude
+00018340: 5f66 6f72 5f69 7373 7565 5f31 3537 320a  _for_issue_1572.
+00018350: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
+00018360: 2d22 5d0a 2020 2020 2020 2020 7061 7468  -"].        path
+00018370: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
+00018380: 6174 6122 202f 2022 696e 636c 7564 655f  ata" / "include_
+00018390: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
+000183a0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+000183b0: 656e 616d 6520 3d20 7374 7228 7061 7468  ename = str(path
+000183c0: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
+000183d0: 7079 2229 0a20 2020 2020 2020 2065 7870  py").        exp
+000183e0: 6563 7465 6420 3d20 5b66 225f 5f42 4c41  ected = [f"__BLA
+000183f0: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
+00018400: 455f 5f7b 7374 6469 6e5f 6669 6c65 6e61  E__{stdin_filena
+00018410: 6d65 7d22 5d0a 2020 2020 2020 2020 6173  me}"].        as
+00018420: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+00018430: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
+00018440: 2020 2020 7372 632c 0a20 2020 2020 2020      src,.       
+00018450: 2020 2020 2065 7870 6563 7465 642c 0a20       expected,. 
+00018460: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+00018470: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
+00018480: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
+00018490: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
+000184a0: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
+000184b0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+000184c0: 2029 0a0a 2020 2020 4070 6174 6368 2822   )..    @patch("
+000184d0: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
+000184e0: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
+000184f0: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
+00018500: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
+00018510: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
+00018520: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
+00018530: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
+00018540: 5f61 6e64 5f66 6f72 6365 5f65 7863 6c75  _and_force_exclu
+00018550: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
+00018560: 3a0a 2020 2020 2020 2020 2320 466f 7263  :.        # Forc
+00018570: 6520 6578 636c 7564 6520 7368 6f75 6c64  e exclude should
+00018580: 2065 7863 6c75 6465 2074 6865 2066 696c   exclude the fil
+00018590: 6520 7768 656e 2070 6173 7369 6e67 2069  e when passing i
+000185a0: 7420 7468 726f 7567 680a 2020 2020 2020  t through.      
+000185b0: 2020 2320 7374 6469 6e5f 6669 6c65 6e61    # stdin_filena
+000185c0: 6d65 0a20 2020 2020 2020 2070 6174 6820  me.        path 
+000185d0: 3d20 5448 4953 5f44 4952 202f 2022 6461  = THIS_DIR / "da
+000185e0: 7461 2220 2f20 2269 6e63 6c75 6465 5f65  ta" / "include_e
+000185f0: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+00018600: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
+00018610: 6e61 6d65 203d 2073 7472 2870 6174 6820  name = str(path 
+00018620: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+00018630: 7922 290a 2020 2020 2020 2020 6173 7365  y").        asse
+00018640: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
+00018650: 7263 6573 280a 2020 2020 2020 2020 2020  rces(.          
+00018660: 2020 7372 633d 5b22 2d22 5d2c 0a20 2020    src=["-"],.   
+00018670: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
+00018680: 643d 5b5d 2c0a 2020 2020 2020 2020 2020  d=[],.          
+00018690: 2020 666f 7263 655f 6578 636c 7564 653d    force_exclude=
+000186a0: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
+000186b0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+000186c0: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d73  stdin_filename=s
+000186d0: 7464 696e 5f66 696c 656e 616d 652c 0a20  tdin_filename,. 
+000186e0: 2020 2020 2020 2029 0a0a 0a74 7279 3a0a         )...try:.
+000186f0: 2020 2020 7769 7468 206f 7065 6e28 626c      with open(bl
+00018700: 6163 6b2e 5f5f 6669 6c65 5f5f 2c20 2272  ack.__file__, "r
+00018710: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
+00018720: 2d38 2229 2061 7320 5f62 663a 0a20 2020  -8") as _bf:.   
+00018730: 2020 2020 2062 6c61 636b 5f73 6f75 7263       black_sourc
+00018740: 655f 6c69 6e65 7320 3d20 5f62 662e 7265  e_lines = _bf.re
+00018750: 6164 6c69 6e65 7328 290a 6578 6365 7074  adlines().except
+00018760: 2055 6e69 636f 6465 4465 636f 6465 4572   UnicodeDecodeEr
+00018770: 726f 723a 0a20 2020 2069 6620 6e6f 7420  ror:.    if not 
+00018780: 626c 6163 6b2e 434f 4d50 494c 4544 3a0a  black.COMPILED:.
+00018790: 2020 2020 2020 2020 7261 6973 650a 0a0a          raise...
+000187a0: 6465 6620 7472 6163 6566 756e 6328 0a20  def tracefunc(. 
+000187b0: 2020 2066 7261 6d65 3a20 7479 7065 732e     frame: types.
+000187c0: 4672 616d 6554 7970 652c 2065 7665 6e74  FrameType, event
+000187d0: 3a20 7374 722c 2061 7267 3a20 416e 790a  : str, arg: Any.
+000187e0: 2920 2d3e 2043 616c 6c61 626c 655b 5b74  ) -> Callable[[t
+000187f0: 7970 6573 2e46 7261 6d65 5479 7065 2c20  ypes.FrameType, 
+00018800: 7374 722c 2041 6e79 5d2c 2041 6e79 5d3a  str, Any], Any]:
+00018810: 0a20 2020 2022 2222 5368 6f77 2066 756e  .    """Show fun
+00018820: 6374 696f 6e20 6361 6c6c 7320 6066 726f  ction calls `fro
+00018830: 6d20 626c 6163 6b2f 5f5f 696e 6974 5f5f  m black/__init__
+00018840: 2e70 7960 2061 7320 7468 6579 2068 6170  .py` as they hap
+00018850: 7065 6e2e 0a0a 2020 2020 5265 6769 7374  pen...    Regist
+00018860: 6572 2074 6869 7320 7769 7468 2060 7379  er this with `sy
+00018870: 732e 7365 7474 7261 6365 2829 6020 696e  s.settrace()` in
+00018880: 2061 2074 6573 7420 796f 7527 7265 2064   a test you're d
+00018890: 6562 7567 6769 6e67 2e0a 2020 2020 2222  ebugging..    ""
+000188a0: 220a 2020 2020 6966 2065 7665 6e74 2021  ".    if event !
+000188b0: 3d20 2263 616c 6c22 3a0a 2020 2020 2020  = "call":.      
+000188c0: 2020 7265 7475 726e 2074 7261 6365 6675    return tracefu
+000188d0: 6e63 0a0a 2020 2020 7374 6163 6b20 3d20  nc..    stack = 
+000188e0: 6c65 6e28 696e 7370 6563 742e 7374 6163  len(inspect.stac
+000188f0: 6b28 2929 202d 2031 390a 2020 2020 7374  k()) - 19.    st
+00018900: 6163 6b20 2a3d 2032 0a20 2020 2066 696c  ack *= 2.    fil
+00018910: 656e 616d 6520 3d20 6672 616d 652e 665f  ename = frame.f_
+00018920: 636f 6465 2e63 6f5f 6669 6c65 6e61 6d65  code.co_filename
+00018930: 0a20 2020 206c 696e 656e 6f20 3d20 6672  .    lineno = fr
+00018940: 616d 652e 665f 6c69 6e65 6e6f 0a20 2020  ame.f_lineno.   
+00018950: 2066 756e 635f 7369 675f 6c69 6e65 6e6f   func_sig_lineno
+00018960: 203d 206c 696e 656e 6f20 2d20 310a 2020   = lineno - 1.  
+00018970: 2020 6675 6e63 6e61 6d65 203d 2062 6c61    funcname = bla
+00018980: 636b 5f73 6f75 7263 655f 6c69 6e65 735b  ck_source_lines[
+00018990: 6675 6e63 5f73 6967 5f6c 696e 656e 6f5d  func_sig_lineno]
+000189a0: 2e73 7472 6970 2829 0a20 2020 2077 6869  .strip().    whi
+000189b0: 6c65 2066 756e 636e 616d 652e 7374 6172  le funcname.star
+000189c0: 7473 7769 7468 2822 4022 293a 0a20 2020  tswith("@"):.   
+000189d0: 2020 2020 2066 756e 635f 7369 675f 6c69       func_sig_li
+000189e0: 6e65 6e6f 202b 3d20 310a 2020 2020 2020  neno += 1.      
+000189f0: 2020 6675 6e63 6e61 6d65 203d 2062 6c61    funcname = bla
+00018a00: 636b 5f73 6f75 7263 655f 6c69 6e65 735b  ck_source_lines[
+00018a10: 6675 6e63 5f73 6967 5f6c 696e 656e 6f5d  func_sig_lineno]
+00018a20: 2e73 7472 6970 2829 0a20 2020 2069 6620  .strip().    if 
+00018a30: 2262 6c61 636b 2f5f 5f69 6e69 745f 5f2e  "black/__init__.
+00018a40: 7079 2220 696e 2066 696c 656e 616d 653a  py" in filename:
+00018a50: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+00018a60: 227b 2720 2720 2a20 7374 6163 6b7d 7b6c  "{' ' * stack}{l
+00018a70: 696e 656e 6f7d 3a7b 6675 6e63 6e61 6d65  ineno}:{funcname
+00018a80: 7d22 290a 2020 2020 7265 7475 726e 2074  }").    return t
+00018a90: 7261 6365 6675 6e63 0a                   racefunc.
```

### Comparing `black-23.3.0/tests/test_blackd.py` & `black-23.7.0/tests/test_blackd.py`

 * *Files 2% similar despite different names*

```diff
@@ -110,15 +110,15 @@
         )
         self.assertEqual(response.status, 200)
         self.assertEqual(await response.text(), expected)
 
     @unittest_run_loop
     async def test_blackd_diff(self) -> None:
         diff_header = re.compile(
-            r"(In|Out)\t\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d\.\d\d\d\d\d\d \+\d\d\d\d"
+            r"(In|Out)\t\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d\.\d\d\d\d\d\d\+\d\d:\d\d"
         )
 
         source, _ = read_data("miscellaneous", "blackd_diff")
         expected, _ = read_data("miscellaneous", "blackd_diff.diff")
 
         response = await self.client.post(
             "/", data=source, headers={blackd.DIFF_HEADER: "true"}
```

### Comparing `black-23.3.0/tests/test_format.py` & `black-23.7.0/tests/test_format.py`

 * *Files 2% similar despite different names*

```diff
@@ -29,17 +29,18 @@
     assert_format(source, expected, mode, fast=False)
 
 
 @pytest.mark.filterwarnings("ignore:invalid escape sequence.*:DeprecationWarning")
 @pytest.mark.parametrize("filename", all_data_cases("simple_cases"))
 def test_simple_format(filename: str) -> None:
     magic_trailing_comma = filename != "skip_magic_trailing_comma"
-    check_file(
-        "simple_cases", filename, black.Mode(magic_trailing_comma=magic_trailing_comma)
+    mode = black.Mode(
+        magic_trailing_comma=magic_trailing_comma, is_pyi=filename.endswith("_pyi")
     )
+    check_file("simple_cases", filename, mode)
 
 
 @pytest.mark.parametrize("filename", all_data_cases("preview"))
 def test_preview_format(filename: str) -> None:
     check_file("preview", filename, black.Mode(preview=True))
 
 
@@ -130,14 +131,21 @@
 @pytest.mark.parametrize("filename", all_data_cases("py_311"))
 def test_python_311(filename: str) -> None:
     source, expected = read_data("py_311", filename)
     mode = black.Mode(target_versions={black.TargetVersion.PY311})
     assert_format(source, expected, mode, minimum_version=(3, 11))
 
 
+@pytest.mark.parametrize("filename", all_data_cases("py_312"))
+def test_python_312(filename: str) -> None:
+    source, expected = read_data("py_312", filename)
+    mode = black.Mode(target_versions={black.TargetVersion.PY312})
+    assert_format(source, expected, mode, minimum_version=(3, 12))
+
+
 @pytest.mark.parametrize("filename", all_data_cases("fast"))
 def test_fast_cases(filename: str) -> None:
     source, expected = read_data("fast", filename)
     assert_format(source, expected, fast=True)
 
 
 def test_python_2_hint() -> None:
```

### Comparing `black-23.3.0/tests/test_ipynb.py` & `black-23.7.0/tests/test_ipynb.py`

 * *Files 2% similar despite different names*

```diff
@@ -435,16 +435,15 @@
 def test_cache_isnt_written_if_no_jupyter_deps_single(
     monkeypatch: MonkeyPatch, tmp_path: pathlib.Path
 ) -> None:
     # Check that the cache isn't written to if Jupyter dependencies aren't installed.
     jupyter_dependencies_are_installed.cache_clear()
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     tmp_nb = tmp_path / "notebook.ipynb"
-    with open(nb) as src, open(tmp_nb, "w") as dst:
-        dst.write(src.read())
+    tmp_nb.write_bytes(nb.read_bytes())
     monkeypatch.setattr(
         "black.jupyter_dependencies_are_installed", lambda verbose, quiet: False
     )
     result = runner.invoke(
         main, [str(tmp_path / "notebook.ipynb"), f"--config={EMPTY_CONFIG}"]
     )
     assert "No Python files are present to be formatted. Nothing to do" in result.output
@@ -461,16 +460,15 @@
 def test_cache_isnt_written_if_no_jupyter_deps_dir(
     monkeypatch: MonkeyPatch, tmp_path: pathlib.Path
 ) -> None:
     # Check that the cache isn't written to if Jupyter dependencies aren't installed.
     jupyter_dependencies_are_installed.cache_clear()
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     tmp_nb = tmp_path / "notebook.ipynb"
-    with open(nb) as src, open(tmp_nb, "w") as dst:
-        dst.write(src.read())
+    tmp_nb.write_bytes(nb.read_bytes())
     monkeypatch.setattr(
         "black.files.jupyter_dependencies_are_installed", lambda verbose, quiet: False
     )
     result = runner.invoke(main, [str(tmp_path), f"--config={EMPTY_CONFIG}"])
     assert "No Python files are present to be formatted. Nothing to do" in result.output
     jupyter_dependencies_are_installed.cache_clear()
     monkeypatch.setattr(
@@ -479,16 +477,15 @@
     result = runner.invoke(main, [str(tmp_path), f"--config={EMPTY_CONFIG}"])
     assert "reformatted" in result.output
 
 
 def test_ipynb_flag(tmp_path: pathlib.Path) -> None:
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     tmp_nb = tmp_path / "notebook.a_file_extension_which_is_definitely_not_ipynb"
-    with open(nb) as src, open(tmp_nb, "w") as dst:
-        dst.write(src.read())
+    tmp_nb.write_bytes(nb.read_bytes())
     result = runner.invoke(
         main,
         [
             str(tmp_nb),
             "--diff",
             "--ipynb",
             f"--config={EMPTY_CONFIG}",
```

### Comparing `black-23.3.0/tests/test_no_ipynb.py` & `black-23.7.0/tests/test_no_ipynb.py`

 * *Files 16% similar despite different names*

```diff
@@ -23,15 +23,14 @@
 
 
 def test_ipynb_diff_with_no_change_dir(tmp_path: pathlib.Path) -> None:
     jupyter_dependencies_are_installed.cache_clear()
     runner = CliRunner()
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     tmp_nb = tmp_path / "notebook.ipynb"
-    with open(nb) as src, open(tmp_nb, "w") as dst:
-        dst.write(src.read())
+    tmp_nb.write_bytes(nb.read_bytes())
     result = runner.invoke(main, [str(tmp_path)])
     expected_output = (
         "Skipping .ipynb files as Jupyter dependencies are not installed.\n"
         'You can fix this by running ``pip install "black[jupyter]"``\n'
     )
     assert expected_output in result.output
```

### Comparing `black-23.3.0/tests/test_trans.py` & `black-23.7.0/tests/test_trans.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/util.py` & `black-23.7.0/tests/util.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/conditional_expression.py` & `black-23.7.0/tests/data/conditional_expression.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb` & `black-23.7.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb` & `black-23.7.0/tests/data/jupyter/notebook_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/jupyter/notebook_without_changes.ipynb` & `black-23.7.0/tests/data/jupyter/notebook_without_changes.ipynb`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/debug_visitor.out` & `black-23.7.0/tests/data/miscellaneous/debug_visitor.out`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/debug_visitor.py` & `black-23.7.0/tests/data/miscellaneous/debug_visitor.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/decorators.py` & `black-23.7.0/tests/data/miscellaneous/decorators.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/docstring_no_string_normalization.py` & `black-23.7.0/tests/data/miscellaneous/docstring_no_string_normalization.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff` & `black-23.7.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/force_py36.py` & `black-23.7.0/tests/data/miscellaneous/force_py36.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/force_pyi.py` & `black-23.7.0/tests/data/miscellaneous/force_pyi.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/long_strings_flag_disabled.py` & `black-23.7.0/tests/data/miscellaneous/long_strings_flag_disabled.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/python2_detection.py` & `black-23.7.0/tests/data/miscellaneous/python2_detection.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/string_quotes.py` & `black-23.7.0/tests/data/miscellaneous/string_quotes.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/miscellaneous/stub.pyi` & `black-23.7.0/tests/data/miscellaneous/stub.pyi`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/cantfit.py` & `black-23.7.0/tests/data/preview/cantfit.py`

 * *Files 2% similar despite different names*

```diff
@@ -75,22 +75,18 @@
 normal_name = (
     but_the_function_name_is_now_ridiculously_long_and_it_is_still_super_annoying(
         [1, 2, 3], arg1, [1, 2, 3], arg2, [1, 2, 3], arg3
     )
 )
 # long arguments
 normal_name = normal_function_name(
-    (
-        "but with super long string arguments that on their own exceed the line limit"
-        " so there's no way it can ever fit"
-    ),
-    (
-        "eggs with spam and eggs and spam with eggs with spam and eggs and spam with"
-        " eggs with spam and eggs and spam with eggs"
-    ),
+    "but with super long string arguments that on their own exceed the line limit so"
+    " there's no way it can ever fit",
+    "eggs with spam and eggs and spam with eggs with spam and eggs and spam with eggs"
+    " with spam and eggs and spam with eggs",
     this_is_a_ridiculously_long_name_and_nobody_in_their_right_mind_would_use_one_like_it=0,
 )
 string_variable_name = "a string that is waaaaaaaayyyyyyyy too long, even in parens, there's nothing you can do"  # noqa
 for key in """
     hostname
     port
     username
```

### Comparing `black-23.3.0/tests/data/preview/comments7.py` & `black-23.7.0/tests/data/preview/comments7.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/format_unicode_escape_seq.py` & `black-23.7.0/tests/data/preview/format_unicode_escape_seq.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/long_dict_values.py` & `black-23.7.0/tests/data/preview/long_dict_values.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/long_strings.py` & `black-23.7.0/tests/data/preview/long_strings.py`

 * *Files 0% similar despite different names*

```diff
@@ -319,18 +319,16 @@
     " on one line. In fact it may even take up three or more lines... like four or"
     " five... but probably just three."
 )
 
 y = "Short string"
 
 print(
-    (
-        "This is a really long string inside of a print statement with extra arguments"
-        " attached at the end of it."
-    ),
+    "This is a really long string inside of a print statement with extra arguments"
+    " attached at the end of it.",
     x,
     y,
     z,
 )
 
 print(
     "This is a really long string inside of a print statement with no extra arguments"
@@ -497,23 +495,21 @@
 bad_split3 = (
     "What if we have inline comments on "  # First Comment
     "each line of a bad split? In that "  # Second Comment
     "case, we should just leave it alone."  # Third Comment
 )
 
 bad_split_func1(
-    (
-        "But what should happen when code has already "
-        "been formatted but in the wrong way? Like "
-        "with a space at the end instead of the "
-        "beginning. Or what about when it is split too "
-        "soon? In the case of a split that is too "
-        "short, black will try to honer the custom "
-        "split."
-    ),
+    "But what should happen when code has already "
+    "been formatted but in the wrong way? Like "
+    "with a space at the end instead of the "
+    "beginning. Or what about when it is split too "
+    "soon? In the case of a split that is too "
+    "short, black will try to honer the custom "
+    "split.",
     xxx,
     yyy,
     zzz,
 )
 
 bad_split_func2(
     xxx,
@@ -608,19 +604,17 @@
 
 comment_string = (  # This comment gets thrown to the top.
     "Long lines with inline comments should have their comments appended to the"
     " reformatted string's enclosing right parentheses."
 )
 
 arg_comment_string = print(
-    (  # This comment gets thrown to the top.
-        "Long lines with inline comments which are apart of (and not the only member"
-        " of) an argument list should have their comments appended to the reformatted"
-        " string's enclosing left parentheses."
-    ),
+    "Long lines with inline comments which are apart of (and not the only member of) an"
+    " argument list should have their comments appended to the reformatted string's"
+    " enclosing left parentheses.",  # This comment gets thrown to the top.
     "Arg #2",
     "Arg #3",
     "Arg #4",
     "Arg #5",
 )
 
 pragma_comment_string1 = "Lines which end with an inline pragma comment of the form `# <pragma>: <...>` should be left alone."  # noqa: E501
@@ -672,39 +666,31 @@
 
 return (
     "A really really really really really really really really really really really"
     " really really long {} {}".format("return", "value")
 )
 
 func_with_bad_comma(
-    (
-        "This is a really long string argument to a function that has a trailing comma"
-        " which should NOT be there."
-    ),
+    "This is a really long string argument to a function that has a trailing comma"
+    " which should NOT be there.",
 )
 
 func_with_bad_comma(
-    (  # comment after comma
-        "This is a really long string argument to a function that has a trailing comma"
-        " which should NOT be there."
-    ),
+    "This is a really long string argument to a function that has a trailing comma"
+    " which should NOT be there.",  # comment after comma
 )
 
 func_with_bad_comma(
-    (
-        "This is a really long string argument to a function that has a trailing comma"
-        " which should NOT be there."
-    ),
+    "This is a really long string argument to a function that has a trailing comma"
+    " which should NOT be there.",
 )
 
 func_with_bad_comma(
-    (  # comment after comma
-        "This is a really long string argument to a function that has a trailing comma"
-        " which should NOT be there."
-    ),
+    "This is a really long string argument to a function that has a trailing comma"
+    " which should NOT be there.",  # comment after comma
 )
 
 func_with_bad_parens_that_wont_fit_in_one_line(
     "short string that should have parens stripped", x, y, z
 )
 
 func_with_bad_parens_that_wont_fit_in_one_line(
```

### Comparing `black-23.3.0/tests/data/preview/long_strings__east_asian_width.py` & `black-23.7.0/tests/data/preview/long_strings__east_asian_width.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/long_strings__edge_case.py` & `black-23.7.0/tests/data/preview/long_strings__edge_case.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/long_strings__regression.py` & `black-23.7.0/tests/data/preview/long_strings__regression.py`

 * *Files 0% similar despite different names*

```diff
@@ -711,32 +711,28 @@
             )
 
 
 class A:
     def foo():
         some_func_call(
             "xxxxxxxxxx",
-            (
-                "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
-                '"xxxx xxxxxxx xxxxxx xxxx; xxxx xxxxxx_xxxxx xxxxxx xxxx; '
-                "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" "
-            ),
+            "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
+            '"xxxx xxxxxxx xxxxxx xxxx; xxxx xxxxxx_xxxxx xxxxxx xxxx; '
+            "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" ",
             None,
             ("xxxxxxxxxxx",),
         ),
 
 
 class A:
     def foo():
         some_func_call(
-            (
-                "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
-                "xxxx, ('xxxxxxx xxxxxx xxxx, xxxx') xxxxxx_xxxxx xxxxxx xxxx; "
-                "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" "
-            ),
+            "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
+            "xxxx, ('xxxxxxx xxxxxx xxxx, xxxx') xxxxxx_xxxxx xxxxxx xxxx; "
+            "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" ",
             None,
             ("xxxxxxxxxxx",),
         ),
 
 
 xxxxxxx = {
     "xx": (
@@ -846,18 +842,16 @@
 some_commented_string = (
     "This string is long but not so long that it needs hahahah toooooo be so greatttt"  # But these
     " {} that I just can't think of any more good words to say about it at"  # comments will stay
     " allllllllllll".format("ha")  # comments here are fine
 )
 
 lpar_and_rpar_have_comments = func_call(  # LPAR Comment
-    (  # Comma Comment
-        "Long really ridiculous type of string that shouldn't really even exist at all."
-        " I mean commmme onnn!!!"
-    ),
+    "Long really ridiculous type of string that shouldn't really even exist at all. I"
+    " mean commmme onnn!!!",  # Comma Comment
 )  # RPAR Comment
 
 cmd_fstring = (
     "sudo -E deluge-console info --detailed --sort-reverse=time_added "
     f"{'' if ID is None else ID} | perl -nE 'print if /^{field}:/'"
 )
```

### Comparing `black-23.3.0/tests/data/preview/long_strings__type_annotations.py` & `black-23.7.0/tests/data/preview/long_strings__type_annotations.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/multiline_strings.py` & `black-23.7.0/tests/data/preview/multiline_strings.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/prefer_rhs_split.py` & `black-23.7.0/tests/data/preview/prefer_rhs_split.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview/trailing_comma.py` & `black-23.7.0/tests/data/preview/trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/targeting_py38.py` & `black-23.7.0/tests/data/preview_context_managers/targeting_py38.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/targeting_py39.py` & `black-23.7.0/tests/data/preview_context_managers/targeting_py39.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_10.py` & `black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_10.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_11.py` & `black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_11.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_8.py` & `black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_8.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_9.py` & `black-23.7.0/tests/data/preview_context_managers/auto_detect/features_3_9.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/parenthesized_context_managers.py` & `black-23.7.0/tests/data/py_310/parenthesized_context_managers.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/pattern_matching_complex.py` & `black-23.7.0/tests/data/py_310/pattern_matching_complex.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/pattern_matching_extras.py` & `black-23.7.0/tests/data/py_310/pattern_matching_extras.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/pattern_matching_generic.py` & `black-23.7.0/tests/data/py_310/pattern_matching_generic.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/pattern_matching_simple.py` & `black-23.7.0/tests/data/py_310/pattern_matching_simple.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_310/pattern_matching_style.py` & `black-23.7.0/tests/data/py_310/pattern_matching_style.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_311/pep_646.py` & `black-23.7.0/tests/data/py_311/pep_646.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_311/pep_654.py` & `black-23.7.0/tests/data/py_311/pep_654.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_311/pep_654_style.py` & `black-23.7.0/tests/data/py_311/pep_654_style.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_36/numeric_literals.py` & `black-23.7.0/tests/data/py_36/numeric_literals.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_37/python37.py` & `black-23.7.0/tests/data/py_37/python37.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_38/pep_570.py` & `black-23.7.0/tests/data/py_38/pep_570.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_38/pep_572.py` & `black-23.7.0/tests/data/py_38/pep_572.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_38/pep_572_remove_parens.py` & `black-23.7.0/tests/data/py_38/pep_572_remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_38/python38.py` & `black-23.7.0/tests/data/py_38/python38.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_39/python39.py` & `black-23.7.0/tests/data/py_39/python39.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/py_39/remove_with_brackets.py` & `black-23.7.0/tests/data/py_39/remove_with_brackets.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/attribute_access_on_number_literals.py` & `black-23.7.0/tests/data/simple_cases/attribute_access_on_number_literals.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/class_blank_parentheses.py` & `black-23.7.0/tests/data/simple_cases/class_blank_parentheses.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/class_methods_new_line.py` & `black-23.7.0/tests/data/simple_cases/class_methods_new_line.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/collections.py` & `black-23.7.0/tests/data/simple_cases/collections.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments.py` & `black-23.7.0/tests/data/simple_cases/comments.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments2.py` & `black-23.7.0/tests/data/simple_cases/comments2.py`

 * *Files 8% similar despite different names*

```diff
@@ -150,14 +150,17 @@
 
 class Test:
     def _init_host(self, parsed) -> None:
         if (parsed.hostname is None or  # type: ignore
                 not parsed.hostname.strip()):
             pass
 
+
+a = "type comment with trailing space"  # type: str   
+
 #######################
 ### SECTION COMMENT ###
 #######################
 
 
 instruction()#comment with bad spacing
 
@@ -328,14 +331,16 @@
 
 class Test:
     def _init_host(self, parsed) -> None:
         if parsed.hostname is None or not parsed.hostname.strip():  # type: ignore
             pass
 
 
+a = "type comment with trailing space"  # type: str
+
 #######################
 ### SECTION COMMENT ###
 #######################
 
 
 instruction()  # comment with bad spacing
```

### Comparing `black-23.3.0/tests/data/simple_cases/comments3.py` & `black-23.7.0/tests/data/simple_cases/comments3.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments4.py` & `black-23.7.0/tests/data/simple_cases/comments4.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments5.py` & `black-23.7.0/tests/data/simple_cases/comments5.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments6.py` & `black-23.7.0/tests/data/simple_cases/comments6.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments9.py` & `black-23.7.0/tests/data/simple_cases/comments9.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/comments_non_breaking_space.py` & `black-23.7.0/tests/data/simple_cases/comments_non_breaking_space.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/composition.py` & `black-23.7.0/tests/data/simple_cases/composition.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/composition_no_trailing_comma.py` & `black-23.7.0/tests/data/simple_cases/composition_no_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/docstring.py` & `black-23.7.0/tests/data/simple_cases/docstring.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/docstring_preview.py` & `black-23.7.0/tests/data/simple_cases/docstring_preview.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/empty_lines.py` & `black-23.7.0/tests/data/simple_cases/empty_lines.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/expression.diff` & `black-23.7.0/tests/data/simple_cases/expression.diff`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/expression.py` & `black-23.7.0/tests/data/simple_cases/expression.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/fmtonoff.py` & `black-23.7.0/tests/data/simple_cases/fmtonoff.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/fmtonoff2.py` & `black-23.7.0/tests/data/simple_cases/fmtonoff2.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/fmtonoff5.py` & `black-23.7.0/tests/data/simple_cases/fmtonoff5.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/fmtskip2.py` & `black-23.7.0/tests/data/simple_cases/fmtskip2.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/fmtskip8.py` & `black-23.7.0/tests/data/simple_cases/fmtskip8.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/function.py` & `black-23.7.0/tests/data/simple_cases/function.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/function2.py` & `black-23.7.0/tests/data/simple_cases/function2.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/function_trailing_comma.py` & `black-23.7.0/tests/data/simple_cases/function_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/import_spacing.py` & `black-23.7.0/tests/data/simple_cases/import_spacing.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/one_element_subscript.py` & `black-23.7.0/tests/data/simple_cases/one_element_subscript.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/power_op_spacing.py` & `black-23.7.0/tests/data/simple_cases/power_op_spacing.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/prefer_rhs_split_reformatted.py` & `black-23.7.0/tests/data/simple_cases/prefer_rhs_split_reformatted.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/remove_await_parens.py` & `black-23.7.0/tests/data/simple_cases/remove_await_parens.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/remove_except_parens.py` & `black-23.7.0/tests/data/simple_cases/remove_except_parens.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/remove_for_brackets.py` & `black-23.7.0/tests/data/simple_cases/remove_for_brackets.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/remove_newline_after_code_block_open.py` & `black-23.7.0/tests/data/simple_cases/remove_newline_after_code_block_open.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/remove_parens.py` & `black-23.7.0/tests/data/simple_cases/remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/return_annotation_brackets.py` & `black-23.7.0/tests/data/simple_cases/return_annotation_brackets.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/skip_magic_trailing_comma.py` & `black-23.7.0/tests/data/simple_cases/skip_magic_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/slices.py` & `black-23.7.0/tests/data/simple_cases/slices.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/string_prefixes.py` & `black-23.7.0/tests/data/simple_cases/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/torture.py` & `black-23.7.0/tests/data/simple_cases/torture.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens1.py` & `black-23.7.0/tests/data/simple_cases/trailing_comma_optional_parens1.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens3.py` & `black-23.7.0/tests/data/simple_cases/trailing_comma_optional_parens3.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/tests/data/simple_cases/trailing_commas_in_leading_parts.py` & `black-23.7.0/tests/data/simple_cases/trailing_commas_in_leading_parts.py`

 * *Files identical despite different names*

### Comparing `black-23.3.0/AUTHORS.md` & `black-23.7.0/AUTHORS.md`

 * *Files identical despite different names*

### Comparing `black-23.3.0/LICENSE` & `black-23.7.0/LICENSE`

 * *Files identical despite different names*

### Comparing `black-23.3.0/pyproject.toml` & `black-23.7.0/pyproject.toml`

 * *Files 5% similar despite different names*

```diff
@@ -29,15 +29,15 @@
 requires = ["hatchling>=1.8.0", "hatch-vcs", "hatch-fancy-pypi-readme"]
 build-backend = "hatchling.build"
 
 [project]
 name = "black"
 description = "The uncompromising code formatter."
 license = { text = "MIT" }
-requires-python = ">=3.7"
+requires-python = ">=3.8"
 authors = [
   { name = "ukasz Langa", email = "lukasz@langa.pl" },
 ]
 keywords = [
   "automation",
   "autopep8",
   "formatter",
@@ -65,15 +65,14 @@
 dependencies = [
   "click>=8.0.0",
   "mypy_extensions>=0.4.3",
   "packaging>=22.0",
   "pathspec>=0.9.0",
   "platformdirs>=2",
   "tomli>=1.1.0; python_version < '3.11'",
-  "typed-ast>=1.4.2; python_version < '3.8' and implementation_name == 'cpython'",
   "typing_extensions>=3.10.0.0; python_version < '3.10'",
 ]
 dynamic = ["readme", "version"]
 
 [project.optional-dependencies]
 colorama = ["colorama>=0.4.3"]
 uvloop = ["uvloop>=0.15.2"]
@@ -115,18 +114,17 @@
 [tool.hatch.build.targets.wheel]
 only-include = ["src"]
 sources = ["src"]
 
 [tool.hatch.build.targets.wheel.hooks.mypyc]
 enable-by-default = false
 dependencies = [
-  "hatch-mypyc>=0.13.0",
-  "mypy==0.991",
-  # Required stubs to be removed when the packages support PEP 561 themselves
-  "types-typed-ast>=1.4.2",
+  "hatch-mypyc>=0.16.0",
+  "mypy==1.3",
+  "click==8.1.3",  # avoid https://github.com/pallets/click/issues/2558
 ]
 require-runtime-dependencies = true
 exclude = [
   # There's no good reason for blackd to be compiled.
   "/src/blackd",
   # Not performance sensitive, so save bytes + compilation time:
   "/src/blib2to3/__init__.py",
@@ -141,15 +139,15 @@
   "/src/black/__main__.py",
 ]
 options = { debug_level = "0" }
 
 [tool.cibuildwheel]
 build-verbosity = 1
 # So these are the environments we target:
-# - Python: CPython 3.7+ only
+# - Python: CPython 3.8+ only
 # - Architecture (64-bit only): amd64 / x86_64, universal2, and arm64
 # - OS: Linux (no musl), Windows, and macOS
 build = "cp3*-*"
 skip = ["*-manylinux_i686", "*-musllinux_*", "*-win32", "pp-*"]
 # This is the bare minimum needed to run the test suite. Pulling in the full
 # test_requirements.txt would download a bunch of other packages not necessary
 # here and would slow down the testing step a fair bit.
@@ -204,14 +202,13 @@
     "error",
     # this is mitigated by a try/catch in https://github.com/psf/black/pull/2974/
     # this ignore can be removed when support for aiohttp 3.7 is dropped.
     '''ignore:Decorator `@unittest_run_loop` is no longer needed in aiohttp 3\.8\+:DeprecationWarning''',
     # this is mitigated by a try/catch in https://github.com/psf/black/pull/3198/
     # this ignore can be removed when support for aiohttp 3.x is dropped.
     '''ignore:Middleware decorator is deprecated since 4\.0 and its behaviour is default, you can simply remove this decorator:DeprecationWarning''',
-    # this is mitigated by https://github.com/python/cpython/issues/79071 in python 3.8+
-    # this ignore can be removed when support for 3.7 is dropped.
-    '''ignore:Bare functions are deprecated, use async ones:DeprecationWarning''',
     # aiohttp is using deprecated cgi modules - Safe to remove when fixed:
     # https://github.com/aio-libs/aiohttp/issues/6905
     '''ignore:'cgi' is deprecated and slated for removal in Python 3.13:DeprecationWarning''',
+    # Work around https://github.com/pytest-dev/pytest/issues/10977 for Python 3.12
+    '''ignore:(Attribute s|Attribute n|ast.Str|ast.Bytes|ast.NameConstant|ast.Num) is deprecated and will be removed in Python 3.14:DeprecationWarning'''
 ]
```

### Comparing `black-23.3.0/PKG-INFO` & `black-23.7.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: black
-Version: 23.3.0
+Version: 23.7.0
 Summary: The uncompromising code formatter.
 Project-URL: Changelog, https://github.com/psf/black/blob/main/CHANGES.md
 Project-URL: Homepage, https://github.com/psf/black
 Author-email: ukasz Langa <lukasz@langa.pl>
 License: MIT
 License-File: AUTHORS.md
 License-File: LICENSE
@@ -19,22 +19,21 @@
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Classifier: Topic :: Software Development :: Quality Assurance
-Requires-Python: >=3.7
+Requires-Python: >=3.8
 Requires-Dist: click>=8.0.0
 Requires-Dist: mypy-extensions>=0.4.3
 Requires-Dist: packaging>=22.0
 Requires-Dist: pathspec>=0.9.0
 Requires-Dist: platformdirs>=2
 Requires-Dist: tomli>=1.1.0; python_version < '3.11'
-Requires-Dist: typed-ast>=1.4.2; python_version < '3.8' and implementation_name == 'cpython'
 Requires-Dist: typing-extensions>=3.10.0.0; python_version < '3.10'
 Provides-Extra: colorama
 Requires-Dist: colorama>=0.4.3; extra == 'colorama'
 Provides-Extra: d
 Requires-Dist: aiohttp>=3.7.4; extra == 'd'
 Provides-Extra: jupyter
 Requires-Dist: ipython>=7.8.0; extra == 'jupyter'
@@ -318,14 +317,86 @@
 <!-- For example, Docker, GitHub Actions, pre-commit, editors -->
 
 ### Documentation
 
 <!-- Major changes to documentation and policies. Small docs changes
      don't need a changelog entry. -->
 
+## 23.7.0
+
+### Highlights
+
+- Runtime support for Python 3.7 has been removed. Formatting 3.7 code will still be
+  supported until further notice (#3765)
+
+### Stable style
+
+- Fix a bug where an illegal trailing comma was added to return type annotations using
+  PEP 604 unions (#3735)
+- Fix several bugs and crashes where comments in stub files were removed or mishandled
+  under some circumstances (#3745)
+- Fix a crash with multi-line magic comments like `type: ignore` within parentheses
+  (#3740)
+- Fix error in AST validation when _Black_ removes trailing whitespace in a type comment
+  (#3773)
+
+### Preview style
+
+- Implicitly concatenated strings used as function args are no longer wrapped inside
+  parentheses (#3640)
+- Remove blank lines between a class definition and its docstring (#3692)
+
+### Configuration
+
+- The `--workers` argument to _Black_ can now be specified via the `BLACK_NUM_WORKERS`
+  environment variable (#3743)
+- `.pytest_cache`, `.ruff_cache` and `.vscode` are now excluded by default (#3691)
+- Fix _Black_ not honouring `pyproject.toml` settings when running `--stdin-filename`
+  and the `pyproject.toml` found isn't in the current working directory (#3719)
+- _Black_ will now error if `exclude` and `extend-exclude` have invalid data types in
+  `pyproject.toml`, instead of silently doing the wrong thing (#3764)
+
+### Packaging
+
+- Upgrade mypyc from 0.991 to 1.3 (#3697)
+- Remove patching of Click that mitigated errors on Python 3.6 with `LANG=C` (#3768)
+
+### Parser
+
+- Add support for the new PEP 695 syntax in Python 3.12 (#3703)
+
+### Performance
+
+- Speed up _Black_ significantly when the cache is full (#3751)
+- Avoid importing `IPython` in a case where we wouldn't need it (#3748)
+
+### Output
+
+- Use aware UTC datetimes internally, avoids deprecation warning on Python 3.12 (#3728)
+- Change verbose logging to exactly mirror _Black_'s logic for source discovery (#3749)
+
+### _Blackd_
+
+- The `blackd` argument parser now shows the default values for options in their help
+  text (#3712)
+
+### Integrations
+
+- Black is now tested with
+  [`PYTHONWARNDEFAULTENCODING = 1`](https://docs.python.org/3/library/io.html#io-encoding-warning)
+  (#3763)
+- Update GitHub Action to display black output in the job summary (#3688)
+
+### Documentation
+
+- Add a CITATION.cff file to the root of the repository, containing metadata on how to
+  cite this software (#3723)
+- Update the _classes_ and _exceptions_ documentation in Developer reference to match
+  the latest code base (#3755)
+
 ## 23.3.0
 
 ### Highlights
 
 This release fixes a longstanding confusing behavior in Black's GitHub action, where the
 version of the action did not determine the version of Black being run (issue #3382). In
 addition, there is a small bug fix around imports and a number of improvements to the
```

#### html2text {}

```diff
@@ -1,30 +1,29 @@
-Metadata-Version: 2.1 Name: black Version: 23.3.0 Summary: The uncompromising
+Metadata-Version: 2.1 Name: black Version: 23.7.0 Summary: The uncompromising
 code formatter. Project-URL: Changelog, https://github.com/psf/black/blob/main/
 CHANGES.md Project-URL: Homepage, https://github.com/psf/black Author-email:
 ukasz Langa
 langa.pl> License: MIT License-File: AUTHORS.md License-File: LICENSE Keywords:
 automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf Classifier: Development
 Status :: 5 - Production/Stable Classifier: Environment :: Console Classifier:
 Intended Audience :: Developers Classifier: License :: OSI Approved :: MIT
 License Classifier: Operating System :: OS Independent Classifier: Programming
 Language :: Python Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Programming Language :: Python :: 3.7 Classifier: Programming
 Language :: Python :: 3.8 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10 Classifier: Programming
 Language :: Python :: 3.11 Classifier: Topic :: Software Development ::
 Libraries :: Python Modules Classifier: Topic :: Software Development ::
-Quality Assurance Requires-Python: >=3.7 Requires-Dist: click>=8.0.0 Requires-
+Quality Assurance Requires-Python: >=3.8 Requires-Dist: click>=8.0.0 Requires-
 Dist: mypy-extensions>=0.4.3 Requires-Dist: packaging>=22.0 Requires-Dist:
 pathspec>=0.9.0 Requires-Dist: platformdirs>=2 Requires-Dist: tomli>=1.1.0;
-python_version < '3.11' Requires-Dist: typed-ast>=1.4.2; python_version < '3.8'
-and implementation_name == 'cpython' Requires-Dist: typing-
-extensions>=3.10.0.0; python_version < '3.10' Provides-Extra: colorama
-Requires-Dist: colorama>=0.4.3; extra == 'colorama' Provides-Extra: d Requires-
-Dist: aiohttp>=3.7.4; extra == 'd' Provides-Extra: jupyter Requires-Dist:
+python_version < '3.11' Requires-Dist: typing-extensions>=3.10.0.0;
+python_version < '3.10' Provides-Extra: colorama Requires-Dist:
+colorama>=0.4.3; extra == 'colorama' Provides-Extra: d Requires-Dist:
+aiohttp>=3.7.4; extra == 'd' Provides-Extra: jupyter Requires-Dist:
 ipython>=7.8.0; extra == 'jupyter' Requires-Dist: tokenize-rt>=3.2.0; extra ==
 'jupyter' Provides-Extra: uvloop Requires-Dist: uvloop>=0.15.2; extra ==
 'uvloop' Description-Content-Type: text/markdown [![Black Logo](https://
 raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)](https:
 //black.readthedocs.io/en/stable/)
                  ***** The Uncompromising Code Formatter *****
 [Actions_Status] [Documentation_Status] [Coverage_Status] [License:_MIT] [PyPI]
@@ -139,31 +138,63 @@
 generally to follow the guidelines articulated in the [Python Community Code of
 Conduct](https://www.python.org/psf/codeofconduct/). At the same time, humor is
 encouraged. In fact, basic familiarity with Monty Python's Flying Circus is
 expected. We are not savages. And if you _really_ need to slap somebody, do it
 with a fish while dancing. # Change Log ## Unreleased ### Highlights  ###
 Stable style  ### Preview style  ### Configuration  ### Packaging  ### Parser
 ### Performance  ### Output  ### _Blackd_  ### Integrations  ### Documentation
-## 23.3.0 ### Highlights This release fixes a longstanding confusing behavior
-in Black's GitHub action, where the version of the action did not determine the
-version of Black being run (issue #3382). In addition, there is a small bug fix
-around imports and a number of improvements to the preview style. Please try
-out the [preview style](https://black.readthedocs.io/en/stable/
-the_black_code_style/future_style.html#preview-style) with `black --preview`
-and tell us your feedback. All changes in the preview style are expected to
-become part of Black's stable style in January 2024. ### Stable style - Import
-lines with `# fmt: skip` and `# fmt: off` no longer have an extra blank line
-added when they are right after another import line (#3610) ### Preview style -
-Add trailing commas to collection literals even if there's a comment after the
-last entry (#3393) - `async def`, `async for`, and `async with` statements are
-now formatted consistently compared to their non-async version. (#3609) -
-`with` statements that contain two context managers will be consistently
-wrapped in parentheses (#3589) - Let string splitters respect [East Asian
-Width](https://www.unicode.org/reports/tr11/) (#3445) - Now long string
-literals can be split after East Asian commas and periods (`` U+3001
+## 23.7.0 ### Highlights - Runtime support for Python 3.7 has been removed.
+Formatting 3.7 code will still be supported until further notice (#3765) ###
+Stable style - Fix a bug where an illegal trailing comma was added to return
+type annotations using PEP 604 unions (#3735) - Fix several bugs and crashes
+where comments in stub files were removed or mishandled under some
+circumstances (#3745) - Fix a crash with multi-line magic comments like `type:
+ignore` within parentheses (#3740) - Fix error in AST validation when _Black_
+removes trailing whitespace in a type comment (#3773) ### Preview style -
+Implicitly concatenated strings used as function args are no longer wrapped
+inside parentheses (#3640) - Remove blank lines between a class definition and
+its docstring (#3692) ### Configuration - The `--workers` argument to _Black_
+can now be specified via the `BLACK_NUM_WORKERS` environment variable (#3743) -
+`.pytest_cache`, `.ruff_cache` and `.vscode` are now excluded by default
+(#3691) - Fix _Black_ not honouring `pyproject.toml` settings when running `--
+stdin-filename` and the `pyproject.toml` found isn't in the current working
+directory (#3719) - _Black_ will now error if `exclude` and `extend-exclude`
+have invalid data types in `pyproject.toml`, instead of silently doing the
+wrong thing (#3764) ### Packaging - Upgrade mypyc from 0.991 to 1.3 (#3697) -
+Remove patching of Click that mitigated errors on Python 3.6 with `LANG=C`
+(#3768) ### Parser - Add support for the new PEP 695 syntax in Python 3.12
+(#3703) ### Performance - Speed up _Black_ significantly when the cache is full
+(#3751) - Avoid importing `IPython` in a case where we wouldn't need it (#3748)
+### Output - Use aware UTC datetimes internally, avoids deprecation warning on
+Python 3.12 (#3728) - Change verbose logging to exactly mirror _Black_'s logic
+for source discovery (#3749) ### _Blackd_ - The `blackd` argument parser now
+shows the default values for options in their help text (#3712) ###
+Integrations - Black is now tested with [`PYTHONWARNDEFAULTENCODING = 1`]
+(https://docs.python.org/3/library/io.html#io-encoding-warning) (#3763) -
+Update GitHub Action to display black output in the job summary (#3688) ###
+Documentation - Add a CITATION.cff file to the root of the repository,
+containing metadata on how to cite this software (#3723) - Update the _classes_
+and _exceptions_ documentation in Developer reference to match the latest code
+base (#3755) ## 23.3.0 ### Highlights This release fixes a longstanding
+confusing behavior in Black's GitHub action, where the version of the action
+did not determine the version of Black being run (issue #3382). In addition,
+there is a small bug fix around imports and a number of improvements to the
+preview style. Please try out the [preview style](https://black.readthedocs.io/
+en/stable/the_black_code_style/future_style.html#preview-style) with `black --
+preview` and tell us your feedback. All changes in the preview style are
+expected to become part of Black's stable style in January 2024. ### Stable
+style - Import lines with `# fmt: skip` and `# fmt: off` no longer have an
+extra blank line added when they are right after another import line (#3610)
+### Preview style - Add trailing commas to collection literals even if there's
+a comment after the last entry (#3393) - `async def`, `async for`, and `async
+with` statements are now formatted consistently compared to their non-async
+version. (#3609) - `with` statements that contain two context managers will be
+consistently wrapped in parentheses (#3589) - Let string splitters respect
+[East Asian Width](https://www.unicode.org/reports/tr11/) (#3445) - Now long
+string literals can be split after East Asian commas and periods (`` U+3001
 IDEOGRAPHIC COMMA, `` U+3002 IDEOGRAPHIC FULL STOP, & `` U+FF0C FULLWIDTH
 COMMA) besides before spaces (#3445) - For stubs, enforce one blank line after
 a nested class with a body other than just `...` (#3564) - Improve handling of
 multiline strings by changing line split behavior (#1879) ### Parser - Added
 support for formatting files with invalid type comments (#3594) ###
 Integrations - Update GitHub Action to use the version of Black equivalent to
 action's version if version input is not specified (#3543) - Fix missing Python
```

